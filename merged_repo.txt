# Popraw NIGHTLY REPORT (23:00)
(Get-Content "C:\xau_rl\ops\daemon_nightly_report.ps1" -Raw) `
  -replace 'return\s+int\.TotalSeconds', 'return int.TotalSeconds' `
| Set-Content "C:\xau_rl\ops\daemon_nightly_report.ps1" -Encoding UTF8

# Popraw NIGHTLY TRAIN (00:30) – ma też zwrot TotalSeconds
(Get-Content "C:\xau_rl\ops\daemon_nightly_train.ps1" -Raw) `
  -replace 'return\s+int\.TotalSeconds', 'return int.TotalSeconds' `
| Set-Content "C:\xau_rl\ops\daemon_nightly_train.ps1" -Encoding UTF8

# Popraw FEATURE DISCOVERY (co 3 dni 21:00)
(Get-Content "C:\xau_rl\ops\daemon_feature_discovery.ps1" -Raw) `
  -replace 'return\s+int\.TotalSeconds', 'return int.TotalSeconds' `
| Set-Content "C:\xau_rl\ops\daemon_feature_discovery.ps1" -Encoding UTF8

# Popraw CALIBRATION (co 3 dni 22:00)
(Get-Content "C:\xau_rl\ops\daemon_calibration_biweekly.ps1" -Raw) `
  -replace 'return\s+int\.TotalSeconds', 'return int.TotalSeconds' `
| Set-Content "C:\xau_rl\ops\daemon_calibration_biweekly.ps1" -Encoding UTF8

# Popraw TE CALENDAR (05:00)
(Get-Content "C:\xau_rl\ops\daemon_te_calendar.ps1" -Raw) `
  -replace 'return\s+int\.TotalSeconds', 'return int.TotalSeconds' `
| Set-Content "C:\xau_rl\ops\daemon_te_calendar.ps1" -Encoding UTF8

# Na wszelki wypadek odblokuj skrypty (gdyby były oznaczone jako z internetu)
Get-ChildItem "C:\xau_rl\ops\daemon_*.ps1" | Unblock-File



# Restart dotkniętych usług
C:\nssm\nssm.exe stop  xau_nightly_report   2>$null
C:\nssm\nssm.exe start xau_nightly_report
C:\nssm\nssm.exe stop  xau_nightly_train    2>$null
C:\nssm\nssm.exe start xau_nightly_train
C:\nssm\nssm.exe stop  xau_feature_discovery 2>$null
C:\nssm\nssm.exe start xau_feature_discovery
C:\nssm\nssm.exe stop  xau_calibration      2>$null
C:\nssm\nssm.exe start xau_calibration
C:\nssm\nssm.exe stop  xau_te_calendar      2>$null
C:\nssm\nssm.exe start xau_te_calendar

# Status po restarcie
sc.exe query xau_nightly_report
sc.exe query xau_nightly_train
sc.exe query xau_feature_discovery
sc.exe query xau_calibration
sc.exe query xau_te_calendar

# Błędy zniknęły? (err log powinien być pusty po restarcie)
Get-Content "C:\xau_rl\logs\services\xau_nightly_report.err.log"    -Tail 30
Get-Content "C:\xau_rl\logs\services\xau_nightly_train.err.log"     -Tail 30
Get-Content "C:\xau_rl\logs\services\xau_feature_discovery.err.log" -Tail 30
Get-Content "C:\xau_rl\logs\services\xau_calibration.err.log"       -Tail 30
Get-Content "C:\xau_rl\logs\services\xau_te_calendar.err.log"       -Tail 30
