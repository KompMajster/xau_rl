

=== FILE: bootstrap_pack.ps1 ===

# bootstrap_pack.ps1
$ErrorActionPreference = "Stop"

# =========================================
# Root + katalogi
# =========================================
$Root = Split-Path -Parent $MyInvocation.MyCommand.Path
$dirs = @("", "data", "features", "rl", "paper_demo", "utils", "models", "models/registry", "reports", "ops", "logs")
foreach($d in $dirs){ New-Item -ItemType Directory -Force -Path (Join-Path $Root $d) | Out-Null }

function Write-UTF8($RelPath, $Content){
  $Path = Join-Path $Root $RelPath
  $dir = Split-Path -Parent $Path
  if(!(Test-Path $dir)){ New-Item -ItemType Directory -Force -Path $dir | Out-Null }
  $Content | Out-File -FilePath $Path -Encoding utf8 -Force
}

# =========================================
# README
# =========================================
Write-UTF8 "README.md" @'
# XAUUSD RL PPO (M5) – Starter (Demo/Edu)
**Uwaga**: tylko do celów edukacyjnych, backtestów i *paper tradingu* (demo). Brak kodu wysyłającego realne zlecenia.

## Szybki start
```powershell
python -m venv .venv
# .\.venv\Scripts\Activate.ps1
pip install -r requirements.txt
# Na końcu zainstaluj TORCH odpowiedni dla CPU/GPU z pytorch.org (wheel).
python fetch__mt5_data.py
python utils\calibration.py
python utils\calibration.py --apply
python features\build_features.py
python rl\train_ppo.py --timesteps 1500000
python rl\evaluate.py --out_dir reports
python utils\make_report.py

24/7 na Windows
Użyj skryptów w ops\ oraz NSSM (patrz ops\install_services.ps1).
Dane i historia
Trzymamy 720 dni historii świec. Zbieracz działa inkrementalnie: dociąga ostatnie update_days (domyślnie 60), scala z istniejacym CSV i przycina do 720 dni. Zapisy CSV są atomowe.
'@
# =========================================
# requirements.txt
# =========================================
Write-UTF8 "requirements.txt" @'
pandas>=2.0
numpy>=1.24
pytz
PyYAML
joblib
matplotlib
tensorboard
MetaTrader5
gymnasium>=0.29
stable-baselines3>=2.2.1
torch: zainstaluj odpowiedni wheel (CPU/GPU) z pytorch.org
'@
# =========================================
# config.yaml
# =========================================
Write-UTF8 "config.yaml" @'
symbol: "XAUUSD"
timeframe: "M5"
history_days: 720  # wymagane okno historii
window: 128
mt5:
bars_chunk: 20000   # ile świec pobierać jednorazowo przy "from_pos" (~70-90 dni M5)
# update_days: 60     # inkrementalny zakres odświeżania (do scalenia z istniejacym CSV)
files:
bars_csv: "data/XAUUSD_M5.csv"
ticks_csv: "data/XAUUSD_ticks_sample.csv"
features_csv: "data/XAUUSD_M5_features.csv"
model_path: "models/ppo_xauusd_m5.zip"
vecnorm_path: "models/vecnorm_xauusd_m5.pkl"
costs:
spread_abs: 0.05
commission_rate: 0.0001
slippage_k: 0.10
env:
reward_mode: "pct"
flip_penalty: 0.002
trade_hours_utc: ["06:00", "20:00"]
enforce_flat_outside_hours: true
min_equity: 0.8
'@
# =========================================
# utils/atomic.py
# =========================================
Write-UTF8 "utils/atomic.py" @'
from pathlib import Path
def atomic_write_csv(df, path: str):
p = Path(path)
p.parent.mkdir(parents=True, exist_ok=True)
tmp = p.with_suffix(p.suffix + ".tmp")
df.to_csv(tmp, index=False)
tmp.replace(p)
'@
# =========================================
# utils/mt5_health.py
# =========================================
Write-UTF8 "utils/mt5_health.py" @'
import MetaTrader5 as mt5, time
def ensure_mt5_ready(retries=3, sleep_s=2):
"""Ponawia initialize i weryfikuje, że terminal + konto są gotowe."""
for i in range(retries):
if mt5.initialize():
ti, ai = mt5.terminal_info(), mt5.account_info()
if ti and ai and getattr(ai, "login", 0):
return True
mt5.shutdown()
time.sleep(sleep_s * (i + 1))
return False
'@
# =========================================
# env_xau.py
# =========================================
Write-UTF8 "env_xau.py" @'
-- coding: utf-8 --
import numpy as np, pandas as pd
import gymnasium as gym
from gymnasium import spaces
from datetime import time as dtime
class XauTradingEnv(gym.Env):
metadata = {"render_modes": []}
def init(self, df: pd.DataFrame, window=128,
spread_abs=0.05, commission_rate=0.0001, slippage_k=0.10,
reward_mode: str = "pct", use_close_norm: bool = True,
flip_penalty: float = 0.0, trade_hours_utc=None,
enforce_flat_outside_hours: bool = True, features_spec: list | None = None,
min_equity: float = 0.8):
super().init()
self.df = df.reset_index(drop=True)
self.window = int(window)
self.spread_abs = float(spread_abs)
self.commission_rate = float(commission_rate)
self.slippage_k = float(slippage_k)
assert reward_mode in {"pct","points"}
self.reward_mode = reward_mode
self.use_close_norm = use_close_norm
self.flip_penalty = float(flip_penalty)
self.enforce_flat_outside = bool(enforce_flat_outside_hours)
self.min_equity = float(min_equity)
self.trade_hours = None
if trade_hours_utc and isinstance(trade_hours_utc,(list,tuple)) and len(trade_hours_utc)==2:
try:
s = [int(x) for x in str(trade_hours_utc[0]).split(":")]
e = [int(x) for x in str(trade_hours_utc[1]).split(":")]
self.trade_hours = (dtime(s[0], s[1] if len(s)>1 else 0), dtime(e[0], e[1] if len(e)>1 else 0))
except Exception:
self.trade_hours = None
base_cols = ['open','high','low','close','tick_volume','spread','time']
if features_spec is not None:
missing = [c for c in features_spec if c not in self.df.columns]
if missing: raise ValueError(f"Missing feature columns: {missing}")
self.feat_cols = list(features_spec)
else:
self.feat_cols = [c for c in self.df.columns if c not in base_cols]
self.price_col = 'close_norm' if (self.use_close_norm and 'close_norm' in self.df.columns) else 'close'
if len(self.df) <= self.window:
raise ValueError(f"Not enough rows: {len(self.df)} <= window {self.window}")
obs_dim = self.window * (1 + len(self.feat_cols)) + 2
self.action_space = spaces.Discrete(3)
self.observation_space = spaces.Box(low=-np.inf, high=np.inf, shape=(obs_dim,), dtype=np.float32)
self._start = self.window
self._i = None
self.pos = 0
self.entry = None
self.equity = 1.0
self.prev_eq = 1.0
def _in_trade_hours(self, ts)->bool:
if self.trade_hours is None: return True
try: t = ts.to_pydatetime().time()
except Exception: t = ts
start, end = self.trade_hours
if start <= end: return (t>=start) and (t<=end)
return (t>=start) or (t<=end)
def _obs(self):
sl = slice(self._i - self.window, self.i)
block_df = self.df.iloc[sl][[self.price_col] + self.feat_cols]
block = block_df.to_numpy(dtype=np.float32)
expected = 1 + len(self.feat_cols)
if block.shape != (self.window, expected):
raise RuntimeError(f"Bad window shape: {block.shape} vs {(self.window, expected)}")
flat = block.flatten()
price = float(self.df.iloc[self.i]['close'])
unreal = 0.0
if self.pos != 0 and self.entry is not None:
dir = 1 if self.pos>0 else -1
unreal = dir * (price - self.entry)
import numpy as np
return np.concatenate([flat, np.array([self.pos, unreal], dtype=np.float32)])
def reset(self, seed=None, options=None):
super().reset(seed=seed)
self._i = self._start
self.pos = 0; self.entry = None
self.equity = 1.0; self.prev_eq = 1.0
return self._obs(), {}
def step(self, action):
import numpy as np
if isinstance(action,(np.ndarray,list,tuple)): action = int(action[0])
else: action = int(action)
if not self.action_space.contains(action): raise ValueError("Invalid action")
info = {}
ts = self.df.iloc[self._i]['time']
inside = self._in_trade_hours(ts)
price = float(self.df.iloc[self.i]['close'])
prev = float(self.df.iloc[self.i-1]['close'])
slip = self.slippage_k * abs(price - prev)
desired = [-1,0,1][action]
if not inside and self.enforce_flat_outside: desired = 0
if desired != self.pos:
if self.pos != 0 and desired != 0 and np.sign(self.pos) != np.sign(desired) and self.flip_penalty>0:
if self.reward_mode == 'pct': self.equity *= max(1.0 - self.flip_penalty, 1e-6)
else: self.equity -= self.flip_penalty
info['flip_penalty'] = float(self.flip_penalty)
if self.pos != 0 and self.entry is not None:
cost = (self.spread_abs + slip)/max(price,1e-12) + self.commission_rate
if self.reward_mode == 'pct': self.equity *= max(1.0 - cost, 1e-6)
else: self.equity -= cost
self.pos = desired
if self.pos != 0:
cost = (self.spread_abs + slip)/max(price,1e-12) + self.commission_rate
if self.reward_mode == 'pct': self.equity *= max(1.0 - cost, 1e-6)
else: self.equity -= cost
self.entry = price
else:
self.entry = None
if self.reward_mode == 'pct':
step_ret = 0.0
if self.pos != 0:
dir = 1 if self.pos>0 else -1
step_ret = dir * ((price/max(prev,1e-12)) - 1.0)
self.equity *= (1.0 + step_ret)
reward = float(self.equity - self.prev_eq)
else:
reward = float(self.equity - self.prev_eq)
self.prev_eq = self.equity
self._i += 1
terminated = bool(self._i >= len(self.df) - 1)
truncated = False
if self.equity <= self.min_equity:
truncated = True
info['early_stop'] = True
info.update({'time': ts, 'price': price, 'pos': int(self.pos), 'equity': float(self.equity), 'inside_hours': bool(inside)})
return self._obs(), reward, terminated, truncated, info
'@
# =========================================
# rl/train_ppo.py
# =========================================
Write-UTF8 "rl/train_ppo.py" @'
-- coding: utf-8 --
"""PPO training with VecNormalize/Monitor/TimeLimit and features_spec."""
import argparse, yaml, json
import pandas as pd
from pathlib import Path
from stable_baselines3 import PPO
from stable_baselines3.common.vec_env import DummyVecEnv, VecNormalize, VecMonitor, sync_envs_normalization
from stable_baselines3.common.callbacks import EvalCallback
from stable_baselines3.common.utils import set_random_seed
from gymnasium.wrappers import TimeLimit
from env_xau import XauTradingEnv
parser = argparse.ArgumentParser()
parser.add_argument('--timesteps', type=int, default=1500000)
parser.add_argument('--seed', type=int, default=42)
parser.add_argument('--eval_freq', type=int, default=100000)
parser.add_argument('--n_eval_episodes', type=int, default=1)
parser.add_argument('--max_train_steps', type=int, default=6000)
parser.add_argument('--max_eval_steps', type=int, default=3000)
args = parser.parse_args()
cfg = yaml.safe_load(open('config.yaml','r',encoding='utf-8'))
FEAT = cfg['files']['features_csv']
MODEL_PATH = Path(cfg['files']['model_path'])
VECNORM_PATH = Path(cfg.get('files',{}).get('vecnorm_path','models/vecnorm_xauusd_m5.pkl'))
WINDOW = int(cfg.get('window',128))
COSTS = cfg['costs']
ENV_CFG = cfg.get('env',{})
REWARD_MODE = ENV_CFG.get('reward_mode', cfg.get('reward_mode','pct'))
FLIP_PENALTY = float(ENV_CFG.get('flip_penalty', cfg.get('flip_penalty',0.0)))
TRADE_HOURS = ENV_CFG.get('trade_hours_utc', cfg.get('trade_hours_utc', None))
MIN_EQ = float(ENV_CFG.get('min_equity', 0.8))
df = pd.read_csv(FEAT, parse_dates=['time'])
cut_val = df['time'].max() - pd.Timedelta(days=120)
train_df = df[df['time'] < cut_val].copy()
val_df   = df[df['time'] >= cut_val].copy()
features_spec = None
fspec = Path('models/features_spec.json')
if fspec.exists():
features_spec = json.loads(fspec.read_text(encoding='utf-8')).get('feature_columns', None)
set_random_seed(args.seed)
def make_train():
env = XauTradingEnv(train_df, window=WINDOW,
spread_abs=COSTS['spread_abs'], commission_rate=COSTS['commission_rate'], slippage_k=COSTS['slippage_k'],
reward_mode=REWARD_MODE, use_close_norm=True, flip_penalty=FLIP_PENALTY, trade_hours_utc=TRADE_HOURS,
enforce_flat_outside_hours=True, features_spec=features_spec, min_equity=MIN_EQ)
return TimeLimit(env, max_episode_steps=args.max_train_steps)
def make_eval():
env = XauTradingEnv(val_df, window=WINDOW,
spread_abs=COSTS['spread_abs'], commission_rate=COSTS['commission_rate'], slippage_k=COSTS['slippage_k'],
reward_mode=REWARD_MODE, use_close_norm=True, flip_penalty=0.0, trade_hours_utc=TRADE_HOURS,
enforce_flat_outside_hours=True, features_spec=features_spec, min_equity=MIN_EQ)
return TimeLimit(env, max_episode_steps=args.max_eval_steps)
venv_train = DummyVecEnv([make_train]); venv_train = VecMonitor(venv_train); venv_train = VecNormalize(venv_train, norm_obs=True, norm_reward=True, clip_obs=10.0, clip_reward=10.0)
venv_eval  = DummyVecEnv([make_eval]);  venv_eval  = VecMonitor(venv_eval);  venv_eval  = VecNormalize(venv_eval, training=False, norm_obs=True, norm_reward=False)
policy_kwargs = dict(net_arch=dict(pi=[128,128], vf=[128,128]))
try:
import tensorboard as _tb
tb_log_dir = 'logs/ppo_gold_m5'
except Exception:
tb_log_dir = None
model = PPO('MlpPolicy', venv_train, n_steps=4096, batch_size=256, learning_rate=3e-4, ent_coef=0.02,
policy_kwargs=policy_kwargs, seed=args.seed, verbose=1, tensorboard_log=tb_log_dir)
sync_envs_normalization(venv_eval, venv_train)
eval_cb = EvalCallback(venv_eval, best_model_save_path=str(MODEL_PATH.parent), log_path='logs/eval',
eval_freq=max(args.eval_freq,1), n_eval_episodes=max(args.n_eval_episodes,1),
deterministic=True, render=False)
model.learn(total_timesteps=args.timesteps, callback=eval_cb)
MODEL_PATH.parent.mkdir(parents=True, exist_ok=True)
model.save(str(MODEL_PATH))
venv_train.save(str(VECNORM_PATH))
print(f"Saved model: {MODEL_PATH}")
print(f"Saved VecNormalize: {VECNORM_PATH}")
'@
# =========================================
# rl/evaluate.py
# =========================================
Write-UTF8 "rl/evaluate.py" @'
-- coding: utf-8 --
"""Validate PPO on last ~120 days, save equity plot and trace CSV."""
import argparse, yaml, json
import pandas as pd, numpy as np
import matplotlib.pyplot as plt
from pathlib import Path
from gymnasium.wrappers import TimeLimit
from stable_baselines3 import PPO
from stable_baselines3.common.vec_env import DummyVecEnv, VecNormalize, VecMonitor
from env_xau import XauTradingEnv
parser = argparse.ArgumentParser()
parser.add_argument('--max_eval_steps', type=int, default=3000)
parser.add_argument('--out_dir', type=str, default='reports')
args = parser.parse_args()
OUT = Path(args.out_dir); OUT.mkdir(parents=True, exist_ok=True)
cfg = yaml.safe_load(open('config.yaml','r',encoding='utf-8'))
FEAT = cfg['files']['features_csv']
MODEL_PATH = cfg['files']['model_path']
VECNORM_PATH = cfg.get('files',{}).get('vecnorm_path','models/vecnorm_xauusd_m5.pkl')
WINDOW = int(cfg.get('window',128))
COSTS = cfg['costs']
ENV_CFG = cfg.get('env',{})
REWARD_MODE = ENV_CFG.get('reward_mode', cfg.get('reward_mode','pct'))
MIN_EQ = float(ENV_CFG.get('min_equity', 0.8))
df = pd.read_csv(FEAT, parse_dates=['time'])
cut_val = df['time'].max() - pd.Timedelta(days=120)
val = df[df['time']>=cut_val].copy()
features_spec = None
fspec = Path('models/features_spec.json')
if fspec.exists():
features_spec = json.loads(fspec.read_text(encoding='utf-8')).get('feature_columns', None)
def make_eval():
env = XauTradingEnv(val, window=WINDOW,
spread_abs=COSTS['spread_abs'], commission_rate=COSTS['commission_rate'], slippage_k=COSTS['slippage_k'],
reward_mode=REWARD_MODE, use_close_norm=True, features_spec=features_spec, min_equity=MIN_EQ)
return TimeLimit(env, max_episode_steps=args.max_eval_steps)
venv = DummyVecEnv([make_eval]); venv = VecMonitor(venv)
if Path(VECNORM_PATH).exists():
venv = VecNormalize.load(VECNORM_PATH, venv)
venv.training=False; venv.norm_reward=False
model = PPO.load(MODEL_PATH, env=venv)
obs = venv.reset(); eq=[]; rows=[]; done=False
while not done:
action,_ = model.predict(obs, deterministic=True)
obs, rewards, dones, infos = venv.step(action)
equity = venv.get_attr('equity', indices=0)[0]
eq.append(float(equity))
info0 = infos[0] if isinstance(infos,(list,tuple)) else infos
rows.append({'time': str(info0.get('time','')), 'price': info0.get('price',np.nan), 'pos': info0.get('pos',np.nan),
'equity': equity, 'action': int(action[0]) if hasattr(action,'len') else int(action)})
done = bool(dones[0])
s = pd.Series(eq)
final_eq = float(s.iloc[-1]); min_eq=float(s.min()); peak=s.cummax(); max_dd=float((s/peak-1.0).min())
plt.figure(figsize=(10,4)); plt.plot(s.values); plt.title('Equity (validation)'); plt.tight_layout()
plt.savefig((OUT/'equity_val.png').as_posix(), dpi=150)
(OUT/'val_metrics.txt').write_text(
f"Final equity: {final_eq:.6f}\nMin equity: {min_eq:.6f}\nMax drawdown: {max_dd:.6f}\n", encoding='utf-8')
pd.DataFrame(rows).to_csv(OUT/'eval_trace.csv', index=False)
print("Saved validation results.")
'@
# =========================================
# rl/walk_forward.py
# =========================================
Write-UTF8 "rl/walk_forward.py" @'
-- coding: utf-8 --
"""Walk-forward evaluation with per-fold traces and CSV/TXT outputs."""
import argparse, yaml, json
import pandas as pd, numpy as np
from pathlib import Path
from gymnasium.wrappers import TimeLimit
from stable_baselines3 import PPO
from stable_baselines3.common.vec_env import DummyVecEnv, VecNormalize, VecMonitor
from env_xau import XauTradingEnv
parser = argparse.ArgumentParser()
parser.add_argument('--segments', type=int, default=6)
parser.add_argument('--train_days', type=int, default=120)
parser.add_argument('--val_days', type=int, default=30)
parser.add_argument('--timesteps', type=int, default=500000)
parser.add_argument('--seed', type=int, default=42)
parser.add_argument('--out_dir', type=str, default='reports_wf')
args = parser.parse_args()
cfg = yaml.safe_load(open('config.yaml','r',encoding='utf-8'))
FEAT = cfg['files']['features_csv']
WINDOW = int(cfg.get('window',128))
COSTS = cfg['costs']
ENV_CFG = cfg.get('env',{})
REWARD_MODE = ENV_CFG.get('reward_mode', cfg.get('reward_mode','pct'))
FLIP_PENALTY = float(ENV_CFG.get('flip_penalty', cfg.get('flip_penalty',0.0)))
TRADE_HOURS = ENV_CFG.get('trade_hours_utc', cfg.get('trade_hours_utc', None))
MIN_EQ = float(ENV_CFG.get('min_equity', 0.8))
out = Path(args.out_dir); out.mkdir(parents=True, exist_ok=True)
df = pd.read_csv(FEAT, parse_dates=['time']).sort_values('time').reset_index(drop=True)
end_time = df['time'].max()
features_spec=None
fspec = Path('models/features_spec.json')
if fspec.exists(): features_spec = json.loads(fspec.read_text(encoding='utf-8')).get('feature_columns', None)
rows=[]
for k in range(args.segments):
val_end = end_time - pd.Timedelta(days=k*args.val_days)
val_start = val_end - pd.Timedelta(days=args.val_days)
train_end = val_start
train_start = train_end - pd.Timedelta(days=args.train_days)
tr = df[(df['time']>=train_start)&(df['time']<train_end)].copy()
va = df[(df['time']>=val_start)&(df['time']<val_end)].copy()
if len(tr)<=WINDOW or len(va)<=WINDOW: continue
def make_train():
env = XauTradingEnv(tr, window=WINDOW, spread_abs=COSTS['spread_abs'], commission_rate=COSTS['commission_rate'], slippage_k=COSTS['slippage_k'],
reward_mode=REWARD_MODE, use_close_norm=True, flip_penalty=FLIP_PENALTY, trade_hours_utc=TRADE_HOURS,
enforce_flat_outside_hours=True, features_spec=features_spec, min_equity=MIN_EQ)
return TimeLimit(env, max_episode_steps=6000)
def make_eval():
env = XauTradingEnv(va, window=WINDOW, spread_abs=COSTS['spread_abs'], commission_rate=COSTS['commission_rate'], slippage_k=COSTS['slippage_k'],
reward_mode=REWARD_MODE, use_close_norm=True, flip_penalty=0.0, trade_hours_utc=TRADE_HOURS,
enforce_flat_outside_hours=True, features_spec=features_spec, min_equity=MIN_EQ)
return TimeLimit(env, max_episode_steps=3000)
vt = DummyVecEnv([make_train]); vt = VecMonitor(vt); vt = VecNormalize(vt, norm_obs=True, norm_reward=True)
ve = DummyVecEnv([make_eval]);  ve = VecMonitor(ve)
model = PPO('MlpPolicy', vt, n_steps=4096, batch_size=256, learning_rate=3e-4, ent_coef=0.02, seed=args.seed, verbose=0)
model.learn(total_timesteps=args.timesteps)
tmp = out/f'vecnorm_{k}.pkl'; vt.save(str(tmp))
ve = VecNormalize.load(str(tmp), ve); ve.training=False; ve.norm_reward=False
obs = ve.reset(); eq=[]; trace=[]; done=False
while not done:
action,=model.predict(obs, deterministic=True)
obs, rewards, dones, infos = ve.step(action)
equity = ve.get_attr('equity', indices=0)[0]
eq.append(float(equity))
info0=infos[0] if isinstance(infos,(list,tuple)) else infos
trace.append({'k':k,'time':str(info0.get('time','')),'price':info0.get('price',np.nan),'pos':info0.get('pos',np.nan),'equity':equity,
'action':int(action[0]) if hasattr(action,'len') else int(action)})
done = bool(dones[0])
s = pd.Series(eq); final_eq=float(s.iloc[-1]); min_eq=float(s.min()); peak=s.cummax(); max_dd=float((s/peak-1.0).min())
rows.append({'k':k,'train_start':train_start,'train_end':train_end,'val_start':val_start,'val_end':val_end,'final_eq':final_eq,'min_eq':min_eq,'max_dd':max_dd,'n_steps':int(len(s))})
pd.DataFrame(trace).to_csv(out/f'fold{k}_trace.csv', index=False)
res = pd.DataFrame(rows).sort_values('k'); res.to_csv(out/'wf_results.csv', index=False)
if res.empty:
txt=['# Walk-Forward Report','No results (windows too short?).']
else:
agg={'folds':len(res),'final_eq_med':float(res['final_eq'].median()),'max_dd_med':float(res['max_dd'].median()),'n_steps_sum':int(res['n_steps'].sum())}
txt=['# Walk-Forward Report',f"Folds: {agg['folds']}",f"Median Final Equity: {agg['final_eq_med']:.4f}",f"Median MaxDD: {agg['max_dd_med']:.2%}",f"Total steps: {agg['n_steps_sum']}"]
(out/'wf_report.txt').write_text('`n'.join(txt), encoding='utf-8')
print("Saved walk-forward results.")
'@
# =========================================
# paper_demo/paper_loop_mt5_demo.py (poprawiony)
# =========================================
Write-UTF8 "paper_demo/paper_loop_mt5_demo.py" @'
-- coding: utf-8 --
"""Paper trading (DEMO) - pull M5 bars from MT5, build features incrementally, log decisions."""
import MetaTrader5 as mt5
import pandas as pd, numpy as np, yaml, time, logging, json
from pathlib import Path
from stable_baselines3 import PPO
from stable_baselines3.common.vec_env import DummyVecEnv, VecNormalize
from utils.mt5_health import ensure_mt5_ready
logging.basicConfig(filename='paper_demo/paper_trading.log', level=logging.INFO, format='%(asctime)s %(levelname)s %(message)s')
cfg = yaml.safe_load(open('config.yaml','r',encoding='utf-8'))
SYMBOL = cfg['symbol']; WINDOW=int(cfg.get('window',128))
MODEL_PATH = cfg['files']['model_path']; VECNORM_PATH = cfg.get('files',{}).get('vecnorm_path','models/vecnorm_xauusd_m5.pkl')
TF_MAP={'M1': mt5.TIMEFRAME_M1,'M5': mt5.TIMEFRAME_M5,'M15': mt5.TIMEFRAME_M15}; TF_NAME = cfg.get('timeframe','M5'); TF = TF_MAP.get(TF_NAME, mt5.TIMEFRAME_M5)
features_spec=None; fs=Path('models/features_spec.json')
if fs.exists(): features_spec=json.loads(fs.read_text(encoding='utf-8')).get('feature_columns', None)
def add_features_incremental(df: pd.DataFrame)->pd.DataFrame:
df=df.sort_values('time').reset_index(drop=True)
df['ret1']=np.log(df['close']).diff()
df['ema10']=df['close'].ewm(span=10).mean(); df['ema50']=df['close'].ewm(span=50).mean(); df['ema200']=df['close'].ewm(span=200).mean()
d=df['close'].diff(); up=d.clip(lower=0).ewm(alpha=1/14,adjust=False).mean(); down=(-d.clip(upper=0)).ewm(alpha=1/14,adjust=False).mean(); rs=up/(down+1e-12)
df['rsi14']=100-(100/(1+rs))
h,l,c=df['high'],df['low'],df['close']; tr=np.maximum(h-l, np.maximum(abs(h-c.shift()), abs(l-c.shift())))
df['atr14']=tr.ewm(alpha=1/14,adjust=False).mean()
ema_fast=df['close'].ewm(span=12,adjust=False).mean(); ema_slow=df['close'].ewm(span=26,adjust=False).mean(); macd_line=ema_fast-ema_slow; signal_line=macd_line.ewm(span=9,adjust=False).mean()
df['macd']=macd_line; df['macd_signal']=signal_line; df['macd_hist']=macd_line-signal_line
ma=df['close'].rolling(20).mean(); sd=df['close'].rolling(20).std()
df['bb_ma']=ma; df['bb_up']=ma+2sd; df['bb_lo']=ma-2sd; df['bb_width']=(df['bb_up']-df['bb_lo'])/(ma.replace(0,np.nan).abs()+1e-12)
df['minute']=df['time'].dt.hour60+df['time'].dt.minute; df['tod_sin']=np.sin(2np.pidf['minute']/1440); df['tod_cos']=np.cos(2np.pidf['minute']/1440); df.drop(columns=['minute'], inplace=True)
df['dow']=df['time'].dt.dayofweek; df['dow_sin']=np.sin(2np.pidf['dow']/7); df['dow_cos']=np.cos(2np.pi*df['dow']/7); df.drop(columns=['dow'], inplace=True)
df['close_log']=np.log(df['close'].clip(lower=1e-12)); mu=df['close_log'].rolling(2000,min_periods=200).mean(); s=df['close_log'].rolling(2000,min_periods=200).std().replace(0,np.nan)
df['close_norm']=(df['close_log']-mu)/(s+1e-8)
norm=['ret1','ema10','ema50','ema200','rsi14','atr14','macd','macd_signal','macd_hist','bb_ma','bb_up','bb_lo','bb_width','tod_sin','tod_cos','dow_sin','dow_cos']
for c in norm:
mu=df[c].rolling(2000,min_periods=200).mean(); s=df[c].rolling(2000,min_periods=200).std().replace(0,np.nan); df[c]=(df[c]-mu)/(s+1e-8)
return df.dropna().reset_index(drop=True)
def get_last_bars(symbol, timeframe, n:int):
rates = mt5.copy_rates_from_pos(symbol, timeframe, 0, n)
if rates is None or len(rates)<n: return None
df=pd.DataFrame(rates); df['time']=pd.to_datetime(df['time'], unit='s', utc=True); df.rename(columns={'real_volume':'tick_volume'}, inplace=True)
return df[['time','open','high','low','close','tick_volume','spread']]
def build_obs(df_feat: pd.DataFrame, model_obs_dim: int)->np.ndarray:
per_step=(model_obs_dim-2)//WINDOW
price_col='close_norm' if 'close_norm' in df_feat.columns else 'close'
if features_spec is None:
base=['open','high','low','close','tick_volume','spread','time']; feat_cols=[c for c in df_feat.columns if c not in base]
else:
feat_cols=[c for c in features_spec if c in df_feat.columns]
tail=df_feat.tail(WINDOW); block=tail[[price_col]+feat_cols].to_numpy(dtype=np.float32)
if block.shape!=(WINDOW, per_step): raise RuntimeError(f"Bad block {block.shape} vs {(WINDOW, per_step)}")
flat=block.flatten(); import numpy as np
return np.concatenate([flat, np.array([0.0,0.0],dtype=np.float32)])
def main():
if not ensure_mt5_ready(): raise RuntimeError("MT5 not ready (terminal/account). Start MT5 and login to a demo account.")
try:
model = PPO.load(MODEL_PATH); expected_dim=int(model.observation_space.shape[0]); assert (expected_dim-2)%WINDOW==0
vecnorm=None
if Path(VECNORM_PATH).exists():
from gymnasium import spaces
class _ObsOnlyEnv:
def init(self, obs_dim):
self.observation_space = spaces.Box(low=-np.inf, high=np.inf, shape=(obs_dim,), dtype=np.float32)
self.action_space = spaces.Discrete(3)
def reset(self, *, seed=None, options=None):
import numpy as np; return np.zeros(self.observation_space.shape, dtype=np.float32), {}
def step(self, action):
import numpy as np; return np.zeros(self.observation_space.shape, dtype=np.float32), 0.0, True, False, {}
dummy=DummyVecEnv([lambda: _ObsOnlyEnv(expected_dim)])
vecnorm=VecNormalize.load(VECNORM_PATH, dummy); vecnorm.training=False; vecnorm.norm_reward=False
Path('paper_demo').mkdir(parents=True, exist_ok=True)
csv=Path('paper_demo/decisions.csv'); if not csv.exists(): csv.write_text('time_utc,price,action_id,action_labeln', encoding='utf-8')         last_ts=None; hb_t=time.time()         while True:             bars=get_last_bars(SYMBOL, TF, n=WINDOW+800)             if bars is None or len(bars)<WINDOW+200: time.sleep(5); continue             feat=add_features_incremental(bars)             if len(feat)<WINDOW: time.sleep(5); continue             cur_ts=feat['time'].iloc[-1]             if last_ts is not None and cur_ts==last_ts: time.sleep(2); continue             obs=build_obs(feat, expected_dim)             if vecnorm is not None:                 import numpy as np; obs=vecnorm.normalize_obs(obs.reshape(1,-1)).reshape(-1)             action,_=model.predict(obs, deterministic=True)             decision={0:'SHORT',1:'FLAT',2:'LONG'}[int(action)]             price=float(feat['close'].iloc[-1]); msg=f"DECISION {decision} @ {price:.2f} (ts={cur_ts})"             print(msg); logging.info(msg)             with open(csv,'a',encoding='utf-8') as f: f.write(f"{cur_ts},{price:.5f},{int(action)},{decision}n")
last_ts=cur_ts
if time.time()-hb_t>600: logging.info(f"[HB] {SYMBOL} {TF_NAME} last_ts={cur_ts} price={price:.2f}"); hb_t=time.time()
time.sleep(30)
finally:
mt5.shutdown()
if name == 'main': main()
'@
# =========================================
# paper_demo/simulate_execution.py
# =========================================
Write-UTF8 "paper_demo/simulate_execution.py" @'
-- coding: utf-8 --
import yaml, pandas as pd
from env_xau import XauTradingEnv
from stable_baselines3 import PPO
from pathlib import Path
cfg = yaml.safe_load(open('config.yaml','r',encoding='utf-8'))
FEAT = cfg['files']['features_csv']; MODEL_PATH = cfg['files']['model_path']; WINDOW = int(cfg.get('window',128)); COSTS = cfg['costs']
df = pd.read_csv(FEAT, parse_dates=['time']); cut = df['time'].max() - pd.Timedelta(days=120); sim = df[df['time']>=cut].copy()
env = XauTradingEnv(sim, window=WINDOW, spread_abs=COSTS['spread_abs'], commission_rate=COSTS['commission_rate'], slippage_k=COSTS['slippage_k'])
obs, info = env.reset(); model = PPO.load(MODEL_PATH)
rows=[]; done=False
while not done:
action,_=model.predict(obs, deterministic=True)
obs, reward, terminated, truncated, info = env.step(action)
done = bool(terminated) or bool(truncated)
rows.append({'time': info.get('time',None), 'price': info.get('price',None), 'action': int(action), 'reward': float(reward), 'equity': float(env.equity)})
Path('reports').mkdir(parents=True, exist_ok=True)
pd.DataFrame(rows).to_csv('reports/trace_simulated.csv', index=False)
pd.Series([r['equity'] for r in rows]).to_csv('reports/equity_simulated.csv', index=False)
print('Saved simulated trace/equity.')
'@
# =========================================
# features/build_features.py (POPRAWIONY)
# =========================================
Write-UTF8 "features/build_features.py" @'
-- coding: utf-8 --
"""Feature builder: EMA/RSI/ATR + MACD + Bollinger + time cycles + rolling z-scores."""
import pandas as pd, numpy as np, yaml, json
from pathlib import Path
cfg = yaml.safe_load(open('config.yaml','r',encoding='utf-8'))
BARS = cfg['files']['bars_csv']; FEAT = cfg['files']['features_csv']
def macd(series, fast=12, slow=26, signal=9):
ema_fast = series.ewm(span=fast, adjust=False).mean()
ema_slow = series.ewm(span=slow, adjust=False).mean()
macd_line = ema_fast - ema_slow
signal_line = macd_line.ewm(span=signal, adjust=False).mean()
return macd_line, signal_line, macd_line - signal_line
def bbands(series, period=20, n_std=2.0):
ma = series.rolling(period).mean(); sd = series.rolling(period).std()
upper = ma + n_stdsd; lower = ma - n_stdsd
width = (upper - lower) / (ma.replace(0,np.nan).abs() + 1e-12)
return ma, upper, lower, width
def add_features(df):
df = df.sort_values('time').reset_index(drop=True)
c = df['close']
df['ret1'] = np.log(c).diff()
df['ema10'] = c.ewm(span=10).mean(); df['ema50']=c.ewm(span=50).mean(); df['ema200']=c.ewm(span=200).mean()
d = c.diff(); up=d.clip(lower=0).ewm(alpha=1/14,adjust=False).mean(); down=(-d.clip(upper=0)).ewm(alpha=1/14,adjust=False).mean(); rs=up/(down+1e-12)
df['rsi14'] = 100 - (100/(1+rs))
h,l,cl = df['high'], df['low'], df['close']
tr = np.maximum(h-l, np.maximum((h-cl.shift()).abs(), (l-cl.shift()).abs()))
df['atr14'] = tr.ewm(alpha=1/14, adjust=False).mean()
m,s,hst = macd(c); df['macd']=m; df['macd_signal']=s; df['macd_hist']=hst
bb_ma, bb_up, bb_lo, bb_w = bbands(c); df['bb_ma']=bb_ma; df['bb_up']=bb_up; df['bb_lo']=bb_lo; df['bb_width']=bb_w
df['minute']=df['time'].dt.hour60+df['time'].dt.minute
df['tod_sin']=np.sin(2np.pidf['minute']/1440); df['tod_cos']=np.cos(2np.pidf['minute']/1440); df.drop(columns=['minute'], inplace=True)
df['dow']=df['time'].dt.dayofweek
df['dow_sin']=np.sin(2np.pidf['dow']/7); df['dow_cos']=np.cos(2np.pi*df['dow']/7); df.drop(columns=['dow'], inplace=True)
df['close_log']=np.log(c.clip(lower=1e-12))
mu = df['close_log'].rolling(2000, min_periods=200).mean(); sd = df['close_log'].rolling(2000, min_periods=200).std().replace(0,np.nan)
df['close_norm']=(df['close_log']-mu)/(sd+1e-8)
feat_cols=['ret1','ema10','ema50','ema200','rsi14','atr14','macd','macd_signal','macd_hist','bb_ma','bb_up','bb_lo','bb_width','tod_sin','tod_cos','dow_sin','dow_cos']
for col in feat_cols:
mu = df[col].rolling(2000, min_periods=200).mean(); sd = df[col].rolling(2000, min_periods=200).std().replace(0,np.nan)
df[col]=(df[col]-mu)/(sd+1e-8)
return df.dropna().reset_index(drop=True)
df = pd.read_csv(BARS, parse_dates=['time'])
df = add_features(df)
assert len(df) > int(cfg.get('window',128)) + 10, "Too few rows for features"
Path(FEAT).parent.mkdir(parents=True, exist_ok=True)
df.to_csv(FEAT, index=False)
base_cols = ['time','open','high','low','close','tick_volume','spread']
feature_columns = [c for c in df.columns if c not in base_cols]
spec = {"feature_columns": feature_columns, "price_column":"close_norm"}
Path('models').mkdir(parents=True, exist_ok=True)
Path('models/features_spec.json').write_text(json.dumps(spec, ensure_ascii=False, indent=2), encoding='utf-8')
print("Saved features and features_spec.json")
'@
# =========================================
# fetch__mt5_data.py (inkrementalny, 720 dni, atomowy zapis, weekend-safe)
# =========================================
Write-UTF8 "fetch__mt5_data.py" @'
-- coding: utf-8 --
"""
Fetch bars & 24h tick sample from MT5 (demo/real). Incremental merge to maintain 720d.
# Atomic CSV writes, Retries/backoff, Weekend-safe ticks (warn only)
"""
import MetaTrader5 as mt5
import pandas as pd
from datetime import datetime, timedelta, timezone
import yaml
from pathlib import Path
import numpy as np, time
from utils.atomic import atomic_write_csv
from utils.mt5_health import ensure_mt5_ready
cfg = yaml.safe_load(open('config.yaml','r',encoding='utf-8'))
SYMBOL = cfg['symbol']
BARS_CSV = cfg['files']['bars_csv']
TICKS_CSV = cfg['files']['ticks_csv']
HISTORY_DAYS = int(cfg.get('history_days', 720))
TF_MAP={'M1': mt5.TIMEFRAME_M1,'M5': mt5.TIMEFRAME_M5,'M15': mt5.TIMEFRAME_M15}
TF_NAME = cfg.get('timeframe','M5'); TF = TF_MAP.get(TF_NAME, mt5.TIMEFRAME_M5)
CHUNK = int(cfg.get('mt5',{}).get('bars_chunk', 20000))
UPDATE_DAYS = int(cfg.get('mt5',{}).get('update_days', 60))
def init_mt5():
if not ensure_mt5_ready(): raise RuntimeError("MT5 not ready (terminal/account). Please login in MT5 terminal.")
term = mt5.terminal_info(); acc = mt5.account_info()
parts=[]
if getattr(term,"company",None): parts.append(f"Company={term.company}")
if getattr(term,"name",None): parts.append(f"TerminalName={term.name}")
if getattr(acc,"login",0): parts.append(f"Login={acc.login}")
if getattr(acc,"server",None): parts.append(f"Server={acc.server}")
if getattr(acc,"name",None): parts.append(f"AccountName={acc.name}")
print("[MT5] " + " | ".join(parts) if parts else "[MT5] initialized")
def ensure_symbol(symbol: str)->bool:
info = mt5.symbol_info(symbol)
if info is None:
mt5.symbol_select(symbol, True)
info = mt5.symbol_info(symbol)
if info is None: return False
if not info.visible:
if not mt5.symbol_select(symbol, True): return False
return True
def suggest_similar(symbol: str, limit=10):
cands=[]
for s in mt5.symbols_get():
name=s.name.upper()
if ("GOLD" in name) or ("XAU" in name): cands.append(s.name)
if not cands:
cands = [s.name for s in mt5.symbols_get()[:limit]]
return sorted(set(cands))[:limit]
def with_retries(fn, attempts=3, sleep_s=2, *a, **kw):
last=None
for i in range(attempts):
try:
return fn(*a, *kw)
except Exception as e:
last = e; time.sleep(sleep_s(i+1))
if last: raise last
def _to_df(rates):
df = pd.DataFrame(rates)
if df.empty: return df
df['time'] = pd.to_datetime(df['time'], unit='s', utc=True)
if 'real_volume' in df.columns:
df.rename(columns={'real_volume':'tick_volume'}, inplace=True)
cols=['time','open','high','low','close','tick_volume','spread']
return df[cols].sort_values('time').drop_duplicates('time')
def fetch_range(symbol, timeframe, utc_from, utc_to):
rates = mt5.copy_rates_range(symbol, timeframe, utc_from, utc_to)
if rates is None or len(rates)==0:
last_err = mt5.last_error()
raise RuntimeError(f"copy_rates_range empty for '{symbol}'. last_error={last_err}")
return _to_df(rates)
def fetch_from_pos_tail(symbol, timeframe, count):
rates = mt5.copy_rates_from_pos(symbol, timeframe, 0, count)
if rates is None or len(rates)==0:
last_err = mt5.last_error()
raise RuntimeError(f"copy_rates_from_pos empty for '{symbol}'. last_error={last_err}")
return _to_df(rates)
def load_existing_bars(path: str):
p = Path(path)
if not p.exists(): return None
try:
df = pd.read_csv(p, parse_dates=['time'])
if df.empty: return None
return df.sort_values('time').drop_duplicates('time').reset_index(drop=True)
except Exception:
return None
def merge_clip(existing: pd.DataFrame | None, new_df: pd.DataFrame, keep_days:int)->pd.DataFrame:
if existing is None or existing.empty:
base = new_df.copy()
else:
base = (pd.concat([existing, new_df], ignore_index=True)
.drop_duplicates('time').sort_values('time'))
cutoff = datetime.now(timezone.utc) - timedelta(days=keep_days+1)
base = base[base['time'] >= pd.Timestamp(cutoff)]
return base.reset_index(drop=True)
def fetch_bars_incremental(symbol, timeframe, keep_days:int, update_days:int)->pd.DataFrame:
existing = load_existing_bars(BARS_CSV)
if existing is None:
to = datetime.now(timezone.utc); frm = to - timedelta(days=keep_days+2)
df = with_retries(lambda: fetch_range(symbol, timeframe, frm, to))
if len(df) < 1000:
tail = with_retries(lambda: fetch_from_pos_tail(symbol, timeframe, CHUNK))
df = merge_clip(df, tail, keep_days)
return df
to = datetime.now(timezone.utc); frm = to - timedelta(days=max(2, update_days))
fresh = with_retries(lambda: fetch_range(symbol, timeframe, frm, to))
merged = merge_clip(existing, fresh, keep_days)
return merged
def fetch_ticks(symbol: str, hours: int=24)->pd.DataFrame:
utc_to = datetime.now(timezone.utc); utc_from = utc_to - timedelta(hours=hours)
ticks = mt5.copy_ticks_range(symbol, utc_from, utc_to, mt5.COPY_TICKS_ALL)
if ticks is None or len(ticks)==0:
last_err = mt5.last_error()
raise RuntimeError(f"No MT5 ticks for '{symbol}'. last_error={last_err}")
tdf = pd.DataFrame(ticks); tdf['time']=pd.to_datetime(tdf['time'], unit='s', utc=True)
return tdf[['time','bid','ask','last','volume']]
def suggest_costs(tdf: pd.DataFrame)->dict:
spr = (tdf['ask'] - tdf['bid']).astype(float).replace([np.inf,-np.inf], np.nan).dropna()
med_spread = float(np.median(spr)) if len(spr) else 0.0
p75_spread = float(np.percentile(spr, 75)) if len(spr) else 0.0
mid = (tdf['ask'] + tdf['bid'])/2.0
dm = (mid.diff().abs()).replace([np.inf,-np.inf], np.nan).dropna()
med_dm = float(np.median(dm)) if len(dm) else 0.0
med_price = float(np.nanmedian(mid)) if len(mid) else 1.0
slippage_k = float(min(max(med_dm / max(med_price, 1e-12), 0.0), 0.01))
return {'spread_abs_median': round(med_spread,5), 'spread_abs_p75': round(p75_spread,5), 'slippage_k_suggested': round(slippage_k,4)}
def main():
init_mt5()
try:
print(f"[CFG] symbol={SYMBOL} tf={TF_NAME} keep_days={HISTORY_DAYS} update_days={UPDATE_DAYS}")
if not ensure_symbol(SYMBOL):
similar = suggest_similar(SYMBOL)
raise SystemExit(
"Symbol not found or not visible in Market Watch: '{}'n"                 "Try one of these (server-specific): {}n"
"Also open Symbols window and SHOW the instrument."
.format(SYMBOL, ", ".join(similar))
)
bars = fetch_bars_incremental(SYMBOL, TF, keep_days=HISTORY_DAYS, update_days=UPDATE_DAYS)
assert {'time','open','high','low','close'}.issubset(bars.columns), "Bars frame malformed"
assert len(bars) > 100, "Too few bars"
atomic_write_csv(bars, BARS_CSV)
print(f"Saved bars: {BARS_CSV} ({len(bars)})")
# ticks są opcjonalne (weekend-safe)
try:
ticks = with_retries(lambda: fetch_ticks(SYMBOL, hours=24))
atomic_write_csv(ticks, TICKS_CSV)
print(f"Saved ticks: {TICKS_CSV} ({len(ticks)})")
sugg = suggest_costs(ticks)
Path('reports').mkdir(parents=True, exist_ok=True)
Path('reports/costs_suggestion.yaml').write_text(
yaml.safe_dump(sugg, allow_unicode=True, sort_keys=False), encoding='utf-8')
print("Cost suggestions -> reports/costs_suggestion.yaml")
except Exception as e:
print(f"[warn] ticks unavailable ({e}); keeping previous {TICKS_CSV}")
finally:
mt5.shutdown()
if name == 'main':
main()
'@
# =========================================
# utils/calibration.py
# =========================================
Write-UTF8 "utils/calibration.py" @'
-- coding: utf-8 --
"""Calibrate costs: spread (median/95p) and slippage_k ratio. Save suggestions; with --apply update config.yaml."""
import argparse, yaml, pandas as pd, numpy as np
from pathlib import Path
parser = argparse.ArgumentParser(); parser.add_argument('--apply', action='store_true'); args=parser.parse_args()
cfg = yaml.safe_load(open('config.yaml','r',encoding='utf-8'))
TICKS = cfg['files']['ticks_csv']; BARS = cfg['files']['bars_csv']
ticks = pd.read_csv(TICKS, parse_dates=['time'])
ticks['spread']=ticks['ask']-ticks['bid']; mid=(ticks['ask']+ticks['bid'])/2.0; dmid=mid.diff().abs()
spread_median=float(ticks['spread'].median()); spread_p95=float(ticks['spread'].quantile(0.95)); dmid_median=float(dmid.median())
bars=pd.read_csv(BARS, parse_dates=['time']); bar_move_med=float(bars['close'].diff().abs().median())
slippage_k=float(np.clip(dmid_median/max(bar_move_med,1e-12), 0.0, 0.5))
Path('reports').mkdir(parents=True, exist_ok=True)
Path('reports/costs_suggestion.yaml').write_text(
yaml.safe_dump({'spread_abs_median':round(spread_median,5),'spread_abs_p95':round(spread_p95,5),'slippage_k_suggested':round(slippage_k,3)},
allow_unicode=True, sort_keys=False),
encoding='utf-8')
print('Suggestions -> reports/costs_suggestion.yaml')
if args.apply:
cfg['costs']['spread_abs']=float(round(spread_median,5)); cfg['costs']['slippage_k']=float(slippage_k)
Path('config.yaml').write_text(yaml.safe_dump(cfg, allow_unicode=True, sort_keys=False), encoding='utf-8')
print('Applied to config.yaml')
'@
# =========================================
# utils/make_report.py (POPRAWIONY)
# =========================================
Write-UTF8 "utils/make_report.py" @'
-- coding: utf-8 --
import argparse, base64
from pathlib import Path
import pandas as pd, numpy as np
import matplotlib.pyplot as plt
from datetime import datetime
parser=argparse.ArgumentParser()
parser.add_argument('--equity_csv', type=str, default='reports/eval_trace.csv')
parser.add_argument('--metrics', type=str, default='reports/val_metrics.txt')
parser.add_argument('--figure', type=str, default='reports/equity_val.png')
parser.add_argument('--out_html', type=str, default='reports/report.html')
parser.add_argument('--out_txt', type=str, default='reports/report.txt')
parser.add_argument('--bars_per_day', type=int, default=288)
parser.add_argument('--trading_days', type=int, default=252)
args=parser.parse_args()
out_html=Path(args.out_html); out_txt=Path(args.out_txt)
out_html.parent.mkdir(parents=True, exist_ok=True); out_txt.parent.mkdir(parents=True, exist_ok=True)
eq=None; p=Path(args.equity_csv)
if p.exists():
df=pd.read_csv(p)
if 'equity' in df.columns: eq=df['equity'].astype(float).to_numpy()
elif df.shape[1]==1: eq=df.iloc[:,0].astype(float).to_numpy()
metrics_text = Path(args.metrics).read_text(encoding='utf-8') if Path(args.metrics).exists() else ''
img_b64=''
if Path(args.figure).exists(): img_b64=base64.b64encode(Path(args.figure).read_bytes()).decode('ascii')
if not img_b64 and eq is not None and len(eq)>1:
fig,ax=plt.subplots(figsize=(9,4)); ax.plot(eq,color='#0057B8',lw=1.5)
ax.set_title('Equity (validation)'); ax.set_xlabel('Steps'); ax.set_ylabel('Equity')
fig.tight_layout(); Path(args.figure).parent.mkdir(parents=True, exist_ok=True); fig.savefig(args.figure,dpi=144); plt.close(fig)
img_b64=base64.b64encode(Path(args.figure).read_bytes()).decode('ascii')
extra={}
if eq is not None and len(eq)>2:
ret=np.diff(eq)/np.maximum(eq[:-1],1e-12); mu=float(np.nanmean(ret)); sigma=float(np.nanstd(ret)+1e-12)
downside=ret[ret<0]; ds=float(np.nanstd(downside)+1e-12)
daily_mu = mu * args.bars_per_day; daily_sigma = sigma * (args.bars_per_day0.5)
sharpe = daily_mu/(daily_sigma+1e-12); sortino = daily_mu/(((args.bars_per_day0.5)*ds)+1e-12)
n=len(eq); years=max(n/args.bars_per_day/args.trading_days,1e-6)
cagr=(eq[-1]/max(eq[0],1e-12))**(1/max(years,1e-6))-1 if years>0 else 0.0
peak=np.maximum.accumulate(eq); max_dd=float((eq/peak-1.0).min()); calmar=(cagr/abs(max_dd)) if max_dd<0 else float('inf')
extra=dict(n_steps=n, sharpe_daily=sharpe, sortino_daily=sortino, vol_daily=daily_sigma, cagr=cagr, max_dd=max_dd, calmar=calmar)
now=datetime.now().strftime('%Y-%m-%d %H:%M:%S')
md=['# RL Validation Report (XAUUSD M5)', f'Date: {now}', '', '## Base metrics', '', metrics_text.strip() if metrics_text else '(no val_metrics.txt)', '', '']
if extra:
md += [
'## Extra metrics from equity',
f"- Steps: {extra['n_steps']}",
f"- Sharpe (daily): {extra['sharpe_daily']:.3f}",
f"- Sortino (daily): {extra['sortino_daily']:.3f}",
f"- Daily vol: {extra['vol_daily']:.4f}",
f"- CAGR (est.): {extra['cagr']:.3%}",
f"- MaxDD: {extra['max_dd']:.2%}",
f"- Calmar: {extra['calmar']:.3f}",
]
else:
md += ['No equity data.']
out_txt.write_text('\n'.join(md)+'\n', encoding='utf-8')
html=f"""RL Validation
RL Validation Report (XAUUSD M5)
Base metrics
{metrics_text if metrics_text else '(no val_metrics.txt)'}
Extra metrics
{('\n'.join(md)) if extra else 'No equity data.'}
Equity
{('data:image/png;base64,'+img_b64) if img_b64 else 'No plot.'}
Generated: {now}
"""
out_html.write_text(html, encoding='utf-8')
print('Saved report.')
'@
# =========================================
# utils/qc_bars.py & utils/time_utils.py
# =========================================
Write-UTF8 "utils/qc_bars.py" @'
#!/usr/bin/env python
import pandas as pd, argparse
parser=argparse.ArgumentParser(); parser.add_argument('--csv', required=True); parser.add_argument('--tf_min', type=int, default=5)
args=parser.parse_args()
df=pd.read_csv(args.csv, parse_dates=['time']).sort_values('time').reset_index(drop=True)
print(f"Rows: {len(df)}\nFrom: {df['time'].iloc[0]} To: {df['time'].iloc[-1]}")
dt=(df['time'].diff().dt.total_seconds()/60).fillna(args.tf_min)
gaps=df.loc[dt>args.tf_min+0.1,['time']].copy(); gaps['gap_min']=dt[dt>args.tf_min+0.1].values
print(f"Gaps > {args.tf_min} min: {len(gaps)}");
if len(gaps): print(gaps.head(10))
'@
Write-UTF8 "utils/time_utils.py" @'
from datetime import datetime, timezone
def now_utc(): return datetime.now(timezone.utc)
'@
# =========================================
# ops: env.ps1 & run scripts & promotion
# =========================================
Write-UTF8 "ops/env.ps1" @'
$ErrorActionPreference = "Stop"
$RepoRoot = Split-Path -Parent $MyInvocation.MyCommand.Path | Split-Path
$Py = Join-Path $RepoRoot ".venv\Scripts\python.exe"
$Cfg = Join-Path $RepoRoot "config.yaml"
$LogDir = Join-Path $RepoRoot "logs"
New-Item -ItemType Directory -Force -Path $LogDir | Out-Null
function RunPy([string]$script, [string]$args="") {
& $Py $script $args 2>&1 | Tee-Object -FilePath (Join-Path $LogDir ((Split-Path $script -Leaf) + ".log")) -Append
}
'@
Write-UTF8 "ops/run_collector.ps1" @'
. "$PSScriptRoot\env.ps1"
while ($true) { try { RunPy "$RepoRoot\fetch__mt5_data.py" } catch { Write-Host "Collector error: $_" } Start-Sleep -Seconds 300 }
'@
Write-UTF8 "ops/run_features.ps1" @'
. "$PSScriptRoot\env.ps1"
while ($true) { try { RunPy "$RepoRoot\features\build_features.py" } catch { Write-Host "Features error: $_" } Start-Sleep -Seconds 600 }
'@
Write-UTF8 "ops/run_paper.ps1" @'
. "$PSScriptRoot\env.ps1"
while ($true) { try { RunPy "$RepoRoot\paper_demo\paper_loop_mt5_demo.py" } catch { Write-Host "Paper loop crash: $_"; Start-Sleep -Seconds 10 } Start-Sleep -Seconds 2 }
'@
Write-UTF8 "ops/run_train_short.ps1" @'
. "$PSScriptRoot\env.ps1"
while ($true) {
try {
RunPy "$RepoRoot\rl\train_ppo.py" "--timesteps 500000 --seed 42 --eval_freq 100000"
RunPy "$RepoRoot\rl\evaluate.py" "--max_eval_steps 3000 --out_dir reports_live"
RunPy "$RepoRoot\ops\save_candidate.py"
& $Py "$RepoRoot\ops\promote_challenger.py"
} catch { Write-Host "Short training error: $_" }
Start-Sleep -Seconds 14400
}
'@
Write-UTF8 "ops/run_train_nightly.ps1" @'
. "$PSScriptRoot\env.ps1"
while ($true) {
try {
while ( (Get-Date).ToUniversalTime().Hour -ne 23 ) { Start-Sleep -Seconds 600 }
Start-Sleep -Seconds 300
RunPy "$RepoRoot\rl\train_ppo.py" "--timesteps 2000000 --seed 42 --eval_freq 200000"
RunPy "$RepoRoot\rl\walk_forward.py" "--segments 6 --train_days 120 --val_days 30 --timesteps 500000 --out_dir reports_wf"
RunPy "$RepoRoot\rl\evaluate.py" "--max_eval_steps 3000 --out_dir reports_nightly"
RunPy "$RepoRoot\ops\save_candidate.py"
& $Py "$RepoRoot\ops\promote_challenger.py"
} catch { Write-Host "Nightly training error: $_" }
Start-Sleep -Seconds 3600
}
'@
Write-UTF8 "ops/save_candidate.py" @'
import json, shutil
from pathlib import Path
ROOT = Path(file).resolve().parents[1]
REG = ROOT / 'models' / 'registry'; REG.mkdir(parents=True, exist_ok=True)
MODEL = ROOT / 'models' / 'ppo_xauusd_m5.zip'
VEC   = ROOT / 'models' / 'vecnorm_xauusd_m5.pkl'
METR  = ROOT / 'reports' / 'val_metrics.txt'
EQP   = ROOT / 'reports' / 'equity_val.png'
def parse_metrics_txt(p: Path):
d = {}
if p.exists():
txt = p.read_text(encoding='utf-8')
for line in txt.splitlines():
if ':' in line:
k, v = line.split(':', 1)
k = k.strip().lower().replace(' ', '')
try: d[k] = float(v.strip())
except: pass
return d
def main():
m = parse_metrics_txt(METR)
if not m:
print('[save_candidate] No metrics.'); return
tag = 'cand' + Path.cwd().name + '_'
n=0
while (REG / f"{tag}{n:02d}").exists(): n+=1
dst = REG / f"{tag}{n:02d}"
dst.mkdir(parents=True, exist_ok=True)
shutil.copy2(MODEL, dst/'model.zip')
if VEC.exists(): shutil.copy2(VEC, dst/'vecnorm.pkl')
if EQP.exists(): shutil.copy2(EQP, dst/'equity.png')
(dst/'metrics.json').write_text(json.dumps({
'final_equity': m.get('final_equity'),
'max_dd': m.get('max_drawdown'),
'sharpe': m.get('sharpe_daily'),
}, indent=2), encoding='utf-8')
print(f'[save_candidate] Saved candidate -> {dst}')
if name == 'main': main()
'@
Write-UTF8 "ops/promote_challenger.py" @'
import json, shutil
from pathlib import Path
ROOT = Path(file).resolve().parents[1]
REG = ROOT / 'models' / 'registry'; REG.mkdir(parents=True, exist_ok=True)
CUR_TXT = REG / 'current.txt'
MODEL_DST = ROOT / 'models' / 'ppo_xauusd_m5.zip'
VEC_DST   = ROOT / 'models' / 'vecnorm_xauusd_m5.pkl'
def load_metrics(d: Path):
if not d: return None
m = d / 'metrics.json'
return json.loads(m.read_text('utf-8')) if m.exists() else None
def pick_latest_dir():
dirs = [p for p in REG.iterdir() if p.is_dir()]
return sorted(dirs, key=lambda p: p.name)[-1] if dirs else None
def better(m_new, m_old):
if m_old is None: return True
s_new, s_old = m_new.get('sharpe', 0.0) or 0.0, m_old.get('sharpe', 0.0) or 0.0
dd_new, dd_old = m_new.get('max_dd', -1.0) or -1.0, m_old.get('max_dd', -1.0) or -1.0
dd_ok = (dd_new >= dd_old * 1.2)
s_ok  = (s_new >= s_old * 1.10) or (s_new >= 0.10 and s_new > s_old)
fe_new, fe_old = m_new.get('final_equity', 0.0) or 0.0, m_old.get('final_equity', 0.0) or 0.0
if (s_new == 0.0 and s_old == 0.0):
return (fe_new > fe_old) and dd_ok
return s_ok and dd_ok
def promote(new_dir: Path):
REG.mkdir(parents=True, exist_ok=True)
(REG/'current.txt').write_text(new_dir.name, encoding='utf-8')
shutil.copy2(new_dir/'model.zip', MODEL_DST)
if (new_dir/'vecnorm.pkl').exists(): shutil.copy2(new_dir/'vecnorm.pkl', VEC_DST)
print(f"[promote] Champion -> {new_dir.name}")
def main():
latest = pick_latest_dir()
if latest is None: print('[promote] No candidates.'); return
new_m = load_metrics(latest)
if new_m is None: print('[promote] Latest has no metrics.json'); return
cur_dir = REG / CUR_TXT.read_text('utf-8').strip() if CUR_TXT.exists() else None
old_m = load_metrics(cur_dir) if cur_dir and cur_dir.exists() else None
if better(new_m, old_m): promote(latest)
else: print('[promote] Challenger not better. No promotion.')
if name == 'main': main()
'@
Write-UTF8 "ops/install_services.ps1" @'
$nssm = "C:\nssm\nssm.exe"
$root = Split-Path -Parent $MyInvocation.MyCommand.Path
$ps = "powershell.exe"
& $nssm install XAU_Collector   $ps "-ExecutionPolicy Bypass -File "$root\run_collector.ps1""
& $nssm set    XAU_Collector   AppDirectory (Split-Path -Parent $root)
& $nssm set    XAU_Collector   Start SERVICE_AUTO_START
& $nssm install XAU_Features    $ps "-ExecutionPolicy Bypass -File "$root\run_features.ps1""
& $nssm set    XAU_Features    AppDirectory (Split-Path -Parent $root)
& $nssm set    XAU_Features    Start SERVICE_AUTO_START
& $nssm install XAU_Paper       $ps "-ExecutionPolicy Bypass -File "$root\run_paper.ps1""
& $nssm set    XAU_Paper       AppDirectory (Split-Path -Parent $root)
& $nssm set    XAU_Paper       Start SERVICE_AUTO_START
& $nssm install XAU_TrainShort  $ps "-ExecutionPolicy Bypass -File "$root\run_train_short.ps1""
& $nssm set    XAU_TrainShort  AppDirectory (Split-Path -Parent $root)
& $nssm set    XAU_TrainShort  Start SERVICE_AUTO_START
& $nssm install XAU_TrainNightly $ps "-ExecutionPolicy Bypass -File "$root\run_train_nightly.ps1""
& $nssm set    XAU_TrainNightly AppDirectory (Split-Path -Parent $root)
& $nssm set    XAU_TrainNightly Start SERVICE_AUTO_START
'@
# =========================================
# quick_env_test + features_spec placeholder
# =========================================
Write-UTF8 "quick_env_test.py" @'
import yaml, pandas as pd
from env_xau import XauTradingEnv
cfg=yaml.safe_load(open('config.yaml','r',encoding='utf-8'))
df=pd.read_csv(cfg['files']['features_csv'], parse_dates=['time']).sort_values('time').reset_index(drop=True)
df=df.tail(max(int(cfg.get('window',128))+256,512))
env=XauTradingEnv(df, window=int(cfg.get('window',128)),
spread_abs=cfg['costs']['spread_abs'], commission_rate=cfg['costs']['commission_rate'], slippage_k=cfg['costs']['slippage_k'],
reward_mode=cfg.get('env',{}).get('reward_mode', cfg.get('reward_mode','pct')), use_close_norm=True,
min_equity=float(cfg.get('env',{}).get('min_equity',0.8)))
obs,info=env.reset(); print('reset OK', len(obs))
obs,r,term,trunc,info=env.step(1); print('step OK', r, term, trunc)
'@
Write-UTF8 "models/features_spec.json" '{"feature_columns": [], "price_column": "close_norm"}'
Write-Host "OK – repo files created in $Root"









=== FILE: check.py ===

import pandas as pd
df = pd.read_csv("data/XAUUSD_M5.csv", parse_dates=["time"])
print("bars rows:", len(df), "from:", df["time"].min(), "to:", df["time"].max())
print(df.tail(3))

=== FILE: config.yaml ===

symbol: GOLD.pro
timeframe: M5
history_days: 720
window: 128
mt5:
  bars_chunk: 100000
  update_days: 60
files:
  bars_csv: data/XAUUSD_M5.csv
  ticks_csv: data/XAUUSD_ticks_sample.csv
  features_csv: data/XAUUSD_M5_features.csv
  model_path: models/ppo_xauusd_m5.zip
  vecnorm_path: models/vecnorm_xauusd_m5.pkl
costs:
  spread_abs: 0.37
  commission_rate: 0.0001
  slippage_k: 0.0
env:
  reward_mode: pct
  flip_penalty: 0.002
  trade_hours_utc:
  - 06:00
  - '20:00'
  enforce_flat_outside_hours: true
  min_equity: 0.8
fundamentals:
  usd_series_id: DTWEXBGS
  gpr_csv: external/gpr/gpr.csv
  cot_csv: external/cot_gold.csv
calendar:
  calendar_csv: external/calendar_us.csv
  events_whitelist:
  - Non Farm Payrolls
  - Unemployment Rate
  - CPI
  - Core CPI
  - Core PCE
  - ISM Manufacturing PMI
  - ISM Services PMI
  - FOMC Interest Rate Decision
  - Fed Press Conference


=== FILE: env_xau.py ===

# -*- coding: utf-8 -*-
import numpy as np
import pandas as pd
import gymnasium as gym
from gymnasium import spaces
from datetime import time as dtime

class XauTradingEnv(gym.Env):
    metadata = {"render_modes": []}

    def __init__(self, df: pd.DataFrame, window=128,
                 spread_abs=0.05, commission_rate=0.0001, slippage_k=0.10,
                 reward_mode: str = "pct", use_close_norm: bool = True,
                 flip_penalty: float = 0.0, trade_hours_utc=None,
                 enforce_flat_outside_hours: bool = True, features_spec: list | None = None,
                 min_equity: float = 0.8):
        super().__init__()
        # Dane i parametry
        self.df = df.sort_values('time').reset_index(drop=True)
        self.window = int(window)
        self.spread_abs = float(spread_abs)
        self.commission_rate = float(commission_rate)
        self.slippage_k = float(slippage_k)
        assert reward_mode in {"pct", "points"}
        self.reward_mode = reward_mode
        self.use_close_norm = use_close_norm
        self.flip_penalty = float(flip_penalty)
        self.enforce_flat_outside = bool(enforce_flat_outside_hours)
        self.min_equity = float(min_equity)

        # Godziny handlu (UTC)
        self.trade_hours = None
        if trade_hours_utc and isinstance(trade_hours_utc, (list, tuple)) and len(trade_hours_utc) == 2:
            try:
                s = [int(x) for x in str(trade_hours_utc[0]).split(":")]
                e = [int(x) for x in str(trade_hours_utc[1]).split(":")]
                self.trade_hours = (dtime(s[0], s[1] if len(s) > 1 else 0),
                                    dtime(e[0], e[1] if len(e) > 1 else 0))
            except Exception:
                self.trade_hours = None

        # Kolumny cech
        base_cols = ['open', 'high', 'low', 'close', 'tick_volume', 'spread', 'time']
        if features_spec is not None:
            missing = [c for c in features_spec if c not in self.df.columns]
            if missing:
                raise ValueError(f"Missing feature columns: {missing}")
            self.feat_cols = list(features_spec)
        else:
            self.feat_cols = [c for c in self.df.columns if c not in base_cols]

        self.price_col = 'close_norm' if (self.use_close_norm and 'close_norm' in self.df.columns) else 'close'

        if len(self.df) <= self.window:
            raise ValueError(f"Not enough rows: {len(self.df)} <= window {self.window}")

        # Observation: [window x (1 + n_features)] + [pos, unrealized]
        obs_dim = self.window * (1 + len(self.feat_cols)) + 2
        self.action_space = spaces.Discrete(3)  # 0=SHORT, 1=FLAT, 2=LONG
        self.observation_space = spaces.Box(low=-np.inf, high=np.inf, shape=(obs_dim,), dtype=np.float32)

        # Stan
        self._start = self.window
        self._i = None
        self.pos = 0
        self.entry = None
        self.equity = 1.0
        self.prev_eq = 1.0

    def _in_trade_hours(self, ts) -> bool:
        if self.trade_hours is None:
            return True
        try:
            t = ts.to_pydatetime().time()
        except Exception:
            t = ts
        start, end = self.trade_hours
        if start <= end:
            return (t >= start) and (t <= end)
        # okno nocne np. 22:00–06:00
        return (t >= start) or (t <= end)

    def _obs(self):
        # Używamy _i wszędzie (nie ma self.i)
        sl = slice(self._i - self.window, self._i)
        block_df = self.df.iloc[sl][[self.price_col] + self.feat_cols]
        block = block_df.to_numpy(dtype=np.float32)
        expected = 1 + len(self.feat_cols)
        if block.shape != (self.window, expected):
            raise RuntimeError(f"Bad window shape: {block.shape} vs {(self.window, expected)}")
        flat = block.flatten()
        price = float(self.df.iloc[self._i]['close'])
        unreal = 0.0
        if self.pos != 0 and self.entry is not None:
            dir_ = 1 if self.pos > 0 else -1
            unreal = dir_ * (price - self.entry)
        return np.concatenate([flat, np.array([self.pos, unreal], dtype=np.float32)])

    def reset(self, seed=None, options=None):
        super().reset(seed=seed)
        self._i = self._start
        self.pos = 0
        self.entry = None
        self.equity = 1.0
        self.prev_eq = 1.0
        return self._obs(), {}

    def step(self, action):
        # Normalizacja akcji
        if isinstance(action, (np.ndarray, list, tuple)):
            action = int(action[0])
        else:
            action = int(action)
        if not self.action_space.contains(action):
            raise ValueError("Invalid action")

        info = {}
        ts = self.df.iloc[self._i]['time']
        inside = self._in_trade_hours(ts)
        price = float(self.df.iloc[self._i]['close'])
        prev = float(self.df.iloc[self._i - 1]['close'])

        slip = self.slippage_k * abs(price - prev)
        desired = [-1, 0, 1][action]
        if not inside and self.enforce_flat_outside:
            desired = 0

        # Zmiana pozycji (koszty + ewentualny flip penalty)
        if desired != self.pos:
            # flip penalty przy odwróceniu bez przejścia przez 0
            if self.pos != 0 and desired != 0 and np.sign(self.pos) != np.sign(desired) and self.flip_penalty > 0:
                if self.reward_mode == 'pct':
                    self.equity *= max(1.0 - self.flip_penalty, 1e-6)
                else:
                    self.equity -= self.flip_penalty
                info['flip_penalty'] = float(self.flip_penalty)

            # koszt zamknięcia starej pozycji
            if self.pos != 0 and self.entry is not None:
                cost = (self.spread_abs + slip) / max(price, 1e-12) + self.commission_rate
                if self.reward_mode == 'pct':
                    self.equity *= max(1.0 - cost, 1e-6)
                else:
                    self.equity -= cost

            # otwórz nową (lub wyzeruj)
            self.pos = desired
            if self.pos != 0:
                cost = (self.spread_abs + slip) / max(price, 1e-12) + self.commission_rate
                if self.reward_mode == 'pct':
                    self.equity *= max(1.0 - cost, 1e-6)
                else:
                    self.equity -= cost
                self.entry = price
            else:
                self.entry = None

        # Zmiana equity w kroku
        if self.reward_mode == 'pct':
            step_ret = 0.0
            if self.pos != 0:
                dir_ = 1 if self.pos > 0 else -1
                step_ret = dir_ * ((price / max(prev, 1e-12)) - 1.0)
            self.equity *= (1.0 + step_ret)
            reward = float(self.equity - self.prev_eq)
        else:
            reward = float(self.equity - self.prev_eq)

        self.prev_eq = self.equity
        self._i += 1

        terminated = bool(self._i >= len(self.df) - 1)
        truncated = False
        if self.equity <= self.min_equity:
            truncated = True
            info['early_stop'] = True

        info.update({
            'time': ts,
            'price': price,
            'pos': int(self.pos),
            'equity': float(self.equity),
            'inside_hours': bool(inside)
        })
        return self._obs(), reward, terminated, truncated, info

=== FILE: features_check.py ===

import pandas as pd

df = pd.read_csv("data/XAUUSD_M5_features.csv", parse_dates=["time"])
print("features rows:", len(df), "from:", df["time"].min(), "to:", df["time"].max())
print(df.tail(3))

=== FILE: fetch__mt5_data.py ===

# -*- coding: utf-8 -*-
"""
fetch__mt5_data.py
------------------
Pobiera świece M5 (inkrementalnie do 720 dni) oraz próbkę ticków z MT5.

• Inkrementalny merge do jednego CSV z 720 dni (przycinanie, deduplikacja po 'time').
• Obejścia brokerów: copy_rates_range (naive datetimes) z fallbackiem do copy_rates_from_pos (tail),
  retry/backoff, chunkowanie przy pierwszym pobraniu.
• Atomiczny zapis CSV.
• Ticki weekend-safe (ostrzeżenie, nie przerywa).
• Sugestie kosztów (median/p75 spread + heurystyka slippage_k).
• Czas wszędzie UTC-aware.

Użycie:
    python fetch__mt5_data.py
"""
from __future__ import annotations

import time
from datetime import datetime, timedelta, timezone
from pathlib import Path

import MetaTrader5 as mt5
import numpy as np
import pandas as pd
import yaml

# nasze utilsy
from utils.atomic import atomic_write_csv
from utils.mt5_health import ensure_mt5_ready

# ============================================================
# Konfiguracja
# ============================================================
CFG_PATH = "config.yaml"
cfg = yaml.safe_load(open(CFG_PATH, "r", encoding="utf-8"))
if not isinstance(cfg, dict) or "files" not in cfg:
    raise RuntimeError(f"{CFG_PATH} jest pusty lub ma złą strukturę (brak sekcji 'files').")

SYMBOL = cfg.get("symbol", "XAUUSD")
BARS_CSV = cfg["files"]["bars_csv"]
TICKS_CSV = cfg["files"]["ticks_csv"]
HISTORY_DAYS = int(cfg.get("history_days", 720))

TF_MAP = {
    "M1": mt5.TIMEFRAME_M1,
    "M5": mt5.TIMEFRAME_M5,
    "M15": mt5.TIMEFRAME_M15,
    "H1": mt5.TIMEFRAME_H1,
}
TF_NAME = str(cfg.get("timeframe", "M5"))
TF = TF_MAP.get(TF_NAME, mt5.TIMEFRAME_M5)

MT5_CFG = cfg.get("mt5", {}) or {}
CHUNK = int(MT5_CFG.get("bars_chunk", 20000))  # 20k ~ 70–90 dni M5 (zależnie od brokera)
UPDATE_DAYS = int(MT5_CFG.get("update_days", 60))


# ============================================================
# MT5 init / symbol utils
# ============================================================
def init_mt5():
    """Initialize MT5 i wypisz krótkie info o terminalu/koncie."""
    if not ensure_mt5_ready():
        last_err = mt5.last_error()
        raise RuntimeError(
            f"MT5 not ready (terminal/account). Start MT5 and login. last_error={last_err}"
        )
    term = mt5.terminal_info()
    acc = mt5.account_info()
    parts = []
    if getattr(term, "company", None):
        parts.append(f"Company={term.company}")
    if getattr(term, "name", None):
        parts.append(f"TerminalName={term.name}")
    if getattr(acc, "login", 0):
        parts.append(f"Login={acc.login}")
    if getattr(acc, "server", None):
        parts.append(f"Server={acc.server}")
    if getattr(acc, "name", None):
        parts.append(f"AccountName={acc.name}")
    print("[MT5] " + " | ".join(parts) if parts else "[MT5] initialized")


def ensure_symbol(symbol: str) -> bool:
    """Upewnij się, że symbol jest widoczny w Market Watch."""
    info = mt5.symbol_info(symbol)
    if info is None:
        mt5.symbol_select(symbol, True)
        info = mt5.symbol_info(symbol)
        if info is None:
            return False
    if not info.visible:
        if not mt5.symbol_select(symbol, True):
            return False
    return True


def suggest_similar(symbol: str, limit=12):
    """Podpowiedz nazwy symboli powiązanych (np. GOLD/XAU) – zależne od serwera."""
    out = []
    try:
        for s in mt5.symbols_get():
            nm = s.name.upper()
            if ("GOLD" in nm) or ("XAU" in nm):
                out.append(s.name)
        if not out:
            out = [s.name for s in mt5.symbols_get()][:limit]
        return sorted(set(out))[:limit]
    except Exception:
        return []


# ============================================================
# Helpers
# ============================================================
def with_retries(fn, attempts=3, sleep_s=2, *a, **kw):
    last = None
    for i in range(attempts):
        try:
            return fn(*a, **kw)
        except Exception as e:
            last = e
            time.sleep(sleep_s * (i + 1))
    if last:
        raise last


def _to_df(rates) -> pd.DataFrame:
    """Konwersja stawek MT5 -> kanoniczny DataFrame z sanity-checkiem kolumn i czasu."""
    df = pd.DataFrame(rates)
    if df.empty:
        return df
    df["time"] = pd.to_datetime(df["time"], unit="s", utc=True)
    if "real_volume" in df.columns:
        df.rename(columns={"real_volume": "tick_volume"}, inplace=True)
    cols = ["time", "open", "high", "low", "close", "tick_volume", "spread"]
    # zachowaj tylko znane kolumny
    df = df[[c for c in cols if c in df.columns]].copy()
    # usuń zduplikowane nazwy i rekordy
    df = (
        df.loc[:, ~df.columns.duplicated()]
        .sort_values("time")
        .drop_duplicates("time")
        .reset_index(drop=True)
    )
    return df


def _make_naive(dt: datetime) -> datetime:
    """Zwróć 'naive' datetime (bez tzinfo) – część brokerów tego wymaga dla copy_rates_range."""
    if dt.tzinfo is not None:
        return dt.replace(tzinfo=None)
    return dt


# ============================================================
# Pobieranie danych
# ============================================================
def fetch_range(symbol, timeframe, utc_from: datetime, utc_to: datetime) -> pd.DataFrame:
    """
    Pobierz zakres 'range' z obejściami:
      • daty 'naive' (bez tzinfo),
      • fallback: tail od końca (copy_rates_from_pos) gdy range zwraca pustkę/Invalid params.
    """
    frm_n = _make_naive(utc_from)
    to_n = _make_naive(utc_to)
    rates = mt5.copy_rates_range(symbol, timeframe, frm_n, to_n)
    if rates is None or len(rates) == 0:
        # fallback: tail od końca
        tail = mt5.copy_rates_from_pos(symbol, timeframe, 0, CHUNK)
        if tail is None or len(tail) == 0:
            last_err = mt5.last_error()
            raise RuntimeError(
                f"copy_rates_range empty for '{symbol}'. last_error={last_err}"
            )
        return _to_df(tail)
    return _to_df(rates)


def fetch_from_pos_tail(symbol, timeframe, count) -> pd.DataFrame:
    rates = mt5.copy_rates_from_pos(symbol, timeframe, 0, count)
    if rates is None or len(rates) == 0:
        last_err = mt5.last_error()
        raise RuntimeError(
            f"copy_rates_from_pos empty for '{symbol}'. last_error={last_err}"
        )
    return _to_df(rates)


def load_existing_bars(path: str):
    p = Path(path)
    if not p.exists():
        return None
    try:
        df = pd.read_csv(p, parse_dates=["time"])
        if df.empty:
            return None
        # Usuń kolumny techniczne i duplikaty nazw
        bad = [c for c in df.columns if str(c).startswith("Unnamed")]
        if bad:
            df = df.drop(columns=bad)
        df = df.loc[:, ~df.columns.duplicated()]
        keep = ["time", "open", "high", "low", "close", "tick_volume", "spread"]
        df = df[[c for c in keep if c in df.columns]].copy()
        # Upewnij się, że 'time' jest UTC-aware
        if pd.api.types.is_datetime64_any_dtype(df["time"]):
            if df["time"].dt.tz is None:
                df["time"] = df["time"].dt.tz_localize("UTC")
            else:
                df["time"] = df["time"].dt.tz_convert("UTC")
        else:
            df["time"] = pd.to_datetime(df["time"], utc=True)
        df = (
            df.sort_values("time")
            .drop_duplicates("time")
            .reset_index(drop=True)
        )
        return df
    except Exception:
        return None


def merge_clip(existing: pd.DataFrame | None, new_df: pd.DataFrame, keep_days: int) -> pd.DataFrame:
    """Scal istniejące i nowe świece, deduplikuj po 'time', przytnij do keep_days i oczyść nagłówki."""
    def _sanitize(d):
        if d is None or d.empty:
            return d
        d = d.loc[:, ~d.columns.duplicated()]
        bad = [c for c in d.columns if str(c).startswith("Unnamed")]
        if bad:
            d = d.drop(columns=bad)
        return d

    existing = _sanitize(existing)
    new_df = _sanitize(new_df)

    if existing is None or existing.empty:
        base = new_df.copy()
    else:
        common = [c for c in existing.columns if c in new_df.columns]
        base = (
            pd.concat([existing[common], new_df[common]], axis=0, ignore_index=True, copy=False)
            .drop_duplicates("time")
            .sort_values("time")
        )
    # time -> UTC-aware
    if pd.api.types.is_datetime64_any_dtype(base["time"]):
        if base["time"].dt.tz is None:
            base["time"] = base["time"].dt.tz_localize("UTC")
        else:
            base["time"] = base["time"].dt.tz_convert("UTC")
    else:
        base["time"] = pd.to_datetime(base["time"], utc=True)

    # clip do okna czasowego
    cutoff = datetime.now(timezone.utc) - timedelta(days=keep_days + 1)
    base = base[base["time"] >= pd.Timestamp(cutoff)].reset_index(drop=True)
    return base


def fetch_bars_incremental(symbol, timeframe, keep_days: int, update_days: int) -> pd.DataFrame:
    """
    Strategia:
      • Gdy brak pliku – zbierz historię 'od końca' (copy_rates_from_pos) w 1–8 chunkach,
        aż pokryjesz ~keep_days (z marginesem). Jeśli to się nie uda – spróbuj krótszego range.
      • Gdy plik istnieje – dociągnij ostatnie update_days (mały range z fallbackiem).
    """
    existing = load_existing_bars(BARS_CSV)

    if existing is None:
        wanted_days = keep_days + 2
        parts_df = None
        # 1–8 prób z narastającą liczbą świec (od końca)
        for i in range(1, 9):  # zwiększone do 8 prób
            count = CHUNK * i
            try:
                dft = with_retries(lambda: fetch_from_pos_tail(symbol, timeframe, count))
            except Exception:
                time.sleep(1.0)
                continue
            if dft is not None and len(dft) > 0:
                parts_df = dft
                span_days = (parts_df["time"].max() - parts_df["time"].min()).days
                print(f"[backfill] try={i} count={count} rows={len(parts_df)} span_days={span_days}")
                if span_days >= wanted_days:
                    break

        if parts_df is None or parts_df.empty:
            # Ostatnia próba – krótszy range (np. 120 dni)
            to = datetime.now(timezone.utc)
            frm = to - timedelta(days=min(120, wanted_days))
            parts_df = fetch_range(symbol, timeframe, frm, to)

        # Informacja: broker ograniczył backfill?
        try:
            final_span = (parts_df["time"].max() - parts_df["time"].min()).days if (parts_df is not None and len(parts_df) > 0) else 0
        except Exception:
            final_span = 0
        if final_span < keep_days - 5:
            print(f"[warn] broker backfill limited: span_days={final_span} < keep_days={keep_days}")

        return merge_clip(None, parts_df, keep_days)

    # Inkrementalnie: dociągnij update_days (mały range z fallbackiem)
    to = datetime.now(timezone.utc)
    frm = to - timedelta(days=max(2, update_days))
    fresh = fetch_range(symbol, timeframe, frm, to)
    merged = merge_clip(existing, fresh, keep_days)
    return merged


def fetch_ticks(symbol: str, hours: int = 24) -> pd.DataFrame:
    utc_to = datetime.now(timezone.utc)
    utc_from = utc_to - timedelta(hours=hours)
    ticks = mt5.copy_ticks_range(symbol, utc_from, utc_to, mt5.COPY_TICKS_ALL)
    if ticks is None or len(ticks) == 0:
        last_err = mt5.last_error()
        raise RuntimeError(f"No MT5 ticks for '{symbol}'. last_error={last_err}")
    tdf = pd.DataFrame(ticks)
    tdf["time"] = pd.to_datetime(tdf["time"], unit="s", utc=True)
    return tdf[["time", "bid", "ask", "last", "volume"]]


def suggest_costs(tdf: pd.DataFrame) -> dict:
    """Sugeruj koszty na bazie ticków: median/p75 spread, heurystyczny slippage_k."""
    spr = (
        tdf["ask"] - tdf["bid"]
    ).astype(float).replace([np.inf, -np.inf], np.nan).dropna()
    med_spread = float(np.median(spr)) if len(spr) else 0.0
    p75_spread = float(np.percentile(spr, 75)) if len(spr) else 0.0
    mid = (tdf["ask"] + tdf["bid"]) / 2.0
    dm = (mid.diff().abs()).replace([np.inf, -np.inf], np.nan).dropna()
    med_dm = float(np.median(dm)) if len(dm) else 0.0
    med_price = float(np.nanmedian(mid)) if len(mid) else 1.0
    # heurystyka: jaką część typowego ruchu stanowi przeciętny skok mida
    slippage_k = float(min(max(med_dm / max(med_price, 1e-12), 0.0), 0.01))
    return {
        "spread_abs_median": round(med_spread, 5),
        "spread_abs_p75": round(p75_spread, 5),
        "slippage_k_suggested": round(slippage_k, 4),
    }


# ============================================================
# Main
# ============================================================
def main():
    init_mt5()
    try:
        print(f"[CFG] symbol={SYMBOL} tf={TF_NAME} keep_days={HISTORY_DAYS} update_days={UPDATE_DAYS}")

        if not ensure_symbol(SYMBOL):
            similar = suggest_similar(SYMBOL)
            hint = ", ".join(similar) if similar else "(brak propozycji)"
            raise SystemExit(
                "Symbol not found or not visible in Market Watch: '{}'\n"
                "Try one of these (server-specific): {}\n"
                "Also open Symbols window and SHOW the instrument."
                .format(SYMBOL, hint)
            )

        # ŚWIECE
        bars = fetch_bars_incremental(SYMBOL, TF, keep_days=HISTORY_DAYS, update_days=UPDATE_DAYS)
        assert {"time", "open", "high", "low", "close"}.issubset(bars.columns), "Bars frame malformed"
        assert len(bars) > 100, "Too few bars"
        atomic_write_csv(bars, BARS_CSV)
        print(f"Saved bars: {BARS_CSV} ({len(bars)})")

        # TICKI (opcjonalnie; weekend-safe)
        try:
            ticks = with_retries(lambda: fetch_ticks(SYMBOL, hours=24))
            atomic_write_csv(ticks, TICKS_CSV)
            print(f"Saved ticks: {TICKS_CSV} ({len(ticks)})")
            sugg = suggest_costs(ticks)
            rep = Path("reports"); rep.mkdir(parents=True, exist_ok=True)
            Path("reports/costs_suggestion.yaml").write_text(
                yaml.safe_dump(sugg, allow_unicode=True, sort_keys=False),
                encoding="utf-8"
            )
            print("Cost suggestions -> reports/costs_suggestion.yaml")
        except Exception as e:
            # np. weekend: brak ticków (OK)
            print(f"[warn] ticks unavailable ({e}); keeping previous {TICKS_CSV}")

    finally:
        mt5.shutdown()


if __name__ == "__main__":
    main()

=== FILE: manually.py ===


import pandas as pd
f = pd.read_csv("data/XAUUSD_M5_features.csv", parse_dates=["time"]).sort_values("time")
print("FEAT:", len(f), f["time"].min(), "->", f["time"].max())

=== FILE: merged_repo.txt ===



=== FILE: bootstrap_pack.ps1 ===

# bootstrap_pack.ps1
$ErrorActionPreference = "Stop"

# =========================================
# Root + katalogi
# =========================================
$Root = Split-Path -Parent $MyInvocation.MyCommand.Path
$dirs = @("", "data", "features", "rl", "paper_demo", "utils", "models", "models/registry", "reports", "ops", "logs")
foreach($d in $dirs){ New-Item -ItemType Directory -Force -Path (Join-Path $Root $d) | Out-Null }

function Write-UTF8($RelPath, $Content){
  $Path = Join-Path $Root $RelPath
  $dir = Split-Path -Parent $Path
  if(!(Test-Path $dir)){ New-Item -ItemType Directory -Force -Path $dir | Out-Null }
  $Content | Out-File -FilePath $Path -Encoding utf8 -Force
}

# =========================================
# README
# =========================================
Write-UTF8 "README.md" @'
# XAUUSD RL PPO (M5) – Starter (Demo/Edu)
**Uwaga**: tylko do celów edukacyjnych, backtestów i *paper tradingu* (demo). Brak kodu wysyłającego realne zlecenia.

## Szybki start
```powershell
python -m venv .venv
# .\.venv\Scripts\Activate.ps1
pip install -r requirements.txt
# Na końcu zainstaluj TORCH odpowiedni dla CPU/GPU z pytorch.org (wheel).
python fetch__mt5_data.py
python utils\calibration.py
python utils\calibration.py --apply
python features\build_features.py
python rl\train_ppo.py --timesteps 1500000
python rl\evaluate.py --out_dir reports
python utils\make_report.py

24/7 na Windows
Użyj skryptów w ops\ oraz NSSM (patrz ops\install_services.ps1).
Dane i historia
Trzymamy 720 dni historii świec. Zbieracz działa inkrementalnie: dociąga ostatnie update_days (domyślnie 60), scala z istniejacym CSV i przycina do 720 dni. Zapisy CSV są atomowe.
'@
# =========================================
# requirements.txt
# =========================================
Write-UTF8 "requirements.txt" @'
pandas>=2.0
numpy>=1.24
pytz
PyYAML
joblib
matplotlib
tensorboard
MetaTrader5
gymnasium>=0.29
stable-baselines3>=2.2.1
torch: zainstaluj odpowiedni wheel (CPU/GPU) z pytorch.org
'@
# =========================================
# config.yaml
# =========================================
Write-UTF8 "config.yaml" @'
symbol: "XAUUSD"
timeframe: "M5"
history_days: 720  # wymagane okno historii
window: 128
mt5:
bars_chunk: 20000   # ile świec pobierać jednorazowo przy "from_pos" (~70-90 dni M5)
# update_days: 60     # inkrementalny zakres odświeżania (do scalenia z istniejacym CSV)
files:
bars_csv: "data/XAUUSD_M5.csv"
ticks_csv: "data/XAUUSD_ticks_sample.csv"
features_csv: "data/XAUUSD_M5_features.csv"
model_path: "models/ppo_xauusd_m5.zip"
vecnorm_path: "models/vecnorm_xauusd_m5.pkl"
costs:
spread_abs: 0.05
commission_rate: 0.0001
slippage_k: 0.10
env:
reward_mode: "pct"
flip_penalty: 0.002
trade_hours_utc: ["06:00", "20:00"]
enforce_flat_outside_hours: true
min_equity: 0.8
'@
# =========================================
# utils/atomic.py
# =========================================
Write-UTF8 "utils/atomic.py" @'
from pathlib import Path
def atomic_write_csv(df, path: str):
p = Path(path)
p.parent.mkdir(parents=True, exist_ok=True)
tmp = p.with_suffix(p.suffix + ".tmp")
df.to_csv(tmp, index=False)
tmp.replace(p)
'@
# =========================================
# utils/mt5_health.py
# =========================================
Write-UTF8 "utils/mt5_health.py" @'
import MetaTrader5 as mt5, time
def ensure_mt5_ready(retries=3, sleep_s=2):
"""Ponawia initialize i weryfikuje, że terminal + konto są gotowe."""
for i in range(retries):
if mt5.initialize():
ti, ai = mt5.terminal_info(), mt5.account_info()
if ti and ai and getattr(ai, "login", 0):
return True
mt5.shutdown()
time.sleep(sleep_s * (i + 1))
return False
'@
# =========================================
# env_xau.py
# =========================================
Write-UTF8 "env_xau.py" @'
-- coding: utf-8 --
import numpy as np, pandas as pd
import gymnasium as gym
from gymnasium import spaces
from datetime import time as dtime
class XauTradingEnv(gym.Env):
metadata = {"render_modes": []}
def init(self, df: pd.DataFrame, window=128,
spread_abs=0.05, commission_rate=0.0001, slippage_k=0.10,
reward_mode: str = "pct", use_close_norm: bool = True,
flip_penalty: float = 0.0, trade_hours_utc=None,
enforce_flat_outside_hours: bool = True, features_spec: list | None = None,
min_equity: float = 0.8):
super().init()
self.df = df.reset_index(drop=True)
self.window = int(window)
self.spread_abs = float(spread_abs)
self.commission_rate = float(commission_rate)
self.slippage_k = float(slippage_k)
assert reward_mode in {"pct","points"}
self.reward_mode = reward_mode
self.use_close_norm = use_close_norm
self.flip_penalty = float(flip_penalty)
self.enforce_flat_outside = bool(enforce_flat_outside_hours)
self.min_equity = float(min_equity)
self.trade_hours = None
if trade_hours_utc and isinstance(trade_hours_utc,(list,tuple)) and len(trade_hours_utc)==2:
try:
s = [int(x) for x in str(trade_hours_utc[0]).split(":")]
e = [int(x) for x in str(trade_hours_utc[1]).split(":")]
self.trade_hours = (dtime(s[0], s[1] if len(s)>1 else 0), dtime(e[0], e[1] if len(e)>1 else 0))
except Exception:
self.trade_hours = None
base_cols = ['open','high','low','close','tick_volume','spread','time']
if features_spec is not None:
missing = [c for c in features_spec if c not in self.df.columns]
if missing: raise ValueError(f"Missing feature columns: {missing}")
self.feat_cols = list(features_spec)
else:
self.feat_cols = [c for c in self.df.columns if c not in base_cols]
self.price_col = 'close_norm' if (self.use_close_norm and 'close_norm' in self.df.columns) else 'close'
if len(self.df) <= self.window:
raise ValueError(f"Not enough rows: {len(self.df)} <= window {self.window}")
obs_dim = self.window * (1 + len(self.feat_cols)) + 2
self.action_space = spaces.Discrete(3)
self.observation_space = spaces.Box(low=-np.inf, high=np.inf, shape=(obs_dim,), dtype=np.float32)
self._start = self.window
self._i = None
self.pos = 0
self.entry = None
self.equity = 1.0
self.prev_eq = 1.0
def _in_trade_hours(self, ts)->bool:
if self.trade_hours is None: return True
try: t = ts.to_pydatetime().time()
except Exception: t = ts
start, end = self.trade_hours
if start <= end: return (t>=start) and (t<=end)
return (t>=start) or (t<=end)
def _obs(self):
sl = slice(self._i - self.window, self.i)
block_df = self.df.iloc[sl][[self.price_col] + self.feat_cols]
block = block_df.to_numpy(dtype=np.float32)
expected = 1 + len(self.feat_cols)
if block.shape != (self.window, expected):
raise RuntimeError(f"Bad window shape: {block.shape} vs {(self.window, expected)}")
flat = block.flatten()
price = float(self.df.iloc[self.i]['close'])
unreal = 0.0
if self.pos != 0 and self.entry is not None:
dir = 1 if self.pos>0 else -1
unreal = dir * (price - self.entry)
import numpy as np
return np.concatenate([flat, np.array([self.pos, unreal], dtype=np.float32)])
def reset(self, seed=None, options=None):
super().reset(seed=seed)
self._i = self._start
self.pos = 0; self.entry = None
self.equity = 1.0; self.prev_eq = 1.0
return self._obs(), {}
def step(self, action):
import numpy as np
if isinstance(action,(np.ndarray,list,tuple)): action = int(action[0])
else: action = int(action)
if not self.action_space.contains(action): raise ValueError("Invalid action")
info = {}
ts = self.df.iloc[self._i]['time']
inside = self._in_trade_hours(ts)
price = float(self.df.iloc[self.i]['close'])
prev = float(self.df.iloc[self.i-1]['close'])
slip = self.slippage_k * abs(price - prev)
desired = [-1,0,1][action]
if not inside and self.enforce_flat_outside: desired = 0
if desired != self.pos:
if self.pos != 0 and desired != 0 and np.sign(self.pos) != np.sign(desired) and self.flip_penalty>0:
if self.reward_mode == 'pct': self.equity *= max(1.0 - self.flip_penalty, 1e-6)
else: self.equity -= self.flip_penalty
info['flip_penalty'] = float(self.flip_penalty)
if self.pos != 0 and self.entry is not None:
cost = (self.spread_abs + slip)/max(price,1e-12) + self.commission_rate
if self.reward_mode == 'pct': self.equity *= max(1.0 - cost, 1e-6)
else: self.equity -= cost
self.pos = desired
if self.pos != 0:
cost = (self.spread_abs + slip)/max(price,1e-12) + self.commission_rate
if self.reward_mode == 'pct': self.equity *= max(1.0 - cost, 1e-6)
else: self.equity -= cost
self.entry = price
else:
self.entry = None
if self.reward_mode == 'pct':
step_ret = 0.0
if self.pos != 0:
dir = 1 if self.pos>0 else -1
step_ret = dir * ((price/max(prev,1e-12)) - 1.0)
self.equity *= (1.0 + step_ret)
reward = float(self.equity - self.prev_eq)
else:
reward = float(self.equity - self.prev_eq)
self.prev_eq = self.equity
self._i += 1
terminated = bool(self._i >= len(self.df) - 1)
truncated = False
if self.equity <= self.min_equity:
truncated = True
info['early_stop'] = True
info.update({'time': ts, 'price': price, 'pos': int(self.pos), 'equity': float(self.equity), 'inside_hours': bool(inside)})
return self._obs(), reward, terminated, truncated, info
'@
# =========================================
# rl/train_ppo.py
# =========================================
Write-UTF8 "rl/train_ppo.py" @'
-- coding: utf-8 --
"""PPO training with VecNormalize/Monitor/TimeLimit and features_spec."""
import argparse, yaml, json
import pandas as pd
from pathlib import Path
from stable_baselines3 import PPO
from stable_baselines3.common.vec_env import DummyVecEnv, VecNormalize, VecMonitor, sync_envs_normalization
from stable_baselines3.common.callbacks import EvalCallback
from stable_baselines3.common.utils import set_random_seed
from gymnasium.wrappers import TimeLimit
from env_xau import XauTradingEnv
parser = argparse.ArgumentParser()
parser.add_argument('--timesteps', type=int, default=1500000)
parser.add_argument('--seed', type=int, default=42)
parser.add_argument('--eval_freq', type=int, default=100000)
parser.add_argument('--n_eval_episodes', type=int, default=1)
parser.add_argument('--max_train_steps', type=int, default=6000)
parser.add_argument('--max_eval_steps', type=int, default=3000)
args = parser.parse_args()
cfg = yaml.safe_load(open('config.yaml','r',encoding='utf-8'))
FEAT = cfg['files']['features_csv']
MODEL_PATH = Path(cfg['files']['model_path'])
VECNORM_PATH = Path(cfg.get('files',{}).get('vecnorm_path','models/vecnorm_xauusd_m5.pkl'))
WINDOW = int(cfg.get('window',128))
COSTS = cfg['costs']
ENV_CFG = cfg.get('env',{})
REWARD_MODE = ENV_CFG.get('reward_mode', cfg.get('reward_mode','pct'))
FLIP_PENALTY = float(ENV_CFG.get('flip_penalty', cfg.get('flip_penalty',0.0)))
TRADE_HOURS = ENV_CFG.get('trade_hours_utc', cfg.get('trade_hours_utc', None))
MIN_EQ = float(ENV_CFG.get('min_equity', 0.8))
df = pd.read_csv(FEAT, parse_dates=['time'])
cut_val = df['time'].max() - pd.Timedelta(days=120)
train_df = df[df['time'] < cut_val].copy()
val_df   = df[df['time'] >= cut_val].copy()
features_spec = None
fspec = Path('models/features_spec.json')
if fspec.exists():
features_spec = json.loads(fspec.read_text(encoding='utf-8')).get('feature_columns', None)
set_random_seed(args.seed)
def make_train():
env = XauTradingEnv(train_df, window=WINDOW,
spread_abs=COSTS['spread_abs'], commission_rate=COSTS['commission_rate'], slippage_k=COSTS['slippage_k'],
reward_mode=REWARD_MODE, use_close_norm=True, flip_penalty=FLIP_PENALTY, trade_hours_utc=TRADE_HOURS,
enforce_flat_outside_hours=True, features_spec=features_spec, min_equity=MIN_EQ)
return TimeLimit(env, max_episode_steps=args.max_train_steps)
def make_eval():
env = XauTradingEnv(val_df, window=WINDOW,
spread_abs=COSTS['spread_abs'], commission_rate=COSTS['commission_rate'], slippage_k=COSTS['slippage_k'],
reward_mode=REWARD_MODE, use_close_norm=True, flip_penalty=0.0, trade_hours_utc=TRADE_HOURS,
enforce_flat_outside_hours=True, features_spec=features_spec, min_equity=MIN_EQ)
return TimeLimit(env, max_episode_steps=args.max_eval_steps)
venv_train = DummyVecEnv([make_train]); venv_train = VecMonitor(venv_train); venv_train = VecNormalize(venv_train, norm_obs=True, norm_reward=True, clip_obs=10.0, clip_reward=10.0)
venv_eval  = DummyVecEnv([make_eval]);  venv_eval  = VecMonitor(venv_eval);  venv_eval  = VecNormalize(venv_eval, training=False, norm_obs=True, norm_reward=False)
policy_kwargs = dict(net_arch=dict(pi=[128,128], vf=[128,128]))
try:
import tensorboard as _tb
tb_log_dir = 'logs/ppo_gold_m5'
except Exception:
tb_log_dir = None
model = PPO('MlpPolicy', venv_train, n_steps=4096, batch_size=256, learning_rate=3e-4, ent_coef=0.02,
policy_kwargs=policy_kwargs, seed=args.seed, verbose=1, tensorboard_log=tb_log_dir)
sync_envs_normalization(venv_eval, venv_train)
eval_cb = EvalCallback(venv_eval, best_model_save_path=str(MODEL_PATH.parent), log_path='logs/eval',
eval_freq=max(args.eval_freq,1), n_eval_episodes=max(args.n_eval_episodes,1),
deterministic=True, render=False)
model.learn(total_timesteps=args.timesteps, callback=eval_cb)
MODEL_PATH.parent.mkdir(parents=True, exist_ok=True)
model.save(str(MODEL_PATH))
venv_train.save(str(VECNORM_PATH))
print(f"Saved model: {MODEL_PATH}")
print(f"Saved VecNormalize: {VECNORM_PATH}")
'@
# =========================================
# rl/evaluate.py
# =========================================
Write-UTF8 "rl/evaluate.py" @'
-- coding: utf-8 --
"""Validate PPO on last ~120 days, save equity plot and trace CSV."""
import argparse, yaml, json
import pandas as pd, numpy as np
import matplotlib.pyplot as plt
from pathlib import Path
from gymnasium.wrappers import TimeLimit
from stable_baselines3 import PPO
from stable_baselines3.common.vec_env import DummyVecEnv, VecNormalize, VecMonitor
from env_xau import XauTradingEnv
parser = argparse.ArgumentParser()
parser.add_argument('--max_eval_steps', type=int, default=3000)
parser.add_argument('--out_dir', type=str, default='reports')
args = parser.parse_args()
OUT = Path(args.out_dir); OUT.mkdir(parents=True, exist_ok=True)
cfg = yaml.safe_load(open('config.yaml','r',encoding='utf-8'))
FEAT = cfg['files']['features_csv']
MODEL_PATH = cfg['files']['model_path']
VECNORM_PATH = cfg.get('files',{}).get('vecnorm_path','models/vecnorm_xauusd_m5.pkl')
WINDOW = int(cfg.get('window',128))
COSTS = cfg['costs']
ENV_CFG = cfg.get('env',{})
REWARD_MODE = ENV_CFG.get('reward_mode', cfg.get('reward_mode','pct'))
MIN_EQ = float(ENV_CFG.get('min_equity', 0.8))
df = pd.read_csv(FEAT, parse_dates=['time'])
cut_val = df['time'].max() - pd.Timedelta(days=120)
val = df[df['time']>=cut_val].copy()
features_spec = None
fspec = Path('models/features_spec.json')
if fspec.exists():
features_spec = json.loads(fspec.read_text(encoding='utf-8')).get('feature_columns', None)
def make_eval():
env = XauTradingEnv(val, window=WINDOW,
spread_abs=COSTS['spread_abs'], commission_rate=COSTS['commission_rate'], slippage_k=COSTS['slippage_k'],
reward_mode=REWARD_MODE, use_close_norm=True, features_spec=features_spec, min_equity=MIN_EQ)
return TimeLimit(env, max_episode_steps=args.max_eval_steps)
venv = DummyVecEnv([make_eval]); venv = VecMonitor(venv)
if Path(VECNORM_PATH).exists():
venv = VecNormalize.load(VECNORM_PATH, venv)
venv.training=False; venv.norm_reward=False
model = PPO.load(MODEL_PATH, env=venv)
obs = venv.reset(); eq=[]; rows=[]; done=False
while not done:
action,_ = model.predict(obs, deterministic=True)
obs, rewards, dones, infos = venv.step(action)
equity = venv.get_attr('equity', indices=0)[0]
eq.append(float(equity))
info0 = infos[0] if isinstance(infos,(list,tuple)) else infos
rows.append({'time': str(info0.get('time','')), 'price': info0.get('price',np.nan), 'pos': info0.get('pos',np.nan),
'equity': equity, 'action': int(action[0]) if hasattr(action,'len') else int(action)})
done = bool(dones[0])
s = pd.Series(eq)
final_eq = float(s.iloc[-1]); min_eq=float(s.min()); peak=s.cummax(); max_dd=float((s/peak-1.0).min())
plt.figure(figsize=(10,4)); plt.plot(s.values); plt.title('Equity (validation)'); plt.tight_layout()
plt.savefig((OUT/'equity_val.png').as_posix(), dpi=150)
(OUT/'val_metrics.txt').write_text(
f"Final equity: {final_eq:.6f}\nMin equity: {min_eq:.6f}\nMax drawdown: {max_dd:.6f}\n", encoding='utf-8')
pd.DataFrame(rows).to_csv(OUT/'eval_trace.csv', index=False)
print("Saved validation results.")
'@
# =========================================
# rl/walk_forward.py
# =========================================
Write-UTF8 "rl/walk_forward.py" @'
-- coding: utf-8 --
"""Walk-forward evaluation with per-fold traces and CSV/TXT outputs."""
import argparse, yaml, json
import pandas as pd, numpy as np
from pathlib import Path
from gymnasium.wrappers import TimeLimit
from stable_baselines3 import PPO
from stable_baselines3.common.vec_env import DummyVecEnv, VecNormalize, VecMonitor
from env_xau import XauTradingEnv
parser = argparse.ArgumentParser()
parser.add_argument('--segments', type=int, default=6)
parser.add_argument('--train_days', type=int, default=120)
parser.add_argument('--val_days', type=int, default=30)
parser.add_argument('--timesteps', type=int, default=500000)
parser.add_argument('--seed', type=int, default=42)
parser.add_argument('--out_dir', type=str, default='reports_wf')
args = parser.parse_args()
cfg = yaml.safe_load(open('config.yaml','r',encoding='utf-8'))
FEAT = cfg['files']['features_csv']
WINDOW = int(cfg.get('window',128))
COSTS = cfg['costs']
ENV_CFG = cfg.get('env',{})
REWARD_MODE = ENV_CFG.get('reward_mode', cfg.get('reward_mode','pct'))
FLIP_PENALTY = float(ENV_CFG.get('flip_penalty', cfg.get('flip_penalty',0.0)))
TRADE_HOURS = ENV_CFG.get('trade_hours_utc', cfg.get('trade_hours_utc', None))
MIN_EQ = float(ENV_CFG.get('min_equity', 0.8))
out = Path(args.out_dir); out.mkdir(parents=True, exist_ok=True)
df = pd.read_csv(FEAT, parse_dates=['time']).sort_values('time').reset_index(drop=True)
end_time = df['time'].max()
features_spec=None
fspec = Path('models/features_spec.json')
if fspec.exists(): features_spec = json.loads(fspec.read_text(encoding='utf-8')).get('feature_columns', None)
rows=[]
for k in range(args.segments):
val_end = end_time - pd.Timedelta(days=k*args.val_days)
val_start = val_end - pd.Timedelta(days=args.val_days)
train_end = val_start
train_start = train_end - pd.Timedelta(days=args.train_days)
tr = df[(df['time']>=train_start)&(df['time']<train_end)].copy()
va = df[(df['time']>=val_start)&(df['time']<val_end)].copy()
if len(tr)<=WINDOW or len(va)<=WINDOW: continue
def make_train():
env = XauTradingEnv(tr, window=WINDOW, spread_abs=COSTS['spread_abs'], commission_rate=COSTS['commission_rate'], slippage_k=COSTS['slippage_k'],
reward_mode=REWARD_MODE, use_close_norm=True, flip_penalty=FLIP_PENALTY, trade_hours_utc=TRADE_HOURS,
enforce_flat_outside_hours=True, features_spec=features_spec, min_equity=MIN_EQ)
return TimeLimit(env, max_episode_steps=6000)
def make_eval():
env = XauTradingEnv(va, window=WINDOW, spread_abs=COSTS['spread_abs'], commission_rate=COSTS['commission_rate'], slippage_k=COSTS['slippage_k'],
reward_mode=REWARD_MODE, use_close_norm=True, flip_penalty=0.0, trade_hours_utc=TRADE_HOURS,
enforce_flat_outside_hours=True, features_spec=features_spec, min_equity=MIN_EQ)
return TimeLimit(env, max_episode_steps=3000)
vt = DummyVecEnv([make_train]); vt = VecMonitor(vt); vt = VecNormalize(vt, norm_obs=True, norm_reward=True)
ve = DummyVecEnv([make_eval]);  ve = VecMonitor(ve)
model = PPO('MlpPolicy', vt, n_steps=4096, batch_size=256, learning_rate=3e-4, ent_coef=0.02, seed=args.seed, verbose=0)
model.learn(total_timesteps=args.timesteps)
tmp = out/f'vecnorm_{k}.pkl'; vt.save(str(tmp))
ve = VecNormalize.load(str(tmp), ve); ve.training=False; ve.norm_reward=False
obs = ve.reset(); eq=[]; trace=[]; done=False
while not done:
action,=model.predict(obs, deterministic=True)
obs, rewards, dones, infos = ve.step(action)
equity = ve.get_attr('equity', indices=0)[0]
eq.append(float(equity))
info0=infos[0] if isinstance(infos,(list,tuple)) else infos
trace.append({'k':k,'time':str(info0.get('time','')),'price':info0.get('price',np.nan),'pos':info0.get('pos',np.nan),'equity':equity,
'action':int(action[0]) if hasattr(action,'len') else int(action)})
done = bool(dones[0])
s = pd.Series(eq); final_eq=float(s.iloc[-1]); min_eq=float(s.min()); peak=s.cummax(); max_dd=float((s/peak-1.0).min())
rows.append({'k':k,'train_start':train_start,'train_end':train_end,'val_start':val_start,'val_end':val_end,'final_eq':final_eq,'min_eq':min_eq,'max_dd':max_dd,'n_steps':int(len(s))})
pd.DataFrame(trace).to_csv(out/f'fold{k}_trace.csv', index=False)
res = pd.DataFrame(rows).sort_values('k'); res.to_csv(out/'wf_results.csv', index=False)
if res.empty:
txt=['# Walk-Forward Report','No results (windows too short?).']
else:
agg={'folds':len(res),'final_eq_med':float(res['final_eq'].median()),'max_dd_med':float(res['max_dd'].median()),'n_steps_sum':int(res['n_steps'].sum())}
txt=['# Walk-Forward Report',f"Folds: {agg['folds']}",f"Median Final Equity: {agg['final_eq_med']:.4f}",f"Median MaxDD: {agg['max_dd_med']:.2%}",f"Total steps: {agg['n_steps_sum']}"]
(out/'wf_report.txt').write_text('`n'.join(txt), encoding='utf-8')
print("Saved walk-forward results.")
'@
# =========================================
# paper_demo/paper_loop_mt5_demo.py (poprawiony)
# =========================================
Write-UTF8 "paper_demo/paper_loop_mt5_demo.py" @'
-- coding: utf-8 --
"""Paper trading (DEMO) - pull M5 bars from MT5, build features incrementally, log decisions."""
import MetaTrader5 as mt5
import pandas as pd, numpy as np, yaml, time, logging, json
from pathlib import Path
from stable_baselines3 import PPO
from stable_baselines3.common.vec_env import DummyVecEnv, VecNormalize
from utils.mt5_health import ensure_mt5_ready
logging.basicConfig(filename='paper_demo/paper_trading.log', level=logging.INFO, format='%(asctime)s %(levelname)s %(message)s')
cfg = yaml.safe_load(open('config.yaml','r',encoding='utf-8'))
SYMBOL = cfg['symbol']; WINDOW=int(cfg.get('window',128))
MODEL_PATH = cfg['files']['model_path']; VECNORM_PATH = cfg.get('files',{}).get('vecnorm_path','models/vecnorm_xauusd_m5.pkl')
TF_MAP={'M1': mt5.TIMEFRAME_M1,'M5': mt5.TIMEFRAME_M5,'M15': mt5.TIMEFRAME_M15}; TF_NAME = cfg.get('timeframe','M5'); TF = TF_MAP.get(TF_NAME, mt5.TIMEFRAME_M5)
features_spec=None; fs=Path('models/features_spec.json')
if fs.exists(): features_spec=json.loads(fs.read_text(encoding='utf-8')).get('feature_columns', None)
def add_features_incremental(df: pd.DataFrame)->pd.DataFrame:
df=df.sort_values('time').reset_index(drop=True)
df['ret1']=np.log(df['close']).diff()
df['ema10']=df['close'].ewm(span=10).mean(); df['ema50']=df['close'].ewm(span=50).mean(); df['ema200']=df['close'].ewm(span=200).mean()
d=df['close'].diff(); up=d.clip(lower=0).ewm(alpha=1/14,adjust=False).mean(); down=(-d.clip(upper=0)).ewm(alpha=1/14,adjust=False).mean(); rs=up/(down+1e-12)
df['rsi14']=100-(100/(1+rs))
h,l,c=df['high'],df['low'],df['close']; tr=np.maximum(h-l, np.maximum(abs(h-c.shift()), abs(l-c.shift())))
df['atr14']=tr.ewm(alpha=1/14,adjust=False).mean()
ema_fast=df['close'].ewm(span=12,adjust=False).mean(); ema_slow=df['close'].ewm(span=26,adjust=False).mean(); macd_line=ema_fast-ema_slow; signal_line=macd_line.ewm(span=9,adjust=False).mean()
df['macd']=macd_line; df['macd_signal']=signal_line; df['macd_hist']=macd_line-signal_line
ma=df['close'].rolling(20).mean(); sd=df['close'].rolling(20).std()
df['bb_ma']=ma; df['bb_up']=ma+2sd; df['bb_lo']=ma-2sd; df['bb_width']=(df['bb_up']-df['bb_lo'])/(ma.replace(0,np.nan).abs()+1e-12)
df['minute']=df['time'].dt.hour60+df['time'].dt.minute; df['tod_sin']=np.sin(2np.pidf['minute']/1440); df['tod_cos']=np.cos(2np.pidf['minute']/1440); df.drop(columns=['minute'], inplace=True)
df['dow']=df['time'].dt.dayofweek; df['dow_sin']=np.sin(2np.pidf['dow']/7); df['dow_cos']=np.cos(2np.pi*df['dow']/7); df.drop(columns=['dow'], inplace=True)
df['close_log']=np.log(df['close'].clip(lower=1e-12)); mu=df['close_log'].rolling(2000,min_periods=200).mean(); s=df['close_log'].rolling(2000,min_periods=200).std().replace(0,np.nan)
df['close_norm']=(df['close_log']-mu)/(s+1e-8)
norm=['ret1','ema10','ema50','ema200','rsi14','atr14','macd','macd_signal','macd_hist','bb_ma','bb_up','bb_lo','bb_width','tod_sin','tod_cos','dow_sin','dow_cos']
for c in norm:
mu=df[c].rolling(2000,min_periods=200).mean(); s=df[c].rolling(2000,min_periods=200).std().replace(0,np.nan); df[c]=(df[c]-mu)/(s+1e-8)
return df.dropna().reset_index(drop=True)
def get_last_bars(symbol, timeframe, n:int):
rates = mt5.copy_rates_from_pos(symbol, timeframe, 0, n)
if rates is None or len(rates)<n: return None
df=pd.DataFrame(rates); df['time']=pd.to_datetime(df['time'], unit='s', utc=True); df.rename(columns={'real_volume':'tick_volume'}, inplace=True)
return df[['time','open','high','low','close','tick_volume','spread']]
def build_obs(df_feat: pd.DataFrame, model_obs_dim: int)->np.ndarray:
per_step=(model_obs_dim-2)//WINDOW
price_col='close_norm' if 'close_norm' in df_feat.columns else 'close'
if features_spec is None:
base=['open','high','low','close','tick_volume','spread','time']; feat_cols=[c for c in df_feat.columns if c not in base]
else:
feat_cols=[c for c in features_spec if c in df_feat.columns]
tail=df_feat.tail(WINDOW); block=tail[[price_col]+feat_cols].to_numpy(dtype=np.float32)
if block.shape!=(WINDOW, per_step): raise RuntimeError(f"Bad block {block.shape} vs {(WINDOW, per_step)}")
flat=block.flatten(); import numpy as np
return np.concatenate([flat, np.array([0.0,0.0],dtype=np.float32)])
def main():
if not ensure_mt5_ready(): raise RuntimeError("MT5 not ready (terminal/account). Start MT5 and login to a demo account.")
try:
model = PPO.load(MODEL_PATH); expected_dim=int(model.observation_space.shape[0]); assert (expected_dim-2)%WINDOW==0
vecnorm=None
if Path(VECNORM_PATH).exists():
from gymnasium import spaces
class _ObsOnlyEnv:
def init(self, obs_dim):
self.observation_space = spaces.Box(low=-np.inf, high=np.inf, shape=(obs_dim,), dtype=np.float32)
self.action_space = spaces.Discrete(3)
def reset(self, *, seed=None, options=None):
import numpy as np; return np.zeros(self.observation_space.shape, dtype=np.float32), {}
def step(self, action):
import numpy as np; return np.zeros(self.observation_space.shape, dtype=np.float32), 0.0, True, False, {}
dummy=DummyVecEnv([lambda: _ObsOnlyEnv(expected_dim)])
vecnorm=VecNormalize.load(VECNORM_PATH, dummy); vecnorm.training=False; vecnorm.norm_reward=False
Path('paper_demo').mkdir(parents=True, exist_ok=True)
csv=Path('paper_demo/decisions.csv'); if not csv.exists(): csv.write_text('time_utc,price,action_id,action_labeln', encoding='utf-8')         last_ts=None; hb_t=time.time()         while True:             bars=get_last_bars(SYMBOL, TF, n=WINDOW+800)             if bars is None or len(bars)<WINDOW+200: time.sleep(5); continue             feat=add_features_incremental(bars)             if len(feat)<WINDOW: time.sleep(5); continue             cur_ts=feat['time'].iloc[-1]             if last_ts is not None and cur_ts==last_ts: time.sleep(2); continue             obs=build_obs(feat, expected_dim)             if vecnorm is not None:                 import numpy as np; obs=vecnorm.normalize_obs(obs.reshape(1,-1)).reshape(-1)             action,_=model.predict(obs, deterministic=True)             decision={0:'SHORT',1:'FLAT',2:'LONG'}[int(action)]             price=float(feat['close'].iloc[-1]); msg=f"DECISION {decision} @ {price:.2f} (ts={cur_ts})"             print(msg); logging.info(msg)             with open(csv,'a',encoding='utf-8') as f: f.write(f"{cur_ts},{price:.5f},{int(action)},{decision}n")
last_ts=cur_ts
if time.time()-hb_t>600: logging.info(f"[HB] {SYMBOL} {TF_NAME} last_ts={cur_ts} price={price:.2f}"); hb_t=time.time()
time.sleep(30)
finally:
mt5.shutdown()
if name == 'main': main()
'@
# =========================================
# paper_demo/simulate_execution.py
# =========================================
Write-UTF8 "paper_demo/simulate_execution.py" @'
-- coding: utf-8 --
import yaml, pandas as pd
from env_xau import XauTradingEnv
from stable_baselines3 import PPO
from pathlib import Path
cfg = yaml.safe_load(open('config.yaml','r',encoding='utf-8'))
FEAT = cfg['files']['features_csv']; MODEL_PATH = cfg['files']['model_path']; WINDOW = int(cfg.get('window',128)); COSTS = cfg['costs']
df = pd.read_csv(FEAT, parse_dates=['time']); cut = df['time'].max() - pd.Timedelta(days=120); sim = df[df['time']>=cut].copy()
env = XauTradingEnv(sim, window=WINDOW, spread_abs=COSTS['spread_abs'], commission_rate=COSTS['commission_rate'], slippage_k=COSTS['slippage_k'])
obs, info = env.reset(); model = PPO.load(MODEL_PATH)
rows=[]; done=False
while not done:
action,_=model.predict(obs, deterministic=True)
obs, reward, terminated, truncated, info = env.step(action)
done = bool(terminated) or bool(truncated)
rows.append({'time': info.get('time',None), 'price': info.get('price',None), 'action': int(action), 'reward': float(reward), 'equity': float(env.equity)})
Path('reports').mkdir(parents=True, exist_ok=True)
pd.DataFrame(rows).to_csv('reports/trace_simulated.csv', index=False)
pd.Series([r['equity'] for r in rows]).to_csv('reports/equity_simulated.csv', index=False)
print('Saved simulated trace/equity.')
'@
# =========================================
# features/build_features.py (POPRAWIONY)
# =========================================
Write-UTF8 "features/build_features.py" @'
-- coding: utf-8 --
"""Feature builder: EMA/RSI/ATR + MACD + Bollinger + time cycles + rolling z-scores."""
import pandas as pd, numpy as np, yaml, json
from pathlib import Path
cfg = yaml.safe_load(open('config.yaml','r',encoding='utf-8'))
BARS = cfg['files']['bars_csv']; FEAT = cfg['files']['features_csv']
def macd(series, fast=12, slow=26, signal=9):
ema_fast = series.ewm(span=fast, adjust=False).mean()
ema_slow = series.ewm(span=slow, adjust=False).mean()
macd_line = ema_fast - ema_slow
signal_line = macd_line.ewm(span=signal, adjust=False).mean()
return macd_line, signal_line, macd_line - signal_line
def bbands(series, period=20, n_std=2.0):
ma = series.rolling(period).mean(); sd = series.rolling(period).std()
upper = ma + n_stdsd; lower = ma - n_stdsd
width = (upper - lower) / (ma.replace(0,np.nan).abs() + 1e-12)
return ma, upper, lower, width
def add_features(df):
df = df.sort_values('time').reset_index(drop=True)
c = df['close']
df['ret1'] = np.log(c).diff()
df['ema10'] = c.ewm(span=10).mean(); df['ema50']=c.ewm(span=50).mean(); df['ema200']=c.ewm(span=200).mean()
d = c.diff(); up=d.clip(lower=0).ewm(alpha=1/14,adjust=False).mean(); down=(-d.clip(upper=0)).ewm(alpha=1/14,adjust=False).mean(); rs=up/(down+1e-12)
df['rsi14'] = 100 - (100/(1+rs))
h,l,cl = df['high'], df['low'], df['close']
tr = np.maximum(h-l, np.maximum((h-cl.shift()).abs(), (l-cl.shift()).abs()))
df['atr14'] = tr.ewm(alpha=1/14, adjust=False).mean()
m,s,hst = macd(c); df['macd']=m; df['macd_signal']=s; df['macd_hist']=hst
bb_ma, bb_up, bb_lo, bb_w = bbands(c); df['bb_ma']=bb_ma; df['bb_up']=bb_up; df['bb_lo']=bb_lo; df['bb_width']=bb_w
df['minute']=df['time'].dt.hour60+df['time'].dt.minute
df['tod_sin']=np.sin(2np.pidf['minute']/1440); df['tod_cos']=np.cos(2np.pidf['minute']/1440); df.drop(columns=['minute'], inplace=True)
df['dow']=df['time'].dt.dayofweek
df['dow_sin']=np.sin(2np.pidf['dow']/7); df['dow_cos']=np.cos(2np.pi*df['dow']/7); df.drop(columns=['dow'], inplace=True)
df['close_log']=np.log(c.clip(lower=1e-12))
mu = df['close_log'].rolling(2000, min_periods=200).mean(); sd = df['close_log'].rolling(2000, min_periods=200).std().replace(0,np.nan)
df['close_norm']=(df['close_log']-mu)/(sd+1e-8)
feat_cols=['ret1','ema10','ema50','ema200','rsi14','atr14','macd','macd_signal','macd_hist','bb_ma','bb_up','bb_lo','bb_width','tod_sin','tod_cos','dow_sin','dow_cos']
for col in feat_cols:
mu = df[col].rolling(2000, min_periods=200).mean(); sd = df[col].rolling(2000, min_periods=200).std().replace(0,np.nan)
df[col]=(df[col]-mu)/(sd+1e-8)
return df.dropna().reset_index(drop=True)
df = pd.read_csv(BARS, parse_dates=['time'])
df = add_features(df)
assert len(df) > int(cfg.get('window',128)) + 10, "Too few rows for features"
Path(FEAT).parent.mkdir(parents=True, exist_ok=True)
df.to_csv(FEAT, index=False)
base_cols = ['time','open','high','low','close','tick_volume','spread']
feature_columns = [c for c in df.columns if c not in base_cols]
spec = {"feature_columns": feature_columns, "price_column":"close_norm"}
Path('models').mkdir(parents=True, exist_ok=True)
Path('models/features_spec.json').write_text(json.dumps(spec, ensure_ascii=False, indent=2), encoding='utf-8')
print("Saved features and features_spec.json")
'@
# =========================================
# fetch__mt5_data.py (inkrementalny, 720 dni, atomowy zapis, weekend-safe)
# =========================================
Write-UTF8 "fetch__mt5_data.py" @'
-- coding: utf-8 --
"""
Fetch bars & 24h tick sample from MT5 (demo/real). Incremental merge to maintain 720d.
# Atomic CSV writes, Retries/backoff, Weekend-safe ticks (warn only)
"""
import MetaTrader5 as mt5
import pandas as pd
from datetime import datetime, timedelta, timezone
import yaml
from pathlib import Path
import numpy as np, time
from utils.atomic import atomic_write_csv
from utils.mt5_health import ensure_mt5_ready
cfg = yaml.safe_load(open('config.yaml','r',encoding='utf-8'))
SYMBOL = cfg['symbol']
BARS_CSV = cfg['files']['bars_csv']
TICKS_CSV = cfg['files']['ticks_csv']
HISTORY_DAYS = int(cfg.get('history_days', 720))
TF_MAP={'M1': mt5.TIMEFRAME_M1,'M5': mt5.TIMEFRAME_M5,'M15': mt5.TIMEFRAME_M15}
TF_NAME = cfg.get('timeframe','M5'); TF = TF_MAP.get(TF_NAME, mt5.TIMEFRAME_M5)
CHUNK = int(cfg.get('mt5',{}).get('bars_chunk', 20000))
UPDATE_DAYS = int(cfg.get('mt5',{}).get('update_days', 60))
def init_mt5():
if not ensure_mt5_ready(): raise RuntimeError("MT5 not ready (terminal/account). Please login in MT5 terminal.")
term = mt5.terminal_info(); acc = mt5.account_info()
parts=[]
if getattr(term,"company",None): parts.append(f"Company={term.company}")
if getattr(term,"name",None): parts.append(f"TerminalName={term.name}")
if getattr(acc,"login",0): parts.append(f"Login={acc.login}")
if getattr(acc,"server",None): parts.append(f"Server={acc.server}")
if getattr(acc,"name",None): parts.append(f"AccountName={acc.name}")
print("[MT5] " + " | ".join(parts) if parts else "[MT5] initialized")
def ensure_symbol(symbol: str)->bool:
info = mt5.symbol_info(symbol)
if info is None:
mt5.symbol_select(symbol, True)
info = mt5.symbol_info(symbol)
if info is None: return False
if not info.visible:
if not mt5.symbol_select(symbol, True): return False
return True
def suggest_similar(symbol: str, limit=10):
cands=[]
for s in mt5.symbols_get():
name=s.name.upper()
if ("GOLD" in name) or ("XAU" in name): cands.append(s.name)
if not cands:
cands = [s.name for s in mt5.symbols_get()[:limit]]
return sorted(set(cands))[:limit]
def with_retries(fn, attempts=3, sleep_s=2, *a, **kw):
last=None
for i in range(attempts):
try:
return fn(*a, *kw)
except Exception as e:
last = e; time.sleep(sleep_s(i+1))
if last: raise last
def _to_df(rates):
df = pd.DataFrame(rates)
if df.empty: return df
df['time'] = pd.to_datetime(df['time'], unit='s', utc=True)
if 'real_volume' in df.columns:
df.rename(columns={'real_volume':'tick_volume'}, inplace=True)
cols=['time','open','high','low','close','tick_volume','spread']
return df[cols].sort_values('time').drop_duplicates('time')
def fetch_range(symbol, timeframe, utc_from, utc_to):
rates = mt5.copy_rates_range(symbol, timeframe, utc_from, utc_to)
if rates is None or len(rates)==0:
last_err = mt5.last_error()
raise RuntimeError(f"copy_rates_range empty for '{symbol}'. last_error={last_err}")
return _to_df(rates)
def fetch_from_pos_tail(symbol, timeframe, count):
rates = mt5.copy_rates_from_pos(symbol, timeframe, 0, count)
if rates is None or len(rates)==0:
last_err = mt5.last_error()
raise RuntimeError(f"copy_rates_from_pos empty for '{symbol}'. last_error={last_err}")
return _to_df(rates)
def load_existing_bars(path: str):
p = Path(path)
if not p.exists(): return None
try:
df = pd.read_csv(p, parse_dates=['time'])
if df.empty: return None
return df.sort_values('time').drop_duplicates('time').reset_index(drop=True)
except Exception:
return None
def merge_clip(existing: pd.DataFrame | None, new_df: pd.DataFrame, keep_days:int)->pd.DataFrame:
if existing is None or existing.empty:
base = new_df.copy()
else:
base = (pd.concat([existing, new_df], ignore_index=True)
.drop_duplicates('time').sort_values('time'))
cutoff = datetime.now(timezone.utc) - timedelta(days=keep_days+1)
base = base[base['time'] >= pd.Timestamp(cutoff)]
return base.reset_index(drop=True)
def fetch_bars_incremental(symbol, timeframe, keep_days:int, update_days:int)->pd.DataFrame:
existing = load_existing_bars(BARS_CSV)
if existing is None:
to = datetime.now(timezone.utc); frm = to - timedelta(days=keep_days+2)
df = with_retries(lambda: fetch_range(symbol, timeframe, frm, to))
if len(df) < 1000:
tail = with_retries(lambda: fetch_from_pos_tail(symbol, timeframe, CHUNK))
df = merge_clip(df, tail, keep_days)
return df
to = datetime.now(timezone.utc); frm = to - timedelta(days=max(2, update_days))
fresh = with_retries(lambda: fetch_range(symbol, timeframe, frm, to))
merged = merge_clip(existing, fresh, keep_days)
return merged
def fetch_ticks(symbol: str, hours: int=24)->pd.DataFrame:
utc_to = datetime.now(timezone.utc); utc_from = utc_to - timedelta(hours=hours)
ticks = mt5.copy_ticks_range(symbol, utc_from, utc_to, mt5.COPY_TICKS_ALL)
if ticks is None or len(ticks)==0:
last_err = mt5.last_error()
raise RuntimeError(f"No MT5 ticks for '{symbol}'. last_error={last_err}")
tdf = pd.DataFrame(ticks); tdf['time']=pd.to_datetime(tdf['time'], unit='s', utc=True)
return tdf[['time','bid','ask','last','volume']]
def suggest_costs(tdf: pd.DataFrame)->dict:
spr = (tdf['ask'] - tdf['bid']).astype(float).replace([np.inf,-np.inf], np.nan).dropna()
med_spread = float(np.median(spr)) if len(spr) else 0.0
p75_spread = float(np.percentile(spr, 75)) if len(spr) else 0.0
mid = (tdf['ask'] + tdf['bid'])/2.0
dm = (mid.diff().abs()).replace([np.inf,-np.inf], np.nan).dropna()
med_dm = float(np.median(dm)) if len(dm) else 0.0
med_price = float(np.nanmedian(mid)) if len(mid) else 1.0
slippage_k = float(min(max(med_dm / max(med_price, 1e-12), 0.0), 0.01))
return {'spread_abs_median': round(med_spread,5), 'spread_abs_p75': round(p75_spread,5), 'slippage_k_suggested': round(slippage_k,4)}
def main():
init_mt5()
try:
print(f"[CFG] symbol={SYMBOL} tf={TF_NAME} keep_days={HISTORY_DAYS} update_days={UPDATE_DAYS}")
if not ensure_symbol(SYMBOL):
similar = suggest_similar(SYMBOL)
raise SystemExit(
"Symbol not found or not visible in Market Watch: '{}'n"                 "Try one of these (server-specific): {}n"
"Also open Symbols window and SHOW the instrument."
.format(SYMBOL, ", ".join(similar))
)
bars = fetch_bars_incremental(SYMBOL, TF, keep_days=HISTORY_DAYS, update_days=UPDATE_DAYS)
assert {'time','open','high','low','close'}.issubset(bars.columns), "Bars frame malformed"
assert len(bars) > 100, "Too few bars"
atomic_write_csv(bars, BARS_CSV)
print(f"Saved bars: {BARS_CSV} ({len(bars)})")
# ticks są opcjonalne (weekend-safe)
try:
ticks = with_retries(lambda: fetch_ticks(SYMBOL, hours=24))
atomic_write_csv(ticks, TICKS_CSV)
print(f"Saved ticks: {TICKS_CSV} ({len(ticks)})")
sugg = suggest_costs(ticks)
Path('reports').mkdir(parents=True, exist_ok=True)
Path('reports/costs_suggestion.yaml').write_text(
yaml.safe_dump(sugg, allow_unicode=True, sort_keys=False), encoding='utf-8')
print("Cost suggestions -> reports/costs_suggestion.yaml")
except Exception as e:
print(f"[warn] ticks unavailable ({e}); keeping previous {TICKS_CSV}")
finally:
mt5.shutdown()
if name == 'main':
main()
'@
# =========================================
# utils/calibration.py
# =========================================
Write-UTF8 "utils/calibration.py" @'
-- coding: utf-8 --
"""Calibrate costs: spread (median/95p) and slippage_k ratio. Save suggestions; with --apply update config.yaml."""
import argparse, yaml, pandas as pd, numpy as np
from pathlib import Path
parser = argparse.ArgumentParser(); parser.add_argument('--apply', action='store_true'); args=parser.parse_args()
cfg = yaml.safe_load(open('config.yaml','r',encoding='utf-8'))
TICKS = cfg['files']['ticks_csv']; BARS = cfg['files']['bars_csv']
ticks = pd.read_csv(TICKS, parse_dates=['time'])
ticks['spread']=ticks['ask']-ticks['bid']; mid=(ticks['ask']+ticks['bid'])/2.0; dmid=mid.diff().abs()
spread_median=float(ticks['spread'].median()); spread_p95=float(ticks['spread'].quantile(0.95)); dmid_median=float(dmid.median())
bars=pd.read_csv(BARS, parse_dates=['time']); bar_move_med=float(bars['close'].diff().abs().median())
slippage_k=float(np.clip(dmid_median/max(bar_move_med,1e-12), 0.0, 0.5))
Path('reports').mkdir(parents=True, exist_ok=True)
Path('reports/costs_suggestion.yaml').write_text(
yaml.safe_dump({'spread_abs_median':round(spread_median,5),'spread_abs_p95':round(spread_p95,5),'slippage_k_suggested':round(slippage_k,3)},
allow_unicode=True, sort_keys=False),
encoding='utf-8')
print('Suggestions -> reports/costs_suggestion.yaml')
if args.apply:
cfg['costs']['spread_abs']=float(round(spread_median,5)); cfg['costs']['slippage_k']=float(slippage_k)
Path('config.yaml').write_text(yaml.safe_dump(cfg, allow_unicode=True, sort_keys=False), encoding='utf-8')
print('Applied to config.yaml')
'@
# =========================================
# utils/make_report.py (POPRAWIONY)
# =========================================
Write-UTF8 "utils/make_report.py" @'
-- coding: utf-8 --
import argparse, base64
from pathlib import Path
import pandas as pd, numpy as np
import matplotlib.pyplot as plt
from datetime import datetime
parser=argparse.ArgumentParser()
parser.add_argument('--equity_csv', type=str, default='reports/eval_trace.csv')
parser.add_argument('--metrics', type=str, default='reports/val_metrics.txt')
parser.add_argument('--figure', type=str, default='reports/equity_val.png')
parser.add_argument('--out_html', type=str, default='reports/report.html')
parser.add_argument('--out_txt', type=str, default='reports/report.txt')
parser.add_argument('--bars_per_day', type=int, default=288)
parser.add_argument('--trading_days', type=int, default=252)
args=parser.parse_args()
out_html=Path(args.out_html); out_txt=Path(args.out_txt)
out_html.parent.mkdir(parents=True, exist_ok=True); out_txt.parent.mkdir(parents=True, exist_ok=True)
eq=None; p=Path(args.equity_csv)
if p.exists():
df=pd.read_csv(p)
if 'equity' in df.columns: eq=df['equity'].astype(float).to_numpy()
elif df.shape[1]==1: eq=df.iloc[:,0].astype(float).to_numpy()
metrics_text = Path(args.metrics).read_text(encoding='utf-8') if Path(args.metrics).exists() else ''
img_b64=''
if Path(args.figure).exists(): img_b64=base64.b64encode(Path(args.figure).read_bytes()).decode('ascii')
if not img_b64 and eq is not None and len(eq)>1:
fig,ax=plt.subplots(figsize=(9,4)); ax.plot(eq,color='#0057B8',lw=1.5)
ax.set_title('Equity (validation)'); ax.set_xlabel('Steps'); ax.set_ylabel('Equity')
fig.tight_layout(); Path(args.figure).parent.mkdir(parents=True, exist_ok=True); fig.savefig(args.figure,dpi=144); plt.close(fig)
img_b64=base64.b64encode(Path(args.figure).read_bytes()).decode('ascii')
extra={}
if eq is not None and len(eq)>2:
ret=np.diff(eq)/np.maximum(eq[:-1],1e-12); mu=float(np.nanmean(ret)); sigma=float(np.nanstd(ret)+1e-12)
downside=ret[ret<0]; ds=float(np.nanstd(downside)+1e-12)
daily_mu = mu * args.bars_per_day; daily_sigma = sigma * (args.bars_per_day0.5)
sharpe = daily_mu/(daily_sigma+1e-12); sortino = daily_mu/(((args.bars_per_day0.5)*ds)+1e-12)
n=len(eq); years=max(n/args.bars_per_day/args.trading_days,1e-6)
cagr=(eq[-1]/max(eq[0],1e-12))**(1/max(years,1e-6))-1 if years>0 else 0.0
peak=np.maximum.accumulate(eq); max_dd=float((eq/peak-1.0).min()); calmar=(cagr/abs(max_dd)) if max_dd<0 else float('inf')
extra=dict(n_steps=n, sharpe_daily=sharpe, sortino_daily=sortino, vol_daily=daily_sigma, cagr=cagr, max_dd=max_dd, calmar=calmar)
now=datetime.now().strftime('%Y-%m-%d %H:%M:%S')
md=['# RL Validation Report (XAUUSD M5)', f'Date: {now}', '', '## Base metrics', '', metrics_text.strip() if metrics_text else '(no val_metrics.txt)', '', '']
if extra:
md += [
'## Extra metrics from equity',
f"- Steps: {extra['n_steps']}",
f"- Sharpe (daily): {extra['sharpe_daily']:.3f}",
f"- Sortino (daily): {extra['sortino_daily']:.3f}",
f"- Daily vol: {extra['vol_daily']:.4f}",
f"- CAGR (est.): {extra['cagr']:.3%}",
f"- MaxDD: {extra['max_dd']:.2%}",
f"- Calmar: {extra['calmar']:.3f}",
]
else:
md += ['No equity data.']
out_txt.write_text('\n'.join(md)+'\n', encoding='utf-8')
html=f"""RL Validation
RL Validation Report (XAUUSD M5)
Base metrics
{metrics_text if metrics_text else '(no val_metrics.txt)'}
Extra metrics
{('\n'.join(md)) if extra else 'No equity data.'}
Equity
{('data:image/png;base64,'+img_b64) if img_b64 else 'No plot.'}
Generated: {now}
"""
out_html.write_text(html, encoding='utf-8')
print('Saved report.')
'@
# =========================================
# utils/qc_bars.py & utils/time_utils.py
# =========================================
Write-UTF8 "utils/qc_bars.py" @'
#!/usr/bin/env python
import pandas as pd, argparse
parser=argparse.ArgumentParser(); parser.add_argument('--csv', required=True); parser.add_argument('--tf_min', type=int, default=5)
args=parser.parse_args()
df=pd.read_csv(args.csv, parse_dates=['time']).sort_values('time').reset_index(drop=True)
print(f"Rows: {len(df)}\nFrom: {df['time'].iloc[0]} To: {df['time'].iloc[-1]}")
dt=(df['time'].diff().dt.total_seconds()/60).fillna(args.tf_min)
gaps=df.loc[dt>args.tf_min+0.1,['time']].copy(); gaps['gap_min']=dt[dt>args.tf_min+0.1].values
print(f"Gaps > {args.tf_min} min: {len(gaps)}");
if len(gaps): print(gaps.head(10))
'@
Write-UTF8 "utils/time_utils.py" @'
from datetime import datetime, timezone
def now_utc(): return datetime.now(timezone.utc)
'@
# =========================================
# ops: env.ps1 & run scripts & promotion
# =========================================
Write-UTF8 "ops/env.ps1" @'
$ErrorActionPreference = "Stop"
$RepoRoot = Split-Path -Parent $MyInvocation.MyCommand.Path | Split-Path
$Py = Join-Path $RepoRoot ".venv\Scripts\python.exe"
$Cfg = Join-Path $RepoRoot "config.yaml"
$LogDir = Join-Path $RepoRoot "logs"
New-Item -ItemType Directory -Force -Path $LogDir | Out-Null
function RunPy([string]$script, [string]$args="") {
& $Py $script $args 2>&1 | Tee-Object -FilePath (Join-Path $LogDir ((Split-Path $script -Leaf) + ".log")) -Append
}
'@
Write-UTF8 "ops/run_collector.ps1" @'
. "$PSScriptRoot\env.ps1"
while ($true) { try { RunPy "$RepoRoot\fetch__mt5_data.py" } catch { Write-Host "Collector error: $_" } Start-Sleep -Seconds 300 }
'@
Write-UTF8 "ops/run_features.ps1" @'
. "$PSScriptRoot\env.ps1"
while ($true) { try { RunPy "$RepoRoot\features\build_features.py" } catch { Write-Host "Features error: $_" } Start-Sleep -Seconds 600 }
'@
Write-UTF8 "ops/run_paper.ps1" @'
. "$PSScriptRoot\env.ps1"
while ($true) { try { RunPy "$RepoRoot\paper_demo\paper_loop_mt5_demo.py" } catch { Write-Host "Paper loop crash: $_"; Start-Sleep -Seconds 10 } Start-Sleep -Seconds 2 }
'@
Write-UTF8 "ops/run_train_short.ps1" @'
. "$PSScriptRoot\env.ps1"
while ($true) {
try {
RunPy "$RepoRoot\rl\train_ppo.py" "--timesteps 500000 --seed 42 --eval_freq 100000"
RunPy "$RepoRoot\rl\evaluate.py" "--max_eval_steps 3000 --out_dir reports_live"
RunPy "$RepoRoot\ops\save_candidate.py"
& $Py "$RepoRoot\ops\promote_challenger.py"
} catch { Write-Host "Short training error: $_" }
Start-Sleep -Seconds 14400
}
'@
Write-UTF8 "ops/run_train_nightly.ps1" @'
. "$PSScriptRoot\env.ps1"
while ($true) {
try {
while ( (Get-Date).ToUniversalTime().Hour -ne 23 ) { Start-Sleep -Seconds 600 }
Start-Sleep -Seconds 300
RunPy "$RepoRoot\rl\train_ppo.py" "--timesteps 2000000 --seed 42 --eval_freq 200000"
RunPy "$RepoRoot\rl\walk_forward.py" "--segments 6 --train_days 120 --val_days 30 --timesteps 500000 --out_dir reports_wf"
RunPy "$RepoRoot\rl\evaluate.py" "--max_eval_steps 3000 --out_dir reports_nightly"
RunPy "$RepoRoot\ops\save_candidate.py"
& $Py "$RepoRoot\ops\promote_challenger.py"
} catch { Write-Host "Nightly training error: $_" }
Start-Sleep -Seconds 3600
}
'@
Write-UTF8 "ops/save_candidate.py" @'
import json, shutil
from pathlib import Path
ROOT = Path(file).resolve().parents[1]
REG = ROOT / 'models' / 'registry'; REG.mkdir(parents=True, exist_ok=True)
MODEL = ROOT / 'models' / 'ppo_xauusd_m5.zip'
VEC   = ROOT / 'models' / 'vecnorm_xauusd_m5.pkl'
METR  = ROOT / 'reports' / 'val_metrics.txt'
EQP   = ROOT / 'reports' / 'equity_val.png'
def parse_metrics_txt(p: Path):
d = {}
if p.exists():
txt = p.read_text(encoding='utf-8')
for line in txt.splitlines():
if ':' in line:
k, v = line.split(':', 1)
k = k.strip().lower().replace(' ', '')
try: d[k] = float(v.strip())
except: pass
return d
def main():
m = parse_metrics_txt(METR)
if not m:
print('[save_candidate] No metrics.'); return
tag = 'cand' + Path.cwd().name + '_'
n=0
while (REG / f"{tag}{n:02d}").exists(): n+=1
dst = REG / f"{tag}{n:02d}"
dst.mkdir(parents=True, exist_ok=True)
shutil.copy2(MODEL, dst/'model.zip')
if VEC.exists(): shutil.copy2(VEC, dst/'vecnorm.pkl')
if EQP.exists(): shutil.copy2(EQP, dst/'equity.png')
(dst/'metrics.json').write_text(json.dumps({
'final_equity': m.get('final_equity'),
'max_dd': m.get('max_drawdown'),
'sharpe': m.get('sharpe_daily'),
}, indent=2), encoding='utf-8')
print(f'[save_candidate] Saved candidate -> {dst}')
if name == 'main': main()
'@
Write-UTF8 "ops/promote_challenger.py" @'
import json, shutil
from pathlib import Path
ROOT = Path(file).resolve().parents[1]
REG = ROOT / 'models' / 'registry'; REG.mkdir(parents=True, exist_ok=True)
CUR_TXT = REG / 'current.txt'
MODEL_DST = ROOT / 'models' / 'ppo_xauusd_m5.zip'
VEC_DST   = ROOT / 'models' / 'vecnorm_xauusd_m5.pkl'
def load_metrics(d: Path):
if not d: return None
m = d / 'metrics.json'
return json.loads(m.read_text('utf-8')) if m.exists() else None
def pick_latest_dir():
dirs = [p for p in REG.iterdir() if p.is_dir()]
return sorted(dirs, key=lambda p: p.name)[-1] if dirs else None
def better(m_new, m_old):
if m_old is None: return True
s_new, s_old = m_new.get('sharpe', 0.0) or 0.0, m_old.get('sharpe', 0.0) or 0.0
dd_new, dd_old = m_new.get('max_dd', -1.0) or -1.0, m_old.get('max_dd', -1.0) or -1.0
dd_ok = (dd_new >= dd_old * 1.2)
s_ok  = (s_new >= s_old * 1.10) or (s_new >= 0.10 and s_new > s_old)
fe_new, fe_old = m_new.get('final_equity', 0.0) or 0.0, m_old.get('final_equity', 0.0) or 0.0
if (s_new == 0.0 and s_old == 0.0):
return (fe_new > fe_old) and dd_ok
return s_ok and dd_ok
def promote(new_dir: Path):
REG.mkdir(parents=True, exist_ok=True)
(REG/'current.txt').write_text(new_dir.name, encoding='utf-8')
shutil.copy2(new_dir/'model.zip', MODEL_DST)
if (new_dir/'vecnorm.pkl').exists(): shutil.copy2(new_dir/'vecnorm.pkl', VEC_DST)
print(f"[promote] Champion -> {new_dir.name}")
def main():
latest = pick_latest_dir()
if latest is None: print('[promote] No candidates.'); return
new_m = load_metrics(latest)
if new_m is None: print('[promote] Latest has no metrics.json'); return
cur_dir = REG / CUR_TXT.read_text('utf-8').strip() if CUR_TXT.exists() else None
old_m = load_metrics(cur_dir) if cur_dir and cur_dir.exists() else None
if better(new_m, old_m): promote(latest)
else: print('[promote] Challenger not better. No promotion.')
if name == 'main': main()
'@
Write-UTF8 "ops/install_services.ps1" @'
$nssm = "C:\nssm\nssm.exe"
$root = Split-Path -Parent $MyInvocation.MyCommand.Path
$ps = "powershell.exe"
& $nssm install XAU_Collector   $ps "-ExecutionPolicy Bypass -File "$root\run_collector.ps1""
& $nssm set    XAU_Collector   AppDirectory (Split-Path -Parent $root)
& $nssm set    XAU_Collector   Start SERVICE_AUTO_START
& $nssm install XAU_Features    $ps "-ExecutionPolicy Bypass -File "$root\run_features.ps1""
& $nssm set    XAU_Features    AppDirectory (Split-Path -Parent $root)
& $nssm set    XAU_Features    Start SERVICE_AUTO_START
& $nssm install XAU_Paper       $ps "-ExecutionPolicy Bypass -File "$root\run_paper.ps1""
& $nssm set    XAU_Paper       AppDirectory (Split-Path -Parent $root)
& $nssm set    XAU_Paper       Start SERVICE_AUTO_START
& $nssm install XAU_TrainShort  $ps "-ExecutionPolicy Bypass -File "$root\run_train_short.ps1""
& $nssm set    XAU_TrainShort  AppDirectory (Split-Path -Parent $root)
& $nssm set    XAU_TrainShort  Start SERVICE_AUTO_START
& $nssm install XAU_TrainNightly $ps "-ExecutionPolicy Bypass -File "$root\run_train_nightly.ps1""
& $nssm set    XAU_TrainNightly AppDirectory (Split-Path -Parent $root)
& $nssm set    XAU_TrainNightly Start SERVICE_AUTO_START
'@
# =========================================
# quick_env_test + features_spec placeholder
# =========================================
Write-UTF8 "quick_env_test.py" @'
import yaml, pandas as pd
from env_xau import XauTradingEnv
cfg=yaml.safe_load(open('config.yaml','r',encoding='utf-8'))
df=pd.read_csv(cfg['files']['features_csv'], parse_dates=['time']).sort_values('time').reset_index(drop=True)
df=df.tail(max(int(cfg.get('window',128))+256,512))
env=XauTradingEnv(df, window=int(cfg.get('window',128)),
spread_abs=cfg['costs']['spread_abs'], commission_rate=cfg['costs']['commission_rate'], slippage_k=cfg['costs']['slippage_k'],
reward_mode=cfg.get('env',{}).get('reward_mode', cfg.get('reward_mode','pct')), use_close_norm=True,
min_equity=float(cfg.get('env',{}).get('min_equity',0.8)))
obs,info=env.reset(); print('reset OK', len(obs))
obs,r,term,trunc,info=env.step(1); print('step OK', r, term, trunc)
'@
Write-UTF8 "models/features_spec.json" '{"feature_columns": [], "price_column": "close_norm"}'
Write-Host "OK – repo files created in $Root"









=== FILE: check.py ===

import pandas as pd
df = pd.read_csv("data/XAUUSD_M5.csv", parse_dates=["time"])
print("bars rows:", len(df), "from:", df["time"].min(), "to:", df["time"].max())
print(df.tail(3))

=== FILE: config.yaml ===

symbol: GOLD.pro
timeframe: M5
history_days: 720
window: 128
mt5:
  bars_chunk: 100000
  update_days: 60
files:
  bars_csv: data/XAUUSD_M5.csv
  ticks_csv: data/XAUUSD_ticks_sample.csv
  features_csv: data/XAUUSD_M5_features.csv
  model_path: models/ppo_xauusd_m5.zip
  vecnorm_path: models/vecnorm_xauusd_m5.pkl
costs:
  spread_abs: 0.37
  commission_rate: 0.0001
  slippage_k: 0.0
env:
  reward_mode: pct
  flip_penalty: 0.002
  trade_hours_utc:
  - 06:00
  - '20:00'
  enforce_flat_outside_hours: true
  min_equity: 0.8
fundamentals:
  usd_series_id: DTWEXBGS
  gpr_csv: external/gpr/gpr.csv
  cot_csv: external/cot_gold.csv
calendar:
  calendar_csv: external/calendar_us.csv
  events_whitelist:
  - Non Farm Payrolls
  - Unemployment Rate
  - CPI
  - Core CPI
  - Core PCE
  - ISM Manufacturing PMI
  - ISM Services PMI
  - FOMC Interest Rate Decision
  - Fed Press Conference


=== FILE: env_xau.py ===

# -*- coding: utf-8 -*-
import numpy as np
import pandas as pd
import gymnasium as gym
from gymnasium import spaces
from datetime import time as dtime

class XauTradingEnv(gym.Env):
    metadata = {"render_modes": []}

    def __init__(self, df: pd.DataFrame, window=128,
                 spread_abs=0.05, commission_rate=0.0001, slippage_k=0.10,
                 reward_mode: str = "pct", use_close_norm: bool = True,
                 flip_penalty: float = 0.0, trade_hours_utc=None,
                 enforce_flat_outside_hours: bool = True, features_spec: list | None = None,
                 min_equity: float = 0.8):
        super().__init__()
        # Dane i parametry
        self.df = df.sort_values('time').reset_index(drop=True)
        self.window = int(window)
        self.spread_abs = float(spread_abs)
        self.commission_rate = float(commission_rate)
        self.slippage_k = float(slippage_k)
        assert reward_mode in {"pct", "points"}
        self.reward_mode = reward_mode
        self.use_close_norm = use_close_norm
        self.flip_penalty = float(flip_penalty)
        self.enforce_flat_outside = bool(enforce_flat_outside_hours)
        self.min_equity = float(min_equity)

        # Godziny handlu (UTC)
        self.trade_hours = None
        if trade_hours_utc and isinstance(trade_hours_utc, (list, tuple)) and len(trade_hours_utc) == 2:
            try:
                s = [int(x) for x in str(trade_hours_utc[0]).split(":")]
                e = [int(x) for x in str(trade_hours_utc[1]).split(":")]
                self.trade_hours = (dtime(s[0], s[1] if len(s) > 1 else 0),
                                    dtime(e[0], e[1] if len(e) > 1 else 0))
            except Exception:
                self.trade_hours = None

        # Kolumny cech
        base_cols = ['open', 'high', 'low', 'close', 'tick_volume', 'spread', 'time']
        if features_spec is not None:
            missing = [c for c in features_spec if c not in self.df.columns]
            if missing:
                raise ValueError(f"Missing feature columns: {missing}")
            self.feat_cols = list(features_spec)
        else:
            self.feat_cols = [c for c in self.df.columns if c not in base_cols]

        self.price_col = 'close_norm' if (self.use_close_norm and 'close_norm' in self.df.columns) else 'close'

        if len(self.df) <= self.window:
            raise ValueError(f"Not enough rows: {len(self.df)} <= window {self.window}")

        # Observation: [window x (1 + n_features)] + [pos, unrealized]
        obs_dim = self.window * (1 + len(self.feat_cols)) + 2
        self.action_space = spaces.Discrete(3)  # 0=SHORT, 1=FLAT, 2=LONG
        self.observation_space = spaces.Box(low=-np.inf, high=np.inf, shape=(obs_dim,), dtype=np.float32)

        # Stan
        self._start = self.window
        self._i = None
        self.pos = 0
        self.entry = None
        self.equity = 1.0
        self.prev_eq = 1.0

    def _in_trade_hours(self, ts) -> bool:
        if self.trade_hours is None:
            return True
        try:
            t = ts.to_pydatetime().time()
        except Exception:
            t = ts
        start, end = self.trade_hours
        if start <= end:
            return (t >= start) and (t <= end)
        # okno nocne np. 22:00–06:00
        return (t >= start) or (t <= end)

    def _obs(self):
        # Używamy _i wszędzie (nie ma self.i)
        sl = slice(self._i - self.window, self._i)
        block_df = self.df.iloc[sl][[self.price_col] + self.feat_cols]
        block = block_df.to_numpy(dtype=np.float32)
        expected = 1 + len(self.feat_cols)
        if block.shape != (self.window, expected):
            raise RuntimeError(f"Bad window shape: {block.shape} vs {(self.window, expected)}")
        flat = block.flatten()
        price = float(self.df.iloc[self._i]['close'])
        unreal = 0.0
        if self.pos != 0 and self.entry is not None:
            dir_ = 1 if self.pos > 0 else -1
            unreal = dir_ * (price - self.entry)
        return np.concatenate([flat, np.array([self.pos, unreal], dtype=np.float32)])

    def reset(self, seed=None, options=None):
        super().reset(seed=seed)
        self._i = self._start
        self.pos = 0
        self.entry = None
        self.equity = 1.0
        self.prev_eq = 1.0
        return self._obs(), {}

    def step(self, action):
        # Normalizacja akcji
        if isinstance(action, (np.ndarray, list, tuple)):
            action = int(action[0])
        else:
            action = int(action)
        if not self.action_space.contains(action):
            raise ValueError("Invalid action")

        info = {}
        ts = self.df.iloc[self._i]['time']
        inside = self._in_trade_hours(ts)
        price = float(self.df.iloc[self._i]['close'])
        prev = float(self.df.iloc[self._i - 1]['close'])

        slip = self.slippage_k * abs(price - prev)
        desired = [-1, 0, 1][action]
        if not inside and self.enforce_flat_outside:
            desired = 0

        # Zmiana pozycji (koszty + ewentualny flip penalty)
        if desired != self.pos:
            # flip penalty przy odwróceniu bez przejścia przez 0
            if self.pos != 0 and desired != 0 and np.sign(self.pos) != np.sign(desired) and self.flip_penalty > 0:
                if self.reward_mode == 'pct':
                    self.equity *= max(1.0 - self.flip_penalty, 1e-6)
                else:
                    self.equity -= self.flip_penalty
                info['flip_penalty'] = float(self.flip_penalty)

            # koszt zamknięcia starej pozycji
            if self.pos != 0 and self.entry is not None:
                cost = (self.spread_abs + slip) / max(price, 1e-12) + self.commission_rate
                if self.reward_mode == 'pct':
                    self.equity *= max(1.0 - cost, 1e-6)
                else:
                    self.equity -= cost

            # otwórz nową (lub wyzeruj)
            self.pos = desired
            if self.pos != 0:
                cost = (self.spread_abs + slip) / max(price, 1e-12) + self.commission_rate
                if self.reward_mode == 'pct':
                    self.equity *= max(1.0 - cost, 1e-6)
                else:
                    self.equity -= cost
                self.entry = price
            else:
                self.entry = None

        # Zmiana equity w kroku
        if self.reward_mode == 'pct':
            step_ret = 0.0
            if self.pos != 0:
                dir_ = 1 if self.pos > 0 else -1
                step_ret = dir_ * ((price / max(prev, 1e-12)) - 1.0)
            self.equity *= (1.0 + step_ret)
            reward = float(self.equity - self.prev_eq)
        else:
            reward = float(self.equity - self.prev_eq)

        self.prev_eq = self.equity
        self._i += 1

        terminated = bool(self._i >= len(self.df) - 1)
        truncated = False
        if self.equity <= self.min_equity:
            truncated = True
            info['early_stop'] = True

        info.update({
            'time': ts,
            'price': price,
            'pos': int(self.pos),
            'equity': float(self.equity),
            'inside_hours': bool(inside)
        })
        return self._obs(), reward, terminated, truncated, info

=== FILE: features_check.py ===

import pandas as pd

df = pd.read_csv("data/XAUUSD_M5_features.csv", parse_dates=["time"])
print("features rows:", len(df), "from:", df["time"].min(), "to:", df["time"].max())
print(df.tail(3))

=== FILE: fetch__mt5_data.py ===

# -*- coding: utf-8 -*-
"""
fetch__mt5_data.py
------------------
Pobiera świece M5 (inkrementalnie do 720 dni) oraz próbkę ticków z MT5.

• Inkrementalny merge do jednego CSV z 720 dni (przycinanie, deduplikacja po 'time').
• Obejścia brokerów: copy_rates_range (naive datetimes) z fallbackiem do copy_rates_from_pos (tail),
  retry/backoff, chunkowanie przy pierwszym pobraniu.
• Atomiczny zapis CSV.
• Ticki weekend-safe (ostrzeżenie, nie przerywa).
• Sugestie kosztów (median/p75 spread + heurystyka slippage_k).
• Czas wszędzie UTC-aware.

Użycie:
    python fetch__mt5_data.py
"""
from __future__ import annotations

import time
from datetime import datetime, timedelta, timezone
from pathlib import Path

import MetaTrader5 as mt5
import numpy as np
import pandas as pd
import yaml

# nasze utilsy
from utils.atomic import atomic_write_csv
from utils.mt5_health import ensure_mt5_ready

# ============================================================
# Konfiguracja
# ============================================================
CFG_PATH = "config.yaml"
cfg = yaml.safe_load(open(CFG_PATH, "r", encoding="utf-8"))
if not isinstance(cfg, dict) or "files" not in cfg:
    raise RuntimeError(f"{CFG_PATH} jest pusty lub ma złą strukturę (brak sekcji 'files').")

SYMBOL = cfg.get("symbol", "XAUUSD")
BARS_CSV = cfg["files"]["bars_csv"]
TICKS_CSV = cfg["files"]["ticks_csv"]
HISTORY_DAYS = int(cfg.get("history_days", 720))

TF_MAP = {
    "M1": mt5.TIMEFRAME_M1,
    "M5": mt5.TIMEFRAME_M5,
    "M15": mt5.TIMEFRAME_M15,
    "H1": mt5.TIMEFRAME_H1,
}
TF_NAME = str(cfg.get("timeframe", "M5"))
TF = TF_MAP.get(TF_NAME, mt5.TIMEFRAME_M5)

MT5_CFG = cfg.get("mt5", {}) or {}
CHUNK = int(MT5_CFG.get("bars_chunk", 20000))  # 20k ~ 70–90 dni M5 (zależnie od brokera)
UPDATE_DAYS = int(MT5_CFG.get("update_days", 60))


# ============================================================
# MT5 init / symbol utils
# ============================================================
def init_mt5():
    """Initialize MT5 i wypisz krótkie info o terminalu/koncie."""
    if not ensure_mt5_ready():
        last_err = mt5.last_error()
        raise RuntimeError(
            f"MT5 not ready (terminal/account). Start MT5 and login. last_error={last_err}"
        )
    term = mt5.terminal_info()
    acc = mt5.account_info()
    parts = []
    if getattr(term, "company", None):
        parts.append(f"Company={term.company}")
    if getattr(term, "name", None):
        parts.append(f"TerminalName={term.name}")
    if getattr(acc, "login", 0):
        parts.append(f"Login={acc.login}")
    if getattr(acc, "server", None):
        parts.append(f"Server={acc.server}")
    if getattr(acc, "name", None):
        parts.append(f"AccountName={acc.name}")
    print("[MT5] " + " | ".join(parts) if parts else "[MT5] initialized")


def ensure_symbol(symbol: str) -> bool:
    """Upewnij się, że symbol jest widoczny w Market Watch."""
    info = mt5.symbol_info(symbol)
    if info is None:
        mt5.symbol_select(symbol, True)
        info = mt5.symbol_info(symbol)
        if info is None:
            return False
    if not info.visible:
        if not mt5.symbol_select(symbol, True):
            return False
    return True


def suggest_similar(symbol: str, limit=12):
    """Podpowiedz nazwy symboli powiązanych (np. GOLD/XAU) – zależne od serwera."""
    out = []
    try:
        for s in mt5.symbols_get():
            nm = s.name.upper()
            if ("GOLD" in nm) or ("XAU" in nm):
                out.append(s.name)
        if not out:
            out = [s.name for s in mt5.symbols_get()][:limit]
        return sorted(set(out))[:limit]
    except Exception:
        return []


# ============================================================
# Helpers
# ============================================================
def with_retries(fn, attempts=3, sleep_s=2, *a, **kw):
    last = None
    for i in range(attempts):
        try:
            return fn(*a, **kw)
        except Exception as e:
            last = e
            time.sleep(sleep_s * (i + 1))
    if last:
        raise last


def _to_df(rates) -> pd.DataFrame:
    """Konwersja stawek MT5 -> kanoniczny DataFrame z sanity-checkiem kolumn i czasu."""
    df = pd.DataFrame(rates)
    if df.empty:
        return df
    df["time"] = pd.to_datetime(df["time"], unit="s", utc=True)
    if "real_volume" in df.columns:
        df.rename(columns={"real_volume": "tick_volume"}, inplace=True)
    cols = ["time", "open", "high", "low", "close", "tick_volume", "spread"]
    # zachowaj tylko znane kolumny
    df = df[[c for c in cols if c in df.columns]].copy()
    # usuń zduplikowane nazwy i rekordy
    df = (
        df.loc[:, ~df.columns.duplicated()]
        .sort_values("time")
        .drop_duplicates("time")
        .reset_index(drop=True)
    )
    return df


def _make_naive(dt: datetime) -> datetime:
    """Zwróć 'naive' datetime (bez tzinfo) – część brokerów tego wymaga dla copy_rates_range."""
    if dt.tzinfo is not None:
        return dt.replace(tzinfo=None)
    return dt


# ============================================================
# Pobieranie danych
# ============================================================
def fetch_range(symbol, timeframe, utc_from: datetime, utc_to: datetime) -> pd.DataFrame:
    """
    Pobierz zakres 'range' z obejściami:
      • daty 'naive' (bez tzinfo),
      • fallback: tail od końca (copy_rates_from_pos) gdy range zwraca pustkę/Invalid params.
    """
    frm_n = _make_naive(utc_from)
    to_n = _make_naive(utc_to)
    rates = mt5.copy_rates_range(symbol, timeframe, frm_n, to_n)
    if rates is None or len(rates) == 0:
        # fallback: tail od końca
        tail = mt5.copy_rates_from_pos(symbol, timeframe, 0, CHUNK)
        if tail is None or len(tail) == 0:
            last_err = mt5.last_error()
            raise RuntimeError(
                f"copy_rates_range empty for '{symbol}'. last_error={last_err}"
            )
        return _to_df(tail)
    return _to_df(rates)


def fetch_from_pos_tail(symbol, timeframe, count) -> pd.DataFrame:
    rates = mt5.copy_rates_from_pos(symbol, timeframe, 0, count)
    if rates is None or len(rates) == 0:
        last_err = mt5.last_error()
        raise RuntimeError(
            f"copy_rates_from_pos empty for '{symbol}'. last_error={last_err}"
        )
    return _to_df(rates)


def load_existing_bars(path: str):
    p = Path(path)
    if not p.exists():
        return None
    try:
        df = pd.read_csv(p, parse_dates=["time"])
        if df.empty:
            return None
        # Usuń kolumny techniczne i duplikaty nazw
        bad = [c for c in df.columns if str(c).startswith("Unnamed")]
        if bad:
            df = df.drop(columns=bad)
        df = df.loc[:, ~df.columns.duplicated()]
        keep = ["time", "open", "high", "low", "close", "tick_volume", "spread"]
        df = df[[c for c in keep if c in df.columns]].copy()
        # Upewnij się, że 'time' jest UTC-aware
        if pd.api.types.is_datetime64_any_dtype(df["time"]):
            if df["time"].dt.tz is None:
                df["time"] = df["time"].dt.tz_localize("UTC")
            else:
                df["time"] = df["time"].dt.tz_convert("UTC")
        else:
            df["time"] = pd.to_datetime(df["time"], utc=True)
        df = (
            df.sort_values("time")
            .drop_duplicates("time")
            .reset_index(drop=True)
        )
        return df
    except Exception:
        return None


def merge_clip(existing: pd.DataFrame | None, new_df: pd.DataFrame, keep_days: int) -> pd.DataFrame:
    """Scal istniejące i nowe świece, deduplikuj po 'time', przytnij do keep_days i oczyść nagłówki."""
    def _sanitize(d):
        if d is None or d.empty:
            return d
        d = d.loc[:, ~d.columns.duplicated()]
        bad = [c for c in d.columns if str(c).startswith("Unnamed")]
        if bad:
            d = d.drop(columns=bad)
        return d

    existing = _sanitize(existing)
    new_df = _sanitize(new_df)

    if existing is None or existing.empty:
        base = new_df.copy()
    else:
        common = [c for c in existing.columns if c in new_df.columns]
        base = (
            pd.concat([existing[common], new_df[common]], axis=0, ignore_index=True, copy=False)
            .drop_duplicates("time")
            .sort_values("time")
        )
    # time -> UTC-aware
    if pd.api.types.is_datetime64_any_dtype(base["time"]):
        if base["time"].dt.tz is None:
            base["time"] = base["time"].dt.tz_localize("UTC")
        else:
            base["time"] = base["time"].dt.tz_convert("UTC")
    else:
        base["time"] = pd.to_datetime(base["time"], utc=True)

    # clip do okna czasowego
    cutoff = datetime.now(timezone.utc) - timedelta(days=keep_days + 1)
    base = base[base["time"] >= pd.Timestamp(cutoff)].reset_index(drop=True)
    return base


def fetch_bars_incremental(symbol, timeframe, keep_days: int, update_days: int) -> pd.DataFrame:
    """
    Strategia:
      • Gdy brak pliku – zbierz historię 'od końca' (copy_rates_from_pos) w 1–8 chunkach,
        aż pokryjesz ~keep_days (z marginesem). Jeśli to się nie uda – spróbuj krótszego range.
      • Gdy plik istnieje – dociągnij ostatnie update_days (mały range z fallbackiem).
    """
    existing = load_existing_bars(BARS_CSV)

    if existing is None:
        wanted_days = keep_days + 2
        parts_df = None
        # 1–8 prób z narastającą liczbą świec (od końca)
        for i in range(1, 9):  # zwiększone do 8 prób
            count = CHUNK * i
            try:
                dft = with_retries(lambda: fetch_from_pos_tail(symbol, timeframe, count))
            except Exception:
                time.sleep(1.0)
                continue
            if dft is not None and len(dft) > 0:
                parts_df = dft
                span_days = (parts_df["time"].max() - parts_df["time"].min()).days
                print(f"[backfill] try={i} count={count} rows={len(parts_df)} span_days={span_days}")
                if span_days >= wanted_days:
                    break

        if parts_df is None or parts_df.empty:
            # Ostatnia próba – krótszy range (np. 120 dni)
            to = datetime.now(timezone.utc)
            frm = to - timedelta(days=min(120, wanted_days))
            parts_df = fetch_range(symbol, timeframe, frm, to)

        # Informacja: broker ograniczył backfill?
        try:
            final_span = (parts_df["time"].max() - parts_df["time"].min()).days if (parts_df is not None and len(parts_df) > 0) else 0
        except Exception:
            final_span = 0
        if final_span < keep_days - 5:
            print(f"[warn] broker backfill limited: span_days={final_span} < keep_days={keep_days}")

        return merge_clip(None, parts_df, keep_days)

    # Inkrementalnie: dociągnij update_days (mały range z fallbackiem)
    to = datetime.now(timezone.utc)
    frm = to - timedelta(days=max(2, update_days))
    fresh = fetch_range(symbol, timeframe, frm, to)
    merged = merge_clip(existing, fresh, keep_days)
    return merged


def fetch_ticks(symbol: str, hours: int = 24) -> pd.DataFrame:
    utc_to = datetime.now(timezone.utc)
    utc_from = utc_to - timedelta(hours=hours)
    ticks = mt5.copy_ticks_range(symbol, utc_from, utc_to, mt5.COPY_TICKS_ALL)
    if ticks is None or len(ticks) == 0:
        last_err = mt5.last_error()
        raise RuntimeError(f"No MT5 ticks for '{symbol}'. last_error={last_err}")
    tdf = pd.DataFrame(ticks)
    tdf["time"] = pd.to_datetime(tdf["time"], unit="s", utc=True)
    return tdf[["time", "bid", "ask", "last", "volume"]]


def suggest_costs(tdf: pd.DataFrame) -> dict:
    """Sugeruj koszty na bazie ticków: median/p75 spread, heurystyczny slippage_k."""
    spr = (
        tdf["ask"] - tdf["bid"]
    ).astype(float).replace([np.inf, -np.inf], np.nan).dropna()
    med_spread = float(np.median(spr)) if len(spr) else 0.0
    p75_spread = float(np.percentile(spr, 75)) if len(spr) else 0.0
    mid = (tdf["ask"] + tdf["bid"]) / 2.0
    dm = (mid.diff().abs()).replace([np.inf, -np.inf], np.nan).dropna()
    med_dm = float(np.median(dm)) if len(dm) else 0.0
    med_price = float(np.nanmedian(mid)) if len(mid) else 1.0
    # heurystyka: jaką część typowego ruchu stanowi przeciętny skok mida
    slippage_k = float(min(max(med_dm / max(med_price, 1e-12), 0.0), 0.01))
    return {
        "spread_abs_median": round(med_spread, 5),
        "spread_abs_p75": round(p75_spread, 5),
        "slippage_k_suggested": round(slippage_k, 4),
    }


# ============================================================
# Main
# ============================================================
def main():
    init_mt5()
    try:
        print(f"[CFG] symbol={SYMBOL} tf={TF_NAME} keep_days={HISTORY_DAYS} update_days={UPDATE_DAYS}")

        if not ensure_symbol(SYMBOL):
            similar = suggest_similar(SYMBOL)
            hint = ", ".join(similar) if similar else "(brak propozycji)"
            raise SystemExit(
                "Symbol not found or not visible in Market Watch: '{}'\n"
                "Try one of these (server-specific): {}\n"
                "Also open Symbols window and SHOW the instrument."
                .format(SYMBOL, hint)
            )

        # ŚWIECE
        bars = fetch_bars_incremental(SYMBOL, TF, keep_days=HISTORY_DAYS, update_days=UPDATE_DAYS)
        assert {"time", "open", "high", "low", "close"}.issubset(bars.columns), "Bars frame malformed"
        assert len(bars) > 100, "Too few bars"
        atomic_write_csv(bars, BARS_CSV)
        print(f"Saved bars: {BARS_CSV} ({len(bars)})")

        # TICKI (opcjonalnie; weekend-safe)
        try:
            ticks = with_retries(lambda: fetch_ticks(SYMBOL, hours=24))
            atomic_write_csv(ticks, TICKS_CSV)
            print(f"Saved ticks: {TICKS_CSV} ({len(ticks)})")
            sugg = suggest_costs(ticks)
            rep = Path("reports"); rep.mkdir(parents=True, exist_ok=True)
            Path("reports/costs_suggestion.yaml").write_text(
                yaml.safe_dump(sugg, allow_unicode=True, sort_keys=False),
                encoding="utf-8"
            )
            print("Cost suggestions -> reports/costs_suggestion.yaml")
        except Exception as e:
            # np. weekend: brak ticków (OK)
            print(f"[warn] ticks unavailable ({e}); keeping previous {TICKS_CSV}")

    finally:
        mt5.shutdown()


if __name__ == "__main__":
    main()

=== FILE: merge_repo.py ===

import os
import chardet

# === KONFIGURACJA ===
repo_path = r"C:\xau_rl"           # ≈öcie≈ºka do folderu repozytorium
output_file = "merged_repo.txt"    # Nazwa wynikowego pliku

# Rozszerzenia plik√≥w do do≈ÇƒÖczenia
included_extensions = (".py", ".ipynb", ".txt", ".md", ".yaml", ".yml", '.ps1', '.log')

# Foldery, kt√≥re majƒÖ byƒá pominiƒôte
excluded_dirs = {".venv", "__pycache__", ".git", ".idea", ".vscode", "build", "dist"}

# === FUNKCJA SCALANIA ===
with open(output_file, "w", encoding="utf-8") as outfile:
    for root, dirs, files in os.walk(repo_path):
        # Pomijaj foldery systemowe / techniczne
        dirs[:] = [d for d in dirs if d not in excluded_dirs]

        for filename in files:
            if filename.endswith(included_extensions):
                file_path = os.path.join(root, filename)
                try:
                    # Automatyczne wykrywanie kodowania
                    with open(file_path, "rb") as raw:
                        result = chardet.detect(raw.read(4096))
                        encoding = result["encoding"] or "utf-8"

                    with open(file_path, "r", encoding=encoding, errors="replace") as infile:
                        relative_path = os.path.relpath(file_path, repo_path)
                        outfile.write(f"\n\n=== FILE: {relative_path} ===\n\n")
                        outfile.write(infile.read())

                    print(f"‚úÖ Dodano: {relative_path}")

                except Exception as e:
                    print(f"‚ö†Ô∏è Nie uda≈Ço siƒô odczytaƒá pliku {filename}: {e}")

print(f"\nüéâ Gotowe! Wszystkie pliki scalono do: {output_file}")

=== FILE: quick_env_test.py ===

import yaml, pandas as pd
from env_xau import XauTradingEnv
cfg=yaml.safe_load(open('config.yaml','r',encoding='utf-8'))
df=pd.read_csv(cfg['files']['features_csv'], parse_dates=['time']).sort_values('time').reset_index(drop=True)
df=df.tail(max(int(cfg.get('window',128))+256,512))
env=XauTradingEnv(df, window=int(cfg.get('window',128)),
    spread_abs=cfg['costs']['spread_abs'], commission_rate=cfg['costs']['commission_rate'], slippage_k=cfg['costs']['slippage_k'],
    reward_mode=cfg.get('env',{}).get('reward_mode', cfg.get('reward_mode','pct')), use_close_norm=True,
    min_equity=float(cfg.get('env',{}).get('min_equity',0.8)))
obs,info=env.reset(); print('reset OK', len(obs))
obs,r,term,trunc,info=env.step(1); print('step OK', r, term, trunc)


=== FILE: README.md ===

# XAUUSD RL PPO (M5) – Starter (Demo/Edu)
**Uwaga**: tylko do celów edukacyjnych, backtestów i *paper tradingu* (demo). Brak kodu wysyłającego realne zlecenia.

## Szybki start
```powershell
python -m venv .venv
# .\.venv\Scripts\Activate.ps1
pip install -r requirements.txt
# Na końcu zainstaluj TORCH odpowiedni dla CPU/GPU z pytorch.org (wheel).
python fetch__mt5_data.py
python utils\calibration.py
python utils\calibration.py --apply
python features\build_features.py
python rl\train_ppo.py --timesteps 1500000
python rl\evaluate.py --out_dir reports
python utils\make_report.py

24/7 na Windows
Użyj skryptów w ops\ oraz NSSM (patrz ops\install_services.ps1).
Dane i historia
Trzymamy 720 dni historii świec. Zbieracz działa inkrementalnie: dociąga ostatnie update_days (domyślnie 60), scala z istniejacym CSV i przycina do 720 dni. Zapisy CSV są atomowe.


=== FILE: requirements.txt ===

pandas>=2.0
numpy>=1.24
pytz
PyYAML
joblib
matplotlib
tensorboard
MetaTrader5
gymnasium>=0.29
stable-baselines3>=2.2.1
python-dotenv
fredapi
scikit-learn
requests
chardet

=== FILE: save_fred_cache.py ===

# save_gpr_cache.py
import pandas as pd
from pathlib import Path
import requests
import io

# Źródło CSV (benchmark GPR, miesięczny) – publiczny plik z witryny autorów:
URL = "https://www.matteoiacoviello.com/gpr_files/GPR.csv"

def main():
    r = requests.get(URL, timeout=30)
    r.raise_for_status()
    # Oryginalny CSV ma nagłówki 'date' i 'GPR' lub podobne – normalizujemy do (date,gpr)
    df = pd.read_csv(io.StringIO(r.text))
    # Ujednolicenie nazw kolumn:
    cols = {c.lower(): c for c in df.columns}
    # próbujemy znaleźć właściwe kolumny bez względu na wielkość liter
    date_col = [c for c in df.columns if c.lower() == 'date'][0]
    gpr_col  = [c for c in df.columns if c.lower() in ('gpr','gpr_index','value')][0]
    out = pd.DataFrame({
        'date': pd.to_datetime(df[date_col]).dt.tz_localize('UTC').dt.normalize(),
        'gpr': pd.to_numeric(df[gpr_col], errors='coerce')
    }).dropna().sort_values('date')
    out['date'] = out['date'].dt.strftime('%Y-%m-%d')

    path = Path("external/gpr"); path.mkdir(parents=True, exist_ok=True)
    out_path = path / "gpr.csv"
    out.to_csv(out_path, index=False)
    print(f"Saved GPR -> {out_path} ({len(out)} rows)")

if __name__ == "__main__":
    main()

=== FILE: save_te_calendar_cache.py ===

# -*- coding: utf-8 -*-
"""
save_te_calendar_cache.py
Pobiera kalendarz makro z Trading Economics i zapisuje cache do external/calendar_us.csv
Zmienna środowiskowa: TE_API_KEY=<Twój_klucz>
"""

from __future__ import annotations
import os, sys, csv
from pathlib import Path
from datetime import datetime, timedelta, timezone
import requests
import pandas as pd

# Domyślny zakres: od dziś-7 dni do dziś+21 dni (żeby objąć zdarzenia przed i po)
LOOKBACK_DAYS = int(os.getenv("TE_LOOKBACK_DAYS", "7"))
LOOKAHEAD_DAYS = int(os.getenv("TE_LOOKAHEAD_DAYS", "21"))
COUNTRY = os.getenv("TE_COUNTRY", "United States")

def iso_date(d: datetime) -> str:
    return d.strftime("%Y-%m-%d")

def fetch_te_calendar(api_key: str, country: str, start_date: str, end_date: str) -> pd.DataFrame:
    """
    API docs: https://docs.tradingeconomics.com/economic_calendar/
    Endpoint: GET /calendar/{start}/{end}?country=...&c=APIKEY
    """
    base = f"https://api.tradingeconomics.com/calendar/{start_date}/{end_date}"
    params = {"country": country, "c": api_key}
    r = requests.get(base, params=params, timeout=40)
    r.raise_for_status()
    data = r.json()

    rows = []
    for it in data:
        # Pola w TE bywają różne zależnie od endpointu — ujednolicamy
        ts = it.get("Date", it.get("DateUtc") or it.get("date"))
        if not ts:
            continue
        try:
            ts_utc = pd.to_datetime(ts, utc=True)
        except Exception:
            # czasami API zwraca bez Z — wymuś UTC
            ts_utc = pd.to_datetime(ts).tz_localize("UTC")
        rows.append({
            "time_utc" : ts_utc,
            "country"  : it.get("Country") or "",
            "event"    : it.get("Event") or it.get("Category") or "",
            "actual"   : it.get("Actual") if it.get("Actual") not in (None, "") else "",
            "previous" : it.get("Previous") if it.get("Previous") not in (None, "") else "",
            "forecast" : it.get("Forecast") if it.get("Forecast") not in (None, "") else "",
            # importance: TE zwykle zwraca 1..3 lub string; rzutujemy na int (brak -> 0)
            "importance": int(it.get("ImportanceValue", it.get("Importance", 0)) or 0),
        })

    df = pd.DataFrame(rows)
    if df.empty:
        return df
    # Normalizacja i sort
    df = df.sort_values("time_utc").reset_index(drop=True)
    return df

def main():
    api_key = os.getenv("TE_API_KEY")
    if not api_key:
        print("Brak TE_API_KEY. Ustaw zmienną środowiskową TE_API_KEY i uruchom ponownie.", file=sys.stderr)
        sys.exit(2)

    now = datetime.now(timezone.utc)
    start = now - timedelta(days=LOOKBACK_DAYS)
    end   = now + timedelta(days=LOOKAHEAD_DAYS)

    df = fetch_te_calendar(api_key, COUNTRY, iso_date(start), iso_date(end))
    out_dir = Path("external"); out_dir.mkdir(parents=True, exist_ok=True)
    out_path = out_dir / "calendar_us.csv"

    if df.empty:
        # jeśli API nic nie zwróciło — nie nadpisujemy istniejącego cache
        if out_path.exists():
            print(f"[warn] Pusta odpowiedź z TE. Zachowuję istniejący cache: {out_path}")
            sys.exit(0)
        else:
            print("[warn] Pusta odpowiedź z TE i brak wcześniejszego cache. Nic nie zapisano.")
            sys.exit(0)

    # Zapisz CSV w formacie zgodnym z features/calendar_features.py
    df_out = df.copy()
    # Upewnijmy się, że kolumny są w oczekiwanym zestawie
    df_out["time_utc"] = df_out["time_utc"].dt.strftime("%Y-%m-%dT%H:%M:%SZ")
    cols = ["time_utc","country","event","actual","previous","forecast","importance"]
    df_out = df_out[cols]
    df_out.to_csv(out_path, index=False, quoting=csv.QUOTE_MINIMAL)
    print(f"Saved TE calendar -> {out_path} ({len(df_out)} rows)")

if __name__ == "__main__":
    main()

=== FILE: features\build_features.py ===

# features/build_features.py
# -*- coding: utf-8 -*-

import json
import os
from pathlib import Path

import numpy as np
import pandas as pd
import yaml

# === config / ścieżki ===
cfg = yaml.safe_load(open('config.yaml', 'r', encoding='utf-8'))
BARS = Path(cfg['files']['bars_csv'])
TICKS = Path(cfg['files'].get('ticks_csv', ''))
FEAT = Path(cfg['files']['features_csv'])
ROOT = Path(__file__).resolve().parents[1]


def atomic_write_csv(df: pd.DataFrame, path: Path):
    path.parent.mkdir(parents=True, exist_ok=True)
    tmp = path.with_suffix(path.suffix + ".tmp")
    df.to_csv(tmp, index=False)
    tmp.replace(path)


# === wczytanie bazowych świec ===
def load_bars():
    df = pd.read_csv(BARS, parse_dates=['time'])
    df = df.sort_values('time').reset_index(drop=True)
    # standaryzacja nazw (jeśli pochodzi z innego źródła)
    df = df.rename(columns={
        'Open': 'open', 'High': 'high', 'Low': 'low', 'Close': 'close',
        'Volume': 'tick_volume', 'TickVolume': 'tick_volume', 'Spread': 'spread'
    })
    for c in ['open', 'high', 'low', 'close']:
        if c not in df.columns:
            raise RuntimeError(f"Brak kolumny '{c}' w {BARS}")
    if 'tick_volume' not in df.columns:
        df['tick_volume'] = np.nan
    if 'spread' not in df.columns:
        df['spread'] = np.nan
    return df


# === ticki (opcjonalnie) ===
def maybe_merge_ticks(base_df: pd.DataFrame):
    if not (TICKS and TICKS.exists()):
        return base_df

    t = pd.read_csv(TICKS)
    tcol = 'time' if 'time' in t.columns else ('DateTime' if 'DateTime' in t.columns else None)
    if tcol is None:
        return base_df

    t[tcol] = pd.to_datetime(t[tcol], utc=True)
    t = t.rename(columns={tcol: 'time'})

    if {'bid', 'ask'}.issubset(t.columns):
        t['spread_abs'] = (t['ask'] - t['bid']).abs()
        t['time_rounded'] = t['time'].dt.floor('min')

        agg = (
            t.groupby('time_rounded')
             .agg(spread_abs_median=('spread_abs', 'median'),
                  spread_abs_p75=('spread_abs', lambda x: x.quantile(0.75)),
                  tick_count=('spread_abs', 'size'))
             .reset_index()
             .rename(columns={'time_rounded': 'time'})
        )

        out = pd.merge_asof(
            base_df.sort_values('time'),
            agg.sort_values('time'),
            on='time',
            direction='backward',
            tolerance=pd.Timedelta('10min')
        )

        # --- KLUCZOWE: wypełnij tick-kolumny, żeby nie ucinać historii ---
        tick_cols = ['spread_abs_median', 'spread_abs_p75', 'tick_count']
        for c in tick_cols:
            if c not in out.columns:
                out[c] = np.nan
            out[c] = out[c].fillna(0.0)

        if 'slippage_k_suggested' not in out.columns:
            out['slippage_k_suggested'] = 0.0
        else:
            out['slippage_k_suggested'] = out['slippage_k_suggested'].fillna(0.0)

        return out

    return base_df


# === wskaźniki ===
def macd(series, fast=12, slow=26, signal=9):
    ema_fast = series.ewm(span=fast, adjust=False).mean()
    ema_slow = series.ewm(span=slow, adjust=False).mean()
    macd_line = ema_fast - ema_slow
    signal_line = macd_line.ewm(span=signal, adjust=False).mean()
    return macd_line, signal_line, macd_line - signal_line


def bbands(series, period=20, n_std=2.0):
    ma = series.rolling(period).mean()
    sd = series.rolling(period).std()
    upper = ma + n_std * sd
    lower = ma - n_std * sd
    width = (upper - lower) / (ma.abs() + 1e-12)
    return ma, upper, lower, width


def add_tech_features(df):
    df = df.sort_values('time').reset_index(drop=True)
    c = df['close']

    # bazowe
    df['ret1'] = np.log(c).diff()
    for w in [8, 10, 12, 20, 30, 50, 100, 200]:
        df[f'ema{w}'] = c.ewm(span=w, adjust=False).mean()
    for w in [20, 50, 100, 200]:
        df[f'sma{w}'] = c.rolling(w, min_periods=int(w * 0.8)).mean()

    # RSI / ATR
    d = c.diff()
    up = d.clip(lower=0).ewm(alpha=1/14, adjust=False).mean()
    down = (-d.clip(upper=0)).ewm(alpha=1/14, adjust=False).mean()
    rs = up / (down + 1e-12)
    df['rsi14'] = 100 - (100 / (1 + rs))

    h, l, cl = df['high'], df['low'], df['close']
    tr = np.maximum(h - l, np.maximum((h - cl.shift()).abs(), (l - cl.shift()).abs()))
    for n in [7, 14, 21]:
        df[f'atr{n}'] = tr.ewm(alpha=1/n, adjust=False).mean()

    # MACD (klasyczny + warianty)
    m, s, hst = macd(c, 12, 26, 9)
    df['macd'] = m; df['macd_signal'] = s; df['macd_hist'] = hst
    for (fa, sl, sg) in [(8, 17, 9), (5, 35, 5)]:
        m, s, hst = macd(c, fa, sl, sg)
        tag = f"{fa}_{sl}_{sg}"
        df[f'macd_{tag}'] = m; df[f'macd_signal_{tag}'] = s; df[f'macd_hist_{tag}'] = hst

    # Bollinger
    bb_ma, bb_up, bb_lo, bb_w = bbands(c, period=20, n_std=2.0)
    df['bb_ma'] = bb_ma; df['bb_up'] = bb_up; df['bb_lo'] = bb_lo; df['bb_width'] = bb_w

    # Donchian / Keltner
    for n in [20, 55]:
        df[f'donchian_hi{n}'] = df['high'].rolling(n).max()
        df[f'donchian_lo{n}'] = df['low'].rolling(n).min()
        df[f'donchian_mid{n}'] = (df[f'donchian_hi{n}'] + df[f'donchian_lo{n}']) / 2

    for n in [20]:
        ema = c.ewm(span=n, adjust=False).mean()
        atr = tr.ewm(alpha=1/n, adjust=False).mean()
        df[f'keltner_mid{n}'] = ema
        df[f'keltner_up{n}'] = ema + 2 * atr
        df[f'keltner_lo{n}'] = ema - 2 * atr

    # Ichimoku (bez przesuwania w przód – brak leak)
    conv = (df['high'].rolling(9).max() + df['low'].rolling(9).min()) / 2
    base = (df['high'].rolling(26).max() + df['low'].rolling(26).min()) / 2
    leadA = (conv + base) / 2
    leadB = (df['high'].rolling(52).max() + df['low'].rolling(52).min()) / 2
    df['ichi_conv9'] = conv; df['ichi_base26'] = base; df['ichi_leadA'] = leadA; df['ichi_leadB'] = leadB

    # Fibonacci – relacja do poziomów z okna
    for win in [50, 100]:
        hi = df['high'].rolling(win).max()
        lo = df['low'].rolling(win).min()
        rng = (hi - lo).replace(0, np.nan)
        for lvl, name in [(0.236, '0236'), (0.382, '0382'), (0.5, '0500'), (0.618, '0618'), (0.786, '0786')]:
            fib = lo + lvl * rng
            df[f'fibo_ret_{name}_win{win}'] = (df['close'] - fib) / (rng + 1e-12)

    # Pivot / Stoch / CCI / ROC
    pp = (df['high'].shift() + df['low'].shift() + df['close'].shift()) / 3
    r1 = 2 * pp - df['low'].shift()
    s1 = 2 * pp - df['high'].shift()
    df['pivot_pp'] = pp; df['pivot_r1'] = r1; df['pivot_s1'] = s1

    n = 14
    low_n = df['low'].rolling(n).min()
    high_n = df['high'].rolling(n).max()
    k = 100 * (df['close'] - low_n) / ((high_n - low_n) + 1e-12)
    d = k.rolling(3).mean()
    df['stoch_k'] = k; df['stoch_d'] = d

    typ = (df['high'] + df['low'] + df['close']) / 3
    sma = typ.rolling(20).mean()
    mad = (typ - sma).abs().rolling(20).mean()
    df['cci20'] = (typ - sma) / (0.015 * (mad + 1e-12))

    for n in [5, 10, 20]:
        df[f'roc{n}'] = df['close'].pct_change(n)

    # cykle doby/tygodnia
    minute = df['time'].dt.hour * 60 + df['time'].dt.minute
    df['tod_sin'] = np.sin(2 * np.pi * minute / 1440)
    df['tod_cos'] = np.cos(2 * np.pi * minute / 1440)
    dow = df['time'].dt.dayofweek
    df['dow_sin'] = np.sin(2 * np.pi * dow / 7)
    df['dow_cos'] = np.cos(2 * np.pi * dow / 7)

    # log i z‑score ceny + z‑score dla wybranych cech
    df['close_log'] = np.log(c.clip(lower=1e-12))
    mu = df['close_log'].rolling(2000, min_periods=200).mean()
    sd = df['close_log'].rolling(2000, min_periods=200).std().replace(0, np.nan)
    df['close_norm'] = (df['close_log'] - mu) / (sd + 1e-8)

    feat_cols = [
        'ret1',
        'ema10', 'ema20', 'ema50', 'ema100', 'ema200',
        'sma20', 'sma50', 'sma100', 'sma200',
        'rsi14', 'atr7', 'atr14', 'atr21',
        'macd', 'macd_signal', 'macd_hist',
        'macd_8_17_9', 'macd_signal_8_17_9', 'macd_hist_8_17_9',
        'macd_5_35_5', 'macd_signal_5_35_5', 'macd_hist_5_35_5',
        'bb_ma', 'bb_up', 'bb_lo', 'bb_width',
        'donchian_hi20', 'donchian_lo20', 'donchian_mid20',
        'donchian_hi55', 'donchian_lo55', 'donchian_mid55',
        'keltner_mid20', 'keltner_up20', 'keltner_lo20',
        'ichi_conv9', 'ichi_base26', 'ichi_leadA', 'ichi_leadB',
        'fibo_ret_0236_win50', 'fibo_ret_0382_win50', 'fibo_ret_0500_win50', 'fibo_ret_0618_win50', 'fibo_ret_0786_win50',
        'fibo_ret_0236_win100', 'fibo_ret_0382_win100', 'fibo_ret_0500_win100', 'fibo_ret_0618_win100', 'fibo_ret_0786_win100',
        'pivot_pp', 'pivot_r1', 'pivot_s1', 'stoch_k', 'stoch_d', 'cci20', 'roc5', 'roc10', 'roc20',
        'tod_sin', 'tod_cos', 'dow_sin', 'dow_cos'
    ]
    for col in feat_cols:
        if col in df.columns:
            mu = df[col].rolling(2000, min_periods=200).mean()
            sd = df[col].rolling(2000, min_periods=200).std().replace(0, np.nan)
            df[col] = (df[col] - mu) / (sd + 1e-8)

    return df


def main():
    # 1) OHLC
    df = load_bars()
    # 2) ticki (opcjonalne)
    df = maybe_merge_ticks(df)
    # 3) wskaźniki
    df = add_tech_features(df)
    # 4) (ŚWIADOMIE) nie dokładamy tutaj fundamentów/kalendarza — robi to Feature Discovery.

    # 5) Oczyść początek serii po rollingach – TYLKO po rdzeniu, nie po wszystkich kolumnach
    core = [
        'time', 'open', 'high', 'low', 'close', 'tick_volume', 'spread',
        'close_log', 'close_norm', 'ret1',
        'ema10', 'ema20', 'ema50', 'ema100', 'ema200',
        'sma20', 'sma50', 'sma100', 'sma200',
        'rsi14', 'atr7', 'atr14', 'atr21',
        'macd', 'macd_signal', 'macd_hist',
        'bb_ma', 'bb_up', 'bb_lo', 'bb_width',
        'tod_sin', 'tod_cos', 'dow_sin', 'dow_cos'
    ]
    have = [c for c in core if c in df.columns]
    df = df.dropna(subset=have).reset_index(drop=True)

    # 6) Zapis atomowy
    atomic_write_csv(df, FEAT)

    # 7) features_spec.json: generuj tylko, jeśli go nie ma (pierwsze uruchomienie)
    spec_path = ROOT / "models" / "features_spec.json"
    if not spec_path.exists():
        base_cols = ['time', 'open', 'high', 'low', 'close', 'tick_volume', 'spread']
        tick_cols = ['spread_abs_median', 'spread_abs_p75', 'tick_count', 'slippage_k_suggested']
        feature_columns = [c for c in df.columns if c not in base_cols + tick_cols + ['close_log', 'close_norm']]
        spec = {"feature_columns": feature_columns, "price_column": "close_norm"}
        spec_path.parent.mkdir(parents=True, exist_ok=True)
        spec_path.write_text(json.dumps(spec, ensure_ascii=False, indent=2), encoding='utf-8')
        print("Saved initial models/features_spec.json (first run).")

    print(f"Saved features -> {FEAT.as_posix()} (rows={len(df)}, cols={len(df.columns)})")


if __name__ == "__main__":
    main()

=== FILE: features\calendar_features.py ===

# -*- coding: utf-8 -*-
"""
features/calendar_features.py
Kalendarz makro (Trading Economics) -> cechy 'time-to-event', 'post-event', dummies,
oraz 'surprise' (tylko w minucie publikacji). Bezpośredni request jest opcjonalny:
możesz też zasilać z lokalnego CSV (cache).

Dokumentacja TE Calendar API: https://docs.tradingeconomics.com/economic_calendar/  # cite: turn2search2
"""

from __future__ import annotations
import os, json
import pandas as pd, numpy as np
from pathlib import Path
from datetime import timezone

try:
    import requests  # type: ignore
except Exception:
    requests = None

DEFAULT_EVENTS = [
    "Non Farm Payrolls", "Unemployment Rate", "CPI", "Core CPI", "Core PCE",
    "ISM Manufacturing PMI", "ISM Services PMI", "FOMC Interest Rate Decision",
    "Fed Press Conference"
]

def fetch_te_calendar(api_key: str,
                      country: str = "United States",
                      start_iso: str = None,
                      end_iso: str = None) -> pd.DataFrame:
    """
    Pobiera kalendarz z Trading Economics. Jeśli requests brak -> podnieś błąd.
    Zwraca DataFrame z kolumnami: time_utc, country, event, actual, previous, forecast, importance
    """
    if requests is None:
        raise ImportError("Brak 'requests'. Użyj lokalnego CSV cache albo zainstaluj requests.")

    base = "https://api.tradingeconomics.com/calendar"
    params = {"country": country, "c": api_key}
    if start_iso and end_iso:
        base = f"{base}/{start_iso}/{end_iso}"

    r = requests.get(base, params=params, timeout=30)
    r.raise_for_status()
    data = r.json()
    rows = []
    for it in data:
        try:
            ts = pd.to_datetime(it.get('Date', it.get('DateUtc') or it.get('date')), utc=True)
            rows.append({
                'time_utc': ts,
                'country': it.get('Country'),
                'event': it.get('Event') or it.get('Category'),
                'actual': it.get('Actual') if it.get('Actual') not in (None, '') else np.nan,
                'previous': it.get('Previous') if it.get('Previous') not in (None, '') else np.nan,
                'forecast': it.get('Forecast') if it.get('Forecast') not in (None, '') else np.nan,
                'importance': it.get('Importance') or it.get('ImportanceValue') or 0
            })
        except Exception:
            continue
    df = pd.DataFrame(rows).dropna(subset=['time_utc','event']).sort_values('time_utc')
    return df

def load_calendar_csv(path: str) -> pd.DataFrame:
    df = pd.read_csv(path)
    df['time_utc'] = pd.to_datetime(df['time_utc'], utc=True)
    return df.sort_values('time_utc')

def make_event_features(bars_csv: str,
                        calendar_df: pd.DataFrame,
                        events_whitelist: list[str] | None = None,
                        impact_threshold: int = 2) -> pd.DataFrame:
    """
    Tworzy cechy eventowe na indeksie M5 z bars_csv:
    - tt_event_min: minuty do najbliższego eventu (clipped np. do +/- 720)
    - post_event_min: minuty od ostatniego eventu
    - is_event_hi: 1 w minucie publikacji eventu o wysokim impakcie
    - surprise_{short}: (actual - forecast) tylko w minucie publikacji
    - one-hot per event (bazując na events_whitelist)

    'impact_threshold' – filtruje tylko eventy o wysokim impakcie.
    """
    bars = pd.read_csv(bars_csv, parse_dates=['time']).sort_values('time').reset_index(drop=True)
    bars['time'] = bars['time'].dt.tz_localize("UTC") if bars['time'].dt.tz is None else bars['time'].dt.tz_convert("UTC")

    ev = calendar_df.copy()
    if events_whitelist:
        ev = ev[ev['event'].isin(events_whitelist)].copy()

    # Map importance do int (0..3)
    def _imp(v):
        if v in (None, np.nan, ''): return 0
        try:
            return int(v)
        except Exception:
            return 0
    ev['imp_i'] = ev['importance'].apply(_imp)
    ev = ev[ev['imp_i'] >= impact_threshold]

    idx = pd.DatetimeIndex(bars['time'])
    # Najbliższy event >= now
    next_ts = np.array([ev['time_utc'][ev['time_utc'] >= t].min() if (ev['time_utc'] >= t).any() else pd.NaT for t in idx])
    prev_ts = np.array([ev['time_utc'][ev['time_utc'] <= t].max() if (ev['time_utc'] <= t).any() else pd.NaT for t in idx])

    tt_event_min = pd.Series(((pd.to_datetime(next_ts) - idx).astype('timedelta64[m]')).astype('float'), index=bars.index)
    post_event_min = pd.Series(((idx - pd.to_datetime(prev_ts)).astype('timedelta64[m]')).astype('float'), index=bars.index)
    tt_event_min = tt_event_min.clip(-720, 720).fillna(720.0)
    post_event_min = post_event_min.clip(-720, 720).fillna(720.0)

    # Flaga minuty publikacji (dokładne dopasowanie do 5-min slotu)
    pub_map = {pd.Timestamp(t, tz="UTC"): i for i, t in enumerate(ev['time_utc'])}
    is_event_hi = bars['time'].map(lambda t: 1 if t.floor('5min') in pub_map else 0).astype(int)

    # Surprise: tylko gdy jest exact minuta publikacji
    ev = ev.set_index(ev['time_utc'].dt.floor('5min'))
    ev_small = ev[['event','actual','forecast']].copy()
    ev_small['surprise'] = pd.to_numeric(ev_small['actual'], errors='coerce') - pd.to_numeric(ev_small['forecast'], errors='coerce')
    surprise = pd.Series(0.0, index=bars.index)
    surp_idx = bars['time'].dt.floor('5min')
    surprise.loc[is_event_hi == 1] = ev_small.reindex(surp_idx[is_event_hi == 1])['surprise'].values

    # One-hot po nazwie eventu (whitelist)
    features = {
        'tt_event_min': tt_event_min.values,
        'post_event_min': post_event_min.values,
        'is_event_hi': is_event_hi.values,
        'ev_surprise': surprise.fillna(0.0).values,
    }
    if events_whitelist:
        for name in events_whitelist:
            k = f"ev_{name.lower().replace(' ', '_').replace('/', '_')}"
            mask = (surp_idx.isin(ev_small.index)) & (ev_small.reindex(surp_idx)['event'] == name)
            features[k] = mask.astype(int).values

    out = pd.DataFrame(features, index=bars.index)
    out.insert(0, 'time', bars['time'].values)
    return out


=== FILE: features\discover.py ===

# -*- coding: utf-8 -*-
"""
features/discover.py
Selektor cech:
- IC (Spearman) cecha vs ret_{+1} (M5) na rolling oknach -> mediana IC, stabilność.
- (Opcjonalnie) ważność z prostego modelu (Lasso / GBDT), jeśli scikit-learn dostępny.
- Ograniczenie zmian: max +/- 'change_frac' względem poprzedniego features_spec.json.

Wejście: pełny plik features_csv (po zbudowaniu), config window, K, change_frac.
Wyjście: models/features_spec.json (lista kolumn + column price 'close_norm').
"""

from __future__ import annotations
import json
from pathlib import Path
import pandas as pd, numpy as np
from scipy.stats import spearmanr

try:
    from sklearn.linear_model import LassoCV  # type: ignore
    HAVE_SKL = True
except Exception:
    HAVE_SKL = False

BASE_COLS = ['time','open','high','low','close','tick_volume','spread']

def compute_targets(df: pd.DataFrame) -> pd.Series:
    ret1 = np.log(df['close']).diff().shift(-1)  # target = kolejna świeca
    return ret1

def rolling_ic(df_feat: pd.DataFrame, target: pd.Series, win: int = 5000) -> pd.Series:
    scores = {}
    valid_cols = [c for c in df_feat.columns if c not in BASE_COLS + ['close_log','close_norm']]
    # prosty IC na całym okresie (dla szybkości); wariant rolling można dodać później
    for c in valid_cols:
        a = df_feat[c].values
        b = target.values
        ok = np.isfinite(a) & np.isfinite(b)
        if ok.sum() < 500:  # min próbek
            scores[c] = 0.0
            continue
        rho, _ = spearmanr(a[ok], b[ok])
        scores[c] = 0.0 if (rho is None or np.isnan(rho)) else float(rho)
    return pd.Series(scores).sort_values(ascending=False)

def model_importance(df_feat: pd.DataFrame, target: pd.Series, top_n: int = 128) -> pd.Series:
    if not HAVE_SKL:
        return pd.Series(dtype=float)
    cols = [c for c in df_feat.columns if c not in BASE_COLS + ['close_log','close_norm']]
    X = df_feat[cols].replace([np.inf,-np.inf], np.nan).fillna(0.0).values
    y = target.replace([np.inf,-np.inf], np.nan).fillna(0.0).values
    if len(cols) == 0 or len(df_feat) < 1000:
        return pd.Series(dtype=float)
    model = LassoCV(cv=5, n_jobs=None, max_iter=10000).fit(X, y)
    imp = pd.Series(np.abs(model.coef_), index=cols)
    return imp.sort_values(ascending=False).head(top_n)

def select_topK(ic: pd.Series, imp: pd.Series | None, K: int = 96) -> list[str]:
    if imp is None or imp.empty:
        return list(ic.head(K).index)
    # fuzja rankingów (simple rank sum)
    ic_rank = ic.rank(ascending=False, method='dense')
    imp = imp.reindex(ic.index).fillna(0.0)
    imp_rank = imp.rank(ascending=False, method='dense')
    score = 1.0/ic_rank + 1.0/(imp_rank.replace(0, np.nan))
    return list(score.sort_values(ascending=False).head(K).index)

def apply_change_budget(prev_cols: list[str], new_cols: list[str], change_frac: float = 0.1) -> list[str]:
    if not prev_cols:
        return new_cols
    K = len(prev_cols)
    max_changes = max(1, int(round(K * change_frac)))
    keep = [c for c in new_cols if c in prev_cols]
    add  = [c for c in new_cols if c not in prev_cols][:max_changes]
    # Usuń najgorsze z poprzednich, żeby zwolnić miejsca
    drop_candidates = [c for c in prev_cols if c not in new_cols]
    drop = drop_candidates[:max_changes]
    # Final: (prev - drop) + add (z zachowaniem kolejności now_cols)
    result = [c for c in prev_cols if c not in drop]
    for c in new_cols:
        if c not in result and c in add:
            result.append(c)
    # Zabezpieczenie na dokładny rozmiar
    if len(result) > K:
        result = result[:K]
    elif len(result) < K:
        # dopełnij z 'keep' na wszelki wypadek
        for c in keep:
            if c not in result:
                result.append(c)
            if len(result) >= K:
                break
    return result

def write_features_spec(path_json: str, feat_cols: list[str], price_col: str = "close_norm") -> None:
    Path(path_json).parent.mkdir(parents=True, exist_ok=True)
    with open(path_json, "w", encoding="utf-8") as f:
        json.dump({"feature_columns": feat_cols, "price_column": price_col}, f, ensure_ascii=False, indent=2)

def main_discover(features_csv: str,
                  out_json: str = "models/features_spec.json",
                  topK: int = 96,
                  change_frac: float = 0.10):
    df = pd.read_csv(features_csv, parse_dates=['time']).sort_values('time').reset_index(drop=True)
    target = compute_targets(df)
    ic = rolling_ic(df, target)
    imp = model_importance(df, target, top_n=topK*2)  # opcjonalne
    proposal = select_topK(ic, imp, K=topK)

    prev = []
    p = Path(out_json)
    if p.exists():
        prev = json.loads(p.read_text(encoding='utf-8')).get("feature_columns", [])
        # nie bierzemy kolumn, których już fizycznie nie ma:
        prev = [c for c in prev if c in df.columns]

    final_cols = apply_change_budget(prev, proposal, change_frac=change_frac)
    write_features_spec(out_json, final_cols, "close_norm")
    print(f"[discover] Wrote {out_json} with {len(final_cols)} features.")

=== FILE: features\fundamentals.py ===

# -*- coding: utf-8 -*-
"""
features/fundamentals.py
Fundamenty dla XAUUSD: realne stopy (DGS10 - T10YIE), USD index (np. FRED),
GPR (Caldara & Iacoviello), COT Gold (CFTC). As-of alignment i FFill -> M5.

Wymaga: pandas, numpy, (opcjonalnie) fredapi, requests, python-dotenv.
Źródła:
- FRED: DGS10, T10YIE (real 10y = DGS10 - T10YIE)      [St. Louis Fed]  # cite: turn2search20
- CFTC COT (COMEX Gold) weekly                          # cite: turn2search9
- GPR (Caldara & Iacoviello) monthly                    # cite: turn2search28
"""

from __future__ import annotations
import os, json
import pandas as pd, numpy as np
from datetime import datetime, timezone, timedelta
from pathlib import Path

try:
    from dotenv import load_dotenv
    load_dotenv()
except Exception:
    pass

# ---------- Utils ----------

def _zscore(s: pd.Series, win: int = 252) -> pd.Series:
    mu = s.rolling(win, min_periods=max(10, win//10)).mean()
    sd = s.rolling(win, min_periods=max(10, win//10)).std().replace(0, np.nan)
    return (s - mu) / (sd + 1e-12)

def _ensure_dt_utc(s: pd.Series) -> pd.Series:
    if not isinstance(s.index, pd.DatetimeIndex):
        raise ValueError("Index must be DatetimeIndex")
    if s.index.tz is None:
        s.index = s.index.tz_localize("UTC")
    else:
        s.index = s.index.tz_convert("UTC")
    return s

def _asof_ffill_daily_to_m5(daily: pd.Series,
                            bars_m5: pd.DataFrame,
                            available_hour_utc: int = 23,
                            available_minute_utc: int = 59) -> pd.Series:
    """
    Dla wartości dziennych zakładamy, że 'stają się znane' o available_* UTC.
    Każda wartość jest użyta od (data, available_time) do kolejnej publikacji.
    To zachowuje konserwatywność (eliminuje look-ahead).
    """
    s = daily.copy()
    s = _ensure_dt_utc(s)
    # Utnij do zakresu świec
    s = s[(s.index <= bars_m5['time'].max())]
    if s.empty:
        return pd.Series(index=bars_m5.index, dtype=float)

    # Tworzymy serię znaczników as-of
    idx_asof = []
    vals = []
    for ts, val in s.items():
        ts_asof = pd.Timestamp(ts.date(), tz=timezone.utc) + timedelta(
            hours=available_hour_utc, minutes=available_minute_utc)
        idx_asof.append(ts_asof)
        vals.append(val)
    asof_series = pd.Series(vals, index=pd.DatetimeIndex(idx_asof, tz="UTC")).sort_index()

    # Reindeks do M5 time i ffill
    m5_idx = pd.DatetimeIndex(bars_m5['time']).tz_convert("UTC")
    out = asof_series.reindex(m5_idx, method="ffill")
    out.name = daily.name
    return out

# ---------- FRED ----------

def load_fred_series(series_id: str, api_key: str | None) -> pd.Series:
    """
    Ładuje serię z FRED (jeśli brak fredapi/klucza -> spodziewa się CSV w external/fred/{series_id}.csv)
    CSV format: DATE,VALUE
    """
    try:
        from fredapi import Fred  # type: ignore
    except Exception:
        Fred = None

    if Fred is not None and api_key:
        fred = Fred(api_key=api_key)
        s = fred.get_series(series_id)
        s = s.dropna().astype(float)
        s.index = pd.to_datetime(s.index, utc=True)
        s.name = series_id
        return s

    # Fallback: lokalny CSV
    p = Path("external/fred") / f"{series_id}.csv"
    if not p.exists():
        raise FileNotFoundError(f"Brak {p}. Zainstaluj fredapi lub umieść CSV.")
    df = pd.read_csv(p)
    df['DATE'] = pd.to_datetime(df['DATE'], utc=True)
    s = pd.Series(df.iloc[:, 1].astype(float).values, index=df['DATE'], name=series_id)
    return s

def build_real10y_and_usd(bars_m5: pd.DataFrame,
                          fred_key: str | None,
                          usd_series_id: str = "DTWEXBGS",
                          real_asof_hh: int = 23,
                          real_asof_mm: int = 59) -> pd.DataFrame:
    """
    Zwraca DataFrame z kolumnami: real10y, real10y_z, d_real10y, usd, usd_z
    - real10y = DGS10 - T10YIE (oba dzienne)  # cite: turn2search20
    - usd = indeks USD (np. DTWEXBGS z FRED)  # cite: turn2search25
    """
    dgs10 = load_fred_series("DGS10", fred_key)
    t10yie = load_fred_series("T10YIE", fred_key)
    real10y_daily = (dgs10 - t10yie).dropna()
    usd_daily = load_fred_series(usd_series_id, fred_key).dropna()

    real10y_m5 = _asof_ffill_daily_to_m5(real10y_daily, bars_m5, real_asof_hh, real_asof_mm)
    usd_m5     = _asof_ffill_daily_to_m5(usd_daily,     bars_m5, 23, 59)

    # pochodne
    real10y_z = _zscore(real10y_m5, 252*24*12//5)  # ~252 dni w M5 ≈ 12*24*252/5
    d_real10y = real10y_m5.diff()

    usd_z = _zscore(usd_m5, 252*24*12//5)

    out = pd.DataFrame({
        'real10y': real10y_m5.values,
        'real10y_z': real10y_z.values,
        'd_real10y': d_real10y.values,
        'usd': usd_m5.values,
        'usd_z': usd_z.values
    }, index=bars_m5.index)
    return out

# ---------- GPR ----------

def load_gpr_local_csv(path: str = "external/gpr/gpr.csv") -> pd.Series:
    """
    Oczekuje miesięcznego GPR z kolumnami ['date','gpr'], gdzie date to YYYY-MM-01 UTC.
    Oryginał i metodologia: Caldara & Iacoviello (AER 2022)                      # cite: turn2search28
    Pobrane dane umieść offline – unikamy look-ahead przez FFill miesięczny.
    """
    p = Path(path)
    if not p.exists():
        raise FileNotFoundError(f"Brak {p}. Pobierz GPR i zapisz jako CSV.")
    df = pd.read_csv(p)
    df['date'] = pd.to_datetime(df['date'], utc=True)
    s = pd.Series(df['gpr'].astype(float).values, index=df['date'], name='gpr')
    return s

def gpr_to_m5(bars_m5: pd.DataFrame, gpr_monthly: pd.Series) -> pd.Series:
    gpr_monthly = _ensure_dt_utc(gpr_monthly)
    # As-of: konserwatywnie początek kolejnego miesiąca 00:00 UTC
    idx_asof = [pd.Timestamp(ts.year + (1 if ts.month==12 else 0),
                             1 if ts.month==12 else ts.month+1, 1, tz="UTC") for ts in gpr_monthly.index]
    s_asof = pd.Series(gpr_monthly.values, index=pd.DatetimeIndex(idx_asof, tz="UTC")).sort_index()
    m5_idx = pd.DatetimeIndex(bars_m5['time']).tz_convert('UTC')
    gpr_m5 = s_asof.reindex(m5_idx, method='ffill')
    gpr_m5.name = 'gpr'
    return gpr_m5

# ---------- COT (Gold) ----------

def load_cot_gold_local_csv(path: str = "external/cot_gold.csv") -> pd.DataFrame:
    """
    Oczekuje tygodniowego COT dla Gold (COMEX): kolumny ['date','mm_long','mm_short'] dla Managed Money.
    Dane z CFTC (Disaggregated report).                               # cite: turn2search9
    """
    p = Path(path)
    if not p.exists():
        raise FileNotFoundError(f"Brak {p}. Przygotuj eksport z CFTC i zapisz CSV.")
    df = pd.read_csv(p)
    df['date'] = pd.to_datetime(df['date'], utc=True)
    return df[['date','mm_long','mm_short']].sort_values('date')

def cot_to_m5(bars_m5: pd.DataFrame, cot_df: pd.DataFrame) -> pd.DataFrame:
    cot_df = cot_df.copy()
    cot_df['mm_net'] = cot_df['mm_long'].astype(float) - cot_df['mm_short'].astype(float)
    # Publikacja: piątek (as-of), dane na wtorek – używamy konserwatywnie od piątku 21:00 UTC
    asof_ts = cot_df['date'] + pd.Timedelta(days=3)  # wtorek -> piątek
    asof_ts = asof_ts.dt.tz_localize('UTC') + pd.Timedelta(hours=21)
    ser = pd.Series(cot_df['mm_net'].values, index=asof_ts, name='cot_mm_net').sort_index()

    m5_idx = pd.DatetimeIndex(bars_m5['time']).tz_convert("UTC")
    mm_net_m5 = ser.reindex(m5_idx, method='ffill')
    mm_net_z  = _zscore(mm_net_m5, 52)  # roczny tygodniowy zscore
    out = pd.DataFrame({'cot_mm_net': mm_net_m5.values, 'cot_mm_net_z': mm_net_z.values}, index=bars_m5.index)
    return out

# ---------- Orkiestracja ----------

def build_fundamentals_features(bars_csv: str,
                                fred_api_key: str | None,
                                gpr_csv: str | None = None,
                                cot_csv: str | None = None,
                                usd_series_id: str = "DTWEXBGS") -> pd.DataFrame:
    """
    Ładuje bars M5, dokleja fundamenty (real10y/usd/gpr/cot) jako cechy na indeksie świec M5.
    """
    bars = pd.read_csv(bars_csv, parse_dates=['time']).sort_values('time').reset_index(drop=True)
    core = build_real10y_and_usd(bars, fred_api_key, usd_series_id)

    cols = [core]
    if gpr_csv:
        gpr = load_gpr_local_csv(gpr_csv)
        gpr_m5 = gpr_to_m5(bars, gpr)
        cols.append(pd.DataFrame({'gpr': gpr_m5.values, 'gpr_z': _zscore(gpr_m5, 36).values}, index=core.index))
    if cot_csv:
        cot = load_cot_gold_local_csv(cot_csv)
        cols.append(cot_to_m5(bars, cot))

    out = pd.concat(cols, axis=1)
    out.insert(0, 'time', bars['time'].values)
    return out

=== FILE: features\__init__.py ===



=== FILE: logs\feature_discovery.log ===

[2025-11-06T11:25:27] feature_discovery bootstrap_alive
[2025-11-06T11:25:27] start
[2025-11-06T11:25:49] saved spec -> C:/xau_rl/models/features_spec.json, rank -> C:/xau_rl/reports/feature_discovery_rank.csv, summary -> C:/xau_rl/reports/feature_discovery_summary.txt
[2025-11-06T13:11:11] feature_discovery bootstrap_alive
[2025-11-06T13:11:11] start
[2025-11-06T13:11:17] saved spec -> C:/xau_rl/models/features_spec.json, rank -> C:/xau_rl/reports/feature_discovery_rank.csv, summary -> C:/xau_rl/reports/feature_discovery_summary.txt
[2025-11-06T15:04:45] feature_discovery bootstrap_alive
[2025-11-06T15:04:45] start
[2025-11-06T15:04:50] saved spec -> C:/xau_rl/models/features_spec.json, rank -> C:/xau_rl/reports/feature_discovery_rank.csv, summary -> C:/xau_rl/reports/feature_discovery_summary.txt
[2025-11-06T15:17:37] feature_discovery bootstrap_alive
[2025-11-06T15:17:37] start
[2025-11-06T15:17:42] saved spec -> C:/xau_rl/models/features_spec.json, rank -> C:/xau_rl/reports/feature_discovery_rank.csv, summary -> C:/xau_rl/reports/feature_discovery_summary.txt
[2025-11-06T15:17:49] feature_discovery bootstrap_alive
[2025-11-06T15:17:49] start
[2025-11-06T15:17:53] saved spec -> C:/xau_rl/models/features_spec.json, rank -> C:/xau_rl/reports/feature_discovery_rank.csv, summary -> C:/xau_rl/reports/feature_discovery_summary.txt
[2025-11-06T15:18:13] feature_discovery bootstrap_alive
[2025-11-06T15:18:13] start
[2025-11-06T15:18:18] saved spec -> C:/xau_rl/models/features_spec.json, rank -> C:/xau_rl/reports/feature_discovery_rank.csv, summary -> C:/xau_rl/reports/feature_discovery_summary.txt
[2025-11-06T15:54:36] feature_discovery bootstrap_alive
[2025-11-06T15:54:36] start
[2025-11-06T15:54:41] [info] skipped_small_n<200: 4 cols
[2025-11-06T15:54:41] [info] skipped_constant: 4 cols (e.g. ['slippage_k_suggested', 'slippage_k_suggested_lag1', 'slippage_k_suggested_lag2', 'slippage_k_suggested_lag3'])
[2025-11-06T15:54:41] saved spec -> C:/xau_rl/models/features_spec.json, rank -> C:/xau_rl/reports/feature_discovery_rank.csv, summary -> C:/xau_rl/reports/feature_discovery_summary.txt
[2025-11-06T15:54:45] feature_discovery bootstrap_alive
[2025-11-06T15:54:45] start
[2025-11-06T15:54:49] [info] skipped_small_n<200: 4 cols
[2025-11-06T15:54:49] [info] skipped_constant: 4 cols (e.g. ['slippage_k_suggested', 'slippage_k_suggested_lag1', 'slippage_k_suggested_lag2', 'slippage_k_suggested_lag3'])
[2025-11-06T15:54:49] saved spec -> C:/xau_rl/models/features_spec.json, rank -> C:/xau_rl/reports/feature_discovery_rank.csv, summary -> C:/xau_rl/reports/feature_discovery_summary.txt
[2025-11-07T18:12:33] feature_discovery bootstrap_alive
[2025-11-07T18:12:33] start
[2025-11-07T18:13:01] [info] skipped_constant: 4 cols (e.g. ['slippage_k_suggested', 'slippage_k_suggested_lag1', 'slippage_k_suggested_lag2', 'slippage_k_suggested_lag3'])
[2025-11-07T18:13:01] saved spec -> C:/xau_rl/models/features_spec.json, rank -> C:/xau_rl/reports/feature_discovery_rank.csv, summary -> C:/xau_rl/reports/feature_discovery_summary.txt


=== FILE: logs\services\fetch_features.log ===


[2025-11-07T23:58:30.2857542+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 6 2 2 1 2 8 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-07T23:58:42.4887187+01:00] [fetch_features] done

[2025-11-08T00:08:42.4914348+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 6 2 2 0 4 4 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T00:08:55.1759789+01:00] [fetch_features] done

[2025-11-08T00:18:55.1862507+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 6 2 2 0 4 4 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T00:19:08.2822830+01:00] [fetch_features] done

[2025-11-08T00:29:08.2829764+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 6 2 2 0 4 4 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T00:29:22.5336467+01:00] [fetch_features] done

[2025-11-08T00:39:22.5739878+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 6 2 2 0 4 4 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T00:39:35.2513131+01:00] [fetch_features] done

[2025-11-08T00:49:35.2851296+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 6 2 2 0 4 4 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T00:49:49.5205188+01:00] [fetch_features] done

[2025-11-08T00:59:49.5234290+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 6 2 2 0 4 4 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T01:00:02.7268424+01:00] [fetch_features] done

[2025-11-08T01:10:02.7367956+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 6 2 1 5 4 0 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T01:10:15.6123046+01:00] [fetch_features] done

[2025-11-08T01:20:15.6379659+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 6 2 0 3 9 8 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T01:20:28.2689915+01:00] [fetch_features] done

[2025-11-08T01:30:28.2850788+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 6 1 9 3 0 4 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T01:30:40.2070494+01:00] [fetch_features] done

[2025-11-08T01:40:40.2370860+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 6 1 7 8 3 4 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T01:40:52.3346651+01:00] [fetch_features] done

[2025-11-08T01:50:52.3465426+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 6 1 6 3 0 0 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T01:51:04.2770614+01:00] [fetch_features] done

[2025-11-08T02:01:04.3012173+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 6 1 5 0 3 2 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T02:01:16.6937447+01:00] [fetch_features] done

[2025-11-08T02:11:16.7063878+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 6 1 2 9 0 4 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T02:11:29.0925715+01:00] [fetch_features] done

[2025-11-08T02:21:29.0963666+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 6 0 9 6 8 2 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T02:21:40.9733542+01:00] [fetch_features] done

[2025-11-08T02:31:40.9968271+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 6 0 7 2 6 4 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T02:31:53.2452662+01:00] [fetch_features] done

[2025-11-08T02:41:53.2607436+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 6 0 3 9 5 2 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T02:42:05.1135202+01:00] [fetch_features] done

[2025-11-08T02:52:05.1433579+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 6 0 0 9 6 2 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T02:52:17.1740191+01:00] [fetch_features] done

[2025-11-08T03:02:17.1962821+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 5 9 5 3 4 6 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T03:02:28.8308562+01:00] [fetch_features] done

[2025-11-08T03:12:28.8503813+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 5 8 9 5 8 8 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T03:12:41.7280240+01:00] [fetch_features] done

[2025-11-08T03:22:41.7354698+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 5 8 4 1 9 6 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T03:22:53.4549945+01:00] [fetch_features] done

[2025-11-08T03:32:53.4552794+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 5 8 0 2 6 8 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T03:33:05.5073424+01:00] [fetch_features] done

[2025-11-08T03:43:05.5181796+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 5 7 5 5 8 2 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T03:43:17.1470832+01:00] [fetch_features] done

[2025-11-08T03:53:17.1624695+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 5 7 1 8 3 0 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T03:53:28.8342867+01:00] [fetch_features] done

[2025-11-08T04:03:28.8345645+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 5 6 9 0 8 0 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T04:03:40.8178165+01:00] [fetch_features] done

[2025-11-08T04:13:40.8188905+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 5 6 5 5 3 0 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T04:13:52.3397175+01:00] [fetch_features] done

[2025-11-08T04:23:52.3505513+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 5 6 1 8 8 0 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T04:24:03.6509171+01:00] [fetch_features] done

[2025-11-08T04:34:03.6609819+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 5 5 5 8 5 6 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T04:34:15.0547726+01:00] [fetch_features] done

[2025-11-08T04:44:15.0651139+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 5 5 2 0 2 8 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T04:44:26.4685555+01:00] [fetch_features] done

[2025-11-08T04:54:26.4756603+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 5 4 7 9 1 2 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T04:54:37.6602424+01:00] [fetch_features] done

[2025-11-08T05:04:37.6647181+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 5 4 4 4 6 0 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T05:04:49.1453113+01:00] [fetch_features] done

[2025-11-08T05:14:49.1457116+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 5 4 0 9 9 6 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T05:15:00.5229605+01:00] [fetch_features] done

[2025-11-08T05:25:00.5345566+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 5 3 8 2 3 4 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T05:25:11.5971269+01:00] [fetch_features] done

[2025-11-08T05:35:11.6122157+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 5 3 5 8 4 8 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T05:35:22.8100263+01:00] [fetch_features] done

[2025-11-08T05:45:22.8168432+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 5 3 3 9 4 2 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T05:45:33.9199334+01:00] [fetch_features] done

[2025-11-08T05:55:33.9251427+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 5 3 0 7 9 0 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T05:55:45.3424489+01:00] [fetch_features] done

[2025-11-08T06:05:45.3482426+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 5 2 7 5 2 2 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T06:05:56.4216140+01:00] [fetch_features] done

[2025-11-08T06:15:56.4249326+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 5 2 5 1 9 4 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T06:16:07.5042187+01:00] [fetch_features] done

[2025-11-08T06:26:07.5130162+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 5 2 1 8 4 0 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T06:26:19.2323743+01:00] [fetch_features] done

[2025-11-08T06:36:19.2372001+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 5 1 9 3 8 2 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T06:36:30.2989194+01:00] [fetch_features] done

[2025-11-08T06:46:30.3137767+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 5 1 7 6 0 8 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T06:46:41.4438466+01:00] [fetch_features] done

[2025-11-08T06:56:41.4554955+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 5 1 5 5 4 4 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T06:56:52.4466732+01:00] [fetch_features] done

[2025-11-08T07:06:52.4562583+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 5 1 3 2 4 4 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T07:07:03.8785001+01:00] [fetch_features] done

[2025-11-08T07:17:03.9294717+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 5 1 1 4 3 6 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T07:17:15.5819981+01:00] [fetch_features] done

[2025-11-08T07:27:15.5888778+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 5 0 9 3 2 4 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T07:27:27.1179041+01:00] [fetch_features] done

[2025-11-08T07:37:27.1282254+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 5 0 5 2 4 8 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T07:37:37.8178354+01:00] [fetch_features] done

[2025-11-08T07:47:37.8371209+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 5 0 2 8 7 2 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T07:47:48.5716207+01:00] [fetch_features] done

[2025-11-08T07:57:48.5812885+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 5 0 0 4 2 6 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T07:57:59.3902136+01:00] [fetch_features] done

[2025-11-08T08:07:59.4095251+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 4 9 6 5 3 4 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T08:08:10.2557341+01:00] [fetch_features] done

[2025-11-08T08:18:10.2689152+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 4 9 3 3 5 0 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T08:18:20.5983224+01:00] [fetch_features] done

[2025-11-08T08:28:20.6130190+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 4 9 0 0 5 6 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T08:28:31.6509587+01:00] [fetch_features] done

[2025-11-08T08:38:31.6681304+01:00] [fetch_features] start
[ M T 5 ]   C o m p a n y = M e t a Q u o t e s   L t d .   |   T e r m i n a l N a m e = M e t a T r a d e r   5   |   L o g i n = 6 2 7 1 9 0 2 5   |   S e r v e r = O A N D A T M S - M T 5   |   A c c o u n t N a m e = P L / M 6 2 7 1 9 0 2 5 / P L N 
 
 [ C F G ]   s y m b o l = G O L D . p r o   t f = M 5   k e e p _ d a y s = 7 2 0   u p d a t e _ d a y s = 6 0 
 
 S a v e d   b a r s :   d a t a / X A U U S D _ M 5 . c s v   ( 1 2 6 1 4 ) 
 
 S a v e d   t i c k s :   d a t a / X A U U S D _ t i c k s _ s a m p l e . c s v   ( 4 8 6 4 7 8 ) 
 
 C o s t   s u g g e s t i o n s   - >   r e p o r t s / c o s t s _ s u g g e s t i o n . y a m l 
 
 S a v e d   f e a t u r e s   - >   d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v   ( r o w s = 1 2 2 5 6 ,   c o l s = 7 9 ) 
 
 
[2025-11-08T08:38:43.0656254+01:00] [fetch_features] done

[2025-11-08T08:48:43.0686243+01:00] [fetch_features] start


=== FILE: logs\services\mini_update_ppo.log ===


[2025-11-08T05:43:39.6813785+01:00] [mini_update] start
[ m i n i _ u p d a t e ]   f e a t u r e s _ c s v = d a t a / X A U U S D _ M 5 _ f e a t u r e s . c s v 
 
 [ m i n i _ u p d a t e ]   d f   r o w s = 1 2 2 5 6     f r o m = 2 0 2 5 - 0 9 - 0 8   0 2 : 0 0 : 0 0     t o = 2 0 2 5 - 1 1 - 0 7   2 1 : 5 5 : 0 0 
 
 [ m i n i _ u p d a t e ]   r a n g e s :   t r a i n _ s t a r t = 2 0 2 5 - 0 6 - 1 0   2 1 : 5 5 : 0 0     v a l _ s t a r t = 2 0 2 5 - 1 0 - 0 8   2 1 : 5 5 : 0 0     v a l _ e n d = 2 0 2 5 - 1 1 - 0 7   2 1 : 5 5 : 0 0 
 
 [ m i n i _ u p d a t e ]   c o u n t s :   t r a i n = 6 2 4 1     v a l = 6 0 1 5     ( W I N D O W = 1 2 8 ) 
 
 [ m i n i _ u p d a t e ]   T r a i n i n g   o n   6 2 4 1   r o w s   ( ~ 1 2 0 d ) ,   t i m e s t e p s = 3 0 0 0 0 0 
 
 [ m i n i _ u p d a t e ]   f e a t u r e s _ s p e c :   u s i n g   i n t e r s e c t i o n :   a v a i l = 2 6 ,   m i s s i n g = 7 0   ( i g n o r e d ) 
 
 U s i n g   c p u   d e v i c e 
 
 L o g g i n g   t o   l o g s / p p o _ g o l d _ m 5 \ P P O _ 1 2 6 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                       |                     | 
 
 |         e p _ l e n _ m e a n           |   5 7 7             | 
 
 |         e p _ r e w _ m e a n           |   - 0 . 2 0 1       | 
 
 |   t i m e /                             |                     | 
 
 |         f p s                           |   3 5 3             | 
 
 |         i t e r a t i o n s             |   1                 | 
 
 |         t i m e _ e l a p s e d         |   1 1               | 
 
 |         t o t a l _ t i m e s t e p s   |   4 0 9 6           | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                           | 
 
 |         e p _ l e n _ m e a n                     |   6 1 2                   | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1             | 
 
 |   t i m e /                                       |                           | 
 
 |         f p s                                     |   3 0 5                   | 
 
 |         i t e r a t i o n s                       |   2                       | 
 
 |         t i m e _ e l a p s e d                   |   2 6                     | 
 
 |         t o t a l _ t i m e s t e p s             |   8 1 9 2                 | 
 
 |   t r a i n /                                     |                           | 
 
 |         a p p r o x _ k l                         |   0 . 0 1 7 4 8 3 9 0 1   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 1 9 6               | 
 
 |         c l i p _ r a n g e                       |   0 . 2                   | 
 
 |         e n t r o p y _ l o s s                   |   - 1 . 0 9               | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   - 0 . 5 8 4             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3             | 
 
 |         l o s s                                   |   - 0 . 0 4 9 9           | 
 
 |         n _ u p d a t e s                         |   1 0                     | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 2 8 1           | 
 
 |         v a l u e _ l o s s                       |   0 . 0 7 8 5             | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                           | 
 
 |         e p _ l e n _ m e a n                     |   6 6 2                   | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1             | 
 
 |   t i m e /                                       |                           | 
 
 |         f p s                                     |   2 9 4                   | 
 
 |         i t e r a t i o n s                       |   3                       | 
 
 |         t i m e _ e l a p s e d                   |   4 1                     | 
 
 |         t o t a l _ t i m e s t e p s             |   1 2 2 8 8               | 
 
 |   t r a i n /                                     |                           | 
 
 |         a p p r o x _ k l                         |   0 . 0 1 9 0 3 2 6 5 2   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 2 4 1               | 
 
 |         c l i p _ r a n g e                       |   0 . 2                   | 
 
 |         e n t r o p y _ l o s s                   |   - 1 . 0 6               | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 5 9 7               | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3             | 
 
 |         l o s s                                   |   - 0 . 0 5 2 3           | 
 
 |         n _ u p d a t e s                         |   2 0                     | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 3 9 5           | 
 
 |         v a l u e _ l o s s                       |   0 . 0 5 3 2             | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                           | 
 
 |         e p _ l e n _ m e a n                     |   7 0 0                   | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1             | 
 
 |   t i m e /                                       |                           | 
 
 |         f p s                                     |   2 8 7                   | 
 
 |         i t e r a t i o n s                       |   4                       | 
 
 |         t i m e _ e l a p s e d                   |   5 6                     | 
 
 |         t o t a l _ t i m e s t e p s             |   1 6 3 8 4               | 
 
 |   t r a i n /                                     |                           | 
 
 |         a p p r o x _ k l                         |   0 . 0 1 9 9 3 6 6 1 2   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 2 7 2               | 
 
 |         c l i p _ r a n g e                       |   0 . 2                   | 
 
 |         e n t r o p y _ l o s s                   |   - 1 . 0 3               | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 7 1 2               | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3             | 
 
 |         l o s s                                   |   - 0 . 0 4 6             | 
 
 |         n _ u p d a t e s                         |   3 0                     | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 3 8 5           | 
 
 |         v a l u e _ l o s s                       |   0 . 0 3 6 3             | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                           | 
 
 |         e p _ l e n _ m e a n                     |   7 2 8                   | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1             | 
 
 |   t i m e /                                       |                           | 
 
 |         f p s                                     |   2 8 3                   | 
 
 |         i t e r a t i o n s                       |   5                       | 
 
 |         t i m e _ e l a p s e d                   |   7 2                     | 
 
 |         t o t a l _ t i m e s t e p s             |   2 0 4 8 0               | 
 
 |   t r a i n /                                     |                           | 
 
 |         a p p r o x _ k l                         |   0 . 0 2 2 9 3 7 1 2 3   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 2 8 4               | 
 
 |         c l i p _ r a n g e                       |   0 . 2                   | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 9 8 9             | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 8 5 3               | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3             | 
 
 |         l o s s                                   |   - 0 . 0 6 5 9           | 
 
 |         n _ u p d a t e s                         |   4 0                     | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 4 2 4           | 
 
 |         v a l u e _ l o s s                       |   0 . 0 3 2 4             | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   7 8 0                 | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 8 0                 | 
 
 |         i t e r a t i o n s                       |   6                     | 
 
 |         t i m e _ e l a p s e d                   |   8 7                   | 
 
 |         t o t a l _ t i m e s t e p s             |   2 4 5 7 6             | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 0 2 5 9 6 9 7 7   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 0 4             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 9 5 4           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 8 5 4             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 6 1 4         | 
 
 |         n _ u p d a t e s                         |   5 0                   | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 4 1           | 
 
 |         v a l u e _ l o s s                       |   0 . 0 3 3             | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                           | 
 
 |         e p _ l e n _ m e a n                     |   8 2 5                   | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1             | 
 
 |   t i m e /                                       |                           | 
 
 |         f p s                                     |   2 7 7                   | 
 
 |         i t e r a t i o n s                       |   7                       | 
 
 |         t i m e _ e l a p s e d                   |   1 0 3                   | 
 
 |         t o t a l _ t i m e s t e p s             |   2 8 6 7 2               | 
 
 |   t r a i n /                                     |                           | 
 
 |         a p p r o x _ k l                         |   0 . 0 3 3 1 5 9 0 2 5   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 5                 | 
 
 |         c l i p _ r a n g e                       |   0 . 2                   | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 9 2 2             | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 8 5 4               | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3             | 
 
 |         l o s s                                   |   - 0 . 0 5 6             | 
 
 |         n _ u p d a t e s                         |   6 0                     | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 4 7 2           | 
 
 |         v a l u e _ l o s s                       |   0 . 0 2 4 6             | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                           | 
 
 |         e p _ l e n _ m e a n                     |   8 8 2                   | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1             | 
 
 |   t i m e /                                       |                           | 
 
 |         f p s                                     |   2 7 3                   | 
 
 |         i t e r a t i o n s                       |   8                       | 
 
 |         t i m e _ e l a p s e d                   |   1 1 9                   | 
 
 |         t o t a l _ t i m e s t e p s             |   3 2 7 6 8               | 
 
 |   t r a i n /                                     |                           | 
 
 |         a p p r o x _ k l                         |   0 . 0 3 3 2 1 6 0 2 6   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 4 5               | 
 
 |         c l i p _ r a n g e                       |   0 . 2                   | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 8 8 9             | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 8 6 5               | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3             | 
 
 |         l o s s                                   |   - 0 . 0 7 9 9           | 
 
 |         n _ u p d a t e s                         |   7 0                     | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 2 1           | 
 
 |         v a l u e _ l o s s                       |   0 . 0 2 1 1             | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                           | 
 
 |         e p _ l e n _ m e a n                     |   9 2 5                   | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1             | 
 
 |   t i m e /                                       |                           | 
 
 |         f p s                                     |   2 7 2                   | 
 
 |         i t e r a t i o n s                       |   9                       | 
 
 |         t i m e _ e l a p s e d                   |   1 3 5                   | 
 
 |         t o t a l _ t i m e s t e p s             |   3 6 8 6 4               | 
 
 |   t r a i n /                                     |                           | 
 
 |         a p p r o x _ k l                         |   0 . 0 3 8 4 5 2 1 8 6   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 6 7               | 
 
 |         c l i p _ r a n g e                       |   0 . 2                   | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 8 5 6             | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 8 1 4               | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3             | 
 
 |         l o s s                                   |   - 0 . 0 8 2             | 
 
 |         n _ u p d a t e s                         |   8 0                     | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 2             | 
 
 |         v a l u e _ l o s s                       |   0 . 0 1 6 5             | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                     | 
 
 |         e p _ l e n _ m e a n                     |   9 6 7             | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1       | 
 
 |   t i m e /                                       |                     | 
 
 |         f p s                                     |   2 7 1             | 
 
 |         i t e r a t i o n s                       |   1 0               | 
 
 |         t i m e _ e l a p s e d                   |   1 5 1             | 
 
 |         t o t a l _ t i m e s t e p s             |   4 0 9 6 0         | 
 
 |   t r a i n /                                     |                     | 
 
 |         a p p r o x _ k l                         |   0 . 0 4 7 7 8 4   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 7 5         | 
 
 |         c l i p _ r a n g e                       |   0 . 2             | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 7 9 3       | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 8 5 3         | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3       | 
 
 |         l o s s                                   |   - 0 . 0 8 7 9     | 
 
 |         n _ u p d a t e s                         |   9 0               | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 9 4     | 
 
 |         v a l u e _ l o s s                       |   0 . 0 1 4 4       | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                           | 
 
 |         e p _ l e n _ m e a n                     |   1 . 0 1 e + 0 3         | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1             | 
 
 |   t i m e /                                       |                           | 
 
 |         f p s                                     |   2 6 9                   | 
 
 |         i t e r a t i o n s                       |   1 1                     | 
 
 |         t i m e _ e l a p s e d                   |   1 6 7                   | 
 
 |         t o t a l _ t i m e s t e p s             |   4 5 0 5 6               | 
 
 |   t r a i n /                                     |                           | 
 
 |         a p p r o x _ k l                         |   0 . 0 4 4 7 4 4 6 8 5   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 6 7               | 
 
 |         c l i p _ r a n g e                       |   0 . 2                   | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 7 8 2             | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 8 2                 | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3             | 
 
 |         l o s s                                   |   - 0 . 0 7 8 4           | 
 
 |         n _ u p d a t e s                         |   1 0 0                   | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 6 5           | 
 
 |         v a l u e _ l o s s                       |   0 . 0 1 1 6             | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   1 . 0 6 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 8                 | 
 
 |         i t e r a t i o n s                       |   1 2                   | 
 
 |         t i m e _ e l a p s e d                   |   1 8 3                 | 
 
 |         t o t a l _ t i m e s t e p s             |   4 9 1 5 2             | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 0 5 5 9 8 6 6 8   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 8 1             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 7 5 3           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 8 0 9             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 8 4           | 
 
 |         n _ u p d a t e s                         |   1 1 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 6 8         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 1 2 5           | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   1 . 1 e + 0 3         | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 7                 | 
 
 |         i t e r a t i o n s                       |   1 3                   | 
 
 |         t i m e _ e l a p s e d                   |   1 9 8                 | 
 
 |         t o t a l _ t i m e s t e p s             |   5 3 2 4 8             | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 0 6 2 7 6 1 9 2   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 8 6             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 7 3 3           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 7 6 8             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 9 9           | 
 
 |         n _ u p d a t e s                         |   1 2 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 8 8         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 1 2 1           | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   1 . 1 4 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 7                 | 
 
 |         i t e r a t i o n s                       |   1 4                   | 
 
 |         t i m e _ e l a p s e d                   |   2 1 4                 | 
 
 |         t o t a l _ t i m e s t e p s             |   5 7 3 4 4             | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 0 6 5 1 2 0 8 9   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 7 8             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 7 1             | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 7 8               | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 8 4 3         | 
 
 |         n _ u p d a t e s                         |   1 3 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 8 2         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 1 3 4           | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                           | 
 
 |         e p _ l e n _ m e a n                     |   1 . 2 e + 0 3           | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1             | 
 
 |   t i m e /                                       |                           | 
 
 |         f p s                                     |   2 6 7                   | 
 
 |         i t e r a t i o n s                       |   1 5                     | 
 
 |         t i m e _ e l a p s e d                   |   2 2 9                   | 
 
 |         t o t a l _ t i m e s t e p s             |   6 1 4 4 0               | 
 
 |   t r a i n /                                     |                           | 
 
 |         a p p r o x _ k l                         |   0 . 0 7 0 1 8 8 1 6 5   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 8 3               | 
 
 |         c l i p _ r a n g e                       |   0 . 2                   | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 6 8 3             | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 7 7 4               | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3             | 
 
 |         l o s s                                   |   - 0 . 0 9 0 1           | 
 
 |         n _ u p d a t e s                         |   1 4 0                   | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 3 5           | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 9 6             | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                           | 
 
 |         e p _ l e n _ m e a n                     |   1 . 2 3 e + 0 3         | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1             | 
 
 |   t i m e /                                       |                           | 
 
 |         f p s                                     |   2 6 8                   | 
 
 |         i t e r a t i o n s                       |   1 6                     | 
 
 |         t i m e _ e l a p s e d                   |   2 4 4                   | 
 
 |         t o t a l _ t i m e s t e p s             |   6 5 5 3 6               | 
 
 |   t r a i n /                                     |                           | 
 
 |         a p p r o x _ k l                         |   0 . 0 7 0 3 2 8 1 2 4   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 9 1               | 
 
 |         c l i p _ r a n g e                       |   0 . 2                   | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 7 1 3             | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 7 1 8               | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3             | 
 
 |         l o s s                                   |   - 0 . 0 7 6 2           | 
 
 |         n _ u p d a t e s                         |   1 5 0                   | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 4 8 5           | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 8 7 1           | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   1 . 2 8 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 8                 | 
 
 |         i t e r a t i o n s                       |   1 7                   | 
 
 |         t i m e _ e l a p s e d                   |   2 5 9                 | 
 
 |         t o t a l _ t i m e s t e p s             |   6 9 6 3 2             | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 0 7 0 3 5 6 1 3   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 8 2             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 6 9             | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 7 7 5             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 9 9 6         | 
 
 |         n _ u p d a t e s                         |   1 6 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 7 3         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 8 9           | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                       | 
 
 |         e p _ l e n _ m e a n                     |   1 . 3 2 e + 0 3     | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1         | 
 
 |   t i m e /                                       |                       | 
 
 |         f p s                                     |   2 6 8               | 
 
 |         i t e r a t i o n s                       |   1 8                 | 
 
 |         t i m e _ e l a p s e d                   |   2 7 4               | 
 
 |         t o t a l _ t i m e s t e p s             |   7 3 7 2 8           | 
 
 |   t r a i n /                                     |                       | 
 
 |         a p p r o x _ k l                         |   0 . 0 6 9 8 5 0 4   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 7 6           | 
 
 |         c l i p _ r a n g e                       |   0 . 2               | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 6 6 7         | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 8 0 4           | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3         | 
 
 |         l o s s                                   |   - 0 . 0 8 5 4       | 
 
 |         n _ u p d a t e s                         |   1 7 0               | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 4 5       | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 8 9 5       | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 E v a l   n u m _ t i m e s t e p s = 7 5 0 0 0 ,   e p i s o d e _ r e w a r d = 0 . 0 3   + / -   0 . 0 0 
 
 E p i s o d e   l e n g t h :   3 0 0 0 . 0 0   + / -   0 . 0 0 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   e v a l /                                       |                         | 
 
 |         m e a n _ e p _ l e n g t h               |   3 e + 0 3             | 
 
 |         m e a n _ r e w a r d                     |   0 . 0 2 9             | 
 
 |   t i m e /                                       |                         | 
 
 |         t o t a l _ t i m e s t e p s             |   7 5 0 0 0             | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 0 8 2 3 0 0 9 4   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 8 3             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 6 5 4           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 7 5 5             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 9 1 4         | 
 
 |         n _ u p d a t e s                         |   1 8 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 5 4         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 1 2 4           | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 N e w   b e s t   m e a n   r e w a r d ! 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                       |                     | 
 
 |         e p _ l e n _ m e a n           |   1 . 3 4 e + 0 3   | 
 
 |         e p _ r e w _ m e a n           |   - 0 . 2 0 1       | 
 
 |   t i m e /                             |                     | 
 
 |         f p s                           |   2 6 3             | 
 
 |         i t e r a t i o n s             |   1 9               | 
 
 |         t i m e _ e l a p s e d         |   2 9 4             | 
 
 |         t o t a l _ t i m e s t e p s   |   7 7 8 2 4         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   1 . 3 7 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 4                 | 
 
 |         i t e r a t i o n s                       |   2 0                   | 
 
 |         t i m e _ e l a p s e d                   |   3 1 0                 | 
 
 |         t o t a l _ t i m e s t e p s             |   8 1 9 2 0             | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 0 7 8 6 0 9 9 2   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 6 9             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 6 1 6           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 7 7 5             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 6 1 3         | 
 
 |         n _ u p d a t e s                         |   1 9 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 4 9 9         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 9 3 7         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                           | 
 
 |         e p _ l e n _ m e a n                     |   1 . 4 1 e + 0 3         | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1             | 
 
 |   t i m e /                                       |                           | 
 
 |         f p s                                     |   2 6 4                   | 
 
 |         i t e r a t i o n s                       |   2 1                     | 
 
 |         t i m e _ e l a p s e d                   |   3 2 5                   | 
 
 |         t o t a l _ t i m e s t e p s             |   8 6 0 1 6               | 
 
 |   t r a i n /                                     |                           | 
 
 |         a p p r o x _ k l                         |   0 . 0 8 7 4 9 8 0 5 4   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 9 8               | 
 
 |         c l i p _ r a n g e                       |   0 . 2                   | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 6 4 3             | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 8 0 3               | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3             | 
 
 |         l o s s                                   |   - 0 . 1 0 2             | 
 
 |         n _ u p d a t e s                         |   2 0 0                   | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 3 6           | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 7 0 6           | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   1 . 4 4 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 4                 | 
 
 |         i t e r a t i o n s                       |   2 2                   | 
 
 |         t i m e _ e l a p s e d                   |   3 4 0                 | 
 
 |         t o t a l _ t i m e s t e p s             |   9 0 1 1 2             | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 0 8 6 0 8 5 0 6   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 7 7             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 6 1 9           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 8 1 2             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 8 9 2         | 
 
 |         n _ u p d a t e s                         |   2 1 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 2 3         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 6 6 4         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   1 . 4 8 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 5                 | 
 
 |         i t e r a t i o n s                       |   2 3                   | 
 
 |         t i m e _ e l a p s e d                   |   3 5 5                 | 
 
 |         t o t a l _ t i m e s t e p s             |   9 4 2 0 8             | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 0 9 0 7 7 2 6 1   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 7 5             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 6 0 6           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 8 1 5             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 8 4 7         | 
 
 |         n _ u p d a t e s                         |   2 2 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 1 4         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 8 5 8         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   1 . 5 e + 0 3         | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 5                 | 
 
 |         i t e r a t i o n s                       |   2 4                   | 
 
 |         t i m e _ e l a p s e d                   |   3 7 0                 | 
 
 |         t o t a l _ t i m e s t e p s             |   9 8 3 0 4             | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 0 0 0 5 9 3 5   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 7 7             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 5 8 9           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 8 4 4             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 8 7 7         | 
 
 |         n _ u p d a t e s                         |   2 3 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 4 2         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 8 3 7         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                           | 
 
 |         e p _ l e n _ m e a n                     |   1 . 5 3 e + 0 3         | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1             | 
 
 |   t i m e /                                       |                           | 
 
 |         f p s                                     |   2 6 5                   | 
 
 |         i t e r a t i o n s                       |   2 5                     | 
 
 |         t i m e _ e l a p s e d                   |   3 8 5                   | 
 
 |         t o t a l _ t i m e s t e p s             |   1 0 2 4 0 0             | 
 
 |   t r a i n /                                     |                           | 
 
 |         a p p r o x _ k l                         |   0 . 1 0 5 2 4 5 6 0 5   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 6 9               | 
 
 |         c l i p _ r a n g e                       |   0 . 2                   | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 5 7 1             | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 8 3 2               | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3             | 
 
 |         l o s s                                   |   - 0 . 0 9 0 5           | 
 
 |         n _ u p d a t e s                         |   2 4 0                   | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 4 6           | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 6 9 6           | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                           | 
 
 |         e p _ l e n _ m e a n                     |   1 . 5 8 e + 0 3         | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1             | 
 
 |   t i m e /                                       |                           | 
 
 |         f p s                                     |   2 6 6                   | 
 
 |         i t e r a t i o n s                       |   2 6                     | 
 
 |         t i m e _ e l a p s e d                   |   4 0 0                   | 
 
 |         t o t a l _ t i m e s t e p s             |   1 0 6 4 9 6             | 
 
 |   t r a i n /                                     |                           | 
 
 |         a p p r o x _ k l                         |   0 . 1 2 4 0 3 8 2 0 5   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 4                   | 
 
 |         c l i p _ r a n g e                       |   0 . 2                   | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 5 9 4             | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 8 2 1               | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3             | 
 
 |         l o s s                                   |   - 0 . 1 0 3             | 
 
 |         n _ u p d a t e s                         |   2 5 0                   | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 5 2           | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 6 7 8           | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   1 . 6 2 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 6                 | 
 
 |         i t e r a t i o n s                       |   2 7                   | 
 
 |         t i m e _ e l a p s e d                   |   4 1 4                 | 
 
 |         t o t a l _ t i m e s t e p s             |   1 1 0 5 9 2           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 1 8 3 4 0 3 6   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 9 5             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 5 8 1           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 8 2 8             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 8 6 6         | 
 
 |         n _ u p d a t e s                         |   2 6 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 4 3         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 5 3 7         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   1 . 6 5 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 6                 | 
 
 |         i t e r a t i o n s                       |   2 8                   | 
 
 |         t i m e _ e l a p s e d                   |   4 3 0                 | 
 
 |         t o t a l _ t i m e s t e p s             |   1 1 4 6 8 8           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 2 6 1 4 8 3 3   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 9 6             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 5 6 9           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 7 7 4             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 1 1 6           | 
 
 |         n _ u p d a t e s                         |   2 7 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 6 3 7         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 3 8           | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   1 . 6 9 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 6                 | 
 
 |         i t e r a t i o n s                       |   2 9                   | 
 
 |         t i m e _ e l a p s e d                   |   4 4 6                 | 
 
 |         t o t a l _ t i m e s t e p s             |   1 1 8 7 8 4           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 2 8 6 8 5 4 7   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 8 4             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 5 5 8           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 7 0 1             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 9 1 4         | 
 
 |         n _ u p d a t e s                         |   2 8 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 7 8         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 5 8           | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   1 . 7 2 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 5                 | 
 
 |         i t e r a t i o n s                       |   3 0                   | 
 
 |         t i m e _ e l a p s e d                   |   4 6 2                 | 
 
 |         t o t a l _ t i m e s t e p s             |   1 2 2 8 8 0           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 3 0 9 8 7 1 1   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 8 8             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 5 5 4           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 7 6 2             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 9 5 5         | 
 
 |         n _ u p d a t e s                         |   2 9 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 6 3 9         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 3 0 9         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                     | 
 
 |         e p _ l e n _ m e a n                     |   1 . 7 6 e + 0 3   | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1       | 
 
 |   t i m e /                                       |                     | 
 
 |         f p s                                     |   2 6 5             | 
 
 |         i t e r a t i o n s                       |   3 1               | 
 
 |         t i m e _ e l a p s e d                   |   4 7 8             | 
 
 |         t o t a l _ t i m e s t e p s             |   1 2 6 9 7 6       | 
 
 |   t r a i n /                                     |                     | 
 
 |         a p p r o x _ k l                         |   0 . 1 3 2 4 5 6   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 7 8         | 
 
 |         c l i p _ r a n g e                       |   0 . 2             | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 5 4 6       | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 6 5 5         | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3       | 
 
 |         l o s s                                   |   - 0 . 0 9 4 7     | 
 
 |         n _ u p d a t e s                         |   3 0 0             | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 9 5     | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 3 8 5     | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   1 . 7 6 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 5                 | 
 
 |         i t e r a t i o n s                       |   3 2                   | 
 
 |         t i m e _ e l a p s e d                   |   4 9 4                 | 
 
 |         t o t a l _ t i m e s t e p s             |   1 3 1 0 7 2           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 3 4 3 1 0 6 9   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 8 1             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 5 2 9           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 7 0 6             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 9 4 8         | 
 
 |         n _ u p d a t e s                         |   3 1 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 6 1         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 3 7 6         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   1 . 8 e + 0 3         | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 5                 | 
 
 |         i t e r a t i o n s                       |   3 3                   | 
 
 |         t i m e _ e l a p s e d                   |   5 0 9                 | 
 
 |         t o t a l _ t i m e s t e p s             |   1 3 5 1 6 8           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 4 9 3 5 1 2 4   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 6 5             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 5 0 3           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 6 1 3             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 8 5 8         | 
 
 |         n _ u p d a t e s                         |   3 2 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 4 8 7         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 4 4 9         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   1 . 8 4 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 5                 | 
 
 |         i t e r a t i o n s                       |   3 4                   | 
 
 |         t i m e _ e l a p s e d                   |   5 2 4                 | 
 
 |         t o t a l _ t i m e s t e p s             |   1 3 9 2 6 4           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 5 1 7 6 0 2 8   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 8 8             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 5 1 9           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 6 2 3             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 9 1 3         | 
 
 |         n _ u p d a t e s                         |   3 3 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 7 5         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 3 8 2         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   1 . 8 9 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 5                 | 
 
 |         i t e r a t i o n s                       |   3 5                   | 
 
 |         t i m e _ e l a p s e d                   |   5 3 9                 | 
 
 |         t o t a l _ t i m e s t e p s             |   1 4 3 3 6 0           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 4 6 5 0 4 1 5   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 6 5             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 9 3           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 6 0 8             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 9 1 1         | 
 
 |         n _ u p d a t e s                         |   3 4 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 1 4         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 3 7 4         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                       | 
 
 |         e p _ l e n _ m e a n                     |   1 . 9 2 e + 0 3     | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1         | 
 
 |   t i m e /                                       |                       | 
 
 |         f p s                                     |   2 6 5               | 
 
 |         i t e r a t i o n s                       |   3 6                 | 
 
 |         t i m e _ e l a p s e d                   |   5 5 4               | 
 
 |         t o t a l _ t i m e s t e p s             |   1 4 7 4 5 6         | 
 
 |   t r a i n /                                     |                       | 
 
 |         a p p r o x _ k l                         |   0 . 1 4 4 8 3 8 9   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 7 3           | 
 
 |         c l i p _ r a n g e                       |   0 . 2               | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 5 0 6         | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 5 8 6           | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3         | 
 
 |         l o s s                                   |   - 0 . 0 9 1 9       | 
 
 |         n _ u p d a t e s                         |   3 5 0               | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 3 3       | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 4 3 9       | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 E v a l   n u m _ t i m e s t e p s = 1 5 0 0 0 0 ,   e p i s o d e _ r e w a r d = - 0 . 0 0   + / -   0 . 0 0 
 
 E p i s o d e   l e n g t h :   3 0 0 0 . 0 0   + / -   0 . 0 0 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   e v a l /                                       |                         | 
 
 |         m e a n _ e p _ l e n g t h               |   3 e + 0 3             | 
 
 |         m e a n _ r e w a r d                     |   - 0 . 0 0 2 5 5       | 
 
 |   t i m e /                                       |                         | 
 
 |         t o t a l _ t i m e s t e p s             |   1 5 0 0 0 0           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 4 7 4 0 1 4 2   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 6 8             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 9 5           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 6 3 5             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 9 5 1         | 
 
 |         n _ u p d a t e s                         |   3 6 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 4 9         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 4 3 6         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                       |                     | 
 
 |         e p _ l e n _ m e a n           |   1 . 9 6 e + 0 3   | 
 
 |         e p _ r e w _ m e a n           |   - 0 . 2 0 1       | 
 
 |   t i m e /                             |                     | 
 
 |         f p s                           |   2 6 2             | 
 
 |         i t e r a t i o n s             |   3 7               | 
 
 |         t i m e _ e l a p s e d         |   5 7 7             | 
 
 |         t o t a l _ t i m e s t e p s   |   1 5 1 5 5 2       | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   1 . 9 6 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 1                 | 
 
 |         i t e r a t i o n s                       |   3 8                   | 
 
 |         t i m e _ e l a p s e d                   |   5 9 4                 | 
 
 |         t o t a l _ t i m e s t e p s             |   1 5 5 6 4 8           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 5 9 3 3 1 0 5   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 6 8             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 8             | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 6 3 5             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 9 4           | 
 
 |         n _ u p d a t e s                         |   3 7 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 5 8         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 4 0 3         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   2 e + 0 3             | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 0                 | 
 
 |         i t e r a t i o n s                       |   3 9                   | 
 
 |         t i m e _ e l a p s e d                   |   6 1 2                 | 
 
 |         t o t a l _ t i m e s t e p s             |   1 5 9 7 4 4           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 5 0 4 6 9 3 2   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 6               | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 6 8           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 7 0 6             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 8 5 3         | 
 
 |         n _ u p d a t e s                         |   3 8 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 5           | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 3 1 5         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   2 . 0 5 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 0                 | 
 
 |         i t e r a t i o n s                       |   4 0                   | 
 
 |         t i m e _ e l a p s e d                   |   6 2 8                 | 
 
 |         t o t a l _ t i m e s t e p s             |   1 6 3 8 4 0           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 5 9 5 8 1 3 3   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 6 7             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 6 1           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 6 4 9             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 8 9 9         | 
 
 |         n _ u p d a t e s                         |   3 9 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 0 7         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 3 5 7         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   2 . 0 9 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 0                 | 
 
 |         i t e r a t i o n s                       |   4 1                   | 
 
 |         t i m e _ e l a p s e d                   |   6 4 4                 | 
 
 |         t o t a l _ t i m e s t e p s             |   1 6 7 9 3 6           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 8 3 7 5 9 4 5   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 7 6             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 5 9           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 7 1 3             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 7 3 8         | 
 
 |         n _ u p d a t e s                         |   4 0 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 5 2         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 3 1 8         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   2 . 0 9 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 0                 | 
 
 |         i t e r a t i o n s                       |   4 2                   | 
 
 |         t i m e _ e l a p s e d                   |   6 5 9                 | 
 
 |         t o t a l _ t i m e s t e p s             |   1 7 2 0 3 2           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 2 0 0 0 9 8 1 4   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 8 8             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 7 4           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 6 6 5             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 9 5           | 
 
 |         n _ u p d a t e s                         |   4 1 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 6 2         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 3 4 8         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   2 . 1 4 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2 0 1           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 1                 | 
 
 |         i t e r a t i o n s                       |   4 3                   | 
 
 |         t i m e _ e l a p s e d                   |   6 7 4                 | 
 
 |         t o t a l _ t i m e s t e p s             |   1 7 6 1 2 8           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 7 2 9 1 7 2 8   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 8 1             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 7 1           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 7 0 1             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 8 9 3         | 
 
 |         n _ u p d a t e s                         |   4 2 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 2 3         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 3 4 2         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   2 . 1 9 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2               | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 1                 | 
 
 |         i t e r a t i o n s                       |   4 4                   | 
 
 |         t i m e _ e l a p s e d                   |   6 8 9                 | 
 
 |         t o t a l _ t i m e s t e p s             |   1 8 0 2 2 4           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 5 9 4 4 3 5 7   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 7 4             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 6 4           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 6 1 5             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 8 1 1         | 
 
 |         n _ u p d a t e s                         |   4 3 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 5 1         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 3 0 8         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   2 . 1 9 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2               | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 1                 | 
 
 |         i t e r a t i o n s                       |   4 5                   | 
 
 |         t i m e _ e l a p s e d                   |   7 0 4                 | 
 
 |         t o t a l _ t i m e s t e p s             |   1 8 4 3 2 0           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 6 5 5 8 2 3 9   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 6 8             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 5 1           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 7 5 6             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 7 7 9         | 
 
 |         n _ u p d a t e s                         |   4 4 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 4 9         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 3 0 3         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   2 . 2 3 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2               | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 1                 | 
 
 |         i t e r a t i o n s                       |   4 6                   | 
 
 |         t i m e _ e l a p s e d                   |   7 2 1                 | 
 
 |         t o t a l _ t i m e s t e p s             |   1 8 8 4 1 6           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 7 7 0 4 3 5 7   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 8 2             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 7 3           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 6 6 4             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 7 0 3         | 
 
 |         n _ u p d a t e s                         |   4 5 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 4 9 7         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 3 6 6         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                       | 
 
 |         e p _ l e n _ m e a n                     |   2 . 2 7 e + 0 3     | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2             | 
 
 |   t i m e /                                       |                       | 
 
 |         f p s                                     |   2 6 1               | 
 
 |         i t e r a t i o n s                       |   4 7                 | 
 
 |         t i m e _ e l a p s e d                   |   7 3 6               | 
 
 |         t o t a l _ t i m e s t e p s             |   1 9 2 5 1 2         | 
 
 |   t r a i n /                                     |                       | 
 
 |         a p p r o x _ k l                         |   0 . 1 8 4 5 5 3 2   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 6 8           | 
 
 |         c l i p _ r a n g e                       |   0 . 2               | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 5 8         | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 6 6 8           | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3         | 
 
 |         l o s s                                   |   - 0 . 0 9 8 7       | 
 
 |         n _ u p d a t e s                         |   4 6 0               | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 1 9       | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 3 3 5       | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   2 . 3 1 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2               | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 1                 | 
 
 |         i t e r a t i o n s                       |   4 8                   | 
 
 |         t i m e _ e l a p s e d                   |   7 5 1                 | 
 
 |         t o t a l _ t i m e s t e p s             |   1 9 6 6 0 8           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 6 3 3 6 6 4 5   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 5 6             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 4 1           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 7 1               | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 7 6 7         | 
 
 |         n _ u p d a t e s                         |   4 7 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 0 8         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 3 7 1         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   2 . 3 1 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 2               | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 1                 | 
 
 |         i t e r a t i o n s                       |   4 9                   | 
 
 |         t i m e _ e l a p s e d                   |   7 6 6                 | 
 
 |         t o t a l _ t i m e s t e p s             |   2 0 0 7 0 4           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 6 4 4 6 1 4 3   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 7 7             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 6 2           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 6 6 7             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 8 3 4         | 
 
 |         n _ u p d a t e s                         |   4 8 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 2 4         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 4 3 5         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   2 . 3 5 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 1 9 9           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 1                 | 
 
 |         i t e r a t i o n s                       |   5 0                   | 
 
 |         t i m e _ e l a p s e d                   |   7 8 1                 | 
 
 |         t o t a l _ t i m e s t e p s             |   2 0 4 8 0 0           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 7 5 7 1 9 5 4   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 7 2             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 4 3           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 8 2 3             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 8 4 2         | 
 
 |         n _ u p d a t e s                         |   4 9 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 3 8         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 3 0 2         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   2 . 4 e + 0 3         | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 1 9 9           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 2                 | 
 
 |         i t e r a t i o n s                       |   5 1                   | 
 
 |         t i m e _ e l a p s e d                   |   7 9 6                 | 
 
 |         t o t a l _ t i m e s t e p s             |   2 0 8 8 9 6           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 8 6 5 0 6 9 6   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 6 5             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 4 7           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 7 7 9             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 8 8 2         | 
 
 |         n _ u p d a t e s                         |   5 0 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 4 7 7         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 3 7 4         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   2 . 4 e + 0 3         | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 1 9 9           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 2                 | 
 
 |         i t e r a t i o n s                       |   5 2                   | 
 
 |         t i m e _ e l a p s e d                   |   8 1 1                 | 
 
 |         t o t a l _ t i m e s t e p s             |   2 1 2 9 9 2           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 9 4 4 1 1 5 2   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 7 7             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 4 6           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 7 2               | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 1 0 1           | 
 
 |         n _ u p d a t e s                         |   5 1 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 6 5         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 3 7 4         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   2 . 4 4 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 1 9 9           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 2                 | 
 
 |         i t e r a t i o n s                       |   5 3                   | 
 
 |         t i m e _ e l a p s e d                   |   8 2 6                 | 
 
 |         t o t a l _ t i m e s t e p s             |   2 1 7 0 8 8           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 2 1 0 0 7 3 2 5   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 9 2             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 6 2           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 5 6 6             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 8 7 8         | 
 
 |         n _ u p d a t e s                         |   5 2 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 0 7         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 4 7 8         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   2 . 4 8 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 1 9 9           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 2                 | 
 
 |         i t e r a t i o n s                       |   5 4                   | 
 
 |         t i m e _ e l a p s e d                   |   8 4 1                 | 
 
 |         t o t a l _ t i m e s t e p s             |   2 2 1 1 8 4           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 8 6 4 2 8 1 6   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 6 2             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 3             | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 7 0 5             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 7 3 8         | 
 
 |         n _ u p d a t e s                         |   5 3 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 0 5         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 3 6 9         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 E v a l   n u m _ t i m e s t e p s = 2 2 5 0 0 0 ,   e p i s o d e _ r e w a r d = - 0 . 0 2   + / -   0 . 0 0 
 
 E p i s o d e   l e n g t h :   3 0 0 0 . 0 0   + / -   0 . 0 0 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   e v a l /                                       |                         | 
 
 |         m e a n _ e p _ l e n g t h               |   3 e + 0 3             | 
 
 |         m e a n _ r e w a r d                     |   - 0 . 0 2 4 6         | 
 
 |   t i m e /                                       |                         | 
 
 |         t o t a l _ t i m e s t e p s             |   2 2 5 0 0 0           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 2 0 1 1 7 7 6 3   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 7 1             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 3             | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 7 1 5             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 8 6 9         | 
 
 |         n _ u p d a t e s                         |   5 4 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 1 8         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 3 5 9         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                       |                     | 
 
 |         e p _ l e n _ m e a n           |   2 . 4 8 e + 0 3   | 
 
 |         e p _ r e w _ m e a n           |   - 0 . 1 9 9       | 
 
 |   t i m e /                             |                     | 
 
 |         f p s                           |   2 6 1             | 
 
 |         i t e r a t i o n s             |   5 5               | 
 
 |         t i m e _ e l a p s e d         |   8 6 2             | 
 
 |         t o t a l _ t i m e s t e p s   |   2 2 5 2 8 0       | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                       | 
 
 |         e p _ l e n _ m e a n                     |   2 . 5 2 e + 0 3     | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 1 9 8         | 
 
 |   t i m e /                                       |                       | 
 
 |         f p s                                     |   2 6 1               | 
 
 |         i t e r a t i o n s                       |   5 6                 | 
 
 |         t i m e _ e l a p s e d                   |   8 7 7               | 
 
 |         t o t a l _ t i m e s t e p s             |   2 2 9 3 7 6         | 
 
 |   t r a i n /                                     |                       | 
 
 |         a p p r o x _ k l                         |   0 . 2 0 7 5 0 9 2   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 9 2           | 
 
 |         c l i p _ r a n g e                       |   0 . 2               | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 4 9         | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 6 6 3           | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3         | 
 
 |         l o s s                                   |   - 0 . 0 8 1 8       | 
 
 |         n _ u p d a t e s                         |   5 5 0               | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 0 9       | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 3 8 6       | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   2 . 5 5 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 1 9 8           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 1                 | 
 
 |         i t e r a t i o n s                       |   5 7                   | 
 
 |         t i m e _ e l a p s e d                   |   8 9 2                 | 
 
 |         t o t a l _ t i m e s t e p s             |   2 3 3 4 7 2           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 9 1 3 8 5 9 5   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 7 4             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 3 9           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 7 4 6             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 8 5 7         | 
 
 |         n _ u p d a t e s                         |   5 6 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 3 3         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 4 3 2         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   2 . 5 5 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 1 9 8           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 1                 | 
 
 |         i t e r a t i o n s                       |   5 8                   | 
 
 |         t i m e _ e l a p s e d                   |   9 0 7                 | 
 
 |         t o t a l _ t i m e s t e p s             |   2 3 7 5 6 8           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 2 1 2 4 7 9 6 2   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 5 9             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 2 5           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 7 2 4             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 7 6 8         | 
 
 |         n _ u p d a t e s                         |   5 7 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 4 9 5         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 3 8           | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   2 . 5 9 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 1 9 7           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 1                 | 
 
 |         i t e r a t i o n s                       |   5 9                   | 
 
 |         t i m e _ e l a p s e d                   |   9 2 2                 | 
 
 |         t o t a l _ t i m e s t e p s             |   2 4 1 6 6 4           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 8 4 1 7 5 6 1   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 7 3             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 3 9           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 7 1 7             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 8 8 7         | 
 
 |         n _ u p d a t e s                         |   5 8 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 4 7           | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 3 5 1         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                       | 
 
 |         e p _ l e n _ m e a n                     |   2 . 6 3 e + 0 3     | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 1 9 6         | 
 
 |   t i m e /                                       |                       | 
 
 |         f p s                                     |   2 6 2               | 
 
 |         i t e r a t i o n s                       |   6 0                 | 
 
 |         t i m e _ e l a p s e d                   |   9 3 7               | 
 
 |         t o t a l _ t i m e s t e p s             |   2 4 5 7 6 0         | 
 
 |   t r a i n /                                     |                       | 
 
 |         a p p r o x _ k l                         |   0 . 1 9 5 5 3 4 7   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 6 6           | 
 
 |         c l i p _ r a n g e                       |   0 . 2               | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 3 2         | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 7 7 7           | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3         | 
 
 |         l o s s                                   |   - 0 . 0 9 6 1       | 
 
 |         n _ u p d a t e s                         |   5 9 0               | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 1 9       | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 3 7 7       | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   2 . 6 3 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 1 9 6           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 2                 | 
 
 |         i t e r a t i o n s                       |   6 1                   | 
 
 |         t i m e _ e l a p s e d                   |   9 5 2                 | 
 
 |         t o t a l _ t i m e s t e p s             |   2 4 9 8 5 6           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 9 3 8 2 3 6 4   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 5 4             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 0 9           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 7 0 5             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 8 6 6         | 
 
 |         n _ u p d a t e s                         |   6 0 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 1 1         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 4 4 1         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   2 . 6 6 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 1 9 5           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 2                 | 
 
 |         i t e r a t i o n s                       |   6 2                   | 
 
 |         t i m e _ e l a p s e d                   |   9 6 7                 | 
 
 |         t o t a l _ t i m e s t e p s             |   2 5 3 9 5 2           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 2 0 4 7 2 5 3 5   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 6               | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 2 4           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 6 4 1             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 8 9 5         | 
 
 |         n _ u p d a t e s                         |   6 1 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 4 6 1         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 5 1 4         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   2 . 7 e + 0 3         | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 1 9 4           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 2                 | 
 
 |         i t e r a t i o n s                       |   6 3                   | 
 
 |         t i m e _ e l a p s e d                   |   9 8 3                 | 
 
 |         t o t a l _ t i m e s t e p s             |   2 5 8 0 4 8           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 9 2 9 6 1 1 9   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 5 4             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 1 7           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 7 9 8             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 8 9 4         | 
 
 |         n _ u p d a t e s                         |   6 2 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 4 7           | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 3 9 2         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   2 . 7 e + 0 3         | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 1 9 4           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 2                 | 
 
 |         i t e r a t i o n s                       |   6 4                   | 
 
 |         t i m e _ e l a p s e d                   |   9 9 9                 | 
 
 |         t o t a l _ t i m e s t e p s             |   2 6 2 1 4 4           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 7 6 7 5 0 5 4   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 3 8             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 0 3           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 6 9 6             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 8 9 6         | 
 
 |         n _ u p d a t e s                         |   6 3 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 4 7 4         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 4 8 7         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   2 . 7 3 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 1 9 3           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 2                 | 
 
 |         i t e r a t i o n s                       |   6 5                   | 
 
 |         t i m e _ e l a p s e d                   |   1 0 1 4               | 
 
 |         t o t a l _ t i m e s t e p s             |   2 6 6 2 4 0           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 7 7 3 0 7 5 5   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 5 7             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 1 1           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 6 3 1             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 8 5           | 
 
 |         n _ u p d a t e s                         |   6 4 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 0 5         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 4 5           | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   2 . 7 7 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 1 9 2           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 2                 | 
 
 |         i t e r a t i o n s                       |   6 6                   | 
 
 |         t i m e _ e l a p s e d                   |   1 0 3 0               | 
 
 |         t o t a l _ t i m e s t e p s             |   2 7 0 3 3 6           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 9 9 3 0 4 3 6   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 5 7             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 1 3           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 7 6 6             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 7 6 5         | 
 
 |         n _ u p d a t e s                         |   6 5 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 0 3         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 4 2 6         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   2 . 8 e + 0 3         | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 1 9 1           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 2                 | 
 
 |         i t e r a t i o n s                       |   6 7                   | 
 
 |         t i m e _ e l a p s e d                   |   1 0 4 5               | 
 
 |         t o t a l _ t i m e s t e p s             |   2 7 4 4 3 2           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 9 0 7 4 1 2 4   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 5 1             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 3 9 9           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 7 0 8             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 7 8 5         | 
 
 |         n _ u p d a t e s                         |   6 6 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 3 9         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 4 4 8         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   2 . 8 e + 0 3         | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 1 9 1           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 2                 | 
 
 |         i t e r a t i o n s                       |   6 8                   | 
 
 |         t i m e _ e l a p s e d                   |   1 0 6 0               | 
 
 |         t o t a l _ t i m e s t e p s             |   2 7 8 5 2 8           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 2 1 4 0 2 8 7 8   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 5 8             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 0 2           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 6 8 2             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 7 7 6         | 
 
 |         n _ u p d a t e s                         |   6 7 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 4 9           | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 4 5 5         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   2 . 8 3 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 1 9             | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 2                 | 
 
 |         i t e r a t i o n s                       |   6 9                   | 
 
 |         t i m e _ e l a p s e d                   |   1 0 7 5               | 
 
 |         t o t a l _ t i m e s t e p s             |   2 8 2 6 2 4           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 2 0 0 6 9 4 2 2   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 5 2             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4               | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 7 0 6             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 9 0 5         | 
 
 |         n _ u p d a t e s                         |   6 8 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 2 7         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 4 1 1         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                       | 
 
 |         e p _ l e n _ m e a n                     |   2 . 8 6 e + 0 3     | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 1 8 9         | 
 
 |   t i m e /                                       |                       | 
 
 |         f p s                                     |   2 6 2               | 
 
 |         i t e r a t i o n s                       |   7 0                 | 
 
 |         t i m e _ e l a p s e d                   |   1 0 9 2             | 
 
 |         t o t a l _ t i m e s t e p s             |   2 8 6 7 2 0         | 
 
 |   t r a i n /                                     |                       | 
 
 |         a p p r o x _ k l                         |   0 . 1 8 7 4 0 6 1   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 5 3           | 
 
 |         c l i p _ r a n g e                       |   0 . 2               | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 3 9 7         | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 7 0 7           | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3         | 
 
 |         l o s s                                   |   - 0 . 0 9 0 1       | 
 
 |         n _ u p d a t e s                         |   6 9 0               | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 5 1 1       | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 4 2 2       | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   2 . 8 6 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 1 8 9           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 2                 | 
 
 |         i t e r a t i o n s                       |   7 1                   | 
 
 |         t i m e _ e l a p s e d                   |   1 1 0 7               | 
 
 |         t o t a l _ t i m e s t e p s             |   2 9 0 8 1 6           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 8 7 8 9 7 0 7   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 4 5             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 3 9 4           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 6 0 1             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 8 2 3         | 
 
 |         n _ u p d a t e s                         |   7 0 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 4 9 1         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 4 4 7         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                         | 
 
 |         e p _ l e n _ m e a n                     |   2 . 9 2 e + 0 3       | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 1 8 8           | 
 
 |   t i m e /                                       |                         | 
 
 |         f p s                                     |   2 6 2                 | 
 
 |         i t e r a t i o n s                       |   7 2                   | 
 
 |         t i m e _ e l a p s e d                   |   1 1 2 2               | 
 
 |         t o t a l _ t i m e s t e p s             |   2 9 4 9 1 2           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 2 1 2 2 6 8 8 6   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 5 8             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 0 8           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 6 8 2             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 6 8 4         | 
 
 |         n _ u p d a t e s                         |   7 1 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 4 6 9         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 3 9 5         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                                 |                       | 
 
 |         e p _ l e n _ m e a n                     |   2 . 9 7 e + 0 3     | 
 
 |         e p _ r e w _ m e a n                     |   - 0 . 1 8 7         | 
 
 |   t i m e /                                       |                       | 
 
 |         f p s                                     |   2 6 2               | 
 
 |         i t e r a t i o n s                       |   7 3                 | 
 
 |         t i m e _ e l a p s e d                   |   1 1 3 8             | 
 
 |         t o t a l _ t i m e s t e p s             |   2 9 9 0 0 8         | 
 
 |   t r a i n /                                     |                       | 
 
 |         a p p r o x _ k l                         |   0 . 2 1 3 1 9 2 4   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 5 2           | 
 
 |         c l i p _ r a n g e                       |   0 . 2               | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 4 0 4         | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 6 6 2           | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3         | 
 
 |         l o s s                                   |   - 0 . 0 8 2 7       | 
 
 |         n _ u p d a t e s                         |   7 2 0               | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 4 3 4       | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 4 9 7       | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 E v a l   n u m _ t i m e s t e p s = 3 0 0 0 0 0 ,   e p i s o d e _ r e w a r d = - 0 . 0 7   + / -   0 . 0 0 
 
 E p i s o d e   l e n g t h :   3 0 0 0 . 0 0   + / -   0 . 0 0 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   e v a l /                                       |                         | 
 
 |         m e a n _ e p _ l e n g t h               |   3 e + 0 3             | 
 
 |         m e a n _ r e w a r d                     |   - 0 . 0 7 3 4         | 
 
 |   t i m e /                                       |                         | 
 
 |         t o t a l _ t i m e s t e p s             |   3 0 0 0 0 0           | 
 
 |   t r a i n /                                     |                         | 
 
 |         a p p r o x _ k l                         |   0 . 1 7 6 0 9 1 0 3   | 
 
 |         c l i p _ f r a c t i o n                 |   0 . 3 3 9             | 
 
 |         c l i p _ r a n g e                       |   0 . 2                 | 
 
 |         e n t r o p y _ l o s s                   |   - 0 . 3 9 2           | 
 
 |         e x p l a i n e d _ v a r i a n c e       |   0 . 6 4 5             | 
 
 |         l e a r n i n g _ r a t e                 |   0 . 0 0 0 3           | 
 
 |         l o s s                                   |   - 0 . 0 8 8 3         | 
 
 |         n _ u p d a t e s                         |   7 3 0                 | 
 
 |         p o l i c y _ g r a d i e n t _ l o s s   |   - 0 . 0 4 9 9         | 
 
 |         v a l u e _ l o s s                       |   0 . 0 0 4 2 8         | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 |   r o l l o u t /                       |                     | 
 
 |         e p _ l e n _ m e a n           |   2 . 9 7 e + 0 3   | 
 
 |         e p _ r e w _ m e a n           |   - 0 . 1 8 7       | 
 
 |   t i m e /                             |                     | 
 
 |         f p s                           |   2 6 1             | 
 
 |         i t e r a t i o n s             |   7 4               | 
 
 |         t i m e _ e l a p s e d         |   1 1 5 9           | 
 
 |         t o t a l _ t i m e s t e p s   |   3 0 3 1 0 4       | 
 
 - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - 
 
 [ m i n i _ u p d a t e ]   S a v e d   m o d e l   - >   m o d e l s \ p p o _ x a u u s d _ m 5 . z i p 
 
 [ m i n i _ u p d a t e ]   S a v e d   V e c N o r m a l i z e   - >   m o d e l s \ v e c n o r m _ x a u u s d _ m 5 . p k l 
 
 
[2025-11-08T06:03:11.8227132+01:00] [mini_update] done


=== FILE: logs\services\nightly_train.log ===


[2025-11-08T00:30:00.5177773+01:00] [nightly_train] start
[ERROR] python.exe : Traceback (most recent call last):
At C:\xau_rl\ops\daemon_nightly_train.ps1:11 char:3
+   & $PY "rl\train_ppo.py" "--timesteps" "1500000" *>> $LOG
+   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (Traceback (most recent call last)::String) [], Remote 
   Exception
    + FullyQualifiedErrorId : NativeCommandError
 



=== FILE: logs\services\paper_loop.err.log ===



=== FILE: logs\services\paper_loop.log ===



=== FILE: logs\services\te_calendar.log ===


[2025-11-08T05:00:00.6133346+01:00] [te_calendar] start
[ERROR] python.exe : Brak TE_API_KEY. Ustaw zmienn╣ ťrodowiskow╣ TE_API_KEY i uruchom ponownie.
At C:\xau_rl\ops\daemon_te_calendar.ps1:11 char:3
+   & $PY "save_te_calendar_cache.py" *>> $LOG
+   ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : NotSpecified: (Brak TE_API_KEY...uchom ponownie.:String) [], RemoteE 
   xception
    + FullyQualifiedErrorId : NativeCommandError
 



=== FILE: logs\services\xau_calibration.err.log ===



=== FILE: logs\services\xau_calibration.out.log ===



=== FILE: logs\services\xau_cleanup.err.log ===



=== FILE: logs\services\xau_cleanup.out.log ===

[2025-11-05T15:36:16.4113721+01:00] [cleanup] Start cleanup
[2025-11-05T15:36:16.5753400+01:00] [cleanup] Czyszczenie folder¢w PPO (C:\xau_rl;KEEP_PPO=15;KEEP_LOG_DAYS=21;CLEANUP_INTERVAL_HOURS=6\logs\ppo_gold_m5) - zachowuj© 10
[2025-11-05T15:36:16.6110234+01:00] [cleanup] Czyszczenie log¢w usˆug starszych ni¾ 30 dni (C:\xau_rl;KEEP_PPO=15;KEEP_LOG_DAYS=21;CLEANUP_INTERVAL_HOURS=6\logs\services)
[2025-11-05T15:36:16.6110234+01:00] [cleanup] Cleanup zakoäczony
[2025-11-05T15:46:02.3881281+01:00] [cleanup] Start cleanup
[2025-11-05T15:46:02.5316108+01:00] [cleanup] Czyszczenie folder¢w PPO (C:\xau_rl;KEEP_PPO=15;KEEP_LOG_DAYS=21;CLEANUP_INTERVAL_HOURS=6\logs\ppo_gold_m5) - zachowuj© 10
[2025-11-05T15:46:02.5971387+01:00] [cleanup] Czyszczenie log¢w usˆug starszych ni¾ 30 dni (C:\xau_rl;KEEP_PPO=15;KEEP_LOG_DAYS=21;CLEANUP_INTERVAL_HOURS=6\logs\services)
[2025-11-05T15:46:02.5971387+01:00] [cleanup] Cleanup zakoäczony
[2025-11-05T15:46:06.4391524+01:00] [cleanup] Start cleanup
[2025-11-05T15:46:06.5179477+01:00] [cleanup] Czyszczenie folder¢w PPO (C:\xau_rl;KEEP_PPO=15;KEEP_LOG_DAYS=21;CLEANUP_INTERVAL_HOURS=6\logs\ppo_gold_m5) - zachowuj© 10
[2025-11-05T15:46:06.5318746+01:00] [cleanup] Czyszczenie log¢w usˆug starszych ni¾ 30 dni (C:\xau_rl;KEEP_PPO=15;KEEP_LOG_DAYS=21;CLEANUP_INTERVAL_HOURS=6\logs\services)
[2025-11-05T15:46:06.5369847+01:00] [cleanup] Cleanup zakoäczony
[2025-11-05T15:47:10.3375474+01:00] [cleanup] Start cleanup
[2025-11-05T15:47:10.3375474+01:00] [cleanup] Czyszczenie folder¢w PPO (C:\xau_rl;KEEP_PPO=15;KEEP_LOG_DAYS=21;CLEANUP_INTERVAL_HOURS=6\logs\ppo_gold_m5) - zachowuj© 10
[2025-11-05T15:47:10.3375474+01:00] [cleanup] Czyszczenie log¢w usˆug starszych ni¾ 30 dni (C:\xau_rl;KEEP_PPO=15;KEEP_LOG_DAYS=21;CLEANUP_INTERVAL_HOURS=6\logs\services)
[2025-11-05T15:47:10.3375474+01:00] [cleanup] Cleanup zakoäczony
[2025-11-05T15:52:15.8787220+01:00] [cleanup] Start cleanup
[2025-11-05T15:52:15.9655369+01:00] [cleanup] Czyszczenie folder¢w PPO (C:\xau_rl\logs\ppo_gold_m5) - zachowuj© 10
[2025-11-05T15:52:16.0432312+01:00] [cleanup] Usuni©to folder: PPO_107
[2025-11-05T15:52:16.0457829+01:00] [cleanup] Usuni©to folder: PPO_106
[2025-11-05T15:52:16.0473392+01:00] [cleanup] Usuni©to folder: PPO_105
[2025-11-05T15:52:16.0532833+01:00] [cleanup] Usuni©to folder: PPO_104
[2025-11-05T15:52:16.0555266+01:00] [cleanup] Usuni©to folder: PPO_103
[2025-11-05T15:52:16.0602694+01:00] [cleanup] Usuni©to folder: PPO_102
[2025-11-05T15:52:16.0602694+01:00] [cleanup] Usuni©to folder: PPO_101
[2025-11-05T15:52:16.0602694+01:00] [cleanup] Usuni©to folder: PPO_100
[2025-11-05T15:52:16.0602694+01:00] [cleanup] Usuni©to folder: PPO_99
[2025-11-05T15:52:16.0880687+01:00] [cleanup] Usuni©to folder: PPO_98
[2025-11-05T15:52:16.0897094+01:00] [cleanup] Usuni©to folder: PPO_97
[2025-11-05T15:52:16.0897094+01:00] [cleanup] Usuni©to folder: PPO_96
[2025-11-05T15:52:16.1015380+01:00] [cleanup] Usuni©to folder: PPO_95
[2025-11-05T15:52:16.1060970+01:00] [cleanup] Usuni©to folder: PPO_94
[2025-11-05T15:52:16.1081221+01:00] [cleanup] Usuni©to folder: PPO_93
[2025-11-05T15:52:16.1081221+01:00] [cleanup] Usuni©to folder: PPO_92
[2025-11-05T15:52:16.1081221+01:00] [cleanup] Usuni©to folder: PPO_91
[2025-11-05T15:52:16.1081221+01:00] [cleanup] Usuni©to folder: PPO_90
[2025-11-05T15:52:16.1081221+01:00] [cleanup] Usuni©to folder: PPO_89
[2025-11-05T15:52:16.1081221+01:00] [cleanup] Usuni©to folder: PPO_88
[2025-11-05T15:52:16.1081221+01:00] [cleanup] Usuni©to folder: PPO_87
[2025-11-05T15:52:16.1368492+01:00] [cleanup] Usuni©to folder: PPO_86
[2025-11-05T15:52:16.1368492+01:00] [cleanup] Usuni©to folder: PPO_85
[2025-11-05T15:52:16.1686927+01:00] [cleanup] Usuni©to folder: PPO_84
[2025-11-05T15:52:16.1756983+01:00] [cleanup] Usuni©to folder: PPO_83
[2025-11-05T15:52:16.1961942+01:00] [cleanup] Usuni©to folder: PPO_82
[2025-11-05T15:52:16.2197665+01:00] [cleanup] Usuni©to folder: PPO_81
[2025-11-05T15:52:16.2197665+01:00] [cleanup] Usuni©to folder: PPO_80
[2025-11-05T15:52:16.3166506+01:00] [cleanup] Usuni©to folder: PPO_79
[2025-11-05T15:52:16.3166506+01:00] [cleanup] Usuni©to folder: PPO_78
[2025-11-05T15:52:16.3312527+01:00] [cleanup] Usuni©to folder: PPO_77
[2025-11-05T15:52:16.3893623+01:00] [cleanup] Usuni©to folder: PPO_76
[2025-11-05T15:52:16.3893623+01:00] [cleanup] Usuni©to folder: PPO_75
[2025-11-05T15:52:16.3893623+01:00] [cleanup] Usuni©to folder: PPO_74
[2025-11-05T15:52:16.3893623+01:00] [cleanup] Usuni©to folder: PPO_73
[2025-11-05T15:52:16.3893623+01:00] [cleanup] Usuni©to folder: PPO_72
[2025-11-05T15:52:16.3893623+01:00] [cleanup] Usuni©to folder: PPO_71
[2025-11-05T15:52:16.3893623+01:00] [cleanup] Usuni©to folder: PPO_70
[2025-11-05T15:52:16.4291213+01:00] [cleanup] Usuni©to folder: PPO_69
[2025-11-05T15:52:16.4291213+01:00] [cleanup] Usuni©to folder: PPO_68
[2025-11-05T15:52:16.4291213+01:00] [cleanup] Usuni©to folder: PPO_67
[2025-11-05T15:52:16.4842107+01:00] [cleanup] Usuni©to folder: PPO_66
[2025-11-05T15:52:16.4871636+01:00] [cleanup] Usuni©to folder: PPO_65
[2025-11-05T15:52:16.4871636+01:00] [cleanup] Usuni©to folder: PPO_64
[2025-11-05T15:52:16.5226818+01:00] [cleanup] Usuni©to folder: PPO_63
[2025-11-05T15:52:16.5337958+01:00] [cleanup] Usuni©to folder: PPO_62
[2025-11-05T15:52:16.5337958+01:00] [cleanup] Usuni©to folder: PPO_61
[2025-11-05T15:52:16.5337958+01:00] [cleanup] Usuni©to folder: PPO_60
[2025-11-05T15:52:16.5337958+01:00] [cleanup] Usuni©to folder: PPO_59
[2025-11-05T15:52:16.5482456+01:00] [cleanup] Usuni©to folder: PPO_58
[2025-11-05T15:52:16.5519942+01:00] [cleanup] Usuni©to folder: PPO_57
[2025-11-05T15:52:16.5519942+01:00] [cleanup] Usuni©to folder: PPO_56
[2025-11-05T15:52:16.5519942+01:00] [cleanup] Usuni©to folder: PPO_55
[2025-11-05T15:52:16.5639725+01:00] [cleanup] Usuni©to folder: PPO_54
[2025-11-05T15:52:16.5639725+01:00] [cleanup] Usuni©to folder: PPO_53
[2025-11-05T15:52:16.5639725+01:00] [cleanup] Usuni©to folder: PPO_52
[2025-11-05T15:52:16.5791079+01:00] [cleanup] Usuni©to folder: PPO_51
[2025-11-05T15:52:16.5850769+01:00] [cleanup] Usuni©to folder: PPO_50
[2025-11-05T15:52:16.5850769+01:00] [cleanup] Usuni©to folder: PPO_49
[2025-11-05T15:52:16.6009750+01:00] [cleanup] Usuni©to folder: PPO_48
[2025-11-05T15:52:16.6009750+01:00] [cleanup] Usuni©to folder: PPO_47
[2025-11-05T15:52:16.6071880+01:00] [cleanup] Usuni©to folder: PPO_46
[2025-11-05T15:52:16.6245067+01:00] [cleanup] Usuni©to folder: PPO_45
[2025-11-05T15:52:16.6348234+01:00] [cleanup] Usuni©to folder: PPO_44
[2025-11-05T15:52:16.6381210+01:00] [cleanup] Usuni©to folder: PPO_43
[2025-11-05T15:52:16.6381210+01:00] [cleanup] Usuni©to folder: PPO_42
[2025-11-05T15:52:16.6627149+01:00] [cleanup] Usuni©to folder: PPO_41
[2025-11-05T15:52:16.6725251+01:00] [cleanup] Usuni©to folder: PPO_40
[2025-11-05T15:52:16.6791262+01:00] [cleanup] Usuni©to folder: PPO_39
[2025-11-05T15:52:16.6791262+01:00] [cleanup] Usuni©to folder: PPO_38
[2025-11-05T15:52:16.6791262+01:00] [cleanup] Usuni©to folder: PPO_37
[2025-11-05T15:52:16.6791262+01:00] [cleanup] Usuni©to folder: PPO_36
[2025-11-05T15:52:16.7016146+01:00] [cleanup] Usuni©to folder: PPO_35
[2025-11-05T15:52:16.7072650+01:00] [cleanup] Usuni©to folder: PPO_34
[2025-11-05T15:52:16.7072650+01:00] [cleanup] Usuni©to folder: PPO_33
[2025-11-05T15:52:16.7072650+01:00] [cleanup] Usuni©to folder: PPO_32
[2025-11-05T15:52:16.7236073+01:00] [cleanup] Usuni©to folder: PPO_31
[2025-11-05T15:52:16.7284833+01:00] [cleanup] Usuni©to folder: PPO_30
[2025-11-05T15:52:16.7410213+01:00] [cleanup] Usuni©to folder: PPO_29
[2025-11-05T15:52:16.7599278+01:00] [cleanup] Usuni©to folder: PPO_28
[2025-11-05T15:52:16.7599278+01:00] [cleanup] Usuni©to folder: PPO_27
[2025-11-05T15:52:16.7716754+01:00] [cleanup] Usuni©to folder: PPO_26
[2025-11-05T15:52:16.7716754+01:00] [cleanup] Usuni©to folder: PPO_25
[2025-11-05T15:52:16.7716754+01:00] [cleanup] Usuni©to folder: PPO_24
[2025-11-05T15:52:16.7716754+01:00] [cleanup] Usuni©to folder: PPO_23
[2025-11-05T15:52:16.7716754+01:00] [cleanup] Usuni©to folder: PPO_22
[2025-11-05T15:52:16.7716754+01:00] [cleanup] Usuni©to folder: PPO_21
[2025-11-05T15:52:16.7716754+01:00] [cleanup] Usuni©to folder: PPO_20
[2025-11-05T15:52:16.7716754+01:00] [cleanup] Usuni©to folder: PPO_19
[2025-11-05T15:52:16.8016326+01:00] [cleanup] Usuni©to folder: PPO_18
[2025-11-05T15:52:16.8016326+01:00] [cleanup] Usuni©to folder: PPO_17
[2025-11-05T15:52:16.8016326+01:00] [cleanup] Usuni©to folder: PPO_16
[2025-11-05T15:52:16.8016326+01:00] [cleanup] Usuni©to folder: PPO_15
[2025-11-05T15:52:16.8016326+01:00] [cleanup] Usuni©to folder: PPO_14
[2025-11-05T15:52:16.8016326+01:00] [cleanup] Usuni©to folder: PPO_13
[2025-11-05T15:52:16.8016326+01:00] [cleanup] Usuni©to folder: PPO_12
[2025-11-05T15:52:16.8016326+01:00] [cleanup] Usuni©to folder: PPO_11
[2025-11-05T15:52:16.8016326+01:00] [cleanup] Usuni©to folder: PPO_10
[2025-11-05T15:52:16.8016326+01:00] [cleanup] Usuni©to folder: PPO_9
[2025-11-05T15:52:16.8016326+01:00] [cleanup] Usuni©to folder: PPO_8
[2025-11-05T15:52:16.8016326+01:00] [cleanup] Usuni©to folder: PPO_7
[2025-11-05T15:52:16.8016326+01:00] [cleanup] Usuni©to folder: PPO_6
[2025-11-05T15:52:16.8652711+01:00] [cleanup] Usuni©to folder: PPO_5
[2025-11-05T15:52:16.8652711+01:00] [cleanup] Usuni©to folder: PPO_4
[2025-11-05T15:52:16.8652711+01:00] [cleanup] Usuni©to folder: PPO_3
[2025-11-05T15:52:16.8652711+01:00] [cleanup] Usuni©to folder: PPO_2
[2025-11-05T15:52:16.9241060+01:00] [cleanup] Usuni©to folder: PPO_1
[2025-11-05T15:52:16.9457406+01:00] [cleanup] Czyszczenie log¢w usˆug starszych ni¾ 30 dni (C:\xau_rl\logs\services)
[2025-11-05T15:52:17.0220503+01:00] [cleanup] Cleanup zakoäczony
[2025-11-06T15:52:17.0622429+01:00] [cleanup] Start cleanup
[2025-11-06T15:52:17.0622429+01:00] [cleanup] Czyszczenie folder¢w PPO (C:\xau_rl\logs\ppo_gold_m5) - zachowuj© 10
[2025-11-06T15:52:17.0622429+01:00] [cleanup] Usuni©to folder: PPO_111
[2025-11-06T15:52:17.0622429+01:00] [cleanup] Usuni©to folder: PPO_110
[2025-11-06T15:52:17.0937782+01:00] [cleanup] Usuni©to folder: PPO_109
[2025-11-06T15:52:17.0937782+01:00] [cleanup] Usuni©to folder: PPO_108
[2025-11-06T15:52:17.0937782+01:00] [cleanup] Czyszczenie log¢w usˆug starszych ni¾ 30 dni (C:\xau_rl\logs\services)
[2025-11-06T15:52:17.0937782+01:00] [cleanup] Cleanup zakoäczony
[2025-11-07T15:52:17.1165756+01:00] [cleanup] Start cleanup
[2025-11-07T15:52:17.1165756+01:00] [cleanup] Czyszczenie folder¢w PPO (C:\xau_rl\logs\ppo_gold_m5) - zachowuj© 10
[2025-11-07T15:52:17.1307712+01:00] [cleanup] Czyszczenie log¢w usˆug starszych ni¾ 30 dni (C:\xau_rl\logs\services)
[2025-11-07T15:52:17.1307712+01:00] [cleanup] Cleanup zakoäczony
[2025-11-07T23:14:58.8737862+01:00] [cleanup] Start cleanup
[2025-11-07T23:14:59.2590042+01:00] [cleanup] Czyszczenie folder¢w PPO (C:\xau_rl\logs\ppo_gold_m5) - zachowuj© 10
[2025-11-07T23:14:59.5919817+01:00] [cleanup] Usuni©to folder: PPO_114
[2025-11-07T23:14:59.7728105+01:00] [cleanup] Usuni©to folder: PPO_113
[2025-11-07T23:14:59.7805828+01:00] [cleanup] Usuni©to folder: PPO_112
[2025-11-07T23:14:59.7805828+01:00] [cleanup] Czyszczenie log¢w usˆug starszych ni¾ 30 dni (C:\xau_rl\logs\services)
[2025-11-07T23:14:59.9236565+01:00] [cleanup] Cleanup zakoäczony


=== FILE: logs\services\xau_daily_report.err.log ===

Out-File : Proces nie mo¾e uzyska† dost©pu do pliku "C:\xau_rl\logs\services\nightly_report.log", p
oniewa¾ jest on u¾ywany przez inny proces.
At C:\xau_rl\ops\daemon_nightly_report.ps1:34 char:34
+ ... R] $($_|Out-String)" | Out-File -FilePath $LOG -Append -Encoding utf8
+                            ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
    + CategoryInfo          : OpenError: (:) [Out-File], IOException
    + FullyQualifiedErrorId : FileOpenFailure,Microsoft.PowerShell.Commands.OutFileCommand
 


=== FILE: logs\services\xau_daily_report.out.log ===



=== FILE: logs\services\xau_feature_discovery.err.log ===



=== FILE: logs\services\xau_feature_discovery.out.log ===



=== FILE: logs\services\xau_fetch_features.err.log ===



=== FILE: logs\services\xau_fetch_features.out.log ===



=== FILE: logs\services\xau_mini_update.err.log ===



=== FILE: logs\services\xau_mini_update.out.log ===



=== FILE: logs\services\xau_nightly_report.err.log ===



=== FILE: logs\services\xau_nightly_report.out.log ===



=== FILE: logs\services\xau_nightly_train.err.log ===



=== FILE: logs\services\xau_nightly_train.out.log ===



=== FILE: logs\services\xau_te_calendar.err.log ===



=== FILE: logs\services\xau_te_calendar.out.log ===



=== FILE: logs\tasks\cleanup.log ===

[] START cleanup
[] END cleanup


=== FILE: models\registry\current.txt ===

cand_00

=== FILE: ops\daemon_calibration_biweekly.ps1 ===

$ErrorActionPreference="Stop"
$REPO="C:\xau_rl"; $PY="$REPO\.venv\Scripts\python.exe"
$LOG="$REPO\logs\services\calibration_3d.log"; $LOCK="$REPO\logs\services\calibration_3d.lock"
New-Item -ItemType Directory -Force -Path (Split-Path $LOG) | Out-Null; Set-Location $REPO
if(-not (Test-Path $LOG) -or (Get-Item $LOG).Length -eq 0){
  "[$(Get-Date -Format o)] [calibration] bootstrap_alive" | Out-File -FilePath $LOG -Append -Encoding utf8
}
function Acquire-Lock { if(Test-Path $LOCK){$false}else{New-Item -ItemType File -Path $LOCK -Force|Out-Null;$true} }
function Release-Lock { if(Test-Path $LOCK){Remove-Item $LOCK -Force} }
function Run-Once { & $PY "utils\calibration.py" "--apply" *>> $LOG }
function Seconds-To-Next-22 {
  $now = Get-Date
  $target = [DateTime]::Today.AddHours(22)
  if ($now -ge $target) { $target = $target.AddDays(1) }
  $diff = $target - $now
  return ([int]$diff.TotalSeconds)
}
while($true){
  Start-Sleep -Seconds (Seconds-To-Next-22)
  $ts=Get-Date -Format o
  try{
    if(Acquire-Lock){
      "`n[$ts] [calibration] start" | Out-File -FilePath $LOG -Append -Encoding utf8
      Run-Once
      "`n[$(Get-Date -Format o)] [calibration] done" | Out-File -FilePath $LOG -Append -Encoding utf8
      Release-Lock
    } else {
      "`n[$ts] [calibration] skipped (locked)" | Out-File -FilePath $LOG -Append -Encoding utf8
    }
  } catch {
    "[ERROR] $($_|Out-String)" | Out-File -FilePath $LOG -Append -Encoding utf8
    Release-Lock
  }
  Start-Sleep -Seconds (3*24*3600 - 60)
}


=== FILE: ops\daemon_cleanup.ps1 ===

# encoding: utf-8
$ErrorActionPreference = "Stop"

# === PARAMETRY Z ENV (z domyślnymi wartościami) ===
# Repo root
$REPO = $env:XAU_REPO
if ([string]::IsNullOrWhiteSpace($REPO)) { $REPO = "C:\xau_rl" }

# Jeśli ktoś podał AppEnvironmentExtra w jednej linii (ze średnikami),
# utnij wszystko po pierwszym ';' – defensywna sanitacja.
if ($REPO -like "*;*") {
    $REPO = $REPO.Split(';')[0]
}

# Ścieżki
$PPO_DIR  = Join-Path $REPO "logs\ppo_gold_m5"
$SERV_DIR = Join-Path $REPO "logs\services"
$MODELS   = Join-Path $REPO "models"
New-Item -ItemType Directory -Force -Path $MODELS | Out-Null

# Liczby z ENV (PS 5.1 – bez operatora ?:)
[int]$KEEP_FOLDERS = 10
if ($env:KEEP_PPO -and $env:KEEP_PPO -match '^\d+$') {
    $KEEP_FOLDERS = [int]$env:KEEP_PPO
}

[int]$KEEP_LOG_DAYS = 30
if ($env:KEEP_LOG_DAYS -and $env:KEEP_LOG_DAYS -match '^\d+$') {
    $KEEP_LOG_DAYS = [int]$env:KEEP_LOG_DAYS
}

[int]$INTERVAL_H = 24
if ($env:CLEANUP_INTERVAL_HOURS -and $env:CLEANUP_INTERVAL_HOURS -match '^\d+$') {
    $INTERVAL_H = [int]$env:CLEANUP_INTERVAL_HOURS
}

function Log([string]$m) {
    $ts = Get-Date -Format o
    Write-Host "[$ts] [cleanup] $m"
}

function Cleanup-PPOFolders {
    Log "Czyszczenie folderów PPO ($PPO_DIR) – zachowuję $KEEP_FOLDERS"
    if (-not (Test-Path -LiteralPath $PPO_DIR)) { return }

    $folders  = Get-ChildItem -LiteralPath $PPO_DIR -Directory -ErrorAction SilentlyContinue |
                Sort-Object LastWriteTime -Descending
    if (-not $folders) { return }

    $toRemove = $folders | Select-Object -Skip $KEEP_FOLDERS
    foreach ($f in $toRemove) {
        try {
            # (opcjonalnie) kopia best_model.zip przed usunięciem katalogu
            $best = Join-Path $f.FullName "best_model.zip"
            if (Test-Path -LiteralPath $best) {
                $dest = Join-Path $MODELS ("best_" + $f.Name + ".zip")
                Copy-Item -LiteralPath $best -Destination $dest -Force
                Log "Zapisano kopię modelu: $dest"
            }

            Remove-Item -LiteralPath $f.FullName -Recurse -Force
            Log "Usunięto folder: $($f.Name)"
        }
        catch {
            Log "Błąd usuwania $($f.Name): $($_.Exception.Message)"
        }
    }
}

function Cleanup-ServiceLogs {
    Log "Czyszczenie logów usług starszych niż $KEEP_LOG_DAYS dni ($SERV_DIR)"
    if (-not (Test-Path -LiteralPath $SERV_DIR)) { return }

    $cutoff = (Get-Date).AddDays(-$KEEP_LOG_DAYS)

    Get-ChildItem -LiteralPath $SERV_DIR -File -ErrorAction SilentlyContinue |
        Where-Object { $_.LastWriteTime -lt $cutoff } |
        ForEach-Object {
            try {
                Remove-Item -LiteralPath $_.FullName -Force
                Log "Usunięto log: $($_.Name)"
            }
            catch {
                Log "Błąd usuwania logu $($_.Name): $($_.Exception.Message)"
            }
        }
}

# --- Pętla główna (co $INTERVAL_H godzin) ---
while ($true) {
    try {
        Log "Start cleanup"
        Cleanup-PPOFolders
        Cleanup-ServiceLogs
        Log "Cleanup zakończony"
    }
    catch {
        Log "Błąd cleanup: $($_.Exception.Message)"
    }

    Start-Sleep -Seconds ($INTERVAL_H * 3600)
}

=== FILE: ops\daemon_daily_report.ps1 ===

# Raport walidacyjny codziennie o 23:00 (czas lokalny)
$ErrorActionPreference = "Stop"
$REPO = "C:\xau_rl"
$PY = "C:\xau_rl\.venv\Scripts\python.exe"
$LOG = "C:\xau_rl\logs\services\daily_report.log"

New-Item -ItemType Directory -Force -Path (Split-Path $LOG) | Out-Null
Set-Location $REPO

function Run-Once {
  & $PY "rl\evaluate.py" "--out_dir" "reports" *>> $LOG
  & $PY "utils\make_report.py" *>> $LOG
}

function Seconds-To-Next-23 {
  $now = Get-Date
  $target = [DateTime]::Today.AddHours(23)
  if ($now -ge $target) { $target = $target.AddDays(1) }
  return int.TotalSeconds
}

# Poczekaj do 23:00, potem wykonuj raz dziennie
while ($true) {
  $sleep = Seconds-To-Next-23
  Start-Sleep -Seconds $sleep
  try {
    "`n[$(Get-Date -Format o)] [daily_report] start" | Out-File -FilePath $LOG -Append -Encoding utf8
    Run-Once
    "`n[$(Get-Date -Format o)] [daily_report] done" | Out-File -FilePath $LOG -Append -Encoding utf8
  } catch {
    "[ERROR] $($_ | Out-String)" | Out-File -FilePath $LOG -Append -Encoding utf8
  }
  "[$(Get-Date -Format o)] [bootstrap_alive]" | Out-File -FilePath $LOG -Append -Encoding utf8
  Start-Sleep -Seconds (24*3600 - 60)  # buffer
}

=== FILE: ops\daemon_feature_discovery.ps1 ===

$ErrorActionPreference="Stop"
$REPO="C:\xau_rl"; $PY="$REPO\.venv\Scripts\python.exe"
$LOG="$REPO\logs\services\feature_discovery.log"; $LOCK="$REPO\logs\services\feature_discovery.lock"
New-Item -ItemType Directory -Force -Path (Split-Path $LOG) | Out-Null; Set-Location $REPO
if(-not (Test-Path $LOG) -or (Get-Item $LOG).Length -eq 0){
  "[$(Get-Date -Format o)] [feature_discovery] bootstrap_alive" | Out-File -FilePath $LOG -Append -Encoding utf8
}
function Acquire-Lock { if(Test-Path $LOCK){$false}else{New-Item -ItemType File -Path $LOCK -Force|Out-Null;$true} }
function Release-Lock { if(Test-Path $LOCK){Remove-Item $LOCK -Force} }
function Run-Once { & $PY "ops\feature_discovery_weekly.py" "--topK" "96" "--change_frac" "0.10" *>> $LOG }
function Seconds-To-Next-21 {
  $now = Get-Date
  $target = [DateTime]::Today.AddHours(21)
  if ($now -ge $target) { $target = $target.AddDays(1) }
  $diff = $target - $now            # TimeSpan
  return ([int]$diff.TotalSeconds)  # zwracamy liczbę sekund (int)
}
while($true){
  Start-Sleep -Seconds (Seconds-To-Next-21)
  $ts=Get-Date -Format o
  try{
    if(Acquire-Lock){
      "`n[$ts] [feature_discovery] start" | Out-File -FilePath $LOG -Append -Encoding utf8
      Run-Once
      "`n[$(Get-Date -Format o)] [feature_discovery] done" | Out-File -FilePath $LOG -Append -Encoding utf8
      Release-Lock
    } else {
      "`n[$ts] [feature_discovery] skipped (locked)" | Out-File -FilePath $LOG -Append -Encoding utf8
    }
  } catch {
    "[ERROR] $($_|Out-String)" | Out-File -FilePath $LOG -Append -Encoding utf8
    Release-Lock
  }
  Start-Sleep -Seconds (3*24*3600 - 60)
}


=== FILE: ops\daemon_fetch_features.ps1 ===

$ErrorActionPreference="Stop"
$REPO="C:\xau_rl"; $PY="$REPO\.venv\Scripts\python.exe"
$LOG="$REPO\logs\services\fetch_features.log"; $LOCK="$REPO\logs\services\fetch_features.lock"
New-Item -ItemType Directory -Force -Path (Split-Path $LOG) | Out-Null; Set-Location $REPO
if(-not (Test-Path $LOG) -or (Get-Item $LOG).Length -eq 0){
  "[$(Get-Date -Format o)] [fetch_features] bootstrap_alive" | Out-File -FilePath $LOG -Append -Encoding utf8
}
function Acquire-Lock { if(Test-Path $LOCK){$false}else{New-Item -ItemType File -Path $LOCK -Force|Out-Null;$true} }
function Release-Lock { if(Test-Path $LOCK){Remove-Item $LOCK -Force} }
function Run-Once {
  & $PY "fetch__mt5_data.py"         *>> $LOG
  & $PY "features\build_features.py" *>> $LOG
}
while($true){
  $ts=Get-Date -Format o
  try{
    if(Acquire-Lock){
      "`n[$ts] [fetch_features] start" | Out-File -FilePath $LOG -Append -Encoding utf8
      Run-Once
      "`n[$(Get-Date -Format o)] [fetch_features] done" | Out-File -FilePath $LOG -Append -Encoding utf8
      Release-Lock
    } else {
      "`n[$ts] [fetch_features] skipped (locked)" | Out-File -FilePath $LOG -Append -Encoding utf8
    }
  }catch{
    "[ERROR] $($_|Out-String)" | Out-File -FilePath $LOG -Append -Encoding utf8
    Release-Lock
  }
  Start-Sleep -Seconds 600
}


=== FILE: ops\daemon_mini_update.ps1 ===

# encoding: utf-8
$ErrorActionPreference="Stop"

$REPO="C:\xau_rl"; $PY="$REPO\.venv\Scripts\python.exe"
$LOG ="$REPO\logs\services\mini_update_ppo.log"
$LOCK="$REPO\logs\services\mini_update_ppo.lock"

New-Item -ItemType Directory -Force -Path (Split-Path $LOG) | Out-Null
Set-Location $REPO

# Pierwsza linia w logu (jak u Ciebie)
if(-not (Test-Path $LOG) -or (Get-Item $LOG).Length -eq 0){
  "[$(Get-Date -Format o)] [mini_update] bootstrap_alive" | Out-File -FilePath $LOG -Append -Encoding utf8
}

function Acquire-Lock {
  if(Test-Path $LOCK){ $false } else { New-Item -ItemType File -Path $LOCK -Force | Out-Null; $true }
}
function Release-Lock {
  if(Test-Path $LOCK){ Remove-Item $LOCK -Force }
}

function Run-Once {
  # dokładnie ten sam mechanizm redirekcji co w fetch_features (all-streams)
  & $PY -u "ops\mini_update_ppo.py" "--timesteps" "300000" *>> $LOG
}

while($true){
  $ts=Get-Date -Format o
  try{
    if(Acquire-Lock){
      "`n[$ts] [mini_update] start" | Out-File -FilePath $LOG -Append -Encoding utf8
      Run-Once
      "`n[$(Get-Date -Format o)] [mini_update] done" | Out-File -FilePath $LOG -Append -Encoding utf8
      Release-Lock
    } else {
      "`n[$ts] [mini_update] skipped (locked)" | Out-File -FilePath $LOG -Append -Encoding utf8
    }
  }catch{
    "[ERROR] $($_|Out-String)" | Out-File -FilePath $LOG -Append -Encoding utf8
    Release-Lock
  }
  # co 6 godzin
  Start-Sleep -Seconds (6*3600)
}

=== FILE: ops\daemon_nightly_report.ps1 ===

# encoding: utf-8
$ErrorActionPreference = "Stop"

$REPO = "C:\xau_rl"
$PY   = "$REPO\.venv\Scripts\python.exe"

$LOG  = "$REPO\logs\services\nightly_report.log"
$LOCK = "$REPO\logs\services\nightly_report.lock"

New-Item -ItemType Directory -Force -Path (Split-Path $LOG) | Out-Null
Set-Location $REPO

# Pierwszy wpis w logu (Add-Content, nie Out-File)
if (-not (Test-Path $LOG) -or (Get-Item $LOG).Length -eq 0) {
  "[$(Get-Date -Format o)] [nightly_report] bootstrap_alive" | Add-Content -LiteralPath $LOG -Encoding UTF8
}

function Acquire-Lock {
  if (Test-Path $LOCK) {
    $false
  } else {
    New-Item -ItemType File -Path $LOCK -Force | Out-Null
    $true
  }
}

function Release-Lock {
  if (Test-Path $LOCK) { Remove-Item $LOCK -Force }
}

function Run-Once {
  # UWAGA: prawdziwe operatory redirekcji (bez encji HTML)
  & $PY "rl\evaluate.py" "--out_dir" "reports" *>> $LOG
  & $PY "utils\make_report.py"                 *>> $LOG
}

function Seconds-To-Next-2300 {
  $now = Get-Date
  $target = [DateTime]::Today.AddHours(23)
  if ($now -ge $target) { $target = $target.AddDays(1) }
  $diff = $target - $now
  return ([int]$diff.TotalSeconds)
}

while ($true) {
  Start-Sleep -Seconds (Seconds-To-Next-2300)
  $ts = Get-Date -Format o
  try {
    if (Acquire-Lock) {
      "`n[$ts] [nightly_report] start" | Add-Content -LiteralPath $LOG -Encoding UTF8
      Run-Once
      "`n[$(Get-Date -Format o)] [nightly_report] done" | Add-Content -LiteralPath $LOG -Encoding UTF8
      Release-Lock
    } else {
      "`n[$ts] [nightly_report] skipped (locked)" | Add-Content -LiteralPath $LOG -Encoding UTF8
    }
  } catch {
    "[ERROR] $($_ | Out-String)" | Add-Content -LiteralPath $LOG -Encoding UTF8
    Release-Lock
  }
  Start-Sleep -Seconds (24*3600 - 60)
}

=== FILE: ops\daemon_nightly_train.ps1 ===

$ErrorActionPreference="Stop"
$REPO="C:\xau_rl"; $PY="$REPO\.venv\Scripts\python.exe"
$LOG="$REPO\logs\services\nightly_train.log"; $LOCK="$REPO\logs\services\nightly_train.lock"
New-Item -ItemType Directory -Force -Path (Split-Path $LOG) | Out-Null; Set-Location $REPO
if(-not (Test-Path $LOG) -or (Get-Item $LOG).Length -eq 0){
  "[$(Get-Date -Format o)] [nightly_train] bootstrap_alive" | Out-File -FilePath $LOG -Append -Encoding utf8
}
function Acquire-Lock { if(Test-Path $LOCK){$false}else{New-Item -ItemType File -Path $LOCK -Force|Out-Null;$true} }
function Release-Lock { if(Test-Path $LOCK){Remove-Item $LOCK -Force} }
function Run-Once {
  & $PY "rl\train_ppo.py" "--timesteps" "1500000" *>> $LOG
  & $PY "rl\evaluate.py" "--out_dir" "reports"    *>> $LOG
  & $PY "utils\make_report.py"                    *>> $LOG
  & $PY "ops\save_candidate.py"                   *>> $LOG
  & $PY "ops\promote_challenger.py"               *>> $LOG
}
function Seconds-To-Next-0030 {
  $now = Get-Date
  $target = [DateTime]::Today.AddHours(0).AddMinutes(30)
  if ($now -ge $target) { 
    $target = $target.AddDays(1) 
  }
  $diff = $target - $now
  return ([int]$diff.TotalSeconds)
}
while($true){
  Start-Sleep -Seconds (Seconds-To-Next-0030)
  $ts=Get-Date -Format o
  try{
    if(Acquire-Lock){
      "`n[$ts] [nightly_train] start" | Out-File -FilePath $LOG -Append -Encoding utf8
      Run-Once
      "`n[$(Get-Date -Format o)] [nightly_train] done"  | Out-File -FilePath $LOG -Append -Encoding utf8
      Release-Lock
    } else {
      "`n[$ts] [nightly_train] skipped (locked)" | Out-File -FilePath $LOG -Append -Encoding utf8
    }
  } catch {
    "[ERROR] $($_|Out-String)" | Out-File -FilePath $LOG -Append -Encoding utf8
    Release-Lock
  }
  Start-Sleep -Seconds (24*3600 - 60)
}


=== FILE: ops\daemon_te_calendar.ps1 ===

$ErrorActionPreference="Stop"
$REPO="C:\xau_rl"; $PY="$REPO\.venv\Scripts\python.exe"
$LOG="$REPO\logs\services\te_calendar.log"; $LOCK="$REPO\logs\services\te_calendar.lock"
New-Item -ItemType Directory -Force -Path (Split-Path $LOG) | Out-Null; Set-Location $REPO
if(-not (Test-Path $LOG) -or (Get-Item $LOG).Length -eq 0){
  "[$(Get-Date -Format o)] [te_calendar] bootstrap_alive" | Out-File -FilePath $LOG -Append -Encoding utf8
}
function Acquire-Lock { if(Test-Path $LOCK){$false}else{New-Item -ItemType File -Path $LOCK -Force|Out-Null;$true} }
function Release-Lock { if(Test-Path $LOCK){Remove-Item $LOCK -Force} }
function Run-Once {
  & $PY "save_te_calendar_cache.py" *>> $LOG
  & $PY "features\build_features.py" *>> $LOG
}
function Seconds-To-Next-0500 {
  $now    = Get-Date
  $target = [DateTime]::Today.AddHours(5)
  if ($now -ge $target) { $target = $target.AddDays(1) }
  $diff = $target - $now
  return [int]$diff.TotalSeconds
}
while($true){
  Start-Sleep -Seconds (Seconds-To-Next-0500)
  $ts=Get-Date -Format o
  try{
    if(Acquire-Lock){
      "`n[$ts] [te_calendar] start" | Out-File -FilePath $LOG -Append -Encoding utf8
      Run-Once
      "`n[$(Get-Date -Format o)] [te_calendar] done"  | Out-File -FilePath $LOG -Append -Encoding utf8
      Release-Lock
    } else {
      "`n[$ts] [te_calendar] skipped (locked)" | Out-File -FilePath $LOG -Append -Encoding utf8
    }
  } catch {
    "[ERROR] $($_|Out-String)" | Out-File -FilePath $LOG -Append -Encoding utf8
    Release-Lock
  }
  Start-Sleep -Seconds (24*3600 - 60)
}


=== FILE: ops\env.ps1 ===

$ErrorActionPreference = "Stop"
$RepoRoot = Split-Path -Parent $MyInvocation.MyCommand.Path | Split-Path
$Py = Join-Path $RepoRoot ".venv\Scripts\python.exe"
$Cfg = Join-Path $RepoRoot "config.yaml"
$LogDir = Join-Path $RepoRoot "logs"
New-Item -ItemType Directory -Force -Path $LogDir | Out-Null
function RunPy([string]$script, [string]$args="") {
& $Py $script $args 2>&1 | Tee-Object -FilePath (Join-Path $LogDir ((Split-Path $script -Leaf) + ".log")) -Append
}


=== FILE: ops\feature_discovery_weekly.py ===

# ops/feature_discovery_weekly.py
# -*- coding: utf-8 -*-
"""
Feature Discovery (dziennie) dla XAUUSD M5:
- Czyta cechy z config.yaml -> files.features_csv,
- (Opcjonalnie) dołącza fundamenty i kalendarz (FRED/GPR/COT/Event),
- Tworzy lagi (--max_lag) w sposób blokowy (bez fragmentacji DataFrame),
- Rankuje cechy po Spearman do targetu 1-krok do przodu, z pominięciem
  kolumn stałych i zbyt krótkich (eliminuje ConstantInputWarning),
- Dywersyfikacja: kara za częste użycie + min. udział nowych (--change_frac),
- Zapisuje:
  * models/features_spec.json
  * models/features_spec_history.jsonl (append)
  * reports/feature_discovery_rank.csv
  * reports/feature_discovery_summary.txt
  * logs/feature_discovery.log
Uruchamiaj jako skrypt (nie jako moduł):
 .\\.venv\\Scripts\\python.exe ops\\feature_discovery_weekly.py --topK 96 --max_lag 3 --change_frac 0.10 --out models\\features_spec.json
"""

import argparse, os, json, traceback
from pathlib import Path
import pandas as pd
import numpy as np
import yaml
from datetime import datetime

# === ŚCIEŻKI ===
ROOT = Path(__file__).resolve().parents[1]
os.chdir(ROOT)
LOG_DIR = ROOT / "logs"
LOG_DIR.mkdir(parents=True, exist_ok=True)
LOG = LOG_DIR / "feature_discovery.log"
HIST_PATH = ROOT / "models" / "features_spec_history.jsonl"
SUMMARY_PATH = ROOT / "reports" / "feature_discovery_summary.txt"
RANK_PATH = ROOT / "reports" / "feature_discovery_rank.csv"

# Parametry
MIN_NEW_RATIO = 0.20
HIST_WINDOW = 6
REPEAT_PENALTY = 0.90
MIN_OBS = 200
FRED_API_KEY_HARDCODED = "404d32dffe691fd6159eed5cceb44e80"

# === LOGOWANIE ===
def log(msg: str):
    ts = datetime.now().isoformat(timespec="seconds")
    with open(LOG, "a", encoding="utf-8") as f:
        f.write(f"[{ts}] {msg}\n")

# === FUNKCJE ===
def load_cfg():
    with open(ROOT / "config.yaml", "r", encoding="utf-8") as f:
        return yaml.safe_load(f)

def read_features_csv(cfg):
    p = Path(cfg["files"]["features_csv"])
    if not p.exists():
        raise FileNotFoundError(f"features_csv not found: {p.as_posix()}")
    df = pd.read_csv(p, parse_dates=["time"])
    return df.sort_values("time").reset_index(drop=True)

def safe_merge_on_time(df_base: pd.DataFrame, df_right: pd.DataFrame, col_map: dict):
    if df_right is None or df_right.empty:
        return df_base
    r = df_right.copy()
    if "time" not in r.columns:
        raise ValueError("Right dataframe has no 'time'")
    r = (r.sort_values("time").drop_duplicates("time")
         .set_index("time").asfreq("1min").ffill()
         .reset_index().rename(columns=col_map))
    out = pd.merge_asof(
        df_base.sort_values("time"),
        r.sort_values("time"),
        on="time",
        direction="backward",
        tolerance=pd.Timedelta(minutes=10)
    )
    return out

def try_load_fred(series_id: str):
    if not series_id:
        return None
    try:
        from fredapi import Fred
        fred = Fred(api_key=FRED_API_KEY_HARDCODED)
        s = fred.get_series(series_id)
        df = s.to_frame(name=series_id).reset_index()
        df = df.rename(columns={"index": "time"})
        df["time"] = pd.to_datetime(df["time"], utc=True)
        return df
    except Exception as e:
        log(f"[warn] FRED api unavailable ({e}); trying CSV fallback")
        csv_p = ROOT / "external" / "fred" / f"{series_id}.csv"
        if csv_p.exists():
            df = pd.read_csv(csv_p)
            col_time = "time" if "time" in df.columns else ("date" if "date" in df.columns else None)
            if not col_time or "value" not in df.columns:
                raise RuntimeError(f"FRED CSV malformed: {csv_p.as_posix()}")
            df[col_time] = pd.to_datetime(df[col_time], utc=True)
            df = df.rename(columns={col_time: "time", "value": series_id})
            return df
    return None

def try_load_simple_csv(p: Path, time_col="time"):
    if not p or not Path(p).exists():
        return None
    df = pd.read_csv(p)
    if time_col not in df.columns:
        for c in ["date", "Date"]:
            if c in df.columns:
                time_col = c
                break
    if time_col not in df.columns:
        return None
    df[time_col] = pd.to_datetime(df[time_col], utc=True)
    return df.rename(columns={time_col: "time"})

def build_target(df: pd.DataFrame, price_col="close", horizon=1):
    return df[price_col].pct_change().shift(-horizon).rename("target_fwd1")

def add_lags(df: pd.DataFrame, cols: list, max_lag: int) -> pd.DataFrame:
    if max_lag <= 0 or not cols:
        return df
    lag_blocks = []
    for L in range(1, max_lag + 1):
        blk = df[cols].shift(L)
        blk.columns = [f"{c}_lag{L}" for c in cols]
        lag_blocks.append(blk)
    out = pd.concat([df] + lag_blocks, axis=1, copy=False)
    return out

def score_features(df: pd.DataFrame, feature_cols: list, target_col="target_fwd1"):
    scores = []
    y_full = df[target_col].astype(float)
    skipped_constant = []
    skipped_small = []
    for c in feature_cols:
        try:
            x_full = df[c].astype(float)
            ok = x_full.notna() & y_full.notna()
            n = int(ok.sum())
            if n < MIN_OBS:
                skipped_small.append(c)
                continue
            x = x_full[ok]
            y = y_full[ok]
            if x.nunique(dropna=True) <= 1 or y.nunique(dropna=True) <= 1:
                skipped_constant.append(c)
                continue
            rho = x.corr(y, method="spearman")
            if pd.notna(rho):
                scores.append((c, float(abs(rho))))
        except Exception:
            continue
    if skipped_small:
        log(f"[info] skipped_small_n<{MIN_OBS}: {len(skipped_small)} cols")
    if skipped_constant:
        log(f"[info] skipped_constant: {len(skipped_constant)} cols (e.g. {skipped_constant[:5]})")
    scores.sort(key=lambda t: t[1], reverse=True)
    return pd.DataFrame(scores, columns=["feature", "abs_spearman"])

def load_history(max_lines=HIST_WINDOW):
    if not HIST_PATH.exists():
        return []
    rows = []
    with open(HIST_PATH, "r", encoding="utf-8") as f:
        for line in f:
            try:
                rows.append(json.loads(line))
            except:
                pass
    return rows[-max_lines:] if rows else []

def save_history(entry: dict):
    HIST_PATH.parent.mkdir(parents=True, exist_ok=True)
    with open(HIST_PATH, "a", encoding="utf-8") as f:
        f.write(json.dumps(entry, ensure_ascii=False) + "\n")

def jaccard(a: set, b: set) -> float:
    if not a and not b:
        return 1.0
    return len(a & b) / max(1, len(a | b))

def apply_repeat_penalty(rank_df: pd.DataFrame, hist_rows: list):
    if not hist_rows or rank_df.empty:
        return rank_df.copy()
    freq = {}
    for r in hist_rows:
        feats = r.get("feature_columns", [])
        for c in feats:
            freq[c] = freq.get(c, 0) + 1
    out = rank_df.copy()
    out["repeat_freq"] = out["feature"].map(lambda c: freq.get(c, 0))
    out["score_after_penalty"] = out["abs_spearman"] * (REPEAT_PENALTY ** out["repeat_freq"])
    out = out.sort_values("score_after_penalty", ascending=False).reset_index(drop=True)
    return out

def diversify_select(adjusted_rank: pd.DataFrame, prev_features: list, topK: int, min_new_ratio=MIN_NEW_RATIO):
    prev_set = set(prev_features or [])
    new_needed = int(np.ceil(topK * min_new_ratio))
    chosen = []
    for _, row in adjusted_rank.iterrows():
        f = row["feature"]
        if f not in prev_set and f not in chosen:
            chosen.append(f)
        if len([c for c in chosen if c not in prev_set]) >= new_needed:
            break
    if len(chosen) < topK:
        for _, row in adjusted_rank.iterrows():
            f = row["feature"]
            if f not in chosen:
                chosen.append(f)
            if len(chosen) >= topK:
                break
    return chosen[:topK]

# === MAIN ===
def main():
    ap = argparse.ArgumentParser()
    ap.add_argument("--topK", type=int, default=96)
    ap.add_argument("--max_lag", type=int, default=3)
    ap.add_argument("--out", type=str, default="models/features_spec.json")
    ap.add_argument("--change_frac", type=float, default=None,
                    help="Minimalny udział nowych cech [0..1] względem poprzedniego wyboru")
    args = ap.parse_args()

    global MIN_NEW_RATIO
    if args.change_frac is not None:
        MIN_NEW_RATIO = float(np.clip(args.change_frac, 0.0, 1.0))

    try:
        log("feature_discovery bootstrap_alive")
        cfg = load_cfg()
        log("start")

        df = read_features_csv(cfg)
        price_col = "close_norm" if "close_norm" in df.columns else "close"
        df["target_fwd1"] = build_target(df, price_col=price_col)

        # Fundamenty i kalendarz
        try:
            fcfg = (cfg.get("fundamentals") or {})
            usd_id = fcfg.get("usd_series_id", None)
            fred_df = try_load_fred(usd_id) if usd_id else None
            if fred_df is not None:
                df = safe_merge_on_time(df, fred_df, {usd_id: f"fred_{usd_id}"})
                col = f"fred_{usd_id}"
                mu = df[col].rolling(5000, min_periods=100).mean()
                sd = df[col].rolling(5000, min_periods=100).std().replace(0, np.nan)
                df[col] = (df[col] - mu) / (sd + 1e-8)
            else:
                log("[info] FRED series not attached (no api/csv)")
        except Exception as e:
            log(f"[warn] fundamentals/calendar attach failed: {e}")

        base_cols = ["time", "open", "high", "low", "close", "tick_volume", "spread"]
        all_cols = [c for c in df.columns if c not in base_cols + ["target_fwd1"]]
        df = add_lags(df, all_cols, max_lag=args.max_lag)
        cand_cols = [c for c in df.columns if c not in base_cols + ["target_fwd1"]]

        rank = score_features(df, cand_cols, target_col="target_fwd1")
        if rank.empty:
            raise RuntimeError("Ranking pusty – brak danych do selekcji.")

        hist_rows = load_history(HIST_WINDOW)
        prev_feats = hist_rows[-1]["feature_columns"] if hist_rows else []
        rank_adj = apply_repeat_penalty(rank, hist_rows)

        out_rank = rank_adj.assign(prev_used=lambda x: x["feature"].isin(prev_feats))
        RANK_PATH.parent.mkdir(parents=True, exist_ok=True)
        out_rank.to_csv(RANK_PATH, index=False)

        topK = max(int(args.topK), 8)
        chosen = diversify_select(rank_adj, prev_feats, topK, MIN_NEW_RATIO)

        spec = {
            "feature_columns": chosen,
            "price_column": "close_norm" if "close_norm" in df.columns else "close",
            "generated_at": datetime.now().isoformat(timespec="seconds")
        }
        out_p = ROOT / args.out
        out_p.parent.mkdir(parents=True, exist_ok=True)
        out_p.write_text(json.dumps(spec, ensure_ascii=False, indent=2), encoding="utf-8")
        save_history({"ts": datetime.now().isoformat(timespec="seconds"), "feature_columns": chosen})

        prev_set = set(prev_feats or [])
        cur_set = set(chosen or [])
        jac = jaccard(prev_set, cur_set)
        chg = len(cur_set - prev_set)
        kept = len(cur_set & prev_set)
        SUMMARY_PATH.parent.mkdir(parents=True, exist_ok=True)
        with open(SUMMARY_PATH, "w", encoding="utf-8") as f:
            f.write("# Feature Discovery Summary\n")
            f.write(f"Generated at: {datetime.now().isoformat(timespec='seconds')}\n")
            f.write(f"TopK: {topK}\n")
            f.write(f"Prev size: {len(prev_set)}, Cur size: {len(cur_set)}\n")
            f.write(f"Jaccard(prev,cur): {jac:.3f}\n")
            f.write(f"Kept from prev: {kept}\n")
            f.write(f"New vs prev: {chg}\n")
            f.write(f"Min new ratio enforced: {MIN_NEW_RATIO:.2f}\n")

        log(f"saved spec -> {out_p.as_posix()}, rank -> {RANK_PATH.as_posix()}, summary -> {SUMMARY_PATH.as_posix()}")
        print("Feature discovery completed.")

    except Exception as e:
        log(f"[ERROR] {e}")
        log(traceback.format_exc())
        raise

if __name__ == "__main__":
    main()

=== FILE: ops\install_all_services.ps1 ===

<#
install_all_services.ps1
Instaluje/aktualizuje kompletny zestaw usług NSSM dla pipeline M5:
- xau_paper_loop              (python -m paper_demo.paper_loop_mt5_demo)
- xau_fetch_features          (co 10 min)
- xau_mini_update             (co 6 h)
- xau_nightly_report          (codziennie 23:00)
- xau_nightly_train           (codziennie 00:30)
- xau_feature_discovery       (co 3 dni 21:00)
- xau_calibration             (co 3 dni 22:00)
- xau_te_calendar             (codziennie 05:00)
#>

[CmdletBinding(SupportsShouldProcess=$true)]
param(
  [string]$RepoRoot    = "C:\xau_rl",
  [string]$NssmPath    = "C:\nssm\nssm.exe",
  [string]$PythonPath  = "$RepoRoot\.venv\Scripts\python.exe",
  [string]$UserAccount = "$env:COMPUTERNAME\$env:USERNAME",
  [securestring]$SecurePassword,
  [string]$Password,          # niezalecane; użyj -SecurePassword
  [switch]$UsePwsh7,          # host demonów: pwsh.exe (PS7) zamiast powershell.exe (PS5)
  [string]$TEApiKey = ""      # opcjonalny TE_API_KEY dla xau_te_calendar
)

#region helpers
function Info($m){ Write-Host "[INFO] $m" -ForegroundColor Cyan }
function Warn($m){ Write-Host "[WARN] $m" -ForegroundColor Yellow }
function Err ($m){ Write-Host "[ERR ] $m" -ForegroundColor Red }

function Ensure-Dir($p){ if(-not(Test-Path $p)){ New-Item -ItemType Directory -Force -Path $p | Out-Null } }

function PS-Host(){
  if($UsePwsh7){
    $p = "C:\Program Files\PowerShell\7\pwsh.exe"
    if(Test-Path $p){ return $p }
    Warn "PS7 nie znaleziony. Używam klasycznego PowerShell."
  }
  return "C:\Windows\System32\WindowsPowerShell\v1.0\powershell.exe"
}

function Get-PlainPassword([securestring]$sec, [string]$plain){
  if ($sec){
    $BSTR = [Runtime.InteropServices.Marshal]::SecureStringToBSTR($sec)
    try { return [Runtime.InteropServices.Marshal]::PtrToStringBSTR($BSTR) }
    finally { if($BSTR -ne [IntPtr]::Zero){ [Runtime.InteropServices.Marshal]::ZeroFreeBSTR($BSTR) } }
  }
  return $plain
}

function NSSM-Check(){
  if(-not (Test-Path $NssmPath)){ throw "Nie znaleziono NSSM: $NssmPath" }
}

function NSSM-Install($name, $application, $parameters, $appDir, $envExtra, $stdout, $stderr, [switch]$DelayedStart, [switch]$NoConsole){
  & $NssmPath stop   $name 2>$null | Out-Null
  & $NssmPath remove $name confirm | Out-Null
  & $NssmPath install $name $application | Out-Null

  & $NssmPath set $name AppParameters  $parameters | Out-Null
  & $NssmPath set $name AppDirectory   $appDir     | Out-Null
  if($envExtra){ & $NssmPath set $name AppEnvironmentExtra $envExtra | Out-Null }

  if($stdout){ & $NssmPath set $name AppStdout $stdout | Out-Null }
  if($stderr){ & $NssmPath set $name AppStderr $stderr | Out-Null }

  & $NssmPath set $name AppRotateFiles   1        | Out-Null
  & $NssmPath set $name AppRotateOnline  1        | Out-Null
  & $NssmPath set $name AppRotateBytes   10485760 | Out-Null
  & $NssmPath set $name AppRotateSeconds 86400    | Out-Null
  if($NoConsole){ & $NssmPath set $name AppNoConsole 1 | Out-Null }
  if($DelayedStart){ & $NssmPath set $name Start SERVICE_DELAYED_AUTO_START | Out-Null }
}

function NSSM-SetLogon($name, $user, $plainPassword){
  if([string]::IsNullOrWhiteSpace($user)){ return }
  if([string]::IsNullOrWhiteSpace($plainPassword)){
    Warn ("Usługa ${name}: brak hasła do ObjectName=${user}. Ustaw ręcznie (nssm edit) lub podaj -SecurePassword.")
    return
  }
  & $NssmPath set $name ObjectName $user $plainPassword | Out-Null
}

function Write-File($path, [string]$content){
  $dir = Split-Path $path
  Ensure-Dir $dir
  Set-Content -LiteralPath $path -Value $content -Encoding UTF8
  Unblock-File -LiteralPath $path -ErrorAction SilentlyContinue
  Info "Zapisano: $path"
}
#endregion

try{
  NSSM-Check
  Ensure-Dir $RepoRoot
  $logs = Join-Path $RepoRoot "logs\services"
  Ensure-Dir $logs
  Ensure-Dir (Join-Path $RepoRoot "paper_demo")

  if(-not (Test-Path $PythonPath)){ Warn "Brak Pythona venv: $PythonPath" }

  #region DAEMONY: treści z poprawnym int.TotalSeconds i 1x bootstrap_alive
  $psFetch = @'
$ErrorActionPreference="Stop"
$REPO="C:\xau_rl"; $PY="$REPO\.venv\Scripts\python.exe"
$LOG="$REPO\logs\services\fetch_features.log"; $LOCK="$REPO\logs\services\fetch_features.lock"
New-Item -ItemType Directory -Force -Path (Split-Path $LOG) | Out-Null; Set-Location $REPO
if(-not (Test-Path $LOG) -or (Get-Item $LOG).Length -eq 0){
  "[$(Get-Date -Format o)] [fetch_features] bootstrap_alive" | Out-File -FilePath $LOG -Append -Encoding utf8
}
function Acquire-Lock { if(Test-Path $LOCK){$false}else{New-Item -ItemType File -Path $LOCK -Force|Out-Null;$true} }
function Release-Lock { if(Test-Path $LOCK){Remove-Item $LOCK -Force} }
function Run-Once {
  & $PY "fetch__mt5_data.py"         *>> $LOG
  & $PY "features\build_features.py" *>> $LOG
}
while($true){
  $ts=Get-Date -Format o
  try{
    if(Acquire-Lock){
      "`n[$ts] [fetch_features] start" | Out-File -FilePath $LOG -Append -Encoding utf8
      Run-Once
      "`n[$(Get-Date -Format o)] [fetch_features] done" | Out-File -FilePath $LOG -Append -Encoding utf8
      Release-Lock
    } else {
      "`n[$ts] [fetch_features] skipped (locked)" | Out-File -FilePath $LOG -Append -Encoding utf8
    }
  }catch{
    "[ERROR] $($_|Out-String)" | Out-File -FilePath $LOG -Append -Encoding utf8
    Release-Lock
  }
  Start-Sleep -Seconds 600
}
'@

  $psMiniUpdate = @'
$ErrorActionPreference = "Stop"
$REPO = "C:\xau_rl"
$PY   = "$REPO\.venv\Scripts\python.exe"
$LOG  = "$REPO\logs\services\mini_update_ppo.log"
$LOCK = "$REPO\logs\services\mini_update_ppo.lock"

New-Item -ItemType Directory -Force -Path (Split-Path $LOG) | Out-Null
Set-Location $REPO

function Acquire-Lock { if (Test-Path $LOCK) { $false } else { New-Item -ItemType File -Path $LOCK -Force | Out-Null; $true } }
function Release-Lock { if (Test-Path $LOCK) { Remove-Item $LOCK -Force } }

function Run-Once {
    "`n[$(Get-Date -Format o)] [mini_update] start" | Out-File -FilePath $LOG -Append -Encoding utf8
    & $PY -u "ops\mini_update_ppo.py" "--timesteps" "300000" 1>> $LOG 2>> $LOG
    $code = $LASTEXITCODE
    "[$(Get-Date -Format o)] [mini_update] exit_code=$code" | Out-File -FilePath $LOG -Append -Encoding utf8
    if ($code -ne 0) { throw "mini_update failed with exit_code=$code (see log)" }
    "[$(Get-Date -Format o)] [mini_update] done" | Out-File -FilePath $LOG -Append -Encoding utf8
}

while ($true) {
  try {
    if (Acquire-Lock) {
      Run-Once
      Release-Lock
    } else {
      "`n[$(Get-Date -Format o)] [mini_update] skipped (locked)" | Out-File -FilePath $LOG -Append -Encoding utf8
    }
  } catch {
    "[ERROR] $($_ | Out-String)" | Out-File -FilePath $LOG -Append -Encoding utf8
    Release-Lock
  }
  Start-Sleep -Seconds (6*3600)  # co 6h
}
'@

  $psNightlyReport = @'
$ErrorActionPreference="Stop"
$REPO="C:\xau_rl"; $PY="$REPO\.venv\Scripts\python.exe"
$LOG="$REPO\logs\services\nightly_report.log"; $LOCK="$REPO\logs\services\nightly_report.lock"
New-Item -ItemType Directory -Force -Path (Split-Path $LOG) | Out-Null; Set-Location $REPO
if(-not (Test-Path $LOG) -or (Get-Item $LOG).Length -eq 0){
  "[$(Get-Date -Format o)] [nightly_report] bootstrap_alive" | Out-File -FilePath $LOG -Append -Encoding utf8
}
function Acquire-Lock { if(Test-Path $LOCK){$false}else{New-Item -ItemType File -Path $LOCK -Force|Out-Null;$true} }
function Release-Lock { if(Test-Path $LOCK){Remove-Item $LOCK -Force} }
function Run-Once {
  & $PY "rl\evaluate.py" "--out_dir" "reports" *>> $LOG
  & $PY "utils\make_report.py"                 *>> $LOG
}
function Seconds-To-Next-2300 {
  $now = Get-Date
  $target = [DateTime]::Today.AddHours(23)
  if ($now -ge $target) { $target = $target.AddDays(1) }
  $diff = $target - $now
  return ([int]$diff.TotalSeconds)
}
while($true){
  Start-Sleep -Seconds (Seconds-To-Next-2300)
  $ts=Get-Date -Format o
  try{
    if(Acquire-Lock){
      "`n[$ts] [nightly_report] start" | Out-File -FilePath $LOG -Append -Encoding utf8
      Run-Once
      "`n[$(Get-Date -Format o)] [nightly_report] done"  | Out-File -FilePath $LOG -Append -Encoding utf8
      Release-Lock
    } else {
      "`n[$ts] [nightly_report] skipped (locked)" | Out-File -FilePath $LOG -Append -Encoding utf8
    }
  } catch {
    "[ERROR] $($_|Out-String)" | Out-File -FilePath $LOG -Append -Encoding utf8
    Release-Lock
  }
  Start-Sleep -Seconds (24*3600 - 60)
}
'@

  $psNightlyTrain = @'
$ErrorActionPreference="Stop"
$REPO="C:\xau_rl"; $PY="$REPO\.venv\Scripts\python.exe"
$LOG="$REPO\logs\services\nightly_train.log"; $LOCK="$REPO\logs\services\nightly_train.lock"
New-Item -ItemType Directory -Force -Path (Split-Path $LOG) | Out-Null; Set-Location $REPO
if(-not (Test-Path $LOG) -or (Get-Item $LOG).Length -eq 0){
  "[$(Get-Date -Format o)] [nightly_train] bootstrap_alive" | Out-File -FilePath $LOG -Append -Encoding utf8
}
function Acquire-Lock { if(Test-Path $LOCK){$false}else{New-Item -ItemType File -Path $LOCK -Force|Out-Null;$true} }
function Release-Lock { if(Test-Path $LOCK){Remove-Item $LOCK -Force} }
function Run-Once {
  & $PY "rl\train_ppo.py" "--timesteps" "1500000" *>> $LOG
  & $PY "rl\evaluate.py" "--out_dir" "reports"    *>> $LOG
  & $PY "utils\make_report.py"                    *>> $LOG
  & $PY "ops\save_candidate.py"                   *>> $LOG
  & $PY "ops\promote_challenger.py"               *>> $LOG
}
function Seconds-To-Next-0030 {
  $now = Get-Date
  $target = [DateTime]::Today.AddHours(0).AddMinutes(30)
  if ($now -ge $target) { 
    $target = $target.AddDays(1) 
  }
  $diff = $target - $now
  return ([int]$diff.TotalSeconds)
}
while($true){
  Start-Sleep -Seconds (Seconds-To-Next-0030)
  $ts=Get-Date -Format o
  try{
    if(Acquire-Lock){
      "`n[$ts] [nightly_train] start" | Out-File -FilePath $LOG -Append -Encoding utf8
      Run-Once
      "`n[$(Get-Date -Format o)] [nightly_train] done"  | Out-File -FilePath $LOG -Append -Encoding utf8
      Release-Lock
    } else {
      "`n[$ts] [nightly_train] skipped (locked)" | Out-File -FilePath $LOG -Append -Encoding utf8
    }
  } catch {
    "[ERROR] $($_|Out-String)" | Out-File -FilePath $LOG -Append -Encoding utf8
    Release-Lock
  }
  Start-Sleep -Seconds (24*3600 - 60)
}
'@

  $psFeatDisc = @'
$ErrorActionPreference="Stop"
$REPO="C:\xau_rl"; $PY="$REPO\.venv\Scripts\python.exe"
$LOG="$REPO\logs\services\feature_discovery.log"; $LOCK="$REPO\logs\services\feature_discovery.lock"
New-Item -ItemType Directory -Force -Path (Split-Path $LOG) | Out-Null; Set-Location $REPO
if(-not (Test-Path $LOG) -or (Get-Item $LOG).Length -eq 0){
  "[$(Get-Date -Format o)] [feature_discovery] bootstrap_alive" | Out-File -FilePath $LOG -Append -Encoding utf8
}
function Acquire-Lock { if(Test-Path $LOCK){$false}else{New-Item -ItemType File -Path $LOCK -Force|Out-Null;$true} }
function Release-Lock { if(Test-Path $LOCK){Remove-Item $LOCK -Force} }
function Run-Once { & $PY "ops\feature_discovery_weekly.py" "--topK" "96" "--change_frac" "0.10" *>> $LOG }
function Seconds-To-Next-21 {
  $now = Get-Date
  $target = [DateTime]::Today.AddHours(21)
  if ($now -ge $target) { $target = $target.AddDays(1) }
  $diff = $target - $now            # TimeSpan
  return ([int]$diff.TotalSeconds)  # zwracamy liczbę sekund (int)
}
while($true){
  Start-Sleep -Seconds (Seconds-To-Next-21)
  $ts=Get-Date -Format o
  try{
    if(Acquire-Lock){
      "`n[$ts] [feature_discovery] start" | Out-File -FilePath $LOG -Append -Encoding utf8
      Run-Once
      "`n[$(Get-Date -Format o)] [feature_discovery] done" | Out-File -FilePath $LOG -Append -Encoding utf8
      Release-Lock
    } else {
      "`n[$ts] [feature_discovery] skipped (locked)" | Out-File -FilePath $LOG -Append -Encoding utf8
    }
  } catch {
    "[ERROR] $($_|Out-String)" | Out-File -FilePath $LOG -Append -Encoding utf8
    Release-Lock
  }
  Start-Sleep -Seconds (3*24*3600 - 60)
}
'@

  $psCalibration = @'
$ErrorActionPreference="Stop"
$REPO="C:\xau_rl"; $PY="$REPO\.venv\Scripts\python.exe"
$LOG="$REPO\logs\services\calibration_3d.log"; $LOCK="$REPO\logs\services\calibration_3d.lock"
New-Item -ItemType Directory -Force -Path (Split-Path $LOG) | Out-Null; Set-Location $REPO
if(-not (Test-Path $LOG) -or (Get-Item $LOG).Length -eq 0){
  "[$(Get-Date -Format o)] [calibration] bootstrap_alive" | Out-File -FilePath $LOG -Append -Encoding utf8
}
function Acquire-Lock { if(Test-Path $LOCK){$false}else{New-Item -ItemType File -Path $LOCK -Force|Out-Null;$true} }
function Release-Lock { if(Test-Path $LOCK){Remove-Item $LOCK -Force} }
function Run-Once { & $PY "utils\calibration.py" "--apply" *>> $LOG }
function Seconds-To-Next-22 {
  $now = Get-Date
  $target = [DateTime]::Today.AddHours(22)
  if ($now -ge $target) { $target = $target.AddDays(1) }
  $diff = $target - $now
  return ([int]$diff.TotalSeconds)
}
while($true){
  Start-Sleep -Seconds (Seconds-To-Next-22)
  $ts=Get-Date -Format o
  try{
    if(Acquire-Lock){
      "`n[$ts] [calibration] start" | Out-File -FilePath $LOG -Append -Encoding utf8
      Run-Once
      "`n[$(Get-Date -Format o)] [calibration] done" | Out-File -FilePath $LOG -Append -Encoding utf8
      Release-Lock
    } else {
      "`n[$ts] [calibration] skipped (locked)" | Out-File -FilePath $LOG -Append -Encoding utf8
    }
  } catch {
    "[ERROR] $($_|Out-String)" | Out-File -FilePath $LOG -Append -Encoding utf8
    Release-Lock
  }
  Start-Sleep -Seconds (3*24*3600 - 60)
}
'@

  $psTECalendar = @'
$ErrorActionPreference="Stop"
$REPO="C:\xau_rl"; $PY="$REPO\.venv\Scripts\python.exe"
$LOG="$REPO\logs\services\te_calendar.log"; $LOCK="$REPO\logs\services\te_calendar.lock"
New-Item -ItemType Directory -Force -Path (Split-Path $LOG) | Out-Null; Set-Location $REPO
if(-not (Test-Path $LOG) -or (Get-Item $LOG).Length -eq 0){
  "[$(Get-Date -Format o)] [te_calendar] bootstrap_alive" | Out-File -FilePath $LOG -Append -Encoding utf8
}
function Acquire-Lock { if(Test-Path $LOCK){$false}else{New-Item -ItemType File -Path $LOCK -Force|Out-Null;$true} }
function Release-Lock { if(Test-Path $LOCK){Remove-Item $LOCK -Force} }
function Run-Once {
  & $PY "save_te_calendar_cache.py" *>> $LOG
  & $PY "features\build_features.py" *>> $LOG
}
function Seconds-To-Next-0500 {
  $now    = Get-Date
  $target = [DateTime]::Today.AddHours(5)
  if ($now -ge $target) { $target = $target.AddDays(1) }
  $diff = $target - $now
  return [int]$diff.TotalSeconds
}
while($true){
  Start-Sleep -Seconds (Seconds-To-Next-0500)
  $ts=Get-Date -Format o
  try{
    if(Acquire-Lock){
      "`n[$ts] [te_calendar] start" | Out-File -FilePath $LOG -Append -Encoding utf8
      Run-Once
      "`n[$(Get-Date -Format o)] [te_calendar] done"  | Out-File -FilePath $LOG -Append -Encoding utf8
      Release-Lock
    } else {
      "`n[$ts] [te_calendar] skipped (locked)" | Out-File -FilePath $LOG -Append -Encoding utf8
    }
  } catch {
    "[ERROR] $($_|Out-String)" | Out-File -FilePath $LOG -Append -Encoding utf8
    Release-Lock
  }
  Start-Sleep -Seconds (24*3600 - 60)
}
'@

  Write-File (Join-Path $RepoRoot "ops\daemon_fetch_features.ps1")        $psFetch
  Write-File (Join-Path $RepoRoot "ops\daemon_mini_update.ps1")           $psMiniUpdate
  Write-File (Join-Path $RepoRoot "ops\daemon_nightly_report.ps1")        $psNightlyReport
  Write-File (Join-Path $RepoRoot "ops\daemon_nightly_train.ps1")         $psNightlyTrain
  Write-File (Join-Path $RepoRoot "ops\daemon_feature_discovery.ps1")     $psFeatDisc
  Write-File (Join-Path $RepoRoot "ops\daemon_calibration_biweekly.ps1")  $psCalibration
  Write-File (Join-Path $RepoRoot "ops\daemon_te_calendar.ps1")           $psTECalendar
  #endregion

  #region install services
  $psExe  = PS-Host
  $envBase = "PYTHONPATH=$RepoRoot"
  if([string]::IsNullOrWhiteSpace($TEApiKey)){
    $envTE = $envBase
  } else {
    $envTE = "$envBase;TE_API_KEY=$TEApiKey"
  }
  $pw = Get-PlainPassword -sec $SecurePassword -plain $Password

  # 1) paper loop
  NSSM-Install "xau_paper_loop" $PythonPath "-m paper_demo.paper_loop_mt5_demo" $RepoRoot $envBase `
               (Join-Path $logs "paper_loop.log") (Join-Path $logs "paper_loop.err.log") -DelayedStart:$true
  NSSM-SetLogon "xau_paper_loop" $UserAccount $pw

  # 2) fetch features
  NSSM-Install "xau_fetch_features" $psExe "-NoProfile -ExecutionPolicy Bypass -WindowStyle Hidden -File $RepoRoot\ops\daemon_fetch_features.ps1" `
               $RepoRoot $envBase (Join-Path $logs "xau_fetch_features.out.log") (Join-Path $logs "xau_fetch_features.err.log") -DelayedStart:$true -NoConsole
  NSSM-SetLogon "xau_fetch_features" $UserAccount $pw

  # 3) mini update
  NSSM-Install "xau_mini_update" $psExe "-NoProfile -ExecutionPolicy Bypass -WindowStyle Hidden -File $RepoRoot\ops\daemon_mini_update.ps1" `
               $RepoRoot $envBase (Join-Path $logs "xau_mini_update.out.log") (Join-Path $logs "xau_mini_update.err.log") -DelayedStart:$true -NoConsole
  NSSM-SetLogon "xau_mini_update" $UserAccount $pw

  # 4) nightly report
  NSSM-Install "xau_nightly_report" $psExe "-NoProfile -ExecutionPolicy Bypass -WindowStyle Hidden -File $RepoRoot\ops\daemon_nightly_report.ps1" `
               $RepoRoot $envBase (Join-Path $logs "xau_nightly_report.out.log") (Join-Path $logs "xau_nightly_report.err.log") -DelayedStart:$true -NoConsole
  NSSM-SetLogon "xau_nightly_report" $UserAccount $pw

  # 5) nightly train
  NSSM-Install "xau_nightly_train" $psExe "-NoProfile -ExecutionPolicy Bypass -WindowStyle Hidden -File $RepoRoot\ops\daemon_nightly_train.ps1" `
               $RepoRoot $envBase (Join-Path $logs "xau_nightly_train.out.log") (Join-Path $logs "xau_nightly_train.err.log") -DelayedStart:$true -NoConsole
  NSSM-SetLogon "xau_nightly_train" $UserAccount $pw

  # 6) feature discovery
  NSSM-Install "xau_feature_discovery" $psExe "-NoProfile -ExecutionPolicy Bypass -WindowStyle Hidden -File $RepoRoot\ops\daemon_feature_discovery.ps1" `
               $RepoRoot $envBase (Join-Path $logs "xau_feature_discovery.out.log") (Join-Path $logs "xau_feature_discovery.err.log") -DelayedStart:$true -NoConsole
  NSSM-SetLogon "xau_feature_discovery" $UserAccount $pw

  # 7) calibration
  NSSM-Install "xau_calibration" $psExe "-NoProfile -ExecutionPolicy Bypass -WindowStyle Hidden -File $RepoRoot\ops\daemon_calibration_biweekly.ps1" `
               $RepoRoot $envBase (Join-Path $logs "xau_calibration.out.log") (Join-Path $logs "xau_calibration.err.log") -DelayedStart:$true -NoConsole
  NSSM-SetLogon "xau_calibration" $UserAccount $pw

  # 8) TE calendar
  NSSM-Install "xau_te_calendar" $psExe "-NoProfile -ExecutionPolicy Bypass -WindowStyle Hidden -File $RepoRoot\ops\daemon_te_calendar.ps1" `
               $RepoRoot $envTE (Join-Path $logs "xau_te_calendar.out.log") (Join-Path $logs "xau_te_calendar.err.log") -DelayedStart:$true -NoConsole
  NSSM-SetLogon "xau_te_calendar" $UserAccount $pw
  #endregion

  # start services
  $svcs = @(
    "xau_paper_loop","xau_fetch_features","xau_mini_update",
    "xau_nightly_report","xau_nightly_train",
    "xau_feature_discovery","xau_calibration","xau_te_calendar"
  )
  foreach($s in $svcs){ & $NssmPath start $s | Out-Null }

  Start-Sleep -Seconds 2
  Write-Host "`n=== STATUS USŁUG ==="
  foreach($s in $svcs){ sc.exe query $s }

  Write-Host "`n=== TAIL LOGÓW (jeśli istnieją) ==="
  Get-ChildItem "$logs\*.log" | Sort-Object LastWriteTime | %{
    Write-Host "`n--- $($_.Name) ---"
    try { Get-Content $_.FullName -Tail 20 } catch {}
  }

  Info "Gotowe. W razie STATUS=PAUSED upewnij się, że Application wskazuje na 64-bit: $(PS-Host) i plik .ps1 istnieje."
  if(-not $SecurePassword -and -not $Password){
    Warn "Usługi uruchomione z ObjectName=${UserAccount} bez ustawionego hasła. Jeśli wymagane, ustaw je: nssm edit <service>."
  }
}
catch{
  Err $_
  exit 1
}

=== FILE: ops\install_scheduled_tasks.ps1 ===

# ops\install_scheduled_tasks.ps1
param(
  [string]$RepoRoot = "C:\xau_rl",
  [string]$PyExe    = "C:\xau_rl\.venv\Scripts\python.exe",
  [string]$UserName = "$env:USERNAME"
)

$ErrorActionPreference = "Stop"

# --- Katalog logów zadań ---
$TasksLogDir = Join-Path $RepoRoot "logs\tasks"
New-Item -ItemType Directory -Force -Path $TasksLogDir | Out-Null

# --- Funkcja: generowanie wrappera z logowaniem ---
function New-LogWrapper {
  param(
    [Parameter(Mandatory=$true)][string]$WrapperPath,
    [Parameter(Mandatory=$true)][string]$CommandLine,
    [Parameter(Mandatory=$true)][string]$LogPath
  )
  $content = @"
`$ErrorActionPreference = 'Continue'
`$ts = (Get-Date).ToString('yyyy-MM-dd HH:mm:ss')
"[$ts] START $CommandLine" | Out-File -FilePath "$LogPath" -Append -Encoding utf8

try {
  & $CommandLine 1>> "$LogPath" 2>> "$LogPath"
} catch {
  "`$($_.Exception.Message)" | Out-File -FilePath "$LogPath" -Append -Encoding utf8
}

`$ts2 = (Get-Date).ToString('yyyy-MM-dd HH:mm:ss')
"[$ts2] END $CommandLine" | Out-File -FilePath "$LogPath" -Append -Encoding utf8
"@
  $content | Set-Content -Path $WrapperPath -Encoding utf8 -Force
}

# --- 1) fetch + features co 10 min ---
$wrap1 = Join-Path $RepoRoot "ops\wr_fetch_features.ps1"
$log1  = Join-Path $TasksLogDir "fetch_features.log"
$cmd1  = "`"$PyExe`" `"$RepoRoot\fetch__mt5_data.py`" && `"$PyExe`" -m features.build_features"
New-LogWrapper -WrapperPath $wrap1 -CommandLine $cmd1 -LogPath $log1

schtasks /Create /TN "xau_fetch_features" `
  /TR "powershell -ExecutionPolicy Bypass -File `"$wrap1`"" `
  /SC MINUTE /MO 10 /RU $UserName /RL HIGHEST /F

# --- 2) Trading Economics cache raz dziennie 06:05 ---
$wrap2 = Join-Path $RepoRoot "ops\wr_te_calendar.ps1"
$log2  = Join-Path $TasksLogDir "te_calendar.log"
$cmd2  = "`"$PyExe`" `"$RepoRoot\save_te_calendar_cache.py`""
New-LogWrapper -WrapperPath $wrap2 -CommandLine $cmd2 -LogPath $log2

schtasks /Create /TN "xau_te_calendar" `
  /TR "powershell -ExecutionPolicy Bypass -File `"$wrap2`"" `
  /SC DAILY /ST 06:05 /RU $UserName /RL HIGHEST /F

# --- 3) mini-update co 6 godzin ---
$wrap3 = Join-Path $RepoRoot "ops\wr_mini_update.ps1"
$log3  = Join-Path $TasksLogDir "mini_update_6h.log"
$cmd3  = "`"$PyExe`" `"$RepoRoot\ops\mini_update_ppo.py`" --timesteps 300000 --train_days 120 --val_days 30"
New-LogWrapper -WrapperPath $wrap3 -CommandLine $cmd3 -LogPath $log3

schtasks /Create /TN "xau_mini_update" `
  /TR "powershell -ExecutionPolicy Bypass -File `"$wrap3`"" `
  /SC HOURLY /MO 6 /RU $UserName /RL HIGHEST /F

# --- 4) nightly train 23:10 ---
$wrap4 = Join-Path $RepoRoot "ops\wr_nightly_train.ps1"
$log4  = Join-Path $TasksLogDir "nightly_train.log"
$cmd4  = "`"$PyExe`" `"$RepoRoot\rl\train_ppo.py`" --timesteps 1500000"
New-LogWrapper -WrapperPath $wrap4 -CommandLine $cmd4 -LogPath $log4

schtasks /Create /TN "xau_nightly_train" `
  /TR "powershell -ExecutionPolicy Bypass -File `"$wrap4`"" `
  /SC DAILY /ST 23:10 /RU $UserName /RL HIGHEST /F

# --- 5) nightly raport/promocja 23:40 ---
$wrap5 = Join-Path $RepoRoot "ops\wr_nightly_report.ps1"
$log5  = Join-Path $TasksLogDir "nightly_report.log"
$cmd5  = "`"$PyExe`" `"$RepoRoot\rl\evaluate.py`" --out_dir reports && `"$PyExe`" `"$RepoRoot\utils\make_report.py`" && `"$PyExe`" `"$RepoRoot\ops\save_candidate.py`" && `"$PyExe`" `"$RepoRoot\ops\promote_challenger.py`""
New-LogWrapper -WrapperPath $wrap5 -CommandLine $cmd5 -LogPath $log5

schtasks /Create /TN "xau_nightly_report" `
  /TR "powershell -ExecutionPolicy Bypass -File `"$wrap5`"" `
  /SC DAILY /ST 23:40 /RU $UserName /RL HIGHEST /F

# --- 6) cleanup logów 03:15 ---
$wrap6 = Join-Path $RepoRoot "ops\wr_cleanup.ps1"
$log6  = Join-Path $TasksLogDir "cleanup.log"
$cmd6  = "powershell -ExecutionPolicy Bypass -File `"$RepoRoot\ops\cleanup_logs.ps1`" -RepoRoot `"$RepoRoot`" -CompressOldReports"

# wrapper dla cleanupu
$cleanupWrapper = @"
`$ts = (Get-Date).ToString('yyyy-MM-dd HH:mm:ss')
"[$ts] START cleanup" | Out-File -FilePath "$log6" -Append -Encoding utf8
try { & $cmd6 1>> "$log6" 2>> "$log6" } catch { "`$($_.Exception.Message)" | Out-File -FilePath "$log6" -Append -Encoding utf8 }
`$ts2 = (Get-Date).ToString('yyyy-MM-dd HH:mm:ss')
"[$ts2] END cleanup" | Out-File -FilePath "$log6" -Append -Encoding utf8
"@
$cleanupWrapper | Set-Content -Path $wrap6 -Encoding utf8 -Force

schtasks /Create /TN "xau_cleanup_logs" `
  /TR "powershell -ExecutionPolicy Bypass -File `"$wrap6`"" `
  /SC DAILY /ST 03:15 /RU $UserName /RL HIGHEST /F

Write-Host "Zadania zainstalowane. Logi zadan: $TasksLogDir"

=== FILE: ops\install_services.ps1 ===

#requires -Version 5.1
<#
    C:\xau_rl\ops\install_services.ps1
    INSTALUJE WYŁĄCZNIE: xau_cleanup (sprzątanie PPO_xxx i logów usług)
    PS 5.1-compatible, bez CmdletBinding/param (stabilne parsowanie).
#>

Set-StrictMode -Version Latest
$ErrorActionPreference = 'Stop'

# ======================
# ===   K O N F I G  ===
# ======================
$RepoRoot            = 'C:\xau_rl'          # katalog repo
$NssmPath            = 'C:\nssm\nssm.exe'   # pełna ścieżka do nssm.exe
$UsePwsh7            = $false               # true => użyj PowerShell 7 jako hosta usługi

# Polityka retencji (możesz zmienić przed uruchomieniem)
$KeepPPO             = 15                   # zachowaj N najnowszych folderów PPO_xxx
$KeepLogDays         = 21                   # usuń logi usług starsze niż N dni
$CleanupIntervalHours= 6                    # pętla cleanup co N godzin

# ==========================
# ===  FUNKCJE POMOCNICZE ==
# ==========================
function Info($m){ Write-Host "[INFO] $m" -ForegroundColor Cyan }
function Warn($m){ Write-Host "[WARN] $m" -ForegroundColor Yellow }
function Err ($m){ Write-Host "[ERR ] $m" -ForegroundColor Red }
function Ensure-Dir($p){ if(-not(Test-Path -LiteralPath $p)){ New-Item -ItemType Directory -Force -Path $p | Out-Null } }

function PS-Host(){
    if($UsePwsh7){
        $p = "C:\Program Files\PowerShell\7\pwsh.exe"
        if(Test-Path $p){ return $p }
        Warn "PowerShell 7 nie znaleziony. Używam klasycznego PowerShell 5.1."
    }
    return "$env:WINDIR\System32\WindowsPowerShell\v1.0\powershell.exe"
}

# ======================
# ===  WALIDACJE    ===
# ======================
if (-not (Test-Path -LiteralPath $NssmPath)) { throw "Nie znaleziono NSSM: $NssmPath" }
Ensure-Dir $RepoRoot
$logsDir = Join-Path $RepoRoot 'logs\services'
Ensure-Dir $logsDir

# ==============================
# ===  GENERUJ daemon_cleanup ==
# ==============================
$CleanupServiceName = "xau_cleanup"
$CleanupDisplayName = "XAU RL - Cleanup"
$CleanupDescription = "Sprzątanie folderów PPO_xxx i logów usług zgodnie z polityką retencji."
$CleanupScriptPath  = Join-Path $RepoRoot "ops\daemon_cleanup.ps1"

Ensure-Dir (Split-Path $CleanupScriptPath)

# Uwaga: czysty PS 5.1 — brak operatora '?:'
$cleanupContent = @'
# encoding: utf-8
$ErrorActionPreference = "Stop"

# === KONFIG z ENV (z domyślnymi wartościami) ===
$REPO = $env:XAU_REPO
if ([string]::IsNullOrWhiteSpace($REPO)) { $REPO = "C:\xau_rl" }

$PPO_DIR  = Join-Path $REPO "logs\ppo_gold_m5"
$SERV_DIR = Join-Path $REPO "logs\services"
$MODELS   = Join-Path $REPO "models"
New-Item -ItemType Directory -Force -Path $MODELS | Out-Null

[int]$KEEP_FOLDERS = 10
if ($env:KEEP_PPO -and $env:KEEP_PPO -match '^\d+$') { $KEEP_FOLDERS = [int]$env:KEEP_PPO }

[int]$KEEP_LOG_DAYS = 30
if ($env:KEEP_LOG_DAYS -and $env:KEEP_LOG_DAYS -match '^\d+$') { $KEEP_LOG_DAYS = [int]$env:KEEP_LOG_DAYS }

[int]$INTERVAL_H = 24
if ($env:CLEANUP_INTERVAL_HOURS -and $env:CLEANUP_INTERVAL_HOURS -match '^\d+$') { $INTERVAL_H = [int]$env:CLEANUP_INTERVAL_HOURS }

function Log([string]$m){ $ts = Get-Date -Format o; Write-Host "[$ts] [cleanup] $m" }

function Cleanup-PPOFolders {
    Log "Czyszczenie folderów PPO ($PPO_DIR) – zachowuję $KEEP_FOLDERS"
    if (-not (Test-Path $PPO_DIR)) { return }
    $folders  = Get-ChildItem $PPO_DIR -Directory | Sort-Object LastWriteTime -Descending
    $toRemove = $folders | Select-Object -Skip $KEEP_FOLDERS
    foreach ($f in $toRemove) {
        try {
            $best = Join-Path $f.FullName "best_model.zip"
            if (Test-Path $best) {
                $dest = Join-Path $MODELS ("best_" + $f.Name + ".zip")
                Copy-Item $best $dest -Force
                Log "Zapisano kopię modelu: $dest"
            }
            Remove-Item $f.FullName -Recurse -Force
            Log "Usunięto folder: $($f.Name)"
        } catch {
            Log "Błąd usuwania $($f.Name): $($_.Exception.Message)"
        }
    }
}

function Cleanup-ServiceLogs {
    Log "Czyszczenie logów usług starszych niż $KEEP_LOG_DAYS dni ($SERV_DIR)"
    if (-not (Test-Path $SERV_DIR)) { return }
    $cutoff = (Get-Date).AddDays(-$KEEP_LOG_DAYS)
    Get-ChildItem $SERV_DIR -File | Where-Object { $_.LastWriteTime -lt $cutoff } |
        ForEach-Object {
            try {
                Remove-Item $_.FullName -Force
                Log "Usunięto log: $($_.Name)"
            } catch {
                Log "Błąd usuwania logu $($_.Name): $($_.Exception.Message)"
            }
        }
}

while ($true) {
    try {
        Log "Start cleanup"
        Cleanup-PPOFolders
        Cleanup-ServiceLogs
        Log "Cleanup zakończony"
    } catch {
        Log "Błąd cleanup: $($_.Exception.Message)"
    }
    Start-Sleep -Seconds ($INTERVAL_H * 3600)
}
'@

Set-Content -LiteralPath $CleanupScriptPath -Value $cleanupContent -Encoding UTF8
Unblock-File -LiteralPath $CleanupScriptPath -ErrorAction SilentlyContinue
Info "Zapisano/odświeżono: $CleanupScriptPath"

# ==================================
# ===  INSTALACJA USŁUGI CLEANUP ===
# ==================================
$psExe = PS-Host

Info "Konfiguruję usługę $CleanupServiceName ..."
& $NssmPath install $CleanupServiceName $psExe `
    -NoProfile -ExecutionPolicy Bypass -WindowStyle Hidden -File $CleanupScriptPath

& $NssmPath set $CleanupServiceName DisplayName  $CleanupDisplayName
& $NssmPath set $CleanupServiceName Description  $CleanupDescription
& $NssmPath set $CleanupServiceName AppDirectory $RepoRoot

# Parametry retencji jako ENV (łatwa zmiana bez edycji pliku)
$envExtra = @(
    "XAU_REPO=$RepoRoot",
    "KEEP_PPO=$KeepPPO",
    "KEEP_LOG_DAYS=$KeepLogDays",
    "CLEANUP_INTERVAL_HOURS=$CleanupIntervalHours"
) -join ';'
& $NssmPath set $CleanupServiceName AppEnvironmentExtra $envExtra

# Logi usługi
& $NssmPath set $CleanupServiceName AppStdout (Join-Path $logsDir "xau_cleanup.out.log")
& $NssmPath set $CleanupServiceName AppStderr (Join-Path $logsDir "xau_cleanup.err.log")

# Auto-start + restart na błędach (standard)
& $NssmPath set $CleanupServiceName Start SERVICE_AUTO_START
& $NssmPath set $CleanupServiceName AppThrottle 1500
& $NssmPath set $CleanupServiceName AppExit Default Restart

# Restart/Start
try { & $NssmPath stop $CleanupServiceName | Out-Null } catch {}
& $NssmPath start $CleanupServiceName | Out-Null

Write-Host "`n=== STATUS USŁUGI ==="
sc.exe query $CleanupServiceName

Write-Host "`n=== OSTATNIE LOGI CLEANUP (jeśli istnieją) ==="
Get-ChildItem "$logsDir\*.log" -ErrorAction SilentlyContinue |
    Where-Object { $_.Name -like "xau_cleanup*.log" } |
    Sort-Object LastWriteTime |
    ForEach-Object {
        Write-Host "`n--- $($_.Name) ---"
        try { Get-Content $_.FullName -Tail 50 } catch {}
    }

Info "Gotowe. Serwis '$CleanupServiceName' działa."

=== FILE: ops\mini_update_ppo.py ===

# -*- coding: utf-8 -*-
"""
ops/mini_update_ppo.py – bezpieczny mini-update PPO na świeżych danych (z rozszerzonym logowaniem).
Użycie:
  python ops/mini_update_ppo.py --timesteps 300000 --train_days 120 --val_days 30 --seed 42
"""

import argparse
import json
import sys
import traceback
from pathlib import Path

import pandas as pd
import yaml
from gymnasium.wrappers import TimeLimit
from stable_baselines3 import PPO
from stable_baselines3.common.callbacks import EvalCallback
from stable_baselines3.common.utils import set_random_seed
from stable_baselines3.common.vec_env import (
    DummyVecEnv,
    VecMonitor,
    VecNormalize,
    sync_envs_normalization,
)

# ------------------------ CLI ------------------------
ap = argparse.ArgumentParser()
ap.add_argument("--timesteps", type=int, default=300000)
ap.add_argument("--train_days", type=int, default=120)
ap.add_argument("--val_days", type=int, default=30)
ap.add_argument("--seed", type=int, default=42)
args = ap.parse_args()

# ------------------------ Dołącz repo root do sys.path ------------------------
# Dzięki temu import z nadrzędnego katalogu (env_xau.py) działa także, gdy
# uruchamiamy skrypt spod ops/.
REPO_ROOT = Path(__file__).resolve().parents[1]
if str(REPO_ROOT) not in sys.path:
    sys.path.insert(0, str(REPO_ROOT))

# ------------------------ Utils ------------------------
def _to_naive_utc(series: pd.Series) -> pd.Series:
    """Ujednolicenie czasu: zwróć datetime64[ns] bez tzinfo (naive, w UTC)."""
    if pd.api.types.is_datetime64_any_dtype(series):
        try:
            if getattr(series.dt, "tz", None) is not None:
                return series.dt.tz_convert("UTC").dt.tz_localize(None)
            return series
        except Exception:
            return pd.to_datetime(series, utc=True).dt.tz_localize(None)
    return pd.to_datetime(series, utc=True).dt.tz_localize(None)


def main():
    # ------------------------ Config ------------------------
    cfg = yaml.safe_load(open("config.yaml", "r", encoding="utf-8"))
    FEAT = cfg["files"]["features_csv"]
    MODEL_PATH = Path(cfg["files"]["model_path"])
    VECNORM_PATH = Path(cfg.get("files", {}).get("vecnorm_path", "models/vecnorm_xauusd_m5.pkl"))
    WINDOW = int(cfg.get("window", 128))
    COSTS = cfg["costs"]
    ENV_CFG = cfg.get("env", {}) or {}
    REWARD_MODE = ENV_CFG.get("reward_mode", cfg.get("reward_mode", "pct"))
    FLIP_PENALTY = float(ENV_CFG.get("flip_penalty", cfg.get("flip_penalty", 0.0)))
    TRADE_HOURS = ENV_CFG.get("trade_hours_utc", cfg.get("trade_hours_utc", None))
    MIN_EQ = float(ENV_CFG.get("min_equity", 0.8))

    # ------------------------ Dane + sanity ------------------------
    df = pd.read_csv(FEAT, parse_dates=["time"])
    df = df.sort_values("time").drop_duplicates("time").reset_index(drop=True)
    df["time"] = _to_naive_utc(df["time"])

    total_rows = len(df)
    tmin, tmax = (None, None)
    if total_rows > 0:
        tmin, tmax = df["time"].min(), df["time"].max()

    print(f"[mini_update] features_csv={FEAT}", flush=True)
    print(f"[mini_update] df rows={total_rows}  from={tmin}  to={tmax}", flush=True)

    val_end = tmax
    val_start = val_end - pd.Timedelta(days=args.val_days) if val_end is not None else None
    train_start = val_start - pd.Timedelta(days=args.train_days) if val_start is not None else None

    if total_rows > 0:
        train_df = df[(df["time"] >= train_start) & (df["time"] <  val_start)].copy()
        val_df   = df[(df["time"] >= val_start)  & (df["time"] <= val_end)].copy()
    else:
        train_df = df.iloc[:0].copy()
        val_df   = df.iloc[:0].copy()

    print(f"[mini_update] ranges: train_start={train_start}  val_start={val_start}  val_end={val_end}")
    print(f"[mini_update] counts: train={len(train_df)}  val={len(val_df)}  (WINDOW={WINDOW})", flush=True)

    # zapis krótkiego debug CSV
    Path("logs").mkdir(parents=True, exist_ok=True)
    try:
        pd.DataFrame({
            "tmin": [tmin],
            "tmax": [tmax],
            "train_start": [train_start],
            "val_start": [val_start],
            "val_end": [val_end],
            "train_rows": [len(train_df)],
            "val_rows": [len(val_df)],
            "window": [WINDOW],
            "total_rows": [total_rows],
        }).to_csv("logs/debug_mini_update.csv", index=False)
    except Exception:
        pass

    # ------------------------ Fallback dla krótkiej próbki ------------------------
    # 1) „Tight” fallback: jeśli mamy >= 2*WINDOW + 5 obserwacji, to walidacja = ostatnie (WINDOW+5),
    #    a trenowanie = reszta. Działa nawet przy bardzo krótkim ogonie.
    if len(train_df) <= WINDOW or len(val_df) <= WINDOW:
        tight_need = 2*WINDOW + 5
        if total_rows >= tight_need:
            val_len = WINDOW + 5
            train_df = df.iloc[: total_rows - val_len, :].copy()
            val_df   = df.iloc[ total_rows - val_len :, :].copy()
            print(f"[mini_update][fallback-tight] train={len(train_df)}, val={len(val_df)}", flush=True)

    # 2) Jeśli nadal za mało, „compact tail”: weź minimalny fragment 2*WINDOW+2 i podziel tak,
    #    by obie części były > WINDOW (np. 60/40 z lekkim zapasem).
    if len(train_df) <= WINDOW or len(val_df) <= WINDOW:
        min_need = 2*WINDOW + 2
        if total_rows >= min_need:
            tail = df.iloc[-min_need:, :].copy()
            split = min_need - (WINDOW + 2)
            train_df = tail.iloc[:split, :].copy()
            val_df   = tail.iloc[split:, :].copy()
            print(f"[mini_update][fallback-compact] train={len(train_df)}, val={len(val_df)}", flush=True)

    print(f"[mini_update] Training on {len(train_df)} rows (~{args.train_days}d), timesteps={args.timesteps}", flush=True)
    if len(train_df) <= WINDOW or len(val_df) <= WINDOW:
        raise RuntimeError(f"Too few rows for window={WINDOW}: train={len(train_df)}, val={len(val_df)}")

    # ------------------------ features_spec ------------------------
    features_spec = None
    fspec = Path("models/features_spec.json")
    if fspec.exists():
        try:
            raw = json.loads(fspec.read_text(encoding="utf-8")).get("feature_columns", None)
        except Exception:
            raw = None
        if raw:
            avail = [c for c in raw if c in df.columns]
            missing = [c for c in raw if c not in df.columns]
            if missing:
                print(f"[mini_update] features_spec: using intersection: avail={len(avail)}, missing={len(missing)} (ignored)", flush=True)
            features_spec = avail if len(avail) > 0 else None

    # ------------------------ Środowiska RL ------------------------
    from env_xau import XauTradingEnv  # <-- teraz zaimportuje się poprawnie

    def make_train():
        env = XauTradingEnv(
            train_df, window=WINDOW,
            spread_abs=COSTS["spread_abs"], commission_rate=COSTS["commission_rate"], slippage_k=COSTS["slippage_k"],
            reward_mode=REWARD_MODE, use_close_norm=True, flip_penalty=FLIP_PENALTY, trade_hours_utc=TRADE_HOURS,
            enforce_flat_outside_hours=True, features_spec=features_spec, min_equity=MIN_EQ
        )
        return TimeLimit(env, max_episode_steps=6000)

    def make_eval():
        env = XauTradingEnv(
            val_df, window=WINDOW,
            spread_abs=COSTS["spread_abs"], commission_rate=COSTS["commission_rate"], slippage_k=COSTS["slippage_k"],
            reward_mode=REWARD_MODE, use_close_norm=True, flip_penalty=0.0, trade_hours_utc=TRADE_HOURS,
            enforce_flat_outside_hours=True, features_spec=features_spec, min_equity=MIN_EQ
        )
        return TimeLimit(env, max_episode_steps=3000)

    set_random_seed(args.seed)
    vtrain = DummyVecEnv([make_train]); vtrain = VecMonitor(vtrain); vtrain = VecNormalize(vtrain, norm_obs=True, norm_reward=True, clip_obs=10.0, clip_reward=10.0)
    veval  = DummyVecEnv([make_eval]);  veval  = VecMonitor(veval);  veval  = VecNormalize(veval, training=False, norm_obs=True, norm_reward=False)
    sync_envs_normalization(veval, vtrain)

    # ------------------------ PPO ------------------------
    policy_kwargs = dict(net_arch=dict(pi=[128, 128], vf=[128, 128]))
    tb_log_dir = "logs/ppo_gold_m5"
    model = PPO(
        "MlpPolicy", vtrain,
        n_steps=4096, batch_size=256, learning_rate=3e-4, ent_coef=0.02,
        policy_kwargs=policy_kwargs, seed=args.seed, verbose=1, tensorboard_log=tb_log_dir
    )

    eval_cb = EvalCallback(
        veval, best_model_save_path=str(MODEL_PATH.parent), log_path="logs/eval",
        eval_freq=max(args.timesteps // 4, 10000), n_eval_episodes=1,
        deterministic=True, render=False
    )

    model.learn(total_timesteps=args.timesteps, callback=eval_cb)

    # ------------------------ Save ------------------------
    MODEL_PATH.parent.mkdir(parents=True, exist_ok=True)
    model.save(str(MODEL_PATH))
    vtrain.save(str(VECNORM_PATH))
    print(f"[mini_update] Saved model -> {MODEL_PATH}")
    print(f"[mini_update] Saved VecNormalize -> {VECNORM_PATH}")


if __name__ == "__main__":
    try:
        main()
    except Exception:
        print("\n[mini_update][FATAL] Uncaught exception:\n", file=sys.stderr, flush=True)
        traceback.print_exc()
        sys.exit(1)

=== FILE: ops\promote_challenger.py ===

# ops/promote_challenger.py
import json, shutil
from pathlib import Path

ROOT = Path(__file__).resolve().parents[1]
REG  = ROOT / 'models' / 'registry'
REG.mkdir(parents=True, exist_ok=True)

CUR_TXT  = REG / 'current.txt'
MODEL_DST = ROOT / 'models' / 'ppo_xauusd_m5.zip'
VEC_DST   = ROOT / 'models' / 'vecnorm_xauusd_m5.pkl'

def load_metrics(d: Path):
    if not d: return None
    m = d / 'metrics.json'
    return json.loads(m.read_text('utf-8')) if m.exists() else None

def pick_latest_dir():
    dirs = [p for p in REG.iterdir() if p.is_dir()]
    return sorted(dirs, key=lambda p: p.name)[-1] if dirs else None

def better(m_new, m_old):
    if m_old is None: return True
    s_new, s_old = (m_new.get('sharpe') or 0.0), (m_old.get('sharpe') or 0.0)
    dd_new, dd_old = (m_new.get('max_dd') or -1.0), (m_old.get('max_dd') or -1.0)
    fe_new, fe_old = (m_new.get('final_equity') or 0.0), (m_old.get('final_equity') or 0.0)
    dd_ok = (dd_new >= dd_old * 1.2)
    s_ok  = (s_new >= s_old * 1.10) or (s_new >= 0.10 and s_new > s_old)
    if s_new == 0.0 and s_old == 0.0:
        return (fe_new > fe_old) and dd_ok
    return s_ok and dd_ok

def promote(new_dir: Path):
    REG.mkdir(parents=True, exist_ok=True)
    CUR_TXT.write_text(new_dir.name, encoding='utf-8')
    shutil.copy2(new_dir/'model.zip', MODEL_DST)
    if (new_dir/'vecnorm.pkl').exists():
        shutil.copy2(new_dir/'vecnorm.pkl', VEC_DST)
    print(f"[promote] Champion -> {new_dir.name}")

def main():
    latest = pick_latest_dir()
    if latest is None:
        print('[promote] No candidates.'); return
    m_new = load_metrics(latest)
    if m_new is None:
        print('[promote] Latest has no metrics.json'); return
    cur_dir = (REG / CUR_TXT.read_text('utf-8').strip()) if CUR_TXT.exists() else None
    m_old = load_metrics(cur_dir) if cur_dir and cur_dir.exists() else None
    if better(m_new, m_old):
        promote(latest)
    else:
        print('[promote] Challenger not better. No promotion.')

if __name__ == '__main__':
    main()

=== FILE: ops\save_candidate.py ===

# ops/save_candidate.py
import json, shutil
from pathlib import Path

ROOT = Path(__file__).resolve().parents[1]
REG  = ROOT / 'models' / 'registry'
REG.mkdir(parents=True, exist_ok=True)

MODEL = ROOT / 'models' / 'ppo_xauusd_m5.zip'
VEC   = ROOT / 'models' / 'vecnorm_xauusd_m5.pkl'
METR  = ROOT / 'reports' / 'val_metrics.txt'
EQP   = ROOT / 'reports' / 'equity_val.png'

def parse_metrics_txt(p: Path):
    d = {}
    if p.exists():
        txt = p.read_text(encoding='utf-8')
        for line in txt.splitlines():
            if ':' in line:
                k, v = line.split(':', 1)
                k = k.strip().lower().replace(' ', '')
                try:
                    d[k] = float(v.strip())
                except:
                    pass
    return d

def main():
    m = parse_metrics_txt(METR)
    if not m:
        print('[save_candidate] No metrics.')
        return
    tag = 'cand_'
    n = 0
    while (REG / f"{tag}{n:02d}").exists():
        n += 1
    dst = REG / f"{tag}{n:02d}"
    dst.mkdir(parents=True, exist_ok=True)
    shutil.copy2(MODEL, dst/'model.zip')
    if VEC.exists():
        shutil.copy2(VEC, dst/'vecnorm.pkl')
    if EQP.exists():
        shutil.copy2(EQP, dst/'equity.png')
    (dst/'metrics.json').write_text(json.dumps({
        'final_equity': m.get('final_equity'),
        'max_dd': m.get('maxdrawdown'),
        'sharpe': m.get('sharpe_daily'),
    }, indent=2), encoding='utf-8')
    print(f'[save_candidate] Saved candidate -> {dst}')

if __name__ == '__main__':
    main()


=== FILE: ops\wr_cleanup.ps1 ===

$ts = (Get-Date).ToString('yyyy-MM-dd HH:mm:ss')
"[] START cleanup" | Out-File -FilePath "C:\xau_rl\logs\tasks\cleanup.log" -Append -Encoding utf8
try { & powershell -ExecutionPolicy Bypass -File "C:\xau_rl\ops\cleanup_logs.ps1" -RepoRoot "C:\xau_rl" -CompressOldReports 1>> "C:\xau_rl\logs\tasks\cleanup.log" 2>> "C:\xau_rl\logs\tasks\cleanup.log" } catch { "$(.Exception.Message)" | Out-File -FilePath "C:\xau_rl\logs\tasks\cleanup.log" -Append -Encoding utf8 }
$ts2 = (Get-Date).ToString('yyyy-MM-dd HH:mm:ss')
"[] END cleanup" | Out-File -FilePath "C:\xau_rl\logs\tasks\cleanup.log" -Append -Encoding utf8


=== FILE: paper_demo\live_trading.log ===

2025-11-08 00:26:19,311 WARNING Mismatch: model expects 27 features, spec has 96. Adjusting.
2025-11-08 00:26:19,316 INFO Outside trade hours – skipping execution.
2025-11-08 00:26:46,068 WARNING Mismatch: model expects 27 features, spec has 96. Adjusting.
2025-11-08 00:26:46,072 INFO Outside trade hours – skipping execution.


=== FILE: paper_demo\paper_loop_mt5_demo.py ===

# -*- coding: utf-8 -*-
"""
Paper Trading Loop (MT5) – PPO Integration
✔ Dynamic feature mapping from features_spec.json
✔ Log missing features
✔ CSV with decision + trade params + retcode
"""

import MetaTrader5 as mt5
import pandas as pd
import numpy as np
import yaml
import time
import logging
import pickle
import json
from pathlib import Path
from datetime import time as dtime
from stable_baselines3 import PPO
from utils.mt5_health import ensure_mt5_ready

# === Konfiguracja ===
logging.basicConfig(filename='paper_demo/live_trading.log',
                    level=logging.INFO,
                    format='%(asctime)s %(levelname)s %(message)s')

cfg = yaml.safe_load(open('config.yaml', 'r', encoding='utf-8'))
SYMBOL = cfg['symbol']
WINDOW = int(cfg.get('window', 128))
MODEL_PATH = cfg['files']['model_path']
VECNORM_PATH = cfg.get('files', {}).get('vecnorm_path', 'models/vecnorm_xauusd_m5.pkl')
TF_MAP = {'M1': mt5.TIMEFRAME_M1, 'M5': mt5.TIMEFRAME_M5, 'M15': mt5.TIMEFRAME_M15}
TF_NAME = cfg.get('timeframe', 'M5')
TF = TF_MAP.get(TF_NAME, mt5.TIMEFRAME_M5)

MIN_EQUITY = float(cfg.get('env', {}).get('min_equity', 0.8))
TRADE_HOURS = cfg.get('env', {}).get('trade_hours_utc', None)
SLIPPAGE = 10
MAGIC = 123456

# === Funkcje pomocnicze ===
def in_trade_hours(ts):
    if not TRADE_HOURS or len(TRADE_HOURS) != 2:
        return True
    try:
        start_h, start_m = [int(x) for x in TRADE_HOURS[0].split(':')]
        end_h, end_m = [int(x) for x in TRADE_HOURS[1].split(':')]
        start = dtime(start_h, start_m)
        end = dtime(end_h, end_m)
        t = ts.to_pydatetime().time()
        if start <= end:
            return start <= t <= end
        return t >= start or t <= end
    except Exception:
        return True

def add_features_incremental(df):
    df = df.sort_values('time').reset_index(drop=True)
    df['ret1'] = np.log(df['close']).diff()
    df['ema10'] = df['close'].ewm(span=10).mean()
    df['ema50'] = df['close'].ewm(span=50).mean()
    df['ema200'] = df['close'].ewm(span=200).mean()
    d = df['close'].diff()
    up = d.clip(lower=0).ewm(alpha=1/14, adjust=False).mean()
    down = (-d.clip(upper=0)).ewm(alpha=1/14, adjust=False).mean()
    rs = up / (down + 1e-12)
    df['rsi14'] = 100 - (100 / (1 + rs))
    h, l, c = df['high'], df['low'], df['close']
    tr = np.maximum(h - l, np.maximum(abs(h - c.shift()), abs(l - c.shift())))
    df['atr14'] = tr.ewm(alpha=1/14, adjust=False).mean()
    ema_fast = df['close'].ewm(span=12, adjust=False).mean()
    ema_slow = df['close'].ewm(span=26, adjust=False).mean()
    macd_line = ema_fast - ema_slow
    signal_line = macd_line.ewm(span=9, adjust=False).mean()
    df['macd'] = macd_line
    df['macd_signal'] = signal_line
    df['macd_hist'] = macd_line - signal_line
    ma = df['close'].rolling(20).mean()
    sd = df['close'].rolling(20).std()
    df['bb_ma'] = ma
    df['bb_up'] = ma + 2 * sd
    df['bb_lo'] = ma - 2 * sd
    df['bb_width'] = (df['bb_up'] - df['bb_lo']) / (ma.replace(0, np.nan).abs() + 1e-12)
    df['close_log'] = np.log(df['close'].clip(lower=1e-12))
    mu = df['close_log'].rolling(2000, min_periods=200).mean()
    s = df['close_log'].rolling(2000, min_periods=200).std().replace(0, np.nan)
    df['close_norm'] = (df['close_log'] - mu) / (s + 1e-8)
    return df.dropna().reset_index(drop=True)

def get_last_bars(symbol, timeframe, n):
    rates = mt5.copy_rates_from_pos(symbol, timeframe, 0, n)
    if rates is None or len(rates) < n:
        return None
    df = pd.DataFrame(rates)
    df['time'] = pd.to_datetime(df['time'], unit='s', utc=True)
    df.rename(columns={'real_volume': 'tick_volume'}, inplace=True)
    return df[['time', 'open', 'high', 'low', 'close', 'tick_volume', 'spread']]

def build_obs(df_feat, model_obs_dim):
    spec_path = Path("models/features_spec.json")
    if not spec_path.exists():
        raise RuntimeError("Brak pliku features_spec.json – uruchom feature discovery.")
    spec = json.loads(spec_path.read_text(encoding="utf-8"))
    feature_cols = spec.get("feature_columns", [])
    if not feature_cols:
        raise RuntimeError("Specyfikacja cech jest pusta.")

    tail = df_feat.tail(WINDOW)
    block = []
    matched = 0
    for col in feature_cols:
        if col in tail.columns:
            block.append(tail[col].to_numpy(dtype=np.float32))
            matched += 1
        else:
            block.append(np.zeros(WINDOW, dtype=np.float32))
    block = np.stack(block, axis=1)

    per_step = (model_obs_dim - 2) // WINDOW
    zero_filled = 0
    if block.shape[1] != per_step:
        logging.warning(f"Mismatch: model expects {per_step} features, spec has {block.shape[1]}. Adjusting.")
        if block.shape[1] < per_step:
            zero_filled = per_step - block.shape[1]
            pad = np.zeros((WINDOW, zero_filled), dtype=np.float32)
            block = np.concatenate([block, pad], axis=1)
        else:
            block = block[:, :per_step]
    flat = block.flatten()
    return np.concatenate([flat, np.array([0.0, 0.0], dtype=np.float32)]), matched, zero_filled

def current_position():
    positions = mt5.positions_get(symbol=SYMBOL)
    return positions[0] if positions else None

def close_position(ticket, pos_type, volume):
    req = {
        "action": mt5.TRADE_ACTION_DEAL,
        "position": ticket,
        "symbol": SYMBOL,
        "type": mt5.ORDER_TYPE_SELL if pos_type == mt5.ORDER_TYPE_BUY else mt5.ORDER_TYPE_BUY,
        "volume": volume,
        "price": mt5.symbol_info_tick(SYMBOL).bid if pos_type == mt5.ORDER_TYPE_BUY else mt5.symbol_info_tick(SYMBOL).ask,
        "deviation": SLIPPAGE,
        "magic": MAGIC,
        "comment": "Close position"
    }
    return mt5.order_send(req)

def open_position(direction, lot, sl=None, tp=None):
    tick = mt5.symbol_info_tick(SYMBOL)
    price = tick.ask if direction == "BUY" else tick.bid
    req = {
        "action": mt5.TRADE_ACTION_DEAL,
        "symbol": SYMBOL,
        "type": mt5.ORDER_TYPE_BUY if direction == "BUY" else mt5.ORDER_TYPE_SELL,
        "volume": lot,
        "price": price,
        "deviation": SLIPPAGE,
        "magic": MAGIC,
        "comment": "Open trade"
    }
    if sl: req["sl"] = sl
    if tp: req["tp"] = tp
    return mt5.order_send(req)

def dynamic_lot(equity):
    return round(max(0.01, equity / 10000), 2)

def calc_sl_tp(price, atr):
    sl = price - 2 * atr if atr else None
    tp = price + 4 * atr if atr else None
    return sl, tp

# === Główna pętla ===
def main():
    if not ensure_mt5_ready():
        raise RuntimeError("MT5 not ready. Start MT5 and login.")
    model = PPO.load(MODEL_PATH)
    expected_dim = int(model.observation_space.shape[0])

    with open(VECNORM_PATH, 'rb') as f:
        vecnorm = pickle.load(f)
    vecnorm.training = False
    vecnorm.norm_reward = False

    Path('paper_demo').mkdir(parents=True, exist_ok=True)
    csv = Path('paper_demo/live_decisions.csv')
    if not csv.exists():
        csv.write_text('time_utc,price,action_id,action_label,equity,lot,sl,tp,retcode,matched_features,zero_filled\n', encoding='utf-8')

    last_ts = None
    hb_t = time.time()

    while True:
        bars = get_last_bars(SYMBOL, TF, n=WINDOW + 800)
        if bars is None or len(bars) < WINDOW + 200:
            time.sleep(5)
            continue
        feat = add_features_incremental(bars)
        if len(feat) < WINDOW:
            time.sleep(5)
            continue
        cur_ts = feat['time'].iloc[-1]
        if last_ts is not None and cur_ts == last_ts:
            time.sleep(2)
            continue

        obs, matched, zero_filled = build_obs(feat, expected_dim)
        obs = vecnorm.normalize_obs(obs.reshape(1, -1)).reshape(-1)
        action, _ = model.predict(obs, deterministic=True)
        decision = {0: 'SHORT', 1: 'FLAT', 2: 'LONG'}[int(action)]
        price = float(feat['close'].iloc[-1])
        atr = float(feat['atr14'].iloc[-1]) if 'atr14' in feat.columns else None

        equity = mt5.account_info().equity
        lot = dynamic_lot(equity)
        sl, tp = calc_sl_tp(price, atr)
        retcode = None

        if not in_trade_hours(cur_ts):
            logging.info("Outside trade hours – skipping execution.")
        elif equity < MIN_EQUITY * mt5.account_info().balance:
            logging.info(f"Equity too low ({equity:.2f}) – skipping execution.")
        else:
            pos = current_position()
            if int(action) == 1:
                if pos:
                    res = close_position(pos.ticket, pos.type, pos.volume)
                    retcode = res.retcode
            else:
                desired = "BUY" if int(action) == 2 else "SELL"
                if not pos or (pos.type == mt5.ORDER_TYPE_BUY and desired == "SELL") or (pos.type == mt5.ORDER_TYPE_SELL and desired == "BUY"):
                    if pos:
                        close_position(pos.ticket, pos.type, pos.volume)
                    res = open_position(desired, lot, sl, tp)
                    retcode = res.retcode

        with open(csv, 'a', encoding='utf-8') as f:
            f.write(f"{cur_ts},{price:.5f},{int(action)},{decision},{equity:.2f},{lot:.2f},{sl},{tp},{retcode},{matched},{zero_filled}\n")

        last_ts = cur_ts
        if time.time() - hb_t > 600:
            logging.info(f"[HB] {SYMBOL} {TF_NAME} last_ts={cur_ts} price={price:.2f}")
            hb_t = time.time()
        time.sleep(30)

    mt5.shutdown()

if __name__ == '__main__':
    main()

=== FILE: paper_demo\paper_trading.log ===

2025-11-05 08:25:15,247 INFO DECISION FLAT @ 3965.14 (ts=2025-11-05 08:25:00+00:00) equity=1.000000
2025-11-05 08:30:01,764 INFO DECISION FLAT @ 3966.20 (ts=2025-11-05 08:30:00+00:00) equity=1.000000
2025-11-05 08:35:02,016 INFO DECISION FLAT @ 3968.11 (ts=2025-11-05 08:35:00+00:00) equity=1.000000
2025-11-05 08:40:01,437 INFO DECISION FLAT @ 3970.07 (ts=2025-11-05 08:40:00+00:00) equity=1.000000
2025-11-05 08:40:01,438 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 08:40:00+00:00 price=3970.07 pos=0 equity=1.000000
2025-11-05 08:45:00,986 INFO DECISION FLAT @ 3970.16 (ts=2025-11-05 08:45:00+00:00) equity=1.000000
2025-11-05 08:50:02,006 INFO DECISION FLAT @ 3970.86 (ts=2025-11-05 08:50:00+00:00) equity=1.000000
2025-11-05 08:50:02,007 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 08:50:00+00:00 price=3970.86 pos=0 equity=1.000000
2025-11-05 08:55:01,384 INFO DECISION FLAT @ 3969.55 (ts=2025-11-05 08:55:00+00:00) equity=1.000000
2025-11-05 09:00:01,650 INFO DECISION FLAT @ 3972.80 (ts=2025-11-05 09:00:00+00:00) equity=1.000000
2025-11-05 09:05:00,861 INFO DECISION FLAT @ 3976.18 (ts=2025-11-05 09:05:00+00:00) equity=1.000000
2025-11-05 09:05:00,867 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 09:05:00+00:00 price=3976.18 pos=0 equity=1.000000
2025-11-05 09:10:01,281 INFO DECISION FLAT @ 3986.42 (ts=2025-11-05 09:10:00+00:00) equity=1.000000
2025-11-05 09:15:03,806 INFO DECISION FLAT @ 3982.44 (ts=2025-11-05 09:15:00+00:00) equity=1.000000
2025-11-05 09:15:03,807 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 09:15:00+00:00 price=3982.44 pos=0 equity=1.000000
2025-11-05 09:15:31,437 INFO DECISION FLAT @ 3981.92 (ts=2025-11-05 09:15:00+00:00) equity=1.000000
2025-11-05 09:20:01,141 INFO DECISION FLAT @ 3982.77 (ts=2025-11-05 09:20:00+00:00) equity=1.000000
2025-11-05 09:25:01,728 INFO DECISION FLAT @ 3981.72 (ts=2025-11-05 09:25:00+00:00) equity=1.000000
2025-11-05 09:30:02,961 INFO DECISION FLAT @ 3980.07 (ts=2025-11-05 09:30:00+00:00) equity=1.000000
2025-11-05 09:30:02,962 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 09:30:00+00:00 price=3980.07 pos=0 equity=1.000000
2025-11-05 09:35:02,229 INFO DECISION FLAT @ 3981.85 (ts=2025-11-05 09:35:00+00:00) equity=1.000000
2025-11-05 09:40:00,320 INFO DECISION FLAT @ 3984.58 (ts=2025-11-05 09:40:00+00:00) equity=1.000000
2025-11-05 09:45:02,294 INFO DECISION FLAT @ 3981.85 (ts=2025-11-05 09:45:00+00:00) equity=1.000000
2025-11-05 09:45:02,295 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 09:45:00+00:00 price=3981.85 pos=0 equity=1.000000
2025-11-05 09:50:01,805 INFO DECISION FLAT @ 3979.91 (ts=2025-11-05 09:50:00+00:00) equity=1.000000
2025-11-05 09:55:01,183 INFO DECISION FLAT @ 3981.93 (ts=2025-11-05 09:55:00+00:00) equity=1.000000
2025-11-05 10:00:00,451 INFO DECISION FLAT @ 3979.64 (ts=2025-11-05 10:00:00+00:00) equity=1.000000
2025-11-05 10:00:00,452 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 10:00:00+00:00 price=3979.64 pos=0 equity=1.000000
2025-11-05 10:05:02,308 INFO DECISION FLAT @ 3979.60 (ts=2025-11-05 10:05:00+00:00) equity=1.000000
2025-11-05 10:10:00,754 INFO DECISION FLAT @ 3978.40 (ts=2025-11-05 10:10:00+00:00) equity=1.000000
2025-11-05 10:10:00,755 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 10:10:00+00:00 price=3978.40 pos=0 equity=1.000000
2025-11-05 10:15:01,468 INFO DECISION FLAT @ 3975.48 (ts=2025-11-05 10:15:00+00:00) equity=1.000000
2025-11-05 10:20:00,638 INFO DECISION FLAT @ 3971.09 (ts=2025-11-05 10:20:00+00:00) equity=1.000000
2025-11-05 10:25:00,522 INFO DECISION FLAT @ 3966.72 (ts=2025-11-05 10:25:00+00:00) equity=1.000000
2025-11-05 10:25:00,523 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 10:25:00+00:00 price=3966.72 pos=0 equity=1.000000
2025-11-05 10:30:01,137 INFO DECISION FLAT @ 3965.21 (ts=2025-11-05 10:30:00+00:00) equity=1.000000
2025-11-05 10:35:00,543 INFO DECISION FLAT @ 3969.05 (ts=2025-11-05 10:35:00+00:00) equity=1.000000
2025-11-05 10:35:00,544 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 10:35:00+00:00 price=3969.05 pos=0 equity=1.000000
2025-11-05 10:57:08,713 INFO DECISION FLAT @ 3971.37 (ts=2025-11-05 10:55:00+00:00) equity=1.000000
2025-11-05 11:00:01,832 INFO DECISION FLAT @ 3971.92 (ts=2025-11-05 11:00:00+00:00) equity=1.000000
2025-11-05 11:05:01,975 INFO DECISION FLAT @ 3961.66 (ts=2025-11-05 11:05:00+00:00) equity=1.000000
2025-11-05 11:10:01,405 INFO DECISION FLAT @ 3965.74 (ts=2025-11-05 11:10:00+00:00) equity=1.000000
2025-11-05 11:10:01,407 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 11:10:00+00:00 price=3965.74 pos=0 equity=1.000000
2025-11-05 11:15:01,746 INFO DECISION FLAT @ 3963.16 (ts=2025-11-05 11:15:00+00:00) equity=1.000000
2025-11-05 11:19:35,342 INFO DECISION FLAT @ 3965.06 (ts=2025-11-05 11:15:00+00:00) equity=1.000000
2025-11-05 11:20:05,383 INFO DECISION FLAT @ 3965.79 (ts=2025-11-05 11:20:00+00:00) equity=1.000000
2025-11-05 11:21:59,179 INFO DECISION FLAT @ 3967.13 (ts=2025-11-05 11:20:00+00:00) equity=1.000000
2025-11-05 11:25:00,642 INFO DECISION FLAT @ 3966.31 (ts=2025-11-05 11:25:00+00:00) equity=1.000000
2025-11-05 11:29:59,611 INFO DECISION FLAT @ 3964.88 (ts=2025-11-05 11:25:00+00:00) equity=1.000000
2025-11-05 11:30:29,816 INFO DECISION FLAT @ 3965.17 (ts=2025-11-05 11:30:00+00:00) equity=1.000000
2025-11-05 11:31:37,111 INFO DECISION FLAT @ 3965.94 (ts=2025-11-05 11:30:00+00:00) equity=1.000000
2025-11-05 11:35:01,699 INFO DECISION FLAT @ 3965.12 (ts=2025-11-05 11:35:00+00:00) equity=1.000000
2025-11-05 11:40:00,910 INFO DECISION FLAT @ 3965.93 (ts=2025-11-05 11:40:00+00:00) equity=1.000000
2025-11-05 11:42:12,289 INFO DECISION FLAT @ 3966.13 (ts=2025-11-05 11:40:00+00:00) equity=1.000000
2025-11-05 11:44:13,044 INFO DECISION FLAT @ 3967.02 (ts=2025-11-05 11:40:00+00:00) equity=1.000000
2025-11-05 11:45:02,139 INFO DECISION FLAT @ 3967.18 (ts=2025-11-05 11:45:00+00:00) equity=1.000000
2025-11-05 11:50:01,863 INFO DECISION FLAT @ 3968.03 (ts=2025-11-05 11:50:00+00:00) equity=1.000000
2025-11-05 11:55:00,999 INFO DECISION FLAT @ 3962.67 (ts=2025-11-05 11:55:00+00:00) equity=1.000000
2025-11-05 11:55:01,001 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 11:55:00+00:00 price=3962.67 pos=0 equity=1.000000
2025-11-05 11:57:58,798 INFO DECISION FLAT @ 3961.53 (ts=2025-11-05 11:55:00+00:00) equity=1.000000
2025-11-05 12:00:00,963 INFO DECISION FLAT @ 3964.71 (ts=2025-11-05 12:00:00+00:00) equity=1.000000
2025-11-05 12:05:02,365 INFO DECISION FLAT @ 3968.82 (ts=2025-11-05 12:05:00+00:00) equity=1.000000
2025-11-05 12:10:01,565 INFO DECISION FLAT @ 3962.86 (ts=2025-11-05 12:10:00+00:00) equity=1.000000
2025-11-05 12:10:01,566 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 12:10:00+00:00 price=3962.86 pos=0 equity=1.000000
2025-11-05 12:15:02,439 INFO DECISION FLAT @ 3960.83 (ts=2025-11-05 12:15:00+00:00) equity=1.000000
2025-11-05 12:20:01,468 INFO DECISION FLAT @ 3961.44 (ts=2025-11-05 12:20:00+00:00) equity=1.000000
2025-11-05 12:25:02,497 INFO DECISION FLAT @ 3958.86 (ts=2025-11-05 12:25:00+00:00) equity=1.000000
2025-11-05 12:25:02,498 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 12:25:00+00:00 price=3958.86 pos=0 equity=1.000000
2025-11-05 12:37:36,653 INFO DECISION FLAT @ 3959.21 (ts=2025-11-05 12:35:00+00:00) equity=1.000000
2025-11-05 12:40:00,787 INFO DECISION FLAT @ 3960.70 (ts=2025-11-05 12:40:00+00:00) equity=1.000000
2025-11-05 12:46:51,932 INFO DECISION FLAT @ 3965.38 (ts=2025-11-05 12:45:00+00:00) equity=1.000000
2025-11-05 12:50:01,270 INFO DECISION FLAT @ 3965.92 (ts=2025-11-05 12:50:00+00:00) equity=1.000000
2025-11-05 12:54:14,733 INFO DECISION FLAT @ 3965.51 (ts=2025-11-05 12:50:00+00:00) equity=1.000000
2025-11-05 12:55:01,778 INFO DECISION FLAT @ 3965.69 (ts=2025-11-05 12:55:00+00:00) equity=1.000000
2025-11-05 13:00:00,688 INFO DECISION FLAT @ 3966.87 (ts=2025-11-05 13:00:00+00:00) equity=1.000000
2025-11-05 13:01:21,175 INFO DECISION FLAT @ 3966.84 (ts=2025-11-05 13:00:00+00:00) equity=1.000000
2025-11-05 13:05:01,901 INFO DECISION FLAT @ 3963.90 (ts=2025-11-05 13:05:00+00:00) equity=1.000000
2025-11-05 13:10:02,006 INFO DECISION FLAT @ 3965.40 (ts=2025-11-05 13:10:00+00:00) equity=1.000000
2025-11-05 13:15:01,951 INFO DECISION SHORT @ 3964.20 (ts=2025-11-05 13:15:00+00:00) equity=0.999814
2025-11-05 13:15:01,952 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 13:15:00+00:00 price=3964.20 pos=-1 equity=0.999814
2025-11-05 13:20:07,341 INFO DECISION SHORT @ 3967.93 (ts=2025-11-05 13:20:00+00:00) equity=0.999797
2025-11-05 13:25:01,094 INFO DECISION SHORT @ 3967.62 (ts=2025-11-05 13:25:00+00:00) equity=0.999777
2025-11-05 13:30:00,383 INFO DECISION FLAT @ 3967.51 (ts=2025-11-05 13:30:00+00:00) equity=0.999571
2025-11-05 13:35:01,283 INFO DECISION FLAT @ 3966.89 (ts=2025-11-05 13:35:00+00:00) equity=0.999571
2025-11-05 13:35:01,283 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 13:35:00+00:00 price=3966.89 pos=0 equity=0.999571
2025-11-05 13:40:00,901 INFO DECISION FLAT @ 3964.43 (ts=2025-11-05 13:40:00+00:00) equity=0.999571
2025-11-05 13:45:01,122 INFO DECISION FLAT @ 3964.65 (ts=2025-11-05 13:45:00+00:00) equity=0.999571
2025-11-05 13:50:01,508 INFO DECISION FLAT @ 3963.82 (ts=2025-11-05 13:50:00+00:00) equity=0.999571
2025-11-05 13:50:01,508 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 13:50:00+00:00 price=3963.82 pos=0 equity=0.999571
2025-11-05 13:55:00,840 INFO DECISION FLAT @ 3965.64 (ts=2025-11-05 13:55:00+00:00) equity=0.999571
2025-11-05 14:00:00,771 INFO DECISION FLAT @ 3969.90 (ts=2025-11-05 14:00:00+00:00) equity=0.999571
2025-11-05 14:05:01,766 INFO DECISION FLAT @ 3967.15 (ts=2025-11-05 14:05:00+00:00) equity=0.999571
2025-11-05 14:05:01,768 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 14:05:00+00:00 price=3967.15 pos=0 equity=0.999571
2025-11-05 14:10:01,707 INFO DECISION FLAT @ 3973.41 (ts=2025-11-05 14:10:00+00:00) equity=0.999571
2025-11-05 14:15:01,522 INFO DECISION SHORT @ 3973.02 (ts=2025-11-05 14:15:00+00:00) equity=0.999325
2025-11-05 14:20:00,923 INFO DECISION FLAT @ 3967.04 (ts=2025-11-05 14:20:00+00:00) equity=0.999119
2025-11-05 14:20:00,924 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 14:20:00+00:00 price=3967.04 pos=0 equity=0.999119
2025-11-05 14:25:00,454 INFO DECISION SHORT @ 3975.66 (ts=2025-11-05 14:25:00+00:00) equity=0.998906
2025-11-05 14:30:01,795 INFO DECISION SHORT @ 3976.56 (ts=2025-11-05 14:30:00+00:00) equity=0.998780
2025-11-05 14:30:01,796 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 14:30:00+00:00 price=3976.56 pos=-1 equity=0.998780
2025-11-05 14:35:01,029 INFO DECISION SHORT @ 3973.06 (ts=2025-11-05 14:35:00+00:00) equity=0.998768
2025-11-05 14:40:02,194 INFO DECISION SHORT @ 3971.28 (ts=2025-11-05 14:40:00+00:00) equity=0.998818
2025-11-05 14:40:02,194 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 14:40:00+00:00 price=3971.28 pos=-1 equity=0.998818
2025-11-05 14:45:01,753 INFO DECISION SHORT @ 3974.53 (ts=2025-11-05 14:45:00+00:00) equity=0.998788
2025-11-05 14:50:01,201 INFO DECISION FLAT @ 3972.26 (ts=2025-11-05 14:50:00+00:00) equity=0.998583
2025-11-05 14:55:02,457 INFO DECISION SHORT @ 3978.72 (ts=2025-11-05 14:55:00+00:00) equity=0.998430
2025-11-05 14:55:02,457 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 14:55:00+00:00 price=3978.72 pos=-1 equity=0.998430
2025-11-05 15:00:00,770 INFO DECISION SHORT @ 3975.96 (ts=2025-11-05 15:00:00+00:00) equity=0.998420
2025-11-05 15:05:01,029 INFO DECISION SHORT @ 3977.30 (ts=2025-11-05 15:05:00+00:00) equity=0.998402
2025-11-05 15:10:01,378 INFO DECISION SHORT @ 3976.22 (ts=2025-11-05 15:10:00+00:00) equity=0.998478
2025-11-05 15:10:01,379 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 15:10:00+00:00 price=3976.22 pos=-1 equity=0.998478
2025-11-05 15:15:00,673 INFO DECISION SHORT @ 3979.64 (ts=2025-11-05 15:15:00+00:00) equity=0.998463
2025-11-05 15:20:02,112 INFO DECISION SHORT @ 3979.65 (ts=2025-11-05 15:20:00+00:00) equity=0.998663
2025-11-05 15:20:02,121 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 15:20:00+00:00 price=3979.65 pos=-1 equity=0.998663
2025-11-05 15:25:00,948 INFO DECISION SHORT @ 3982.11 (ts=2025-11-05 15:25:00+00:00) equity=0.998673
2025-11-05 15:30:01,371 INFO DECISION SHORT @ 3982.72 (ts=2025-11-05 15:30:00+00:00) equity=0.998979
2025-11-05 15:35:02,001 INFO DECISION SHORT @ 3983.28 (ts=2025-11-05 15:35:00+00:00) equity=0.999202
2025-11-05 15:35:02,002 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 15:35:00+00:00 price=3983.28 pos=-1 equity=0.999202
2025-11-05 15:40:01,286 INFO DECISION FLAT @ 3981.73 (ts=2025-11-05 15:40:00+00:00) equity=0.998997
2025-11-05 15:45:00,362 INFO DECISION SHORT @ 3976.60 (ts=2025-11-05 15:45:00+00:00) equity=0.998739
2025-11-05 15:50:01,562 INFO DECISION SHORT @ 3972.06 (ts=2025-11-05 15:50:00+00:00) equity=0.998764
2025-11-05 15:50:01,562 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 15:50:00+00:00 price=3972.06 pos=-1 equity=0.998764
2025-11-05 15:55:01,290 INFO DECISION SHORT @ 3975.03 (ts=2025-11-05 15:55:00+00:00) equity=0.998505
2025-11-05 16:00:02,186 INFO DECISION SHORT @ 3969.80 (ts=2025-11-05 16:00:00+00:00) equity=0.999463
2025-11-05 16:00:02,187 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 16:00:00+00:00 price=3969.80 pos=-1 equity=0.999463
2025-11-05 16:05:01,411 INFO DECISION FLAT @ 3970.63 (ts=2025-11-05 16:05:00+00:00) equity=0.999257
2025-11-05 16:10:00,330 INFO DECISION FLAT @ 3974.10 (ts=2025-11-05 16:10:00+00:00) equity=0.999257
2025-11-05 16:15:00,878 INFO DECISION FLAT @ 3971.00 (ts=2025-11-05 16:15:00+00:00) equity=0.999257
2025-11-05 16:15:00,879 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 16:15:00+00:00 price=3971.00 pos=0 equity=0.999257
2025-11-05 16:20:01,094 INFO DECISION FLAT @ 3969.66 (ts=2025-11-05 16:20:00+00:00) equity=0.999257
2025-11-05 16:25:01,169 INFO DECISION FLAT @ 3971.98 (ts=2025-11-05 16:25:00+00:00) equity=0.999257
2025-11-05 16:25:01,169 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 16:25:00+00:00 price=3971.98 pos=0 equity=0.999257
2025-11-05 16:30:00,282 INFO DECISION FLAT @ 3979.38 (ts=2025-11-05 16:30:00+00:00) equity=0.999257
2025-11-05 16:35:01,499 INFO DECISION FLAT @ 3981.65 (ts=2025-11-05 16:35:00+00:00) equity=0.999257
2025-11-05 16:35:01,500 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 16:35:00+00:00 price=3981.65 pos=0 equity=0.999257
2025-11-05 16:40:01,058 INFO DECISION FLAT @ 3980.33 (ts=2025-11-05 16:40:00+00:00) equity=0.999257
2025-11-05 16:45:02,298 INFO DECISION FLAT @ 3982.84 (ts=2025-11-05 16:45:00+00:00) equity=0.999257
2025-11-05 16:45:02,299 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 16:45:00+00:00 price=3982.84 pos=0 equity=0.999257
2025-11-05 16:50:01,285 INFO DECISION FLAT @ 3980.46 (ts=2025-11-05 16:50:00+00:00) equity=0.999257
2025-11-05 16:55:00,644 INFO DECISION LONG @ 3980.89 (ts=2025-11-05 16:55:00+00:00) equity=0.999051
2025-11-05 17:00:01,020 INFO DECISION LONG @ 3978.29 (ts=2025-11-05 17:00:00+00:00) equity=0.999041
2025-11-05 17:00:01,025 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 17:00:00+00:00 price=3978.29 pos=1 equity=0.999041
2025-11-05 17:05:01,830 INFO DECISION FLAT @ 3978.67 (ts=2025-11-05 17:05:00+00:00) equity=0.998836
2025-11-05 17:10:02,086 INFO DECISION FLAT @ 3981.80 (ts=2025-11-05 17:10:00+00:00) equity=0.998836
2025-11-05 17:10:02,088 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 17:10:00+00:00 price=3981.80 pos=0 equity=0.998836
2025-11-05 17:15:01,289 INFO DECISION FLAT @ 3976.72 (ts=2025-11-05 17:15:00+00:00) equity=0.998836
2025-11-05 17:20:00,303 INFO DECISION FLAT @ 3977.08 (ts=2025-11-05 17:20:00+00:00) equity=0.998836
2025-11-05 17:25:01,689 INFO DECISION FLAT @ 3979.68 (ts=2025-11-05 17:25:00+00:00) equity=0.998836
2025-11-05 17:25:01,690 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 17:25:00+00:00 price=3979.68 pos=0 equity=0.998836
2025-11-05 17:30:00,268 INFO DECISION FLAT @ 3981.52 (ts=2025-11-05 17:30:00+00:00) equity=0.998836
2025-11-05 17:35:01,456 INFO DECISION FLAT @ 3980.01 (ts=2025-11-05 17:35:00+00:00) equity=0.998836
2025-11-05 17:40:01,842 INFO DECISION FLAT @ 3983.41 (ts=2025-11-05 17:40:00+00:00) equity=0.998836
2025-11-05 17:40:01,843 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 17:40:00+00:00 price=3983.41 pos=0 equity=0.998836
2025-11-05 17:45:01,703 INFO DECISION FLAT @ 3984.33 (ts=2025-11-05 17:45:00+00:00) equity=0.998836
2025-11-05 17:50:01,954 INFO DECISION FLAT @ 3988.03 (ts=2025-11-05 17:50:00+00:00) equity=0.998836
2025-11-05 17:50:01,955 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 17:50:00+00:00 price=3988.03 pos=0 equity=0.998836
2025-11-05 17:55:00,841 INFO DECISION FLAT @ 3986.75 (ts=2025-11-05 17:55:00+00:00) equity=0.998836
2025-11-05 18:00:01,476 INFO DECISION FLAT @ 3987.28 (ts=2025-11-05 18:00:00+00:00) equity=0.998836
2025-11-05 18:05:00,720 INFO DECISION FLAT @ 3987.18 (ts=2025-11-05 18:05:00+00:00) equity=0.998836
2025-11-05 18:05:00,721 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 18:05:00+00:00 price=3987.18 pos=0 equity=0.998836
2025-11-05 18:10:00,791 INFO DECISION FLAT @ 3984.49 (ts=2025-11-05 18:10:00+00:00) equity=0.998836
2025-11-05 18:15:01,446 INFO DECISION FLAT @ 3984.24 (ts=2025-11-05 18:15:00+00:00) equity=0.998836
2025-11-05 18:15:01,448 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 18:15:00+00:00 price=3984.24 pos=0 equity=0.998836
2025-11-05 18:20:01,529 INFO DECISION SHORT @ 3981.61 (ts=2025-11-05 18:20:00+00:00) equity=0.998633
2025-11-05 18:25:01,365 INFO DECISION SHORT @ 3980.56 (ts=2025-11-05 18:25:00+00:00) equity=0.998628
2025-11-05 18:30:02,105 INFO DECISION SHORT @ 3982.36 (ts=2025-11-05 18:30:00+00:00) equity=0.998636
2025-11-05 18:30:02,106 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 18:30:00+00:00 price=3982.36 pos=-1 equity=0.998636
2025-11-05 18:35:01,390 INFO DECISION SHORT @ 3981.53 (ts=2025-11-05 18:35:00+00:00) equity=0.998668
2025-11-05 18:40:02,003 INFO DECISION SHORT @ 3981.69 (ts=2025-11-05 18:40:00+00:00) equity=0.998714
2025-11-05 18:45:00,266 INFO DECISION SHORT @ 3983.27 (ts=2025-11-05 18:45:00+00:00) equity=0.998714
2025-11-05 18:45:00,268 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 18:45:00+00:00 price=3983.27 pos=-1 equity=0.998714
2025-11-05 18:50:01,831 INFO DECISION SHORT @ 3982.58 (ts=2025-11-05 18:50:00+00:00) equity=0.998709
2025-11-05 18:55:00,626 INFO DECISION SHORT @ 3982.31 (ts=2025-11-05 18:55:00+00:00) equity=0.998711
2025-11-05 18:55:00,627 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 18:55:00+00:00 price=3982.31 pos=-1 equity=0.998711
2025-11-05 19:00:00,977 INFO DECISION SHORT @ 3982.38 (ts=2025-11-05 19:00:00+00:00) equity=0.998648
2025-11-05 19:05:01,500 INFO DECISION SHORT @ 3981.65 (ts=2025-11-05 19:05:00+00:00) equity=0.998638
2025-11-05 19:05:01,503 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 19:05:00+00:00 price=3981.65 pos=-1 equity=0.998638
2025-11-05 19:10:01,894 INFO DECISION SHORT @ 3982.07 (ts=2025-11-05 19:10:00+00:00) equity=0.998648
2025-11-05 19:15:00,332 INFO DECISION SHORT @ 3983.57 (ts=2025-11-05 19:15:00+00:00) equity=0.998694
2025-11-05 19:20:01,182 INFO DECISION SHORT @ 3984.61 (ts=2025-11-05 19:20:00+00:00) equity=0.998706
2025-11-05 19:20:01,182 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 19:20:00+00:00 price=3984.61 pos=-1 equity=0.998706
2025-11-05 19:25:01,188 INFO DECISION SHORT @ 3984.56 (ts=2025-11-05 19:25:00+00:00) equity=0.998686
2025-11-05 19:30:02,102 INFO DECISION SHORT @ 3983.83 (ts=2025-11-05 19:30:00+00:00) equity=0.998653
2025-11-05 19:30:02,102 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 19:30:00+00:00 price=3983.83 pos=-1 equity=0.998653
2025-11-05 19:35:02,253 INFO DECISION SHORT @ 3981.73 (ts=2025-11-05 19:35:00+00:00) equity=0.998651
2025-11-05 19:40:00,448 INFO DECISION SHORT @ 3980.45 (ts=2025-11-05 19:40:00+00:00) equity=0.998651
2025-11-05 19:45:01,987 INFO DECISION SHORT @ 3979.81 (ts=2025-11-05 19:45:00+00:00) equity=0.998643
2025-11-05 19:45:01,988 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 19:45:00+00:00 price=3979.81 pos=-1 equity=0.998643
2025-11-05 19:50:01,605 INFO DECISION SHORT @ 3981.45 (ts=2025-11-05 19:50:00+00:00) equity=0.998643
2025-11-05 19:55:00,954 INFO DECISION SHORT @ 3983.02 (ts=2025-11-05 19:55:00+00:00) equity=0.998646
2025-11-05 20:00:00,677 INFO DECISION SHORT @ 3982.52 (ts=2025-11-05 20:00:00+00:00) equity=0.998646
2025-11-05 20:00:00,678 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 20:00:00+00:00 price=3982.52 pos=-1 equity=0.998646
2025-11-05 20:05:00,509 INFO DECISION FLAT @ 3984.79 (ts=2025-11-05 20:05:00+00:00) equity=0.998441
2025-11-05 20:10:00,356 INFO DECISION FLAT @ 3980.77 (ts=2025-11-05 20:10:00+00:00) equity=0.998441
2025-11-05 20:15:00,584 INFO DECISION FLAT @ 3979.81 (ts=2025-11-05 20:15:00+00:00) equity=0.998441
2025-11-05 20:15:00,585 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 20:15:00+00:00 price=3979.81 pos=0 equity=0.998441
2025-11-05 20:20:01,287 INFO DECISION FLAT @ 3982.32 (ts=2025-11-05 20:20:00+00:00) equity=0.998441
2025-11-05 20:25:01,060 INFO DECISION FLAT @ 3982.82 (ts=2025-11-05 20:25:00+00:00) equity=0.998441
2025-11-05 20:25:01,061 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 20:25:00+00:00 price=3982.82 pos=0 equity=0.998441
2025-11-05 20:30:01,701 INFO DECISION FLAT @ 3984.39 (ts=2025-11-05 20:30:00+00:00) equity=0.998441
2025-11-05 20:35:01,994 INFO DECISION FLAT @ 3983.17 (ts=2025-11-05 20:35:00+00:00) equity=0.998441
2025-11-05 20:35:01,995 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 20:35:00+00:00 price=3983.17 pos=0 equity=0.998441
2025-11-05 20:40:01,532 INFO DECISION FLAT @ 3985.97 (ts=2025-11-05 20:40:00+00:00) equity=0.998441
2025-11-05 20:45:01,011 INFO DECISION FLAT @ 3987.29 (ts=2025-11-05 20:45:00+00:00) equity=0.998441
2025-11-05 20:50:00,994 INFO DECISION FLAT @ 3986.66 (ts=2025-11-05 20:50:00+00:00) equity=0.998441
2025-11-05 20:50:00,996 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 20:50:00+00:00 price=3986.66 pos=0 equity=0.998441
2025-11-05 20:55:00,553 INFO DECISION FLAT @ 3987.37 (ts=2025-11-05 20:55:00+00:00) equity=0.998441
2025-11-05 21:00:02,252 INFO DECISION FLAT @ 3987.46 (ts=2025-11-05 21:00:00+00:00) equity=0.998441
2025-11-05 21:00:02,253 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 21:00:00+00:00 price=3987.46 pos=0 equity=0.998441
2025-11-05 21:05:00,146 INFO DECISION FLAT @ 3987.66 (ts=2025-11-05 21:05:00+00:00) equity=0.998441
2025-11-05 21:10:01,436 INFO DECISION FLAT @ 3989.83 (ts=2025-11-05 21:10:00+00:00) equity=0.998441
2025-11-05 21:15:01,960 INFO DECISION FLAT @ 3987.78 (ts=2025-11-05 21:15:00+00:00) equity=0.998441
2025-11-05 21:15:01,961 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 21:15:00+00:00 price=3987.78 pos=0 equity=0.998441
2025-11-05 21:20:01,277 INFO DECISION FLAT @ 3986.56 (ts=2025-11-05 21:20:00+00:00) equity=0.998441
2025-11-05 21:25:00,975 INFO DECISION FLAT @ 3987.25 (ts=2025-11-05 21:25:00+00:00) equity=0.998441
2025-11-05 21:30:01,183 INFO DECISION FLAT @ 3985.76 (ts=2025-11-05 21:30:00+00:00) equity=0.998441
2025-11-05 21:30:01,184 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 21:30:00+00:00 price=3985.76 pos=0 equity=0.998441
2025-11-05 21:35:01,188 INFO DECISION FLAT @ 3986.48 (ts=2025-11-05 21:35:00+00:00) equity=0.998441
2025-11-05 21:40:01,251 INFO DECISION FLAT @ 3987.95 (ts=2025-11-05 21:40:00+00:00) equity=0.998441
2025-11-05 21:40:01,252 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 21:40:00+00:00 price=3987.95 pos=0 equity=0.998441
2025-11-05 21:45:00,761 INFO DECISION FLAT @ 3984.53 (ts=2025-11-05 21:45:00+00:00) equity=0.998441
2025-11-05 21:50:00,547 INFO DECISION FLAT @ 3982.19 (ts=2025-11-05 21:50:00+00:00) equity=0.998441
2025-11-05 21:55:01,400 INFO DECISION FLAT @ 3982.43 (ts=2025-11-05 21:55:00+00:00) equity=0.998441
2025-11-05 21:55:01,402 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 21:55:00+00:00 price=3982.43 pos=0 equity=0.998441
2025-11-05 22:00:01,521 INFO DECISION FLAT @ 3984.46 (ts=2025-11-05 22:00:00+00:00) equity=0.998441
2025-11-05 22:05:00,241 INFO DECISION FLAT @ 3984.93 (ts=2025-11-05 22:05:00+00:00) equity=0.998441
2025-11-05 22:10:02,010 INFO DECISION FLAT @ 3982.07 (ts=2025-11-05 22:10:00+00:00) equity=0.998441
2025-11-05 22:10:02,012 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 22:10:00+00:00 price=3982.07 pos=0 equity=0.998441
2025-11-05 22:15:02,347 INFO DECISION FLAT @ 3983.15 (ts=2025-11-05 22:15:00+00:00) equity=0.998441
2025-11-05 22:20:02,654 INFO DECISION FLAT @ 3983.70 (ts=2025-11-05 22:20:00+00:00) equity=0.998441
2025-11-05 22:20:02,654 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 22:20:00+00:00 price=3983.70 pos=0 equity=0.998441
2025-11-05 22:25:06,591 INFO DECISION FLAT @ 3983.73 (ts=2025-11-05 22:25:00+00:00) equity=0.998441
2025-11-05 22:30:02,241 INFO DECISION FLAT @ 3981.94 (ts=2025-11-05 22:30:00+00:00) equity=0.998441
2025-11-05 22:35:02,154 INFO DECISION FLAT @ 3982.12 (ts=2025-11-05 22:35:00+00:00) equity=0.998441
2025-11-05 22:35:02,154 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 22:35:00+00:00 price=3982.12 pos=0 equity=0.998441
2025-11-05 22:40:01,681 INFO DECISION FLAT @ 3982.76 (ts=2025-11-05 22:40:00+00:00) equity=0.998441
2025-11-05 22:45:01,453 INFO DECISION FLAT @ 3982.27 (ts=2025-11-05 22:45:00+00:00) equity=0.998441
2025-11-05 22:50:00,929 INFO DECISION FLAT @ 3982.20 (ts=2025-11-05 22:50:00+00:00) equity=0.998441
2025-11-05 22:50:00,930 INFO [HB] GOLD.pro M5 last_ts=2025-11-05 22:50:00+00:00 price=3982.20 pos=0 equity=0.998441
2025-11-05 22:55:00,730 INFO DECISION FLAT @ 3979.25 (ts=2025-11-05 22:55:00+00:00) equity=0.998441
2025-11-06 00:05:02,865 INFO DECISION FLAT @ 3968.58 (ts=2025-11-06 00:05:00+00:00) equity=0.998441
2025-11-06 00:05:02,867 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 00:05:00+00:00 price=3968.58 pos=0 equity=0.998441
2025-11-06 00:10:00,529 INFO DECISION FLAT @ 3968.86 (ts=2025-11-06 00:10:00+00:00) equity=0.998441
2025-11-06 00:15:01,942 INFO DECISION FLAT @ 3970.13 (ts=2025-11-06 00:15:00+00:00) equity=0.998441
2025-11-06 00:20:01,104 INFO DECISION FLAT @ 3970.11 (ts=2025-11-06 00:20:00+00:00) equity=0.998441
2025-11-06 00:20:01,105 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 00:20:00+00:00 price=3970.11 pos=0 equity=0.998441
2025-11-06 00:25:02,505 INFO DECISION FLAT @ 3970.04 (ts=2025-11-06 00:25:00+00:00) equity=0.998441
2025-11-06 00:30:01,715 INFO DECISION FLAT @ 3970.57 (ts=2025-11-06 00:30:00+00:00) equity=0.998441
2025-11-06 00:30:01,716 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 00:30:00+00:00 price=3970.57 pos=0 equity=0.998441
2025-11-06 00:35:03,786 INFO DECISION FLAT @ 3973.48 (ts=2025-11-06 00:35:00+00:00) equity=0.998441
2025-11-06 00:40:01,346 INFO DECISION FLAT @ 3975.27 (ts=2025-11-06 00:40:00+00:00) equity=0.998441
2025-11-06 00:45:01,008 INFO DECISION FLAT @ 3973.47 (ts=2025-11-06 00:45:00+00:00) equity=0.998441
2025-11-06 00:45:01,009 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 00:45:00+00:00 price=3973.47 pos=0 equity=0.998441
2025-11-06 00:50:01,446 INFO DECISION FLAT @ 3976.68 (ts=2025-11-06 00:50:00+00:00) equity=0.998441
2025-11-06 00:55:00,821 INFO DECISION FLAT @ 3973.84 (ts=2025-11-06 00:55:00+00:00) equity=0.998441
2025-11-06 01:00:00,347 INFO DECISION FLAT @ 3973.85 (ts=2025-11-06 01:00:00+00:00) equity=0.998441
2025-11-06 01:00:00,348 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 01:00:00+00:00 price=3973.85 pos=0 equity=0.998441
2025-11-06 01:05:04,922 INFO DECISION FLAT @ 3971.51 (ts=2025-11-06 01:05:00+00:00) equity=0.998441
2025-11-06 01:10:02,666 INFO DECISION FLAT @ 3973.22 (ts=2025-11-06 01:10:00+00:00) equity=0.998441
2025-11-06 01:10:02,666 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 01:10:00+00:00 price=3973.22 pos=0 equity=0.998441
2025-11-06 01:15:02,055 INFO DECISION FLAT @ 3975.12 (ts=2025-11-06 01:15:00+00:00) equity=0.998441
2025-11-06 01:20:01,694 INFO DECISION FLAT @ 3972.47 (ts=2025-11-06 01:20:00+00:00) equity=0.998441
2025-11-06 01:25:01,049 INFO DECISION FLAT @ 3973.49 (ts=2025-11-06 01:25:00+00:00) equity=0.998441
2025-11-06 01:25:01,049 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 01:25:00+00:00 price=3973.49 pos=0 equity=0.998441
2025-11-06 01:30:01,171 INFO DECISION FLAT @ 3973.84 (ts=2025-11-06 01:30:00+00:00) equity=0.998441
2025-11-06 01:35:01,128 INFO DECISION FLAT @ 3971.99 (ts=2025-11-06 01:35:00+00:00) equity=0.998441
2025-11-06 01:35:01,128 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 01:35:00+00:00 price=3971.99 pos=0 equity=0.998441
2025-11-06 01:40:00,981 INFO DECISION FLAT @ 3972.53 (ts=2025-11-06 01:40:00+00:00) equity=0.998441
2025-11-06 01:45:01,422 INFO DECISION FLAT @ 3972.62 (ts=2025-11-06 01:45:00+00:00) equity=0.998441
2025-11-06 01:45:01,423 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 01:45:00+00:00 price=3972.62 pos=0 equity=0.998441
2025-11-06 01:50:01,165 INFO DECISION FLAT @ 3972.68 (ts=2025-11-06 01:50:00+00:00) equity=0.998441
2025-11-06 01:55:00,621 INFO DECISION FLAT @ 3973.59 (ts=2025-11-06 01:55:00+00:00) equity=0.998441
2025-11-06 02:00:00,586 INFO DECISION FLAT @ 3976.40 (ts=2025-11-06 02:00:00+00:00) equity=0.998441
2025-11-06 02:00:00,587 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 02:00:00+00:00 price=3976.40 pos=0 equity=0.998441
2025-11-06 02:05:01,758 INFO DECISION FLAT @ 3972.05 (ts=2025-11-06 02:05:00+00:00) equity=0.998441
2025-11-06 02:10:02,105 INFO DECISION FLAT @ 3965.28 (ts=2025-11-06 02:10:00+00:00) equity=0.998441
2025-11-06 02:10:02,107 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 02:10:00+00:00 price=3965.28 pos=0 equity=0.998441
2025-11-06 02:15:02,491 INFO DECISION FLAT @ 3970.41 (ts=2025-11-06 02:15:00+00:00) equity=0.998441
2025-11-06 02:20:00,535 INFO DECISION FLAT @ 3970.52 (ts=2025-11-06 02:20:00+00:00) equity=0.998441
2025-11-06 02:25:02,078 INFO DECISION FLAT @ 3973.33 (ts=2025-11-06 02:25:00+00:00) equity=0.998441
2025-11-06 02:25:02,079 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 02:25:00+00:00 price=3973.33 pos=0 equity=0.998441
2025-11-06 02:30:01,769 INFO DECISION FLAT @ 3968.65 (ts=2025-11-06 02:30:00+00:00) equity=0.998441
2025-11-06 02:35:01,082 INFO DECISION FLAT @ 3972.87 (ts=2025-11-06 02:35:00+00:00) equity=0.998441
2025-11-06 02:40:01,023 INFO DECISION FLAT @ 3972.54 (ts=2025-11-06 02:40:00+00:00) equity=0.998441
2025-11-06 02:40:01,024 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 02:40:00+00:00 price=3972.54 pos=0 equity=0.998441
2025-11-06 02:45:00,328 INFO DECISION FLAT @ 3971.17 (ts=2025-11-06 02:45:00+00:00) equity=0.998441
2025-11-06 02:50:02,288 INFO DECISION FLAT @ 3972.35 (ts=2025-11-06 02:50:00+00:00) equity=0.998441
2025-11-06 02:50:02,288 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 02:50:00+00:00 price=3972.35 pos=0 equity=0.998441
2025-11-06 02:55:02,042 INFO DECISION FLAT @ 3975.59 (ts=2025-11-06 02:55:00+00:00) equity=0.998441
2025-11-06 03:00:01,522 INFO DECISION FLAT @ 3976.67 (ts=2025-11-06 03:00:00+00:00) equity=0.998441
2025-11-06 03:05:00,878 INFO DECISION FLAT @ 3976.86 (ts=2025-11-06 03:05:00+00:00) equity=0.998441
2025-11-06 03:05:00,880 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 03:05:00+00:00 price=3976.86 pos=0 equity=0.998441
2025-11-06 03:10:02,057 INFO DECISION FLAT @ 3978.57 (ts=2025-11-06 03:10:00+00:00) equity=0.998441
2025-11-06 03:15:01,282 INFO DECISION FLAT @ 3977.53 (ts=2025-11-06 03:15:00+00:00) equity=0.998441
2025-11-06 03:15:01,282 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 03:15:00+00:00 price=3977.53 pos=0 equity=0.998441
2025-11-06 03:20:00,911 INFO DECISION FLAT @ 3978.19 (ts=2025-11-06 03:20:00+00:00) equity=0.998441
2025-11-06 03:25:02,117 INFO DECISION FLAT @ 3978.00 (ts=2025-11-06 03:25:00+00:00) equity=0.998441
2025-11-06 03:25:02,118 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 03:25:00+00:00 price=3978.00 pos=0 equity=0.998441
2025-11-06 03:30:01,492 INFO DECISION FLAT @ 3978.41 (ts=2025-11-06 03:30:00+00:00) equity=0.998441
2025-11-06 03:35:01,328 INFO DECISION FLAT @ 3983.63 (ts=2025-11-06 03:35:00+00:00) equity=0.998441
2025-11-06 03:40:00,601 INFO DECISION FLAT @ 3983.49 (ts=2025-11-06 03:40:00+00:00) equity=0.998441
2025-11-06 03:40:00,602 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 03:40:00+00:00 price=3983.49 pos=0 equity=0.998441
2025-11-06 03:45:02,100 INFO DECISION FLAT @ 3980.55 (ts=2025-11-06 03:45:00+00:00) equity=0.998441
2025-11-06 03:50:01,390 INFO DECISION FLAT @ 3982.44 (ts=2025-11-06 03:50:00+00:00) equity=0.998441
2025-11-06 03:50:01,391 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 03:50:00+00:00 price=3982.44 pos=0 equity=0.998441
2025-11-06 03:55:01,118 INFO DECISION FLAT @ 3982.85 (ts=2025-11-06 03:55:00+00:00) equity=0.998441
2025-11-06 04:00:01,484 INFO DECISION FLAT @ 3983.57 (ts=2025-11-06 04:00:00+00:00) equity=0.998441
2025-11-06 04:00:01,485 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 04:00:00+00:00 price=3983.57 pos=0 equity=0.998441
2025-11-06 04:05:01,068 INFO DECISION FLAT @ 3981.44 (ts=2025-11-06 04:05:00+00:00) equity=0.998441
2025-11-06 04:10:00,744 INFO DECISION FLAT @ 3981.08 (ts=2025-11-06 04:10:00+00:00) equity=0.998441
2025-11-06 04:15:02,013 INFO DECISION FLAT @ 3985.15 (ts=2025-11-06 04:15:00+00:00) equity=0.998441
2025-11-06 04:15:02,014 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 04:15:00+00:00 price=3985.15 pos=0 equity=0.998441
2025-11-06 04:20:01,453 INFO DECISION FLAT @ 3984.49 (ts=2025-11-06 04:20:00+00:00) equity=0.998441
2025-11-06 04:25:00,843 INFO DECISION FLAT @ 3986.54 (ts=2025-11-06 04:25:00+00:00) equity=0.998441
2025-11-06 04:30:02,266 INFO DECISION FLAT @ 3986.01 (ts=2025-11-06 04:30:00+00:00) equity=0.998441
2025-11-06 04:30:02,267 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 04:30:00+00:00 price=3986.01 pos=0 equity=0.998441
2025-11-06 04:35:01,266 INFO DECISION FLAT @ 3988.58 (ts=2025-11-06 04:35:00+00:00) equity=0.998441
2025-11-06 04:40:00,467 INFO DECISION FLAT @ 3990.20 (ts=2025-11-06 04:40:00+00:00) equity=0.998441
2025-11-06 04:45:01,469 INFO DECISION FLAT @ 3987.57 (ts=2025-11-06 04:45:00+00:00) equity=0.998441
2025-11-06 04:45:01,470 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 04:45:00+00:00 price=3987.57 pos=0 equity=0.998441
2025-11-06 04:50:00,962 INFO DECISION FLAT @ 3986.98 (ts=2025-11-06 04:50:00+00:00) equity=0.998441
2025-11-06 04:55:00,323 INFO DECISION FLAT @ 3986.52 (ts=2025-11-06 04:55:00+00:00) equity=0.998441
2025-11-06 05:00:01,658 INFO DECISION FLAT @ 3987.97 (ts=2025-11-06 05:00:00+00:00) equity=0.998441
2025-11-06 05:00:01,659 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 05:00:00+00:00 price=3987.97 pos=0 equity=0.998441
2025-11-06 05:05:03,009 INFO DECISION FLAT @ 3985.79 (ts=2025-11-06 05:05:00+00:00) equity=0.998441
2025-11-06 05:10:02,037 INFO DECISION FLAT @ 3985.78 (ts=2025-11-06 05:10:00+00:00) equity=0.998441
2025-11-06 05:10:02,037 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 05:10:00+00:00 price=3985.78 pos=0 equity=0.998441
2025-11-06 05:15:01,166 INFO DECISION FLAT @ 3985.62 (ts=2025-11-06 05:15:00+00:00) equity=0.998441
2025-11-06 05:20:02,408 INFO DECISION FLAT @ 3985.08 (ts=2025-11-06 05:20:00+00:00) equity=0.998441
2025-11-06 05:20:02,415 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 05:20:00+00:00 price=3985.08 pos=0 equity=0.998441
2025-11-06 05:25:01,452 INFO DECISION FLAT @ 3986.24 (ts=2025-11-06 05:25:00+00:00) equity=0.998441
2025-11-06 05:30:00,915 INFO DECISION FLAT @ 3986.67 (ts=2025-11-06 05:30:00+00:00) equity=0.998441
2025-11-06 05:35:01,924 INFO DECISION FLAT @ 3986.50 (ts=2025-11-06 05:35:00+00:00) equity=0.998441
2025-11-06 05:35:01,926 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 05:35:00+00:00 price=3986.50 pos=0 equity=0.998441
2025-11-06 05:40:02,879 INFO DECISION FLAT @ 3986.88 (ts=2025-11-06 05:40:00+00:00) equity=0.998441
2025-11-06 05:45:01,976 INFO DECISION FLAT @ 3986.90 (ts=2025-11-06 05:45:00+00:00) equity=0.998441
2025-11-06 05:45:01,979 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 05:45:00+00:00 price=3986.90 pos=0 equity=0.998441
2025-11-06 05:50:01,191 INFO DECISION FLAT @ 3987.05 (ts=2025-11-06 05:50:00+00:00) equity=0.998441
2025-11-06 05:55:00,575 INFO DECISION FLAT @ 3986.62 (ts=2025-11-06 05:55:00+00:00) equity=0.998441
2025-11-06 06:00:01,725 INFO DECISION SHORT @ 3988.94 (ts=2025-11-06 06:00:00+00:00) equity=0.998231
2025-11-06 06:00:01,726 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 06:00:00+00:00 price=3988.94 pos=-1 equity=0.998231
2025-11-06 06:05:01,019 INFO DECISION SHORT @ 3990.21 (ts=2025-11-06 06:05:00+00:00) equity=0.998241
2025-11-06 06:10:00,450 INFO DECISION SHORT @ 3987.10 (ts=2025-11-06 06:10:00+00:00) equity=0.998243
2025-11-06 06:15:01,405 INFO DECISION SHORT @ 3988.31 (ts=2025-11-06 06:15:00+00:00) equity=0.998203
2025-11-06 06:15:01,406 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 06:15:00+00:00 price=3988.31 pos=-1 equity=0.998203
2025-11-06 06:20:02,535 INFO DECISION SHORT @ 3988.50 (ts=2025-11-06 06:20:00+00:00) equity=0.998203
2025-11-06 06:25:01,378 INFO DECISION SHORT @ 3989.79 (ts=2025-11-06 06:25:00+00:00) equity=0.998241
2025-11-06 06:30:00,509 INFO DECISION FLAT @ 3989.92 (ts=2025-11-06 06:30:00+00:00) equity=0.998036
2025-11-06 06:30:00,510 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 06:30:00+00:00 price=3989.92 pos=0 equity=0.998036
2025-11-06 06:35:01,612 INFO DECISION FLAT @ 3987.95 (ts=2025-11-06 06:35:00+00:00) equity=0.998036
2025-11-06 06:40:00,566 INFO DECISION FLAT @ 3987.99 (ts=2025-11-06 06:40:00+00:00) equity=0.998036
2025-11-06 06:40:00,567 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 06:40:00+00:00 price=3987.99 pos=0 equity=0.998036
2025-11-06 06:45:01,679 INFO DECISION FLAT @ 3987.87 (ts=2025-11-06 06:45:00+00:00) equity=0.998036
2025-11-06 06:50:00,752 INFO DECISION FLAT @ 3989.24 (ts=2025-11-06 06:50:00+00:00) equity=0.998036
2025-11-06 06:50:00,752 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 06:50:00+00:00 price=3989.24 pos=0 equity=0.998036
2025-11-06 06:55:01,945 INFO DECISION FLAT @ 3988.68 (ts=2025-11-06 06:55:00+00:00) equity=0.998036
2025-11-06 07:00:00,946 INFO DECISION FLAT @ 3987.42 (ts=2025-11-06 07:00:00+00:00) equity=0.998036
2025-11-06 07:00:00,947 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 07:00:00+00:00 price=3987.42 pos=0 equity=0.998036
2025-11-06 07:05:00,552 INFO DECISION FLAT @ 3988.77 (ts=2025-11-06 07:05:00+00:00) equity=0.998036
2025-11-06 07:10:01,733 INFO DECISION FLAT @ 3988.28 (ts=2025-11-06 07:10:00+00:00) equity=0.998036
2025-11-06 07:10:01,734 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 07:10:00+00:00 price=3988.28 pos=0 equity=0.998036
2025-11-06 07:15:00,971 INFO DECISION FLAT @ 3986.99 (ts=2025-11-06 07:15:00+00:00) equity=0.998036
2025-11-06 07:20:02,197 INFO DECISION FLAT @ 3987.31 (ts=2025-11-06 07:20:00+00:00) equity=0.998036
2025-11-06 07:20:02,198 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 07:20:00+00:00 price=3987.31 pos=0 equity=0.998036
2025-11-06 07:25:01,195 INFO DECISION FLAT @ 3987.70 (ts=2025-11-06 07:25:00+00:00) equity=0.998036
2025-11-06 07:30:00,330 INFO DECISION FLAT @ 3987.23 (ts=2025-11-06 07:30:00+00:00) equity=0.998036
2025-11-06 07:35:01,839 INFO DECISION FLAT @ 3986.42 (ts=2025-11-06 07:35:00+00:00) equity=0.998036
2025-11-06 07:35:01,839 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 07:35:00+00:00 price=3986.42 pos=0 equity=0.998036
2025-11-06 07:40:00,992 INFO DECISION FLAT @ 3986.16 (ts=2025-11-06 07:40:00+00:00) equity=0.998036
2025-11-06 07:45:02,110 INFO DECISION FLAT @ 3984.54 (ts=2025-11-06 07:45:00+00:00) equity=0.998036
2025-11-06 07:45:02,110 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 07:45:00+00:00 price=3984.54 pos=0 equity=0.998036
2025-11-06 07:50:01,463 INFO DECISION FLAT @ 3986.03 (ts=2025-11-06 07:50:00+00:00) equity=0.998036
2025-11-06 07:55:00,836 INFO DECISION FLAT @ 3989.00 (ts=2025-11-06 07:55:00+00:00) equity=0.998036
2025-11-06 08:00:01,945 INFO DECISION FLAT @ 3991.91 (ts=2025-11-06 08:00:00+00:00) equity=0.998036
2025-11-06 08:00:01,946 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 08:00:00+00:00 price=3991.91 pos=0 equity=0.998036
2025-11-06 08:05:01,281 INFO DECISION FLAT @ 3997.34 (ts=2025-11-06 08:05:00+00:00) equity=0.998036
2025-11-06 08:10:00,759 INFO DECISION FLAT @ 3997.58 (ts=2025-11-06 08:10:00+00:00) equity=0.998036
2025-11-06 08:15:01,669 INFO DECISION FLAT @ 3998.50 (ts=2025-11-06 08:15:00+00:00) equity=0.998036
2025-11-06 08:15:01,670 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 08:15:00+00:00 price=3998.50 pos=0 equity=0.998036
2025-11-06 08:20:00,871 INFO DECISION LONG @ 4000.88 (ts=2025-11-06 08:20:00+00:00) equity=0.997874
2025-11-06 08:25:02,314 INFO DECISION LONG @ 4006.27 (ts=2025-11-06 08:25:00+00:00) equity=0.998018
2025-11-06 08:25:02,315 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 08:25:00+00:00 price=4006.27 pos=1 equity=0.998018
2025-11-06 08:30:01,567 INFO DECISION LONG @ 4004.17 (ts=2025-11-06 08:30:00+00:00) equity=0.998088
2025-11-06 08:35:01,098 INFO DECISION LONG @ 4005.52 (ts=2025-11-06 08:35:00+00:00) equity=0.998085
2025-11-06 08:40:00,346 INFO DECISION LONG @ 4008.58 (ts=2025-11-06 08:40:00+00:00) equity=0.998046
2025-11-06 08:40:00,347 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 08:40:00+00:00 price=4008.58 pos=1 equity=0.998046
2025-11-06 08:45:00,207 INFO DECISION LONG @ 4005.43 (ts=2025-11-06 08:45:00+00:00) equity=0.998041
2025-11-06 08:50:00,771 INFO DECISION LONG @ 4007.65 (ts=2025-11-06 08:50:00+00:00) equity=0.998058
2025-11-06 08:50:00,772 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 08:50:00+00:00 price=4007.65 pos=1 equity=0.998058
2025-11-06 08:55:00,497 INFO DECISION LONG @ 4006.10 (ts=2025-11-06 08:55:00+00:00) equity=0.998056
2025-11-06 09:00:02,117 INFO DECISION LONG @ 4005.47 (ts=2025-11-06 09:00:00+00:00) equity=0.997981
2025-11-06 09:00:02,118 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 09:00:00+00:00 price=4005.47 pos=1 equity=0.997981
2025-11-06 09:05:00,411 INFO DECISION FLAT @ 4007.13 (ts=2025-11-06 09:05:00+00:00) equity=0.997776
2025-11-06 09:10:00,366 INFO DECISION FLAT @ 4007.13 (ts=2025-11-06 09:10:00+00:00) equity=0.997776
2025-11-06 09:15:00,262 INFO DECISION FLAT @ 4009.08 (ts=2025-11-06 09:15:00+00:00) equity=0.997776
2025-11-06 09:15:00,263 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 09:15:00+00:00 price=4009.08 pos=0 equity=0.997776
2025-11-06 09:20:01,018 INFO DECISION SHORT @ 4010.72 (ts=2025-11-06 09:20:00+00:00) equity=0.997572
2025-11-06 09:25:01,035 INFO DECISION SHORT @ 4013.37 (ts=2025-11-06 09:25:00+00:00) equity=0.997570
2025-11-06 09:25:01,036 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 09:25:00+00:00 price=4013.37 pos=-1 equity=0.997570
2025-11-06 09:30:01,343 INFO DECISION SHORT @ 4015.96 (ts=2025-11-06 09:30:00+00:00) equity=0.997560
2025-11-06 09:35:01,098 INFO DECISION SHORT @ 4013.99 (ts=2025-11-06 09:35:00+00:00) equity=0.997562
2025-11-06 09:35:01,099 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 09:35:00+00:00 price=4013.99 pos=-1 equity=0.997562
2025-11-06 09:40:00,596 INFO DECISION SHORT @ 4013.70 (ts=2025-11-06 09:40:00+00:00) equity=0.997567
2025-11-06 09:45:00,926 INFO DECISION SHORT @ 4010.35 (ts=2025-11-06 09:45:00+00:00) equity=0.997527
2025-11-06 09:50:02,441 INFO DECISION SHORT @ 4011.61 (ts=2025-11-06 09:50:00+00:00) equity=0.997443
2025-11-06 09:50:02,442 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 09:50:00+00:00 price=4011.61 pos=-1 equity=0.997443
2025-11-06 09:55:02,033 INFO DECISION SHORT @ 4012.33 (ts=2025-11-06 09:55:00+00:00) equity=0.997478
2025-11-06 10:00:00,864 INFO DECISION SHORT @ 4014.86 (ts=2025-11-06 10:00:00+00:00) equity=0.997485
2025-11-06 10:05:01,386 INFO DECISION SHORT @ 4013.74 (ts=2025-11-06 10:05:00+00:00) equity=0.997411
2025-11-06 10:05:01,387 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 10:05:00+00:00 price=4013.74 pos=-1 equity=0.997411
2025-11-06 10:10:01,777 INFO DECISION SHORT @ 4012.71 (ts=2025-11-06 10:10:00+00:00) equity=0.997406
2025-11-06 10:15:01,666 INFO DECISION SHORT @ 4012.15 (ts=2025-11-06 10:15:00+00:00) equity=0.997396
2025-11-06 10:15:01,667 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 10:15:00+00:00 price=4012.15 pos=-1 equity=0.997396
2025-11-06 10:20:02,993 INFO DECISION SHORT @ 4012.10 (ts=2025-11-06 10:20:00+00:00) equity=0.997222
2025-11-06 10:25:02,190 INFO DECISION SHORT @ 4013.26 (ts=2025-11-06 10:25:00+00:00) equity=0.997227
2025-11-06 10:25:02,194 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 10:25:00+00:00 price=4013.26 pos=-1 equity=0.997227
2025-11-06 10:30:00,913 INFO DECISION SHORT @ 4012.71 (ts=2025-11-06 10:30:00+00:00) equity=0.997229
2025-11-06 10:35:01,140 INFO DECISION SHORT @ 4012.96 (ts=2025-11-06 10:35:00+00:00) equity=0.997239
2025-11-06 10:40:00,596 INFO DECISION SHORT @ 4012.18 (ts=2025-11-06 10:40:00+00:00) equity=0.997237
2025-11-06 10:40:00,596 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 10:40:00+00:00 price=4012.18 pos=-1 equity=0.997237
2025-11-06 10:45:01,030 INFO DECISION SHORT @ 4012.43 (ts=2025-11-06 10:45:00+00:00) equity=0.997214
2025-11-06 10:50:00,614 INFO DECISION SHORT @ 4011.76 (ts=2025-11-06 10:50:00+00:00) equity=0.997214
2025-11-06 10:50:00,615 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 10:50:00+00:00 price=4011.76 pos=-1 equity=0.997214
2025-11-06 10:55:00,907 INFO DECISION SHORT @ 4010.89 (ts=2025-11-06 10:55:00+00:00) equity=0.997212
2025-11-06 11:00:00,358 INFO DECISION SHORT @ 4010.96 (ts=2025-11-06 11:00:00+00:00) equity=0.997214
2025-11-06 11:05:02,156 INFO DECISION SHORT @ 4008.84 (ts=2025-11-06 11:05:00+00:00) equity=0.997142
2025-11-06 11:05:02,158 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 11:05:00+00:00 price=4008.84 pos=-1 equity=0.997142
2025-11-06 11:10:01,799 INFO DECISION SHORT @ 4006.81 (ts=2025-11-06 11:10:00+00:00) equity=0.997105
2025-11-06 11:15:01,601 INFO DECISION SHORT @ 4008.79 (ts=2025-11-06 11:15:00+00:00) equity=0.997100
2025-11-06 11:20:02,083 INFO DECISION SHORT @ 4008.19 (ts=2025-11-06 11:20:00+00:00) equity=0.997025
2025-11-06 11:20:02,084 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 11:20:00+00:00 price=4008.19 pos=-1 equity=0.997025
2025-11-06 11:25:02,196 INFO DECISION SHORT @ 4006.00 (ts=2025-11-06 11:25:00+00:00) equity=0.997013
2025-11-06 11:30:01,028 INFO DECISION SHORT @ 4005.69 (ts=2025-11-06 11:30:00+00:00) equity=0.997117
2025-11-06 11:35:02,293 INFO DECISION SHORT @ 4005.37 (ts=2025-11-06 11:35:00+00:00) equity=0.997112
2025-11-06 11:35:02,294 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 11:35:00+00:00 price=4005.37 pos=-1 equity=0.997112
2025-11-06 11:40:02,603 INFO DECISION SHORT @ 4005.76 (ts=2025-11-06 11:40:00+00:00) equity=0.997135
2025-11-06 11:45:00,629 INFO DECISION SHORT @ 4007.96 (ts=2025-11-06 11:45:00+00:00) equity=0.997137
2025-11-06 11:50:00,935 INFO DECISION SHORT @ 4006.48 (ts=2025-11-06 11:50:00+00:00) equity=0.997105
2025-11-06 11:50:00,936 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 11:50:00+00:00 price=4006.48 pos=-1 equity=0.997105
2025-11-06 11:55:01,763 INFO DECISION SHORT @ 4008.95 (ts=2025-11-06 11:55:00+00:00) equity=0.997035
2025-11-06 12:00:01,573 INFO DECISION SHORT @ 4008.31 (ts=2025-11-06 12:00:00+00:00) equity=0.997085
2025-11-06 12:00:01,575 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 12:00:00+00:00 price=4008.31 pos=-1 equity=0.997085
2025-11-06 12:05:01,256 INFO DECISION SHORT @ 4009.59 (ts=2025-11-06 12:05:00+00:00) equity=0.997140
2025-11-06 12:10:01,742 INFO DECISION SHORT @ 4008.43 (ts=2025-11-06 12:10:00+00:00) equity=0.997137
2025-11-06 12:10:01,743 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 12:10:00+00:00 price=4008.43 pos=-1 equity=0.997137
2025-11-06 12:15:01,270 INFO DECISION SHORT @ 4009.94 (ts=2025-11-06 12:15:00+00:00) equity=0.997125
2025-11-06 12:20:02,767 INFO DECISION SHORT @ 4008.80 (ts=2025-11-06 12:20:00+00:00) equity=0.997149
2025-11-06 12:20:02,767 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 12:20:00+00:00 price=4008.80 pos=-1 equity=0.997149
2025-11-06 12:25:00,319 INFO DECISION SHORT @ 4007.56 (ts=2025-11-06 12:25:00+00:00) equity=0.997154
2025-11-06 12:30:00,447 INFO DECISION SHORT @ 4009.50 (ts=2025-11-06 12:30:00+00:00) equity=0.997169
2025-11-06 12:35:00,511 INFO DECISION SHORT @ 4012.30 (ts=2025-11-06 12:35:00+00:00) equity=0.997169
2025-11-06 12:35:00,512 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 12:35:00+00:00 price=4012.30 pos=-1 equity=0.997169
2025-11-06 12:40:00,826 INFO DECISION SHORT @ 4016.11 (ts=2025-11-06 12:40:00+00:00) equity=0.997152
2025-11-06 12:45:01,098 INFO DECISION SHORT @ 4016.01 (ts=2025-11-06 12:45:00+00:00) equity=0.997127
2025-11-06 12:45:01,099 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 12:45:00+00:00 price=4016.01 pos=-1 equity=0.997127
2025-11-06 12:50:00,946 INFO DECISION SHORT @ 4015.40 (ts=2025-11-06 12:50:00+00:00) equity=0.997107
2025-11-06 12:55:00,536 INFO DECISION SHORT @ 4017.41 (ts=2025-11-06 12:55:00+00:00) equity=0.997102
2025-11-06 13:00:01,593 INFO DECISION SHORT @ 4018.41 (ts=2025-11-06 13:00:00+00:00) equity=0.997035
2025-11-06 13:00:01,594 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 13:00:00+00:00 price=4018.41 pos=-1 equity=0.997035
2025-11-06 13:05:01,543 INFO DECISION SHORT @ 4015.15 (ts=2025-11-06 13:05:00+00:00) equity=0.997008
2025-11-06 13:10:02,883 INFO DECISION SHORT @ 4013.39 (ts=2025-11-06 13:10:00+00:00) equity=0.997006
2025-11-06 13:10:02,884 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 13:10:00+00:00 price=4013.39 pos=-1 equity=0.997006
2025-11-06 13:15:00,227 INFO DECISION SHORT @ 4012.82 (ts=2025-11-06 13:15:00+00:00) equity=0.997010
2025-11-06 13:20:01,684 INFO DECISION SHORT @ 4013.95 (ts=2025-11-06 13:20:00+00:00) equity=0.997008
2025-11-06 13:25:00,415 INFO DECISION SHORT @ 4012.76 (ts=2025-11-06 13:25:00+00:00) equity=0.996991
2025-11-06 13:25:00,416 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 13:25:00+00:00 price=4012.76 pos=-1 equity=0.996991
2025-11-06 13:30:01,927 INFO DECISION SHORT @ 4012.45 (ts=2025-11-06 13:30:00+00:00) equity=0.996784
2025-11-06 13:35:00,940 INFO DECISION SHORT @ 4011.33 (ts=2025-11-06 13:35:00+00:00) equity=0.996782
2025-11-06 13:35:00,941 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 13:35:00+00:00 price=4011.33 pos=-1 equity=0.996782
2025-11-06 13:40:01,965 INFO DECISION SHORT @ 4008.66 (ts=2025-11-06 13:40:00+00:00) equity=0.996759
2025-11-06 13:45:00,749 INFO DECISION SHORT @ 4009.20 (ts=2025-11-06 13:45:00+00:00) equity=0.996754
2025-11-06 13:50:01,771 INFO DECISION SHORT @ 4007.72 (ts=2025-11-06 13:50:00+00:00) equity=0.996774
2025-11-06 13:50:01,772 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 13:50:00+00:00 price=4007.72 pos=-1 equity=0.996774
2025-11-06 13:55:01,016 INFO DECISION SHORT @ 4005.68 (ts=2025-11-06 13:55:00+00:00) equity=0.996777
2025-11-06 14:00:00,273 INFO DECISION FLAT @ 4005.43 (ts=2025-11-06 14:00:00+00:00) equity=0.996573
2025-11-06 14:05:01,414 INFO DECISION FLAT @ 4007.09 (ts=2025-11-06 14:05:00+00:00) equity=0.996573
2025-11-06 14:05:01,415 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 14:05:00+00:00 price=4007.09 pos=0 equity=0.996573
2025-11-06 14:10:00,437 INFO DECISION FLAT @ 4010.43 (ts=2025-11-06 14:10:00+00:00) equity=0.996573
2025-11-06 14:15:01,518 INFO DECISION SHORT @ 4012.10 (ts=2025-11-06 14:15:00+00:00) equity=0.996341
2025-11-06 14:15:01,519 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 14:15:00+00:00 price=4012.10 pos=-1 equity=0.996341
2025-11-06 14:20:00,398 INFO DECISION SHORT @ 4013.43 (ts=2025-11-06 14:20:00+00:00) equity=0.996217
2025-11-06 14:25:01,347 INFO DECISION SHORT @ 4013.96 (ts=2025-11-06 14:25:00+00:00) equity=0.996101
2025-11-06 14:30:00,290 INFO DECISION SHORT @ 4013.57 (ts=2025-11-06 14:30:00+00:00) equity=0.996101
2025-11-06 14:30:00,290 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 14:30:00+00:00 price=4013.57 pos=-1 equity=0.996101
2025-11-06 14:35:01,135 INFO DECISION SHORT @ 4013.61 (ts=2025-11-06 14:35:00+00:00) equity=0.996031
2025-11-06 14:40:02,249 INFO DECISION SHORT @ 4014.21 (ts=2025-11-06 14:40:00+00:00) equity=0.996029
2025-11-06 14:40:02,249 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 14:40:00+00:00 price=4014.21 pos=-1 equity=0.996029
2025-11-06 14:45:01,208 INFO DECISION SHORT @ 4013.33 (ts=2025-11-06 14:45:00+00:00) equity=0.996145
2025-11-06 14:50:02,031 INFO DECISION FLAT @ 4015.55 (ts=2025-11-06 14:50:00+00:00) equity=0.995941
2025-11-06 14:55:01,161 INFO DECISION FLAT @ 4014.02 (ts=2025-11-06 14:55:00+00:00) equity=0.995941
2025-11-06 14:55:01,162 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 14:55:00+00:00 price=4014.02 pos=0 equity=0.995941
2025-11-06 15:00:00,456 INFO DECISION FLAT @ 4012.33 (ts=2025-11-06 15:00:00+00:00) equity=0.995941
2025-11-06 15:05:00,262 INFO DECISION LONG @ 4008.22 (ts=2025-11-06 15:05:00+00:00) equity=0.995715
2025-11-06 15:10:01,392 INFO DECISION FLAT @ 4009.30 (ts=2025-11-06 15:10:00+00:00) equity=0.995511
2025-11-06 15:10:01,394 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 15:10:00+00:00 price=4009.30 pos=0 equity=0.995511
2025-11-06 15:15:00,511 INFO DECISION FLAT @ 4008.34 (ts=2025-11-06 15:15:00+00:00) equity=0.995511
2025-11-06 15:20:00,352 INFO DECISION FLAT @ 4002.21 (ts=2025-11-06 15:20:00+00:00) equity=0.995511
2025-11-06 15:25:01,567 INFO DECISION FLAT @ 3994.41 (ts=2025-11-06 15:25:00+00:00) equity=0.995511
2025-11-06 15:25:01,568 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 15:25:00+00:00 price=3994.41 pos=0 equity=0.995511
2025-11-06 15:30:00,940 INFO DECISION FLAT @ 3991.02 (ts=2025-11-06 15:30:00+00:00) equity=0.995511
2025-11-06 15:35:00,361 INFO DECISION FLAT @ 3999.92 (ts=2025-11-06 15:35:00+00:00) equity=0.995511
2025-11-06 15:40:01,417 INFO DECISION FLAT @ 3999.93 (ts=2025-11-06 15:40:00+00:00) equity=0.995511
2025-11-06 15:40:01,418 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 15:40:00+00:00 price=3999.93 pos=0 equity=0.995511
2025-11-06 15:45:00,203 INFO DECISION FLAT @ 3998.49 (ts=2025-11-06 15:45:00+00:00) equity=0.995511
2025-11-06 15:50:01,061 INFO DECISION FLAT @ 3998.83 (ts=2025-11-06 15:50:00+00:00) equity=0.995511
2025-11-06 15:55:00,796 INFO DECISION FLAT @ 3995.75 (ts=2025-11-06 15:55:00+00:00) equity=0.995511
2025-11-06 15:55:00,797 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 15:55:00+00:00 price=3995.75 pos=0 equity=0.995511
2025-11-06 16:00:01,857 INFO DECISION FLAT @ 3992.53 (ts=2025-11-06 16:00:00+00:00) equity=0.995511
2025-11-06 16:05:01,031 INFO DECISION FLAT @ 3979.37 (ts=2025-11-06 16:05:00+00:00) equity=0.995511
2025-11-06 16:05:01,033 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 16:05:00+00:00 price=3979.37 pos=0 equity=0.995511
2025-11-06 16:10:00,251 INFO DECISION LONG @ 3982.08 (ts=2025-11-06 16:10:00+00:00) equity=0.995194
2025-11-06 16:15:01,268 INFO DECISION LONG @ 3982.97 (ts=2025-11-06 16:15:00+00:00) equity=0.995267
2025-11-06 16:15:01,268 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 16:15:00+00:00 price=3982.97 pos=1 equity=0.995267
2025-11-06 16:20:01,056 INFO DECISION FLAT @ 3988.02 (ts=2025-11-06 16:20:00+00:00) equity=0.995062
2025-11-06 16:25:01,827 INFO DECISION SHORT @ 3990.02 (ts=2025-11-06 16:25:00+00:00) equity=0.994813
2025-11-06 16:25:01,827 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 16:25:00+00:00 price=3990.02 pos=-1 equity=0.994813
2025-11-06 16:30:01,386 INFO DECISION FLAT @ 3987.10 (ts=2025-11-06 16:30:00+00:00) equity=0.994609
2025-11-06 16:35:00,589 INFO DECISION LONG @ 3981.84 (ts=2025-11-06 16:35:00+00:00) equity=0.994372
2025-11-06 16:40:01,544 INFO DECISION LONG @ 3979.58 (ts=2025-11-06 16:40:00+00:00) equity=0.994370
2025-11-06 16:40:01,544 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 16:40:00+00:00 price=3979.58 pos=1 equity=0.994370
2025-11-06 16:45:00,580 INFO DECISION LONG @ 3978.69 (ts=2025-11-06 16:45:00+00:00) equity=0.994427
2025-11-06 16:50:01,709 INFO DECISION LONG @ 3980.28 (ts=2025-11-06 16:50:00+00:00) equity=0.994335
2025-11-06 16:50:01,710 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 16:50:00+00:00 price=3980.28 pos=1 equity=0.994335
2025-11-06 16:55:01,066 INFO DECISION LONG @ 3981.51 (ts=2025-11-06 16:55:00+00:00) equity=0.994332
2025-11-06 17:00:00,456 INFO DECISION LONG @ 3980.46 (ts=2025-11-06 17:00:00+00:00) equity=0.994350
2025-11-06 17:05:01,714 INFO DECISION LONG @ 3984.49 (ts=2025-11-06 17:05:00+00:00) equity=0.994332
2025-11-06 17:05:01,716 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 17:05:00+00:00 price=3984.49 pos=1 equity=0.994332
2025-11-06 17:10:00,904 INFO DECISION FLAT @ 3985.64 (ts=2025-11-06 17:10:00+00:00) equity=0.994128
2025-11-06 17:15:01,941 INFO DECISION FLAT @ 3981.72 (ts=2025-11-06 17:15:00+00:00) equity=0.994128
2025-11-06 17:15:01,943 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 17:15:00+00:00 price=3981.72 pos=0 equity=0.994128
2025-11-06 17:20:01,381 INFO DECISION FLAT @ 3978.58 (ts=2025-11-06 17:20:00+00:00) equity=0.994128
2025-11-06 17:25:00,387 INFO DECISION FLAT @ 3979.89 (ts=2025-11-06 17:25:00+00:00) equity=0.994128
2025-11-06 17:30:01,345 INFO DECISION FLAT @ 3984.00 (ts=2025-11-06 17:30:00+00:00) equity=0.994128
2025-11-06 17:30:01,346 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 17:30:00+00:00 price=3984.00 pos=0 equity=0.994128
2025-11-06 17:35:00,831 INFO DECISION SHORT @ 3979.55 (ts=2025-11-06 17:35:00+00:00) equity=0.993601
2025-11-06 17:40:01,770 INFO DECISION SHORT @ 3980.73 (ts=2025-11-06 17:40:00+00:00) equity=0.993454
2025-11-06 17:40:01,770 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 17:40:00+00:00 price=3980.73 pos=-1 equity=0.993454
2025-11-06 17:45:00,719 INFO DECISION SHORT @ 3979.21 (ts=2025-11-06 17:45:00+00:00) equity=0.993484
2025-11-06 17:50:01,637 INFO DECISION SHORT @ 3979.52 (ts=2025-11-06 17:50:00+00:00) equity=0.993467
2025-11-06 17:55:00,620 INFO DECISION SHORT @ 3981.75 (ts=2025-11-06 17:55:00+00:00) equity=0.993509
2025-11-06 17:55:00,621 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 17:55:00+00:00 price=3981.75 pos=-1 equity=0.993509
2025-11-06 18:00:01,694 INFO DECISION SHORT @ 3981.63 (ts=2025-11-06 18:00:00+00:00) equity=0.993354
2025-11-06 18:05:00,510 INFO DECISION SHORT @ 3984.43 (ts=2025-11-06 18:05:00+00:00) equity=0.993357
2025-11-06 18:10:01,862 INFO DECISION SHORT @ 3983.61 (ts=2025-11-06 18:10:00+00:00) equity=0.993369
2025-11-06 18:10:01,864 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 18:10:00+00:00 price=3983.61 pos=-1 equity=0.993369
2025-11-06 18:15:00,644 INFO DECISION SHORT @ 3978.50 (ts=2025-11-06 18:15:00+00:00) equity=0.993464
2025-11-06 18:20:00,320 INFO DECISION SHORT @ 3977.80 (ts=2025-11-06 18:20:00+00:00) equity=0.993492
2025-11-06 18:25:01,300 INFO DECISION LONG @ 3967.51 (ts=2025-11-06 18:25:00+00:00) equity=0.993057
2025-11-06 18:25:01,304 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 18:25:00+00:00 price=3967.51 pos=1 equity=0.993057
2025-11-06 18:30:00,450 INFO DECISION LONG @ 3969.90 (ts=2025-11-06 18:30:00+00:00) equity=0.993060
2025-11-06 18:35:01,301 INFO DECISION LONG @ 3972.41 (ts=2025-11-06 18:35:00+00:00) equity=0.993037
2025-11-06 18:40:00,272 INFO DECISION SHORT @ 3975.17 (ts=2025-11-06 18:40:00+00:00) equity=0.992657
2025-11-06 18:40:00,273 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 18:40:00+00:00 price=3975.17 pos=-1 equity=0.992657
2025-11-06 18:45:01,087 INFO DECISION SHORT @ 3981.97 (ts=2025-11-06 18:45:00+00:00) equity=0.992657
2025-11-06 18:50:02,062 INFO DECISION SHORT @ 3985.07 (ts=2025-11-06 18:50:00+00:00) equity=0.992584
2025-11-06 18:50:02,063 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 18:50:00+00:00 price=3985.07 pos=-1 equity=0.992584
2025-11-06 18:55:00,873 INFO DECISION SHORT @ 3986.07 (ts=2025-11-06 18:55:00+00:00) equity=0.992594
2025-11-06 19:00:02,322 INFO DECISION SHORT @ 3986.11 (ts=2025-11-06 19:00:00+00:00) equity=0.992659
2025-11-06 19:00:02,323 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 19:00:00+00:00 price=3986.11 pos=-1 equity=0.992659
2025-11-06 19:05:01,529 INFO DECISION SHORT @ 3982.66 (ts=2025-11-06 19:05:00+00:00) equity=0.992671
2025-11-06 19:10:00,357 INFO DECISION SHORT @ 3982.44 (ts=2025-11-06 19:10:00+00:00) equity=0.992654
2025-11-06 19:15:00,994 INFO DECISION FLAT @ 3984.05 (ts=2025-11-06 19:15:00+00:00) equity=0.992450
2025-11-06 19:15:00,995 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 19:15:00+00:00 price=3984.05 pos=0 equity=0.992450
2025-11-06 19:20:01,764 INFO DECISION FLAT @ 3985.24 (ts=2025-11-06 19:20:00+00:00) equity=0.992450
2025-11-06 19:25:00,403 INFO DECISION FLAT @ 3988.11 (ts=2025-11-06 19:25:00+00:00) equity=0.992450
2025-11-06 19:30:01,186 INFO DECISION FLAT @ 3983.82 (ts=2025-11-06 19:30:00+00:00) equity=0.992450
2025-11-06 19:30:01,187 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 19:30:00+00:00 price=3983.82 pos=0 equity=0.992450
2025-11-06 19:35:02,163 INFO DECISION FLAT @ 3987.47 (ts=2025-11-06 19:35:00+00:00) equity=0.992450
2025-11-06 19:40:00,806 INFO DECISION FLAT @ 3989.41 (ts=2025-11-06 19:40:00+00:00) equity=0.992450
2025-11-06 19:45:01,620 INFO DECISION FLAT @ 3989.35 (ts=2025-11-06 19:45:00+00:00) equity=0.992450
2025-11-06 19:45:01,621 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 19:45:00+00:00 price=3989.35 pos=0 equity=0.992450
2025-11-06 19:50:00,404 INFO DECISION SHORT @ 3989.08 (ts=2025-11-06 19:50:00+00:00) equity=0.992209
2025-11-06 19:55:01,261 INFO DECISION SHORT @ 3988.13 (ts=2025-11-06 19:55:00+00:00) equity=0.992254
2025-11-06 20:00:00,262 INFO DECISION SHORT @ 3987.87 (ts=2025-11-06 20:00:00+00:00) equity=0.992236
2025-11-06 20:00:00,264 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 20:00:00+00:00 price=3987.87 pos=-1 equity=0.992236
2025-11-06 20:05:01,140 INFO DECISION FLAT @ 3988.67 (ts=2025-11-06 20:05:00+00:00) equity=0.992033
2025-11-06 20:10:01,897 INFO DECISION FLAT @ 3990.75 (ts=2025-11-06 20:10:00+00:00) equity=0.992033
2025-11-06 20:10:01,898 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 20:10:00+00:00 price=3990.75 pos=0 equity=0.992033
2025-11-06 20:15:00,729 INFO DECISION FLAT @ 3995.20 (ts=2025-11-06 20:15:00+00:00) equity=0.992033
2025-11-06 20:20:01,464 INFO DECISION FLAT @ 3993.84 (ts=2025-11-06 20:20:00+00:00) equity=0.992033
2025-11-06 20:25:02,300 INFO DECISION FLAT @ 3993.64 (ts=2025-11-06 20:25:00+00:00) equity=0.992033
2025-11-06 20:25:02,301 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 20:25:00+00:00 price=3993.64 pos=0 equity=0.992033
2025-11-06 20:30:00,991 INFO DECISION FLAT @ 3992.46 (ts=2025-11-06 20:30:00+00:00) equity=0.992033
2025-11-06 20:35:01,771 INFO DECISION FLAT @ 3991.05 (ts=2025-11-06 20:35:00+00:00) equity=0.992033
2025-11-06 20:40:00,369 INFO DECISION FLAT @ 3991.34 (ts=2025-11-06 20:40:00+00:00) equity=0.992033
2025-11-06 20:40:00,370 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 20:40:00+00:00 price=3991.34 pos=0 equity=0.992033
2025-11-06 20:45:01,415 INFO DECISION FLAT @ 3989.64 (ts=2025-11-06 20:45:00+00:00) equity=0.992033
2025-11-06 20:50:00,223 INFO DECISION FLAT @ 3985.50 (ts=2025-11-06 20:50:00+00:00) equity=0.992033
2025-11-06 20:55:01,429 INFO DECISION FLAT @ 3985.46 (ts=2025-11-06 20:55:00+00:00) equity=0.992033
2025-11-06 20:55:01,430 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 20:55:00+00:00 price=3985.46 pos=0 equity=0.992033
2025-11-06 21:00:00,469 INFO DECISION FLAT @ 3985.23 (ts=2025-11-06 21:00:00+00:00) equity=0.992033
2025-11-06 21:05:02,197 INFO DECISION FLAT @ 3985.75 (ts=2025-11-06 21:05:00+00:00) equity=0.992033
2025-11-06 21:05:02,203 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 21:05:00+00:00 price=3985.75 pos=0 equity=0.992033
2025-11-06 21:10:01,335 INFO DECISION FLAT @ 3986.77 (ts=2025-11-06 21:10:00+00:00) equity=0.992033
2025-11-06 21:15:00,466 INFO DECISION FLAT @ 3984.61 (ts=2025-11-06 21:15:00+00:00) equity=0.992033
2025-11-06 21:20:01,762 INFO DECISION FLAT @ 3983.85 (ts=2025-11-06 21:20:00+00:00) equity=0.992033
2025-11-06 21:20:01,764 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 21:20:00+00:00 price=3983.85 pos=0 equity=0.992033
2025-11-06 21:25:02,136 INFO DECISION FLAT @ 3983.86 (ts=2025-11-06 21:25:00+00:00) equity=0.992033
2025-11-06 21:30:01,718 INFO DECISION FLAT @ 3982.77 (ts=2025-11-06 21:30:00+00:00) equity=0.992033
2025-11-06 21:35:01,296 INFO DECISION FLAT @ 3986.37 (ts=2025-11-06 21:35:00+00:00) equity=0.992033
2025-11-06 21:35:01,297 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 21:35:00+00:00 price=3986.37 pos=0 equity=0.992033
2025-11-06 21:40:00,771 INFO DECISION FLAT @ 3984.02 (ts=2025-11-06 21:40:00+00:00) equity=0.992033
2025-11-06 21:45:00,451 INFO DECISION FLAT @ 3984.00 (ts=2025-11-06 21:45:00+00:00) equity=0.992033
2025-11-06 21:50:01,751 INFO DECISION FLAT @ 3982.23 (ts=2025-11-06 21:50:00+00:00) equity=0.992033
2025-11-06 21:50:01,753 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 21:50:00+00:00 price=3982.23 pos=0 equity=0.992033
2025-11-06 21:55:01,836 INFO DECISION FLAT @ 3981.08 (ts=2025-11-06 21:55:00+00:00) equity=0.992033
2025-11-06 22:00:01,135 INFO DECISION FLAT @ 3980.28 (ts=2025-11-06 22:00:00+00:00) equity=0.992033
2025-11-06 22:05:02,209 INFO DECISION FLAT @ 3980.61 (ts=2025-11-06 22:05:00+00:00) equity=0.992033
2025-11-06 22:05:02,211 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 22:05:00+00:00 price=3980.61 pos=0 equity=0.992033
2025-11-06 22:10:02,944 INFO DECISION FLAT @ 3980.49 (ts=2025-11-06 22:10:00+00:00) equity=0.992033
2025-11-06 22:15:01,794 INFO DECISION FLAT @ 3981.32 (ts=2025-11-06 22:15:00+00:00) equity=0.992033
2025-11-06 22:20:00,586 INFO DECISION FLAT @ 3979.85 (ts=2025-11-06 22:20:00+00:00) equity=0.992033
2025-11-06 22:20:00,587 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 22:20:00+00:00 price=3979.85 pos=0 equity=0.992033
2025-11-06 22:25:01,574 INFO DECISION FLAT @ 3979.92 (ts=2025-11-06 22:25:00+00:00) equity=0.992033
2025-11-06 22:30:02,259 INFO DECISION FLAT @ 3980.64 (ts=2025-11-06 22:30:00+00:00) equity=0.992033
2025-11-06 22:30:02,263 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 22:30:00+00:00 price=3980.64 pos=0 equity=0.992033
2025-11-06 22:35:01,167 INFO DECISION FLAT @ 3979.12 (ts=2025-11-06 22:35:00+00:00) equity=0.992033
2025-11-06 22:40:01,885 INFO DECISION FLAT @ 3979.12 (ts=2025-11-06 22:40:00+00:00) equity=0.992033
2025-11-06 22:45:00,515 INFO DECISION FLAT @ 3979.06 (ts=2025-11-06 22:45:00+00:00) equity=0.992033
2025-11-06 22:45:00,516 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 22:45:00+00:00 price=3979.06 pos=0 equity=0.992033
2025-11-06 22:50:01,258 INFO DECISION FLAT @ 3978.00 (ts=2025-11-06 22:50:00+00:00) equity=0.992033
2025-11-06 22:55:00,729 INFO DECISION FLAT @ 3977.65 (ts=2025-11-06 22:55:00+00:00) equity=0.992033
2025-11-06 22:55:00,729 INFO [HB] GOLD.pro M5 last_ts=2025-11-06 22:55:00+00:00 price=3977.65 pos=0 equity=0.992033
2025-11-07 00:05:01,785 INFO DECISION FLAT @ 3979.26 (ts=2025-11-07 00:05:00+00:00) equity=0.992033
2025-11-07 00:05:01,786 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 00:05:00+00:00 price=3979.26 pos=0 equity=0.992033
2025-11-07 00:10:00,665 INFO DECISION FLAT @ 3981.55 (ts=2025-11-07 00:10:00+00:00) equity=0.992033
2025-11-07 00:15:01,368 INFO DECISION FLAT @ 3981.34 (ts=2025-11-07 00:15:00+00:00) equity=0.992033
2025-11-07 00:20:02,008 INFO DECISION FLAT @ 3984.21 (ts=2025-11-07 00:20:00+00:00) equity=0.992033
2025-11-07 00:20:02,008 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 00:20:00+00:00 price=3984.21 pos=0 equity=0.992033
2025-11-07 00:25:00,507 INFO DECISION FLAT @ 3985.01 (ts=2025-11-07 00:25:00+00:00) equity=0.992033
2025-11-07 00:30:01,192 INFO DECISION FLAT @ 3983.71 (ts=2025-11-07 00:30:00+00:00) equity=0.992033
2025-11-07 00:35:01,840 INFO DECISION FLAT @ 3983.92 (ts=2025-11-07 00:35:00+00:00) equity=0.992033
2025-11-07 00:35:01,841 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 00:35:00+00:00 price=3983.92 pos=0 equity=0.992033
2025-11-07 00:40:00,445 INFO DECISION FLAT @ 3986.33 (ts=2025-11-07 00:40:00+00:00) equity=0.992033
2025-11-07 00:45:02,992 INFO DECISION FLAT @ 3986.27 (ts=2025-11-07 00:45:00+00:00) equity=0.992033
2025-11-07 00:45:02,993 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 00:45:00+00:00 price=3986.27 pos=0 equity=0.992033
2025-11-07 00:50:01,622 INFO DECISION FLAT @ 3988.49 (ts=2025-11-07 00:50:00+00:00) equity=0.992033
2025-11-07 00:55:00,392 INFO DECISION FLAT @ 3989.67 (ts=2025-11-07 00:55:00+00:00) equity=0.992033
2025-11-07 01:00:01,239 INFO DECISION FLAT @ 3989.37 (ts=2025-11-07 01:00:00+00:00) equity=0.992033
2025-11-07 01:00:01,240 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 01:00:00+00:00 price=3989.37 pos=0 equity=0.992033
2025-11-07 01:05:01,839 INFO DECISION FLAT @ 3987.44 (ts=2025-11-07 01:05:00+00:00) equity=0.992033
2025-11-07 01:10:02,715 INFO DECISION FLAT @ 3986.12 (ts=2025-11-07 01:10:00+00:00) equity=0.992033
2025-11-07 01:10:02,717 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 01:10:00+00:00 price=3986.12 pos=0 equity=0.992033
2025-11-07 01:15:01,261 INFO DECISION FLAT @ 3987.41 (ts=2025-11-07 01:15:00+00:00) equity=0.992033
2025-11-07 01:20:02,132 INFO DECISION FLAT @ 3990.67 (ts=2025-11-07 01:20:00+00:00) equity=0.992033
2025-11-07 01:25:00,725 INFO DECISION FLAT @ 3991.54 (ts=2025-11-07 01:25:00+00:00) equity=0.992033
2025-11-07 01:25:00,726 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 01:25:00+00:00 price=3991.54 pos=0 equity=0.992033
2025-11-07 01:30:01,609 INFO DECISION FLAT @ 3991.78 (ts=2025-11-07 01:30:00+00:00) equity=0.992033
2025-11-07 01:35:00,314 INFO DECISION FLAT @ 3992.69 (ts=2025-11-07 01:35:00+00:00) equity=0.992033
2025-11-07 01:40:01,017 INFO DECISION FLAT @ 3990.21 (ts=2025-11-07 01:40:00+00:00) equity=0.992033
2025-11-07 01:40:01,018 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 01:40:00+00:00 price=3990.21 pos=0 equity=0.992033
2025-11-07 01:45:01,765 INFO DECISION FLAT @ 3991.44 (ts=2025-11-07 01:45:00+00:00) equity=0.992033
2025-11-07 01:50:00,574 INFO DECISION FLAT @ 3990.52 (ts=2025-11-07 01:50:00+00:00) equity=0.992033
2025-11-07 01:55:01,418 INFO DECISION FLAT @ 3988.58 (ts=2025-11-07 01:55:00+00:00) equity=0.992033
2025-11-07 01:55:01,419 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 01:55:00+00:00 price=3988.58 pos=0 equity=0.992033
2025-11-07 02:00:02,173 INFO DECISION FLAT @ 3988.13 (ts=2025-11-07 02:00:00+00:00) equity=0.992033
2025-11-07 02:05:01,071 INFO DECISION FLAT @ 3993.63 (ts=2025-11-07 02:05:00+00:00) equity=0.992033
2025-11-07 02:10:00,742 INFO DECISION FLAT @ 3996.41 (ts=2025-11-07 02:10:00+00:00) equity=0.992033
2025-11-07 02:10:00,743 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 02:10:00+00:00 price=3996.41 pos=0 equity=0.992033
2025-11-07 02:15:01,483 INFO DECISION FLAT @ 3999.26 (ts=2025-11-07 02:15:00+00:00) equity=0.992033
2025-11-07 02:20:00,264 INFO DECISION FLAT @ 3999.81 (ts=2025-11-07 02:20:00+00:00) equity=0.992033
2025-11-07 02:25:01,027 INFO DECISION FLAT @ 3999.13 (ts=2025-11-07 02:25:00+00:00) equity=0.992033
2025-11-07 02:25:01,028 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 02:25:00+00:00 price=3999.13 pos=0 equity=0.992033
2025-11-07 02:30:00,250 INFO DECISION FLAT @ 3997.68 (ts=2025-11-07 02:30:00+00:00) equity=0.992033
2025-11-07 02:35:00,927 INFO DECISION FLAT @ 3996.21 (ts=2025-11-07 02:35:00+00:00) equity=0.992033
2025-11-07 02:40:00,158 INFO DECISION FLAT @ 3997.79 (ts=2025-11-07 02:40:00+00:00) equity=0.992033
2025-11-07 02:40:00,159 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 02:40:00+00:00 price=3997.79 pos=0 equity=0.992033
2025-11-07 02:45:00,862 INFO DECISION FLAT @ 4002.13 (ts=2025-11-07 02:45:00+00:00) equity=0.992033
2025-11-07 02:50:01,820 INFO DECISION FLAT @ 4000.05 (ts=2025-11-07 02:50:00+00:00) equity=0.992033
2025-11-07 02:50:01,821 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 02:50:00+00:00 price=4000.05 pos=0 equity=0.992033
2025-11-07 02:55:01,031 INFO DECISION FLAT @ 4002.71 (ts=2025-11-07 02:55:00+00:00) equity=0.992033
2025-11-07 03:00:01,885 INFO DECISION FLAT @ 4001.96 (ts=2025-11-07 03:00:00+00:00) equity=0.992033
2025-11-07 03:00:01,886 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 03:00:00+00:00 price=4001.96 pos=0 equity=0.992033
2025-11-07 03:05:02,800 INFO DECISION FLAT @ 4001.81 (ts=2025-11-07 03:05:00+00:00) equity=0.992033
2025-11-07 03:10:01,822 INFO DECISION FLAT @ 4002.14 (ts=2025-11-07 03:10:00+00:00) equity=0.992033
2025-11-07 03:15:00,560 INFO DECISION FLAT @ 3998.03 (ts=2025-11-07 03:15:00+00:00) equity=0.992033
2025-11-07 03:15:00,560 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 03:15:00+00:00 price=3998.03 pos=0 equity=0.992033
2025-11-07 03:20:01,579 INFO DECISION FLAT @ 3995.80 (ts=2025-11-07 03:20:00+00:00) equity=0.992033
2025-11-07 03:25:00,407 INFO DECISION FLAT @ 3996.51 (ts=2025-11-07 03:25:00+00:00) equity=0.992033
2025-11-07 03:30:01,742 INFO DECISION FLAT @ 3995.81 (ts=2025-11-07 03:30:00+00:00) equity=0.992033
2025-11-07 03:30:01,743 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 03:30:00+00:00 price=3995.81 pos=0 equity=0.992033
2025-11-07 03:35:00,802 INFO DECISION FLAT @ 3993.84 (ts=2025-11-07 03:35:00+00:00) equity=0.992033
2025-11-07 03:40:01,532 INFO DECISION FLAT @ 3998.41 (ts=2025-11-07 03:40:00+00:00) equity=0.992033
2025-11-07 03:45:00,158 INFO DECISION FLAT @ 3992.97 (ts=2025-11-07 03:45:00+00:00) equity=0.992033
2025-11-07 03:45:00,159 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 03:45:00+00:00 price=3992.97 pos=0 equity=0.992033
2025-11-07 03:50:01,003 INFO DECISION FLAT @ 3994.66 (ts=2025-11-07 03:50:00+00:00) equity=0.992033
2025-11-07 03:55:01,871 INFO DECISION FLAT @ 3997.48 (ts=2025-11-07 03:55:00+00:00) equity=0.992033
2025-11-07 03:55:01,873 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 03:55:00+00:00 price=3997.48 pos=0 equity=0.992033
2025-11-07 04:00:01,078 INFO DECISION FLAT @ 3995.28 (ts=2025-11-07 04:00:00+00:00) equity=0.992033
2025-11-07 04:05:02,351 INFO DECISION FLAT @ 3991.96 (ts=2025-11-07 04:05:00+00:00) equity=0.992033
2025-11-07 04:05:02,353 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 04:05:00+00:00 price=3991.96 pos=0 equity=0.992033
2025-11-07 04:10:01,170 INFO DECISION FLAT @ 3989.24 (ts=2025-11-07 04:10:00+00:00) equity=0.992033
2025-11-07 04:15:01,960 INFO DECISION FLAT @ 3991.24 (ts=2025-11-07 04:15:00+00:00) equity=0.992033
2025-11-07 04:20:00,505 INFO DECISION FLAT @ 3990.22 (ts=2025-11-07 04:20:00+00:00) equity=0.992033
2025-11-07 04:20:00,506 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 04:20:00+00:00 price=3990.22 pos=0 equity=0.992033
2025-11-07 04:25:01,472 INFO DECISION FLAT @ 3991.95 (ts=2025-11-07 04:25:00+00:00) equity=0.992033
2025-11-07 04:30:00,196 INFO DECISION FLAT @ 3992.70 (ts=2025-11-07 04:30:00+00:00) equity=0.992033
2025-11-07 04:35:01,019 INFO DECISION FLAT @ 3991.97 (ts=2025-11-07 04:35:00+00:00) equity=0.992033
2025-11-07 04:35:01,020 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 04:35:00+00:00 price=3991.97 pos=0 equity=0.992033
2025-11-07 04:40:03,738 INFO DECISION FLAT @ 3992.96 (ts=2025-11-07 04:40:00+00:00) equity=0.992033
2025-11-07 04:45:00,309 INFO DECISION FLAT @ 3994.74 (ts=2025-11-07 04:45:00+00:00) equity=0.992033
2025-11-07 04:50:01,138 INFO DECISION FLAT @ 3994.65 (ts=2025-11-07 04:50:00+00:00) equity=0.992033
2025-11-07 04:50:01,139 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 04:50:00+00:00 price=3994.65 pos=0 equity=0.992033
2025-11-07 04:55:00,222 INFO DECISION FLAT @ 3990.28 (ts=2025-11-07 04:55:00+00:00) equity=0.992033
2025-11-07 05:00:00,865 INFO DECISION FLAT @ 3990.38 (ts=2025-11-07 05:00:00+00:00) equity=0.992033
2025-11-07 05:05:01,990 INFO DECISION FLAT @ 3990.29 (ts=2025-11-07 05:05:00+00:00) equity=0.992033
2025-11-07 05:05:01,992 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 05:05:00+00:00 price=3990.29 pos=0 equity=0.992033
2025-11-07 05:10:00,644 INFO DECISION FLAT @ 3992.07 (ts=2025-11-07 05:10:00+00:00) equity=0.992033
2025-11-07 05:15:01,271 INFO DECISION FLAT @ 3991.33 (ts=2025-11-07 05:15:00+00:00) equity=0.992033
2025-11-07 05:20:01,913 INFO DECISION FLAT @ 3994.95 (ts=2025-11-07 05:20:00+00:00) equity=0.992033
2025-11-07 05:20:01,914 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 05:20:00+00:00 price=3994.95 pos=0 equity=0.992033
2025-11-07 05:25:00,633 INFO DECISION FLAT @ 3996.48 (ts=2025-11-07 05:25:00+00:00) equity=0.992033
2025-11-07 05:30:01,631 INFO DECISION FLAT @ 3996.37 (ts=2025-11-07 05:30:00+00:00) equity=0.992033
2025-11-07 05:35:00,560 INFO DECISION FLAT @ 3994.45 (ts=2025-11-07 05:35:00+00:00) equity=0.992033
2025-11-07 05:35:00,561 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 05:35:00+00:00 price=3994.45 pos=0 equity=0.992033
2025-11-07 05:40:01,172 INFO DECISION FLAT @ 3995.52 (ts=2025-11-07 05:40:00+00:00) equity=0.992033
2025-11-07 05:45:01,787 INFO DECISION FLAT @ 3995.32 (ts=2025-11-07 05:45:00+00:00) equity=0.992033
2025-11-07 05:45:01,788 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 05:45:00+00:00 price=3995.32 pos=0 equity=0.992033
2025-11-07 05:50:00,543 INFO DECISION FLAT @ 3996.81 (ts=2025-11-07 05:50:00+00:00) equity=0.992033
2025-11-07 05:55:01,344 INFO DECISION FLAT @ 3998.16 (ts=2025-11-07 05:55:00+00:00) equity=0.992033
2025-11-07 06:00:01,994 INFO DECISION LONG @ 3998.49 (ts=2025-11-07 06:00:00+00:00) equity=0.991867
2025-11-07 06:00:01,996 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 06:00:00+00:00 price=3998.49 pos=1 equity=0.991867
2025-11-07 06:05:00,943 INFO DECISION LONG @ 3997.93 (ts=2025-11-07 06:05:00+00:00) equity=0.991864
2025-11-07 06:10:01,588 INFO DECISION LONG @ 3998.50 (ts=2025-11-07 06:10:00+00:00) equity=0.991859
2025-11-07 06:15:00,255 INFO DECISION LONG @ 3997.76 (ts=2025-11-07 06:15:00+00:00) equity=0.991859
2025-11-07 06:15:00,256 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 06:15:00+00:00 price=3997.76 pos=1 equity=0.991859
2025-11-07 06:20:00,810 INFO DECISION LONG @ 3997.30 (ts=2025-11-07 06:20:00+00:00) equity=0.991876
2025-11-07 06:25:01,386 INFO DECISION LONG @ 3992.61 (ts=2025-11-07 06:25:00+00:00) equity=0.991881
2025-11-07 06:25:01,387 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 06:25:00+00:00 price=3992.61 pos=1 equity=0.991881
2025-11-07 06:30:02,045 INFO DECISION LONG @ 3995.29 (ts=2025-11-07 06:30:00+00:00) equity=0.992137
2025-11-07 06:35:00,874 INFO DECISION LONG @ 3995.94 (ts=2025-11-07 06:35:00+00:00) equity=0.992179
2025-11-07 06:40:01,426 INFO DECISION LONG @ 3997.87 (ts=2025-11-07 06:40:00+00:00) equity=0.992197
2025-11-07 06:40:01,427 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 06:40:00+00:00 price=3997.87 pos=1 equity=0.992197
2025-11-07 06:45:02,264 INFO DECISION LONG @ 3996.79 (ts=2025-11-07 06:45:00+00:00) equity=0.992234
2025-11-07 06:50:00,887 INFO DECISION LONG @ 3994.68 (ts=2025-11-07 06:50:00+00:00) equity=0.992259
2025-11-07 06:55:01,647 INFO DECISION LONG @ 3993.79 (ts=2025-11-07 06:55:00+00:00) equity=0.992279
2025-11-07 06:55:01,647 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 06:55:00+00:00 price=3993.79 pos=1 equity=0.992279
2025-11-07 07:00:00,416 INFO DECISION LONG @ 3994.96 (ts=2025-11-07 07:00:00+00:00) equity=0.992279
2025-11-07 07:05:01,294 INFO DECISION LONG @ 3992.82 (ts=2025-11-07 07:05:00+00:00) equity=0.992276
2025-11-07 07:10:01,976 INFO DECISION LONG @ 3995.31 (ts=2025-11-07 07:10:00+00:00) equity=0.992276
2025-11-07 07:10:01,978 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 07:10:00+00:00 price=3995.31 pos=1 equity=0.992276
2025-11-07 07:15:00,667 INFO DECISION LONG @ 3995.35 (ts=2025-11-07 07:15:00+00:00) equity=0.992291
2025-11-07 07:20:01,376 INFO DECISION LONG @ 3997.11 (ts=2025-11-07 07:20:00+00:00) equity=0.992358
2025-11-07 07:25:01,900 INFO DECISION FLAT @ 3998.91 (ts=2025-11-07 07:25:00+00:00) equity=0.992155
2025-11-07 07:25:01,901 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 07:25:00+00:00 price=3998.91 pos=0 equity=0.992155
2025-11-07 07:30:00,577 INFO DECISION SHORT @ 3998.15 (ts=2025-11-07 07:30:00+00:00) equity=0.992023
2025-11-07 07:35:01,566 INFO DECISION SHORT @ 4002.52 (ts=2025-11-07 07:35:00+00:00) equity=0.991974
2025-11-07 07:40:02,280 INFO DECISION SHORT @ 4000.65 (ts=2025-11-07 07:40:00+00:00) equity=0.992016
2025-11-07 07:40:02,281 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 07:40:00+00:00 price=4000.65 pos=-1 equity=0.992016
2025-11-07 07:45:00,979 INFO DECISION SHORT @ 4001.49 (ts=2025-11-07 07:45:00+00:00) equity=0.992016
2025-11-07 07:50:01,859 INFO DECISION SHORT @ 4003.93 (ts=2025-11-07 07:50:00+00:00) equity=0.992013
2025-11-07 07:55:00,994 INFO DECISION SHORT @ 4007.09 (ts=2025-11-07 07:55:00+00:00) equity=0.991998
2025-11-07 07:55:00,995 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 07:55:00+00:00 price=4007.09 pos=-1 equity=0.991998
2025-11-07 08:00:02,211 INFO DECISION SHORT @ 4007.73 (ts=2025-11-07 08:00:00+00:00) equity=0.991781
2025-11-07 08:05:01,345 INFO DECISION SHORT @ 4007.91 (ts=2025-11-07 08:05:00+00:00) equity=0.991773
2025-11-07 08:05:01,353 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 08:05:00+00:00 price=4007.91 pos=-1 equity=0.991773
2025-11-07 08:10:02,380 INFO DECISION SHORT @ 4008.24 (ts=2025-11-07 08:10:00+00:00) equity=0.991805
2025-11-07 08:15:01,297 INFO DECISION SHORT @ 4008.22 (ts=2025-11-07 08:15:00+00:00) equity=0.991736
2025-11-07 08:20:00,301 INFO DECISION SHORT @ 4008.94 (ts=2025-11-07 08:20:00+00:00) equity=0.991739
2025-11-07 08:20:00,302 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 08:20:00+00:00 price=4008.94 pos=-1 equity=0.991739
2025-11-07 08:25:01,718 INFO DECISION FLAT @ 4006.61 (ts=2025-11-07 08:25:00+00:00) equity=0.991535
2025-11-07 08:30:00,758 INFO DECISION LONG @ 4003.70 (ts=2025-11-07 08:30:00+00:00) equity=0.991332
2025-11-07 08:30:00,759 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 08:30:00+00:00 price=4003.70 pos=1 equity=0.991332
2025-11-07 08:35:01,608 INFO DECISION LONG @ 4005.56 (ts=2025-11-07 08:35:00+00:00) equity=0.991315
2025-11-07 08:40:00,443 INFO DECISION LONG @ 4006.15 (ts=2025-11-07 08:40:00+00:00) equity=0.991315
2025-11-07 08:45:01,300 INFO DECISION LONG @ 4005.50 (ts=2025-11-07 08:45:00+00:00) equity=0.991293
2025-11-07 08:45:01,300 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 08:45:00+00:00 price=4005.50 pos=1 equity=0.991293
2025-11-07 08:50:04,008 INFO DECISION LONG @ 4003.32 (ts=2025-11-07 08:50:00+00:00) equity=0.991270
2025-11-07 08:55:01,029 INFO DECISION LONG @ 4005.69 (ts=2025-11-07 08:55:00+00:00) equity=0.991283
2025-11-07 09:00:01,760 INFO DECISION LONG @ 4009.35 (ts=2025-11-07 09:00:00+00:00) equity=0.991649
2025-11-07 09:00:01,762 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 09:00:00+00:00 price=4009.35 pos=1 equity=0.991649
2025-11-07 09:05:01,059 INFO DECISION LONG @ 4006.03 (ts=2025-11-07 09:05:00+00:00) equity=0.991649
2025-11-07 09:10:02,245 INFO DECISION LONG @ 4007.76 (ts=2025-11-07 09:10:00+00:00) equity=0.991649
2025-11-07 09:10:02,246 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 09:10:00+00:00 price=4007.76 pos=1 equity=0.991649
2025-11-07 09:15:01,043 INFO DECISION LONG @ 4009.91 (ts=2025-11-07 09:15:00+00:00) equity=0.991671
2025-11-07 09:20:02,071 INFO DECISION LONG @ 4007.69 (ts=2025-11-07 09:20:00+00:00) equity=0.991661
2025-11-07 09:25:02,944 INFO DECISION LONG @ 4005.31 (ts=2025-11-07 09:25:00+00:00) equity=0.991666
2025-11-07 09:25:02,945 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 09:25:00+00:00 price=4005.31 pos=1 equity=0.991666
2025-11-07 09:30:01,930 INFO DECISION LONG @ 4005.81 (ts=2025-11-07 09:30:00+00:00) equity=0.991688
2025-11-07 09:35:03,062 INFO DECISION LONG @ 4007.96 (ts=2025-11-07 09:35:00+00:00) equity=0.991686
2025-11-07 09:35:03,063 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 09:35:00+00:00 price=4007.96 pos=1 equity=0.991686
2025-11-07 09:40:01,816 INFO DECISION LONG @ 4008.36 (ts=2025-11-07 09:40:00+00:00) equity=0.991683
2025-11-07 09:45:00,881 INFO DECISION LONG @ 4005.79 (ts=2025-11-07 09:45:00+00:00) equity=0.991666
2025-11-07 09:50:01,757 INFO DECISION LONG @ 4007.04 (ts=2025-11-07 09:50:00+00:00) equity=0.991664
2025-11-07 09:50:01,758 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 09:50:00+00:00 price=4007.04 pos=1 equity=0.991664
2025-11-07 09:55:00,571 INFO DECISION LONG @ 4007.46 (ts=2025-11-07 09:55:00+00:00) equity=0.991641
2025-11-07 10:00:01,385 INFO DECISION LONG @ 4010.26 (ts=2025-11-07 10:00:00+00:00) equity=0.991772
2025-11-07 10:05:00,577 INFO DECISION LONG @ 4010.58 (ts=2025-11-07 10:05:00+00:00) equity=0.991797
2025-11-07 10:05:00,579 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 10:05:00+00:00 price=4010.58 pos=1 equity=0.991797
2025-11-07 10:10:01,302 INFO DECISION LONG @ 4009.24 (ts=2025-11-07 10:10:00+00:00) equity=0.991787
2025-11-07 10:15:01,970 INFO DECISION LONG @ 4010.91 (ts=2025-11-07 10:15:00+00:00) equity=0.991797
2025-11-07 10:15:01,970 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 10:15:00+00:00 price=4010.91 pos=1 equity=0.991797
2025-11-07 10:20:00,890 INFO DECISION LONG @ 4011.96 (ts=2025-11-07 10:20:00+00:00) equity=0.991810
2025-11-07 10:25:01,489 INFO DECISION LONG @ 4011.37 (ts=2025-11-07 10:25:00+00:00) equity=0.991839
2025-11-07 10:30:01,171 INFO DECISION SHORT @ 4010.23 (ts=2025-11-07 10:30:00+00:00) equity=0.991426
2025-11-07 10:30:01,172 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 10:30:00+00:00 price=4010.23 pos=-1 equity=0.991426
2025-11-07 10:35:02,185 INFO DECISION SHORT @ 4005.00 (ts=2025-11-07 10:35:00+00:00) equity=0.991589
2025-11-07 10:40:00,859 INFO DECISION SHORT @ 4005.77 (ts=2025-11-07 10:40:00+00:00) equity=0.991582
2025-11-07 10:45:01,620 INFO DECISION SHORT @ 4006.27 (ts=2025-11-07 10:45:00+00:00) equity=0.991609
2025-11-07 10:45:01,621 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 10:45:00+00:00 price=4006.27 pos=-1 equity=0.991609
2025-11-07 10:50:00,274 INFO DECISION SHORT @ 4009.07 (ts=2025-11-07 10:50:00+00:00) equity=0.991614
2025-11-07 10:55:01,010 INFO DECISION SHORT @ 4006.20 (ts=2025-11-07 10:55:00+00:00) equity=0.991616
2025-11-07 11:00:01,911 INFO DECISION SHORT @ 4006.82 (ts=2025-11-07 11:00:00+00:00) equity=0.991601
2025-11-07 11:00:01,913 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 11:00:00+00:00 price=4006.82 pos=-1 equity=0.991601
2025-11-07 11:05:00,842 INFO DECISION FLAT @ 4008.83 (ts=2025-11-07 11:05:00+00:00) equity=0.991398
2025-11-07 11:10:00,370 INFO DECISION FLAT @ 4007.69 (ts=2025-11-07 11:10:00+00:00) equity=0.991398
2025-11-07 11:15:01,435 INFO DECISION FLAT @ 4006.24 (ts=2025-11-07 11:15:00+00:00) equity=0.991398
2025-11-07 11:15:01,436 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 11:15:00+00:00 price=4006.24 pos=0 equity=0.991398
2025-11-07 11:20:00,548 INFO DECISION FLAT @ 4004.50 (ts=2025-11-07 11:20:00+00:00) equity=0.991398
2025-11-07 11:25:01,340 INFO DECISION FLAT @ 4009.07 (ts=2025-11-07 11:25:00+00:00) equity=0.991398
2025-11-07 11:30:00,462 INFO DECISION FLAT @ 4006.12 (ts=2025-11-07 11:30:00+00:00) equity=0.991398
2025-11-07 11:30:00,463 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 11:30:00+00:00 price=4006.12 pos=0 equity=0.991398
2025-11-07 11:35:01,723 INFO DECISION FLAT @ 4004.87 (ts=2025-11-07 11:35:00+00:00) equity=0.991398
2025-11-07 11:40:00,742 INFO DECISION FLAT @ 4005.84 (ts=2025-11-07 11:40:00+00:00) equity=0.991398
2025-11-07 11:40:00,743 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 11:40:00+00:00 price=4005.84 pos=0 equity=0.991398
2025-11-07 11:45:02,017 INFO DECISION FLAT @ 4004.47 (ts=2025-11-07 11:45:00+00:00) equity=0.991398
2025-11-07 11:50:01,188 INFO DECISION FLAT @ 4006.90 (ts=2025-11-07 11:50:00+00:00) equity=0.991398
2025-11-07 11:50:01,188 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 11:50:00+00:00 price=4006.90 pos=0 equity=0.991398
2025-11-07 11:55:02,349 INFO DECISION FLAT @ 4008.37 (ts=2025-11-07 11:55:00+00:00) equity=0.991398
2025-11-07 12:00:01,564 INFO DECISION LONG @ 4008.00 (ts=2025-11-07 12:00:00+00:00) equity=0.991203
2025-11-07 12:00:01,565 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 12:00:00+00:00 price=4008.00 pos=1 equity=0.991203
2025-11-07 12:05:00,677 INFO DECISION FLAT @ 4011.65 (ts=2025-11-07 12:05:00+00:00) equity=0.991000
2025-11-07 12:10:01,615 INFO DECISION FLAT @ 4006.85 (ts=2025-11-07 12:10:00+00:00) equity=0.991000
2025-11-07 12:10:01,616 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 12:10:00+00:00 price=4006.85 pos=0 equity=0.991000
2025-11-07 12:15:02,359 INFO DECISION FLAT @ 4003.45 (ts=2025-11-07 12:15:00+00:00) equity=0.991000
2025-11-07 12:20:01,188 INFO DECISION FLAT @ 4005.68 (ts=2025-11-07 12:20:00+00:00) equity=0.991000
2025-11-07 12:25:01,921 INFO DECISION FLAT @ 4002.64 (ts=2025-11-07 12:25:00+00:00) equity=0.991000
2025-11-07 12:25:01,922 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 12:25:00+00:00 price=4002.64 pos=0 equity=0.991000
2025-11-07 12:30:00,815 INFO DECISION FLAT @ 3999.26 (ts=2025-11-07 12:30:00+00:00) equity=0.991000
2025-11-07 12:35:01,869 INFO DECISION FLAT @ 3996.74 (ts=2025-11-07 12:35:00+00:00) equity=0.991000
2025-11-07 12:40:00,843 INFO DECISION LONG @ 3995.56 (ts=2025-11-07 12:40:00+00:00) equity=0.990802
2025-11-07 12:40:00,844 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 12:40:00+00:00 price=3995.56 pos=1 equity=0.990802
2025-11-07 12:45:01,671 INFO DECISION FLAT @ 3998.62 (ts=2025-11-07 12:45:00+00:00) equity=0.990598
2025-11-07 12:50:01,007 INFO DECISION FLAT @ 4002.01 (ts=2025-11-07 12:50:00+00:00) equity=0.990598
2025-11-07 12:50:01,009 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 12:50:00+00:00 price=4002.01 pos=0 equity=0.990598
2025-11-07 12:55:02,244 INFO DECISION FLAT @ 4003.93 (ts=2025-11-07 12:55:00+00:00) equity=0.990598
2025-11-07 13:00:01,302 INFO DECISION FLAT @ 4002.87 (ts=2025-11-07 13:00:00+00:00) equity=0.990598
2025-11-07 13:00:01,303 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 13:00:00+00:00 price=4002.87 pos=0 equity=0.990598
2025-11-07 13:05:01,014 INFO DECISION FLAT @ 4006.58 (ts=2025-11-07 13:05:00+00:00) equity=0.990598
2025-11-07 13:10:01,895 INFO DECISION LONG @ 4007.88 (ts=2025-11-07 13:10:00+00:00) equity=0.990391
2025-11-07 13:10:01,896 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 13:10:00+00:00 price=4007.88 pos=1 equity=0.990391
2025-11-07 13:15:00,851 INFO DECISION LONG @ 4005.97 (ts=2025-11-07 13:15:00+00:00) equity=0.990425
2025-11-07 13:20:01,748 INFO DECISION LONG @ 4003.46 (ts=2025-11-07 13:20:00+00:00) equity=0.990351
2025-11-07 13:25:00,772 INFO DECISION LONG @ 4001.45 (ts=2025-11-07 13:25:00+00:00) equity=0.990306
2025-11-07 13:25:00,779 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 13:25:00+00:00 price=4001.45 pos=1 equity=0.990306
2025-11-07 13:30:00,251 INFO DECISION LONG @ 3998.48 (ts=2025-11-07 13:30:00+00:00) equity=0.990306
2025-11-07 13:35:01,452 INFO DECISION LONG @ 3998.15 (ts=2025-11-07 13:35:00+00:00) equity=0.990299
2025-11-07 13:35:01,453 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 13:35:00+00:00 price=3998.15 pos=1 equity=0.990299
2025-11-07 13:40:00,375 INFO DECISION LONG @ 3997.17 (ts=2025-11-07 13:40:00+00:00) equity=0.990292
2025-11-07 13:45:01,061 INFO DECISION LONG @ 3996.57 (ts=2025-11-07 13:45:00+00:00) equity=0.990316
2025-11-07 13:50:01,953 INFO DECISION LONG @ 3992.89 (ts=2025-11-07 13:50:00+00:00) equity=0.990463
2025-11-07 13:50:01,954 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 13:50:00+00:00 price=3992.89 pos=1 equity=0.990463
2025-11-07 13:55:00,872 INFO DECISION LONG @ 3995.25 (ts=2025-11-07 13:55:00+00:00) equity=0.990453
2025-11-07 14:00:01,577 INFO DECISION LONG @ 3995.86 (ts=2025-11-07 14:00:00+00:00) equity=0.990411
2025-11-07 14:05:00,620 INFO DECISION LONG @ 3998.66 (ts=2025-11-07 14:05:00+00:00) equity=0.990361
2025-11-07 14:05:00,622 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 14:05:00+00:00 price=3998.66 pos=1 equity=0.990361
2025-11-07 14:10:01,536 INFO DECISION LONG @ 3999.82 (ts=2025-11-07 14:10:00+00:00) equity=0.990440
2025-11-07 14:15:00,334 INFO DECISION LONG @ 3996.05 (ts=2025-11-07 14:15:00+00:00) equity=0.990440
2025-11-07 14:20:00,789 INFO DECISION LONG @ 3999.21 (ts=2025-11-07 14:20:00+00:00) equity=0.990599
2025-11-07 14:20:00,790 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 14:20:00+00:00 price=3999.21 pos=1 equity=0.990599
2025-11-07 14:25:01,777 INFO DECISION LONG @ 3998.54 (ts=2025-11-07 14:25:00+00:00) equity=0.990557
2025-11-07 14:30:00,320 INFO DECISION LONG @ 3997.14 (ts=2025-11-07 14:30:00+00:00) equity=0.990520
2025-11-07 14:35:01,275 INFO DECISION FLAT @ 3995.19 (ts=2025-11-07 14:35:00+00:00) equity=0.990316
2025-11-07 14:35:01,276 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 14:35:00+00:00 price=3995.19 pos=0 equity=0.990316
2025-11-07 14:40:01,895 INFO DECISION FLAT @ 3995.05 (ts=2025-11-07 14:40:00+00:00) equity=0.990316
2025-11-07 14:45:00,902 INFO DECISION LONG @ 3993.89 (ts=2025-11-07 14:45:00+00:00) equity=0.990098
2025-11-07 14:50:01,606 INFO DECISION LONG @ 3996.00 (ts=2025-11-07 14:50:00+00:00) equity=0.990101
2025-11-07 14:50:01,607 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 14:50:00+00:00 price=3996.00 pos=1 equity=0.990101
2025-11-07 14:55:00,476 INFO DECISION LONG @ 3999.13 (ts=2025-11-07 14:55:00+00:00) equity=0.990093
2025-11-07 15:00:01,066 INFO DECISION LONG @ 3997.34 (ts=2025-11-07 15:00:00+00:00) equity=0.989975
2025-11-07 15:05:01,945 INFO DECISION LONG @ 3997.04 (ts=2025-11-07 15:05:00+00:00) equity=0.989871
2025-11-07 15:05:01,947 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 15:05:00+00:00 price=3997.04 pos=1 equity=0.989871
2025-11-07 15:10:00,752 INFO DECISION LONG @ 3999.03 (ts=2025-11-07 15:10:00+00:00) equity=0.989880
2025-11-07 15:15:02,416 INFO DECISION LONG @ 4002.74 (ts=2025-11-07 15:15:00+00:00) equity=0.989836
2025-11-07 15:15:02,417 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 15:15:00+00:00 price=4002.74 pos=1 equity=0.989836
2025-11-07 15:20:01,399 INFO DECISION FLAT @ 4006.45 (ts=2025-11-07 15:20:00+00:00) equity=0.989633
2025-11-07 15:25:00,572 INFO DECISION FLAT @ 4005.28 (ts=2025-11-07 15:25:00+00:00) equity=0.989633
2025-11-07 15:30:01,760 INFO DECISION FLAT @ 3998.96 (ts=2025-11-07 15:30:00+00:00) equity=0.989633
2025-11-07 15:30:01,761 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 15:30:00+00:00 price=3998.96 pos=0 equity=0.989633
2025-11-07 15:35:01,631 INFO DECISION LONG @ 3992.90 (ts=2025-11-07 15:35:00+00:00) equity=0.989348
2025-11-07 15:40:01,008 INFO DECISION LONG @ 3985.76 (ts=2025-11-07 15:40:00+00:00) equity=0.989177
2025-11-07 15:45:00,300 INFO DECISION LONG @ 3990.72 (ts=2025-11-07 15:45:00+00:00) equity=0.989207
2025-11-07 15:45:00,301 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 15:45:00+00:00 price=3990.72 pos=1 equity=0.989207
2025-11-07 15:50:01,886 INFO DECISION LONG @ 3990.32 (ts=2025-11-07 15:50:00+00:00) equity=0.989202
2025-11-07 15:55:00,684 INFO DECISION LONG @ 3991.36 (ts=2025-11-07 15:55:00+00:00) equity=0.989214
2025-11-07 15:55:00,685 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 15:55:00+00:00 price=3991.36 pos=1 equity=0.989214
2025-11-07 16:00:00,884 INFO DECISION LONG @ 3993.67 (ts=2025-11-07 16:00:00+00:00) equity=0.989237
2025-11-07 16:05:00,515 INFO DECISION LONG @ 3997.26 (ts=2025-11-07 16:05:00+00:00) equity=0.989360
2025-11-07 16:10:00,135 INFO DECISION LONG @ 3994.64 (ts=2025-11-07 16:10:00+00:00) equity=0.989378
2025-11-07 16:10:00,137 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 16:10:00+00:00 price=3994.64 pos=1 equity=0.989378
2025-11-07 16:15:01,859 INFO DECISION LONG @ 3991.16 (ts=2025-11-07 16:15:00+00:00) equity=0.989415
2025-11-07 16:20:00,832 INFO DECISION LONG @ 3990.22 (ts=2025-11-07 16:20:00+00:00) equity=0.989417
2025-11-07 16:20:00,834 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 16:20:00+00:00 price=3990.22 pos=1 equity=0.989417
2025-11-07 16:25:00,387 INFO DECISION LONG @ 3990.56 (ts=2025-11-07 16:25:00+00:00) equity=0.989489
2025-11-07 16:30:01,957 INFO DECISION LONG @ 3991.87 (ts=2025-11-07 16:30:00+00:00) equity=0.989127
2025-11-07 16:30:01,958 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 16:30:00+00:00 price=3991.87 pos=1 equity=0.989127
2025-11-07 16:35:01,410 INFO DECISION LONG @ 3992.25 (ts=2025-11-07 16:35:00+00:00) equity=0.989011
2025-11-07 16:40:00,454 INFO DECISION LONG @ 3989.08 (ts=2025-11-07 16:40:00+00:00) equity=0.988979
2025-11-07 16:45:01,386 INFO DECISION LONG @ 3986.69 (ts=2025-11-07 16:45:00+00:00) equity=0.989053
2025-11-07 16:45:01,388 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 16:45:00+00:00 price=3986.69 pos=1 equity=0.989053
2025-11-07 16:50:01,087 INFO DECISION LONG @ 3991.13 (ts=2025-11-07 16:50:00+00:00) equity=0.989053
2025-11-07 16:55:01,332 INFO DECISION LONG @ 3992.08 (ts=2025-11-07 16:55:00+00:00) equity=0.989123
2025-11-07 17:00:00,533 INFO DECISION FLAT @ 3991.30 (ts=2025-11-07 17:00:00+00:00) equity=0.988920
2025-11-07 17:00:00,534 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 17:00:00+00:00 price=3991.30 pos=0 equity=0.988920
2025-11-07 17:05:01,069 INFO DECISION FLAT @ 3995.48 (ts=2025-11-07 17:05:00+00:00) equity=0.988920
2025-11-07 17:10:01,991 INFO DECISION FLAT @ 3998.11 (ts=2025-11-07 17:10:00+00:00) equity=0.988920
2025-11-07 17:10:01,994 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 17:10:00+00:00 price=3998.11 pos=0 equity=0.988920
2025-11-07 17:15:00,911 INFO DECISION SHORT @ 3999.49 (ts=2025-11-07 17:15:00+00:00) equity=0.988717
2025-11-07 17:20:00,257 INFO DECISION SHORT @ 3996.43 (ts=2025-11-07 17:20:00+00:00) equity=0.988705
2025-11-07 17:25:01,010 INFO DECISION SHORT @ 4005.47 (ts=2025-11-07 17:25:00+00:00) equity=0.988630
2025-11-07 17:25:01,011 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 17:25:00+00:00 price=4005.47 pos=-1 equity=0.988630
2025-11-07 17:30:00,869 INFO DECISION SHORT @ 4008.00 (ts=2025-11-07 17:30:00+00:00) equity=0.988630
2025-11-07 17:35:00,537 INFO DECISION SHORT @ 4017.18 (ts=2025-11-07 17:35:00+00:00) equity=0.988849
2025-11-07 17:40:00,402 INFO DECISION SHORT @ 4026.12 (ts=2025-11-07 17:40:00+00:00) equity=0.988793
2025-11-07 17:40:00,404 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 17:40:00+00:00 price=4026.12 pos=-1 equity=0.988793
2025-11-07 17:45:01,015 INFO DECISION SHORT @ 4022.15 (ts=2025-11-07 17:45:00+00:00) equity=0.988461
2025-11-07 17:50:01,693 INFO DECISION SHORT @ 4019.08 (ts=2025-11-07 17:50:00+00:00) equity=0.988454
2025-11-07 17:50:01,694 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 17:50:00+00:00 price=4019.08 pos=-1 equity=0.988454
2025-11-07 17:55:01,347 INFO DECISION SHORT @ 4013.48 (ts=2025-11-07 17:55:00+00:00) equity=0.988481
2025-11-07 18:00:00,356 INFO DECISION SHORT @ 4007.52 (ts=2025-11-07 18:00:00+00:00) equity=0.988547
2025-11-07 18:05:00,639 INFO DECISION FLAT @ 4003.98 (ts=2025-11-07 18:05:00+00:00) equity=0.988345
2025-11-07 18:05:00,641 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 18:05:00+00:00 price=4003.98 pos=0 equity=0.988345
2025-11-07 18:10:02,133 INFO DECISION FLAT @ 4000.80 (ts=2025-11-07 18:10:00+00:00) equity=0.988345
2025-11-07 18:15:00,510 INFO DECISION LONG @ 3999.61 (ts=2025-11-07 18:15:00+00:00) equity=0.988058
2025-11-07 18:20:00,950 INFO DECISION LONG @ 3995.45 (ts=2025-11-07 18:20:00+00:00) equity=0.988073
2025-11-07 18:20:00,950 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 18:20:00+00:00 price=3995.45 pos=1 equity=0.988073
2025-11-07 18:25:00,484 INFO DECISION LONG @ 3994.21 (ts=2025-11-07 18:25:00+00:00) equity=0.988063
2025-11-07 18:30:01,898 INFO DECISION LONG @ 3995.97 (ts=2025-11-07 18:30:00+00:00) equity=0.987564
2025-11-07 18:30:01,899 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 18:30:00+00:00 price=3995.97 pos=1 equity=0.987564
2025-11-07 18:35:00,901 INFO DECISION FLAT @ 3994.27 (ts=2025-11-07 18:35:00+00:00) equity=0.987361
2025-11-07 18:40:02,107 INFO DECISION SHORT @ 3998.45 (ts=2025-11-07 18:40:00+00:00) equity=0.987141
2025-11-07 18:40:02,108 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 18:40:00+00:00 price=3998.45 pos=-1 equity=0.987141
2025-11-07 18:45:01,417 INFO DECISION SHORT @ 3998.96 (ts=2025-11-07 18:45:00+00:00) equity=0.987161
2025-11-07 18:50:00,584 INFO DECISION SHORT @ 3997.59 (ts=2025-11-07 18:50:00+00:00) equity=0.987193
2025-11-07 18:55:02,035 INFO DECISION SHORT @ 4001.96 (ts=2025-11-07 18:55:00+00:00) equity=0.987156
2025-11-07 18:55:02,036 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 18:55:00+00:00 price=4001.96 pos=-1 equity=0.987156
2025-11-07 19:00:01,085 INFO DECISION SHORT @ 4005.75 (ts=2025-11-07 19:00:00+00:00) equity=0.987109
2025-11-07 19:05:02,183 INFO DECISION SHORT @ 4006.01 (ts=2025-11-07 19:05:00+00:00) equity=0.987102
2025-11-07 19:05:02,185 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 19:05:00+00:00 price=4006.01 pos=-1 equity=0.987102
2025-11-07 19:10:01,062 INFO DECISION SHORT @ 4004.93 (ts=2025-11-07 19:10:00+00:00) equity=0.987122
2025-11-07 19:15:00,359 INFO DECISION SHORT @ 4004.92 (ts=2025-11-07 19:15:00+00:00) equity=0.987117
2025-11-07 19:20:01,438 INFO DECISION SHORT @ 4004.64 (ts=2025-11-07 19:20:00+00:00) equity=0.987068
2025-11-07 19:20:01,439 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 19:20:00+00:00 price=4004.64 pos=-1 equity=0.987068
2025-11-07 19:25:00,719 INFO DECISION SHORT @ 4003.02 (ts=2025-11-07 19:25:00+00:00) equity=0.987077
2025-11-07 19:30:01,646 INFO DECISION SHORT @ 4002.83 (ts=2025-11-07 19:30:00+00:00) equity=0.987090
2025-11-07 19:30:01,647 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 19:30:00+00:00 price=4002.83 pos=-1 equity=0.987090
2025-11-07 19:35:00,954 INFO DECISION SHORT @ 4004.34 (ts=2025-11-07 19:35:00+00:00) equity=0.987077
2025-11-07 19:40:00,196 INFO DECISION SHORT @ 4005.15 (ts=2025-11-07 19:40:00+00:00) equity=0.987075
2025-11-07 19:45:01,383 INFO DECISION SHORT @ 4006.37 (ts=2025-11-07 19:45:00+00:00) equity=0.987068
2025-11-07 19:45:01,383 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 19:45:00+00:00 price=4006.37 pos=-1 equity=0.987068
2025-11-07 19:50:00,582 INFO DECISION SHORT @ 4005.21 (ts=2025-11-07 19:50:00+00:00) equity=0.987070
2025-11-07 19:55:02,005 INFO DECISION SHORT @ 4006.39 (ts=2025-11-07 19:55:00+00:00) equity=0.987045
2025-11-07 19:55:02,008 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 19:55:00+00:00 price=4006.39 pos=-1 equity=0.987045
2025-11-07 20:00:01,536 INFO DECISION SHORT @ 4005.35 (ts=2025-11-07 20:00:00+00:00) equity=0.987142
2025-11-07 20:05:01,087 INFO DECISION FLAT @ 4006.23 (ts=2025-11-07 20:05:00+00:00) equity=0.986939
2025-11-07 20:10:00,374 INFO DECISION FLAT @ 4007.24 (ts=2025-11-07 20:10:00+00:00) equity=0.986939
2025-11-07 20:10:00,375 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 20:10:00+00:00 price=4007.24 pos=0 equity=0.986939
2025-11-07 20:15:01,600 INFO DECISION FLAT @ 4008.01 (ts=2025-11-07 20:15:00+00:00) equity=0.986939
2025-11-07 20:20:00,750 INFO DECISION FLAT @ 4006.87 (ts=2025-11-07 20:20:00+00:00) equity=0.986939
2025-11-07 20:20:00,752 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 20:20:00+00:00 price=4006.87 pos=0 equity=0.986939
2025-11-07 20:25:02,027 INFO DECISION FLAT @ 4006.96 (ts=2025-11-07 20:25:00+00:00) equity=0.986939
2025-11-07 20:30:01,053 INFO DECISION FLAT @ 4006.59 (ts=2025-11-07 20:30:00+00:00) equity=0.986939
2025-11-07 20:30:01,054 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 20:30:00+00:00 price=4006.59 pos=0 equity=0.986939
2025-11-07 20:35:00,445 INFO DECISION FLAT @ 4006.18 (ts=2025-11-07 20:35:00+00:00) equity=0.986939
2025-11-07 20:40:01,690 INFO DECISION FLAT @ 4006.29 (ts=2025-11-07 20:40:00+00:00) equity=0.986939
2025-11-07 20:40:01,690 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 20:40:00+00:00 price=4006.29 pos=0 equity=0.986939
2025-11-07 20:45:01,361 INFO DECISION FLAT @ 4003.20 (ts=2025-11-07 20:45:00+00:00) equity=0.986939
2025-11-07 20:50:01,119 INFO DECISION FLAT @ 4004.02 (ts=2025-11-07 20:50:00+00:00) equity=0.986939
2025-11-07 20:55:00,644 INFO DECISION FLAT @ 4007.82 (ts=2025-11-07 20:55:00+00:00) equity=0.986939
2025-11-07 20:55:00,644 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 20:55:00+00:00 price=4007.82 pos=0 equity=0.986939
2025-11-07 21:00:00,690 INFO DECISION FLAT @ 4006.38 (ts=2025-11-07 21:00:00+00:00) equity=0.986939
2025-11-07 21:05:01,963 INFO DECISION FLAT @ 4005.61 (ts=2025-11-07 21:05:00+00:00) equity=0.986939
2025-11-07 21:05:01,965 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 21:05:00+00:00 price=4005.61 pos=0 equity=0.986939
2025-11-07 21:10:01,819 INFO DECISION FLAT @ 4005.16 (ts=2025-11-07 21:10:00+00:00) equity=0.986939
2025-11-07 21:15:01,123 INFO DECISION FLAT @ 4005.15 (ts=2025-11-07 21:15:00+00:00) equity=0.986939
2025-11-07 21:20:00,501 INFO DECISION FLAT @ 3998.83 (ts=2025-11-07 21:20:00+00:00) equity=0.986939
2025-11-07 21:20:00,502 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 21:20:00+00:00 price=3998.83 pos=0 equity=0.986939
2025-11-07 21:25:01,980 INFO DECISION FLAT @ 3996.54 (ts=2025-11-07 21:25:00+00:00) equity=0.986939
2025-11-07 21:30:01,391 INFO DECISION FLAT @ 3999.15 (ts=2025-11-07 21:30:00+00:00) equity=0.986939
2025-11-07 21:30:01,391 INFO [HB] GOLD.pro M5 last_ts=2025-11-07 21:30:00+00:00 price=3999.15 pos=0 equity=0.986939


=== FILE: paper_demo\simulate_execution.py ===

# -*- coding: utf-8 -*-
import yaml, pandas as pd
from env_xau import XauTradingEnv
from stable_baselines3 import PPO
from pathlib import Path

cfg = yaml.safe_load(open('config.yaml','r',encoding='utf-8'))
FEAT = cfg['files']['features_csv']
MODEL_PATH = cfg['files']['model_path']
WINDOW = int(cfg.get('window',128))
COSTS = cfg['costs']

df = pd.read_csv(FEAT, parse_dates=['time'])
cut = df['time'].max() - pd.Timedelta(days=120)
sim = df[df['time']>=cut].copy()

env = XauTradingEnv(sim, window=WINDOW, spread_abs=COSTS['spread_abs'], commission_rate=COSTS['commission_rate'], slippage_k=COSTS['slippage_k'])
obs, info = env.reset(); model = PPO.load(MODEL_PATH)
rows=[]; done=False
while not done:
    action,_=model.predict(obs, deterministic=True)
    obs, reward, terminated, truncated, info = env.step(action)
    done = bool(terminated) or bool(truncated)
    rows.append({'time': info.get('time',None), 'price': info.get('price',None), 'action': int(action), 'reward': float(reward), 'equity': float(env.equity)})
Path('reports').mkdir(parents=True, exist_ok=True)
pd.DataFrame(rows).to_csv('reports/trace_simulated.csv', index=False)
pd.Series([r['equity'] for r in rows]).to_csv('reports/equity_simulated.csv', index=False)
print('Saved simulated trace/equity.')


=== FILE: paper_demo\__init__.py ===



=== FILE: reports\costs_suggestion.yaml ===

spread_abs_median: 0.38
spread_abs_p75: 0.44
slippage_k_suggested: 0.0


=== FILE: reports\feature_discovery_summary.txt ===

# Feature Discovery Summary
Generated at: 2025-11-07T18:13:01
TopK: 96
Prev size: 96, Cur size: 96
Jaccard(prev,cur): 0.055  (1.0 = identyczne, 0.0 = zupełnie różne)
Kept from prev: 10
New vs prev:   86
Min new ratio enforced: 0.10


=== FILE: reports\report.txt ===

# RL Validation Report (XAUUSD M5)
Date: 2025-11-08 08:16:02

## Base metrics

Final equity: 1.000000
Min equity: 0.998649
Max drawdown: -0.091540


## Extra metrics from equity
- Steps: 3000
- Sharpe (daily): 0.015
- Sortino (daily): 0.009
- Daily vol: 0.0284
- CAGR (est.): -0.303%
- MaxDD: -9.15%
- Calmar: -0.033


=== FILE: reports\val_metrics.txt ===

Final equity: 1.000000
Min equity: 0.998649
Max drawdown: -0.091540


=== FILE: rl\evaluate.py ===

# -*- coding: utf-8 -*-
import argparse
import yaml
import json
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from pathlib import Path
from gymnasium.wrappers import TimeLimit
from stable_baselines3 import PPO
from stable_baselines3.common.vec_env import DummyVecEnv, VecNormalize, VecMonitor
import sys
from datetime import datetime

# Dodaj katalog główny do PYTHONPATH
sys.path.append(str(Path(__file__).resolve().parents[1]))

try:
    from env_xau import XauTradingEnv
except ImportError as e:
    print(f"[ERROR] Nie można zaimportować env_xau: {e}")
    sys.exit(1)

parser = argparse.ArgumentParser()
parser.add_argument('--max_eval_steps', type=int, default=3000)
parser.add_argument('--out_dir', type=str, default='reports')
args = parser.parse_args()

OUT = Path(args.out_dir)
OUT.mkdir(parents=True, exist_ok=True)

cfg = yaml.safe_load(open('config.yaml', 'r', encoding='utf-8'))
FEAT = cfg['files']['features_csv']
MODEL_PATH = cfg['files']['model_path']
VECNORM_PATH = cfg.get('files', {}).get('vecnorm_path', 'models/vecnorm_xauusd_m5.pkl')
WINDOW = int(cfg.get('window', 128))
COSTS = cfg['costs']
ENV_CFG = cfg.get('env', {})
REWARD_MODE = ENV_CFG.get('reward_mode', cfg.get('reward_mode', 'pct'))
MIN_EQ = float(ENV_CFG.get('min_equity', 0.8))

# Wczytaj dane
df = pd.read_csv(FEAT, parse_dates=['time'])
cut_val = df['time'].max() - pd.Timedelta(days=120)
val = df[df['time'] >= cut_val].copy()

if len(val) < WINDOW + 10:
    print(f"[ERROR] Za mało danych do walidacji: {len(val)} wierszy (wymagane >= {WINDOW + 10})")
    sys.exit(1)

# Wczytaj spec cech
features_spec = None
fspec = Path('models/features_spec.json')
if fspec.exists():
    features_spec = json.loads(fspec.read_text(encoding='utf-8')).get('feature_columns', None)

def make_eval():
    env = XauTradingEnv(val, window=WINDOW,
        spread_abs=COSTS['spread_abs'], commission_rate=COSTS['commission_rate'], slippage_k=COSTS['slippage_k'],
        reward_mode=REWARD_MODE, use_close_norm=True, features_spec=features_spec, min_equity=MIN_EQ)
    return TimeLimit(env, max_episode_steps=args.max_eval_steps)

venv = DummyVecEnv([make_eval])
venv = VecMonitor(venv)
if Path(VECNORM_PATH).exists():
    venv = VecNormalize.load(VECNORM_PATH, venv)
    venv.training = False
    venv.norm_reward = False

model = PPO.load(MODEL_PATH, env=venv)

obs = venv.reset()
eq = []
rows = []
done = False
steps = 0

print("[INFO] Start walidacji PPO...")
while not done and steps < args.max_eval_steps:
    action, _ = model.predict(obs, deterministic=True)
    obs, rewards, dones, infos = venv.step(action)
    equity = venv.get_attr('equity', indices=0)[0]
    eq.append(float(equity))
    info0 = infos[0] if isinstance(infos, (list, tuple)) else infos
    rows.append({
        'time': str(info0.get('time', '')),
        'price': info0.get('price', np.nan),
        'pos': info0.get('pos', np.nan),
        'equity': equity,
        'action': int(action[0]) if hasattr(action, '__len__') else int(action)
    })
    done = bool(dones[0])
    steps += 1

print(f"[INFO] Walidacja zakończona. Wykonano {steps} kroków.")

if steps == 0:
    print("[ERROR] Brak kroków w walidacji – sprawdź dane i konfigurację.")
    sys.exit(1)

# Zapis wyników
s = pd.Series(eq)
final_eq = float(s.iloc[-1])
min_eq = float(s.min())
peak = s.cummax()
max_dd = float((s / peak - 1.0).min())

# Wykres equity
fig_path = OUT / 'equity_val.png'
plt.figure(figsize=(10, 4))
plt.plot(s.values)
plt.title('Equity (validation)')
plt.tight_layout()
plt.savefig(fig_path.as_posix(), dpi=150)
plt.close()

# Metryki
metrics_path = OUT / 'val_metrics.txt'
metrics_path.write_text(
    f"Final equity: {final_eq:.6f}\nMin equity: {min_eq:.6f}\nMax drawdown: {max_dd:.6f}\n",
    encoding='utf-8'
)

# Ślad walidacji
trace_path = OUT / 'eval_trace.csv'
pd.DataFrame(rows).to_csv(trace_path, index=False)

# Logowanie ścieżek
print("[INFO] Pliki zapisane:")
print(f" - {fig_path}")
print(f" - {metrics_path}")
print(f" - {trace_path}")
print(f"[INFO] Final equity: {final_eq:.2f}, MaxDD: {max_dd:.2%}")

=== FILE: rl\train_ppo.py ===

# -*- coding: utf-8 -*-
import argparse, yaml, json
import pandas as pd
from pathlib import Path
from stable_baselines3 import PPO
from stable_baselines3.common.vec_env import DummyVecEnv, VecNormalize, VecMonitor, sync_envs_normalization
from stable_baselines3.common.callbacks import EvalCallback
from stable_baselines3.common.utils import set_random_seed
from gymnasium.wrappers import TimeLimit
from env_xau import XauTradingEnv

parser = argparse.ArgumentParser()
parser.add_argument('--timesteps', type=int, default=1500000)
parser.add_argument('--seed', type=int, default=42)
parser.add_argument('--eval_freq', type=int, default=100000)
parser.add_argument('--n_eval_episodes', type=int, default=1)
parser.add_argument('--max_train_steps', type=int, default=6000)
parser.add_argument('--max_eval_steps', type=int, default=3000)
args = parser.parse_args()

cfg = yaml.safe_load(open('config.yaml','r',encoding='utf-8'))
FEAT = cfg['files']['features_csv']
MODEL_PATH = Path(cfg['files']['model_path'])
VECNORM_PATH = Path(cfg.get('files',{}).get('vecnorm_path','models/vecnorm_xauusd_m5.pkl'))
WINDOW = int(cfg.get('window',128))
COSTS = cfg['costs']
ENV_CFG = cfg.get('env',{})
REWARD_MODE = ENV_CFG.get('reward_mode', cfg.get('reward_mode','pct'))
FLIP_PENALTY = float(ENV_CFG.get('flip_penalty', cfg.get('flip_penalty',0.0)))
TRADE_HOURS = ENV_CFG.get('trade_hours_utc', cfg.get('trade_hours_utc', None))
MIN_EQ = float(ENV_CFG.get('min_equity', 0.8))

df = pd.read_csv(FEAT, parse_dates=['time'])
cut_val = df['time'].max() - pd.Timedelta(days=30)
train_df = df[df['time'] < cut_val].copy()
val_df   = df[df['time'] >= cut_val].copy()

features_spec = None
fspec = Path('models/features_spec.json')
if fspec.exists():
    features_spec = json.loads(fspec.read_text(encoding='utf-8')).get('feature_columns', None)

set_random_seed(args.seed)

def make_train():
    env = XauTradingEnv(train_df, window=WINDOW,
        spread_abs=COSTS['spread_abs'], commission_rate=COSTS['commission_rate'], slippage_k=COSTS['slippage_k'],
        reward_mode=REWARD_MODE, use_close_norm=True, flip_penalty=FLIP_PENALTY, trade_hours_utc=TRADE_HOURS,
        enforce_flat_outside_hours=True, features_spec=features_spec, min_equity=MIN_EQ)
    return TimeLimit(env, max_episode_steps=args.max_train_steps)

def make_eval():
    env = XauTradingEnv(val_df, window=WINDOW,
        spread_abs=COSTS['spread_abs'], commission_rate=COSTS['commission_rate'], slippage_k=COSTS['slippage_k'],
        reward_mode=REWARD_MODE, use_close_norm=True, flip_penalty=0.0, trade_hours_utc=TRADE_HOURS,
        enforce_flat_outside_hours=True, features_spec=features_spec, min_equity=MIN_EQ)
    return TimeLimit(env, max_episode_steps=args.max_eval_steps)

venv_train = DummyVecEnv([make_train]); venv_train = VecMonitor(venv_train); venv_train = VecNormalize(venv_train, norm_obs=True, norm_reward=True, clip_obs=10.0, clip_reward=10.0)
venv_eval  = DummyVecEnv([make_eval]);  venv_eval  = VecMonitor(venv_eval);  venv_eval  = VecNormalize(venv_eval, training=False, norm_obs=True, norm_reward=False)

policy_kwargs = dict(net_arch=dict(pi=[128,128], vf=[128,128]))
try:
    import tensorboard as _tb
    tb_log_dir = 'logs/ppo_gold_m5'
except Exception:
    tb_log_dir = None

model = PPO('MlpPolicy', venv_train, n_steps=4096, batch_size=256, learning_rate=3e-4, ent_coef=0.02,
            policy_kwargs=policy_kwargs, seed=args.seed, verbose=1, tensorboard_log=tb_log_dir)

sync_envs_normalization(venv_eval, venv_train)
eval_cb = EvalCallback(venv_eval, best_model_save_path=str(MODEL_PATH.parent), log_path='logs/eval',
                       eval_freq=max(args.eval_freq,1), n_eval_episodes=max(args.n_eval_episodes,1),
                       deterministic=True, render=False)

model.learn(total_timesteps=args.timesteps, callback=eval_cb)
MODEL_PATH.parent.mkdir(parents=True, exist_ok=True)
model.save(str(MODEL_PATH))
venv_train.save(str(VECNORM_PATH))
print(f"Saved model: {MODEL_PATH}")
print(f"Saved VecNormalize: {VECNORM_PATH}")


=== FILE: rl\walk_forward.py ===

# -*- coding: utf-8 -*-
import argparse, yaml, json
import pandas as pd, numpy as np
from pathlib import Path
from gymnasium.wrappers import TimeLimit
from stable_baselines3 import PPO
from stable_baselines3.common.vec_env import DummyVecEnv, VecNormalize, VecMonitor
from env_xau import XauTradingEnv

parser = argparse.ArgumentParser()
parser.add_argument('--segments', type=int, default=6)
parser.add_argument('--train_days', type=int, default=120)
parser.add_argument('--val_days', type=int, default=30)
parser.add_argument('--timesteps', type=int, default=500000)
parser.add_argument('--seed', type=int, default=42)
parser.add_argument('--out_dir', type=str, default='reports_wf')
args = parser.parse_args()

cfg = yaml.safe_load(open('config.yaml','r',encoding='utf-8'))
FEAT = cfg['files']['features_csv']
WINDOW = int(cfg.get('window',128))
COSTS = cfg['costs']
ENV_CFG = cfg.get('env',{})
REWARD_MODE = ENV_CFG.get('reward_mode', cfg.get('reward_mode','pct'))
FLIP_PENALTY = float(ENV_CFG.get('flip_penalty', cfg.get('flip_penalty',0.0)))
TRADE_HOURS = ENV_CFG.get('trade_hours_utc', cfg.get('trade_hours_utc', None))
MIN_EQ = float(ENV_CFG.get('min_equity', 0.8))

out = Path(args.out_dir); out.mkdir(parents=True, exist_ok=True)
df = pd.read_csv(FEAT, parse_dates=['time']).sort_values('time').reset_index(drop=True)
end_time = df['time'].max()

features_spec=None
fspec = Path('models/features_spec.json')
if fspec.exists(): features_spec = json.loads(fspec.read_text(encoding='utf-8')).get('feature_columns', None)

rows=[]
for k in range(args.segments):
    val_end = end_time - pd.Timedelta(days=k*args.val_days)
    val_start = val_end - pd.Timedelta(days=args.val_days)
    train_end = val_start
    train_start = train_end - pd.Timedelta(days=args.train_days)
    tr = df[(df['time']>=train_start)&(df['time']<train_end)].copy()
    va = df[(df['time']>=val_start)&(df['time']<val_end)].copy()
    if len(tr)<=WINDOW or len(va)<=WINDOW: continue

    def make_train():
        env = XauTradingEnv(tr, window=WINDOW, spread_abs=COSTS['spread_abs'], commission_rate=COSTS['commission_rate'], slippage_k=COSTS['slippage_k'],
            reward_mode=REWARD_MODE, use_close_norm=True, flip_penalty=FLIP_PENALTY, trade_hours_utc=TRADE_HOURS,
            enforce_flat_outside_hours=True, features_spec=features_spec, min_equity=MIN_EQ)
        return TimeLimit(env, max_episode_steps=6000)

    def make_eval():
        env = XauTradingEnv(va, window=WINDOW, spread_abs=COSTS['spread_abs'], commission_rate=COSTS['commission_rate'], slippage_k=COSTS['slippage_k'],
            reward_mode=REWARD_MODE, use_close_norm=True, flip_penalty=0.0, trade_hours_utc=TRADE_HOURS,
            enforce_flat_outside_hours=True, features_spec=features_spec, min_equity=MIN_EQ)
        return TimeLimit(env, max_episode_steps=3000)

    vt = DummyVecEnv([make_train]); vt = VecMonitor(vt); vt = VecNormalize(vt, norm_obs=True, norm_reward=True)
    ve = DummyVecEnv([make_eval]);  ve = VecMonitor(ve)

    model = PPO('MlpPolicy', vt, n_steps=4096, batch_size=256, learning_rate=3e-4, ent_coef=0.02, seed=args.seed, verbose=0)
    model.learn(total_timesteps=args.timesteps)

    tmp = out/f'vecnorm_{k}.pkl'; vt.save(str(tmp))
    ve = VecNormalize.load(str(tmp), ve); ve.training=False; ve.norm_reward=False

    obs = ve.reset(); eq=[]; trace=[]; done=False
    while not done:
        action,_=model.predict(obs, deterministic=True)
        obs, rewards, dones, infos = ve.step(action)
        equity = ve.get_attr('equity', indices=0)[0]
        eq.append(float(equity))
        info0=infos[0] if isinstance(infos,(list,tuple)) else infos
        trace.append({'k':k,'time':str(info0.get('time','')),'price':info0.get('price',np.nan),'pos':info0.get('pos',np.nan),'equity':equity,
                      'action':int(action[0]) if hasattr(action,'__len__') else int(action)})
        done = bool(dones[0])

    s = pd.Series(eq); final_eq=float(s.iloc[-1]); min_eq=float(s.min()); peak=s.cummax(); max_dd=float((s/peak-1.0).min())
    rows.append({'k':k,'train_start':train_start,'train_end':train_end,'val_start':val_start,'val_end':val_end,'final_eq':final_eq,'min_eq':min_eq,'max_dd':max_dd,'n_steps':int(len(s))})
    pd.DataFrame(trace).to_csv(out/f'fold_{k}_trace.csv', index=False)

res = pd.DataFrame(rows).sort_values('k'); res.to_csv(out/'wf_results.csv', index=False)
if res.empty:
    txt=['# Walk-Forward Report','No results (windows too short?).']
else:
    agg={'folds':len(res),'final_eq_med':float(res['final_eq'].median()),'max_dd_med':float(res['max_dd'].median()),'n_steps_sum':int(res['n_steps'].sum())}
    txt=['# Walk-Forward Report',f"Folds: {agg['folds']}",f"Median Final Equity: {agg['final_eq_med']:.4f}",f"Median MaxDD: {agg['max_dd_med']:.2%}",f"Total steps: {agg['n_steps_sum']}"]
(out/'wf_report.txt').write_text('\n'.join(txt), encoding='utf-8')
print("Saved walk-forward results.")


=== FILE: rl\__init__.py ===



=== FILE: utils\atomic.py ===

from pathlib import Path

def atomic_write_csv(df, path: str):
    p = Path(path)
    p.parent.mkdir(parents=True, exist_ok=True)
    tmp = p.with_suffix(p.suffix + ".tmp")
    df.to_csv(tmp, index=False)
    tmp.replace(p)


=== FILE: utils\calibration.py ===

# utils/calibration.py
# -*- coding: utf-8 -*-
import argparse, yaml, pandas as pd, numpy as np
from pathlib import Path

parser = argparse.ArgumentParser()
parser.add_argument('--apply', action='store_true', help='Nadpisz config.yaml sugerowanymi kosztami')
parser.add_argument('--ticks_csv', type=str, default=None, help='Ścieżka do CSV z tickami (domyślnie z config.yaml)')
parser.add_argument('--bars_csv', type=str, default=None, help='Ścieżka do CSV ze świecami (domyślnie z config.yaml)')
args = parser.parse_args()

cfg = yaml.safe_load(open('config.yaml','r',encoding='utf-8'))
TICKS = args.ticks_csv or cfg['files']['ticks_csv']
BARS  = args.bars_csv  or cfg['files']['bars_csv']

ticks = pd.read_csv(TICKS, parse_dates=['time'])
ticks['spread'] = ticks['ask'] - ticks['bid']
mid = (ticks['ask'] + ticks['bid']) / 2.0
dmid = mid.diff().abs()

spread_median = float(ticks['spread'].median())
spread_p95    = float(ticks['spread'].quantile(0.95))
bars = pd.read_csv(BARS, parse_dates=['time'])
bar_move_med = float(bars['close'].diff().abs().median())

# Slippage ~ median|Δmid| jako proporcja do mediany ruchu barowego (ucięta do sensownych widełek)
slippage_k = float(np.clip(dmid.median() / max(bar_move_med, 1e-12), 0.0, 0.5))

Path('reports').mkdir(parents=True, exist_ok=True)
Path('reports/costs_suggestion.yaml').write_text(
    yaml.safe_dump(
        {
            'spread_abs_median': round(spread_median, 5),
            'spread_abs_p95': round(spread_p95, 5),
            'slippage_k_suggested': round(slippage_k, 3),
        },
        allow_unicode=True, sort_keys=False
    ),
    encoding='utf-8'
)
print("Saved: reports/costs_suggestion.yaml")

if args.apply:
    cfg.setdefault('costs', {})
    cfg['costs']['spread_abs']   = round(spread_median, 5)
    cfg['costs']['slippage_k']   = round(slippage_k, 3)
    Path('config.yaml').write_text(yaml.safe_dump(cfg, allow_unicode=True, sort_keys=False), encoding='utf-8')
    print("Applied suggestions to config.yaml")

=== FILE: utils\make_report.py ===

# -*- coding: utf-8 -*-
import argparse, base64
from pathlib import Path
import pandas as pd, numpy as np
import matplotlib.pyplot as plt
from datetime import datetime

parser = argparse.ArgumentParser()
parser.add_argument('--equity_csv', type=str, default='reports/eval_trace.csv')
parser.add_argument('--metrics', type=str, default='reports/val_metrics.txt')
parser.add_argument('--figure', type=str, default='reports/equity_val.png')
parser.add_argument('--out_html', type=str, default='reports/report.html')
parser.add_argument('--out_txt', type=str, default='reports/report.txt')
parser.add_argument('--bars_per_day', type=int, default=288)
parser.add_argument('--trading_days', type=int, default=252)
args = parser.parse_args()

out_html = Path(args.out_html)
out_txt  = Path(args.out_txt)
out_html.parent.mkdir(parents=True, exist_ok=True)
out_txt.parent.mkdir(parents=True, exist_ok=True)

eq = None
p = Path(args.equity_csv)
if p.exists():
    df = pd.read_csv(p)
    if 'equity' in df.columns:
        eq = df['equity'].astype(float).to_numpy()
    elif df.shape[1] == 1:
        eq = df.iloc[:, 0].astype(float).to_numpy()

metrics_text = Path(args.metrics).read_text(encoding='utf-8') if Path(args.metrics).exists() else ''

img_b64 = ''
if Path(args.figure).exists():
    img_b64 = base64.b64encode(Path(args.figure).read_bytes()).decode('ascii')

# Jeśli nie ma obrazka, wygeneruj go z danych equity
if not img_b64 and eq is not None and len(eq) > 1:
    fig, ax = plt.subplots(figsize=(9, 4))
    ax.plot(eq, color='#0057B8', lw=1.5)
    ax.set_title('Equity (validation)')
    ax.set_xlabel('Steps')
    ax.set_ylabel('Equity')
    fig.tight_layout()
    Path(args.figure).parent.mkdir(parents=True, exist_ok=True)
    fig.savefig(args.figure, dpi=144)
    plt.close(fig)
    img_b64 = base64.b64encode(Path(args.figure).read_bytes()).decode('ascii')

# Dodatkowe metryki
extra = {}
if eq is not None and len(eq) > 2:
    ret = np.diff(eq) / np.maximum(eq[:-1], 1e-12)
    mu = float(np.nanmean(ret))
    sigma = float(np.nanstd(ret) + 1e-12)
    downside = ret[ret < 0]
    ds = float(np.nanstd(downside) + 1e-12)

    daily_mu = mu * args.bars_per_day
    daily_sigma = sigma * (args.bars_per_day ** 0.5)
    sharpe = daily_mu / (daily_sigma + 1e-12)
    sortino = daily_mu / (((args.bars_per_day ** 0.5) * ds) + 1e-12)

    n = len(eq)
    years = max(n / args.bars_per_day / args.trading_days, 1e-6)
    cagr = (eq[-1] / max(eq[0], 1e-12)) ** (1 / years) - 1 if years > 0 else 0.0
    peak = np.maximum.accumulate(eq)
    max_dd = float((eq / peak - 1.0).min())
    calmar = (cagr / abs(max_dd)) if max_dd < 0 else float('inf')

    extra = dict(
        n_steps=n,
        sharpe_daily=sharpe,
        sortino_daily=sortino,
        vol_daily=daily_sigma,
        cagr=cagr,
        max_dd=max_dd,
        calmar=calmar
    )

now = datetime.now().strftime('%Y-%m-%d %H:%M:%S')

md = [
    '# RL Validation Report (XAUUSD M5)',
    f'Date: {now}',
    '',
    '## Base metrics',
    '',
    metrics_text.strip() if metrics_text else '(no val_metrics.txt)',
    '',
    ''
]

if extra:
    md += [
        '## Extra metrics from equity',
        f"- Steps: {extra['n_steps']}",
        f"- Sharpe (daily): {extra['sharpe_daily']:.3f}",
        f"- Sortino (daily): {extra['sortino_daily']:.3f}",
        f"- Daily vol: {extra['vol_daily']:.4f}",
        f"- CAGR (est.): {extra['cagr']:.3%}",
        f"- MaxDD: {extra['max_dd']:.2%}",
        f"- Calmar: {extra['calmar']:.3f}",
    ]
else:
    md += ['No equity data.']

out_txt.write_text('\n'.join(md) + '\n', encoding='utf-8')

html = f"""RL Validation
RL Validation Report (XAUUSD M5)
Base metrics
{metrics_text if metrics_text else '(no val_metrics.txt)'}
Extra metrics
{('\n'.join(md)) if extra else 'No equity data.'}
Equity
{('data:image/png;base64,' + img_b64) if img_b64 else 'No plot.'}
Generated: {now}
"""
out_html.write_text(html, encoding='utf-8')
print('Saved report.')

=== FILE: utils\mt5_health.py ===

import MetaTrader5 as mt5
import time

def ensure_mt5_ready(retries=3, sleep_s=2):
    """Ponawia initialize i weryfikuje, że terminal + konto są gotowe."""
    for i in range(retries):
        if mt5.initialize():
            ti, ai = mt5.terminal_info(), mt5.account_info()
            if ti and ai and getattr(ai, "login", 0):
                return True
            mt5.shutdown()
        time.sleep(sleep_s * (i + 1))
    return False


=== FILE: utils\qc_bars.py ===

#!/usr/bin/env python
import pandas as pd, argparse
parser=argparse.ArgumentParser(); parser.add_argument('--csv', required=True); parser.add_argument('--tf_min', type=int, default=5)
args=parser.parse_args()
df=pd.read_csv(args.csv, parse_dates=['time']).sort_values('time').reset_index(drop=True)
print(f"Rows: {len(df)}\nFrom: {df['time'].iloc[0]} To: {df['time'].iloc[-1]}")
dt=(df['time'].diff().dt.total_seconds()/60).fillna(args.tf_min)
gaps=df.loc[dt>args.tf_min+0.1,['time']].copy(); gaps['gap_min']=dt[dt>args.tf_min+0.1].values
print(f"Gaps > {args.tf_min} min: {len(gaps)}");
if len(gaps): print(gaps.head(10))


=== FILE: utils\time_utils.py ===

from datetime import datetime, timezone
def now_utc(): return datetime.now(timezone.utc)


=== FILE: utils\__init__.py ===



=== FILE: _backup_py\env_xau.py ===

-- coding: utf-8 --
import numpy as np, pandas as pd
import gymnasium as gym
from gymnasium import spaces
from datetime import time as dtime
class XauTradingEnv(gym.Env):
metadata = {"render_modes": []}
def init(self, df: pd.DataFrame, window=128,
spread_abs=0.05, commission_rate=0.0001, slippage_k=0.10,
reward_mode: str = "pct", use_close_norm: bool = True,
flip_penalty: float = 0.0, trade_hours_utc=None,
enforce_flat_outside_hours: bool = True, features_spec: list | None = None,
min_equity: float = 0.8):
super().init()
self.df = df.reset_index(drop=True)
self.window = int(window)
self.spread_abs = float(spread_abs)
self.commission_rate = float(commission_rate)
self.slippage_k = float(slippage_k)
assert reward_mode in {"pct","points"}
self.reward_mode = reward_mode
self.use_close_norm = use_close_norm
self.flip_penalty = float(flip_penalty)
self.enforce_flat_outside = bool(enforce_flat_outside_hours)
self.min_equity = float(min_equity)
self.trade_hours = None
if trade_hours_utc and isinstance(trade_hours_utc,(list,tuple)) and len(trade_hours_utc)==2:
try:
s = [int(x) for x in str(trade_hours_utc[0]).split(":")]
e = [int(x) for x in str(trade_hours_utc[1]).split(":")]
self.trade_hours = (dtime(s[0], s[1] if len(s)>1 else 0), dtime(e[0], e[1] if len(e)>1 else 0))
except Exception:
self.trade_hours = None
base_cols = ['open','high','low','close','tick_volume','spread','time']
if features_spec is not None:
missing = [c for c in features_spec if c not in self.df.columns]
if missing: raise ValueError(f"Missing feature columns: {missing}")
self.feat_cols = list(features_spec)
else:
self.feat_cols = [c for c in self.df.columns if c not in base_cols]
self.price_col = 'close_norm' if (self.use_close_norm and 'close_norm' in self.df.columns) else 'close'
if len(self.df) <= self.window:
raise ValueError(f"Not enough rows: {len(self.df)} <= window {self.window}")
obs_dim = self.window * (1 + len(self.feat_cols)) + 2
self.action_space = spaces.Discrete(3)
self.observation_space = spaces.Box(low=-np.inf, high=np.inf, shape=(obs_dim,), dtype=np.float32)
self._start = self.window
self._i = None
self.pos = 0
self.entry = None
self.equity = 1.0
self.prev_eq = 1.0
def _in_trade_hours(self, ts)->bool:
if self.trade_hours is None: return True
try: t = ts.to_pydatetime().time()
except Exception: t = ts
start, end = self.trade_hours
if start <= end: return (t>=start) and (t<=end)
return (t>=start) or (t<=end)
def _obs(self):
sl = slice(self._i - self.window, self.i)
block_df = self.df.iloc[sl][[self.price_col] + self.feat_cols]
block = block_df.to_numpy(dtype=np.float32)
expected = 1 + len(self.feat_cols)
if block.shape != (self.window, expected):
raise RuntimeError(f"Bad window shape: {block.shape} vs {(self.window, expected)}")
flat = block.flatten()
price = float(self.df.iloc[self.i]['close'])
unreal = 0.0
if self.pos != 0 and self.entry is not None:
dir = 1 if self.pos>0 else -1
unreal = dir * (price - self.entry)
import numpy as np
return np.concatenate([flat, np.array([self.pos, unreal], dtype=np.float32)])
def reset(self, seed=None, options=None):
super().reset(seed=seed)
self._i = self._start
self.pos = 0; self.entry = None
self.equity = 1.0; self.prev_eq = 1.0
return self._obs(), {}
def step(self, action):
import numpy as np
if isinstance(action,(np.ndarray,list,tuple)): action = int(action[0])
else: action = int(action)
if not self.action_space.contains(action): raise ValueError("Invalid action")
info = {}
ts = self.df.iloc[self._i]['time']
inside = self._in_trade_hours(ts)
price = float(self.df.iloc[self.i]['close'])
prev = float(self.df.iloc[self.i-1]['close'])
slip = self.slippage_k * abs(price - prev)
desired = [-1,0,1][action]
if not inside and self.enforce_flat_outside: desired = 0
if desired != self.pos:
if self.pos != 0 and desired != 0 and np.sign(self.pos) != np.sign(desired) and self.flip_penalty>0:
if self.reward_mode == 'pct': self.equity *= max(1.0 - self.flip_penalty, 1e-6)
else: self.equity -= self.flip_penalty
info['flip_penalty'] = float(self.flip_penalty)
if self.pos != 0 and self.entry is not None:
cost = (self.spread_abs + slip)/max(price,1e-12) + self.commission_rate
if self.reward_mode == 'pct': self.equity *= max(1.0 - cost, 1e-6)
else: self.equity -= cost
self.pos = desired
if self.pos != 0:
cost = (self.spread_abs + slip)/max(price,1e-12) + self.commission_rate
if self.reward_mode == 'pct': self.equity *= max(1.0 - cost, 1e-6)
else: self.equity -= cost
self.entry = price
else:
self.entry = None
if self.reward_mode == 'pct':
step_ret = 0.0
if self.pos != 0:
dir = 1 if self.pos>0 else -1
step_ret = dir * ((price/max(prev,1e-12)) - 1.0)
self.equity *= (1.0 + step_ret)
reward = float(self.equity - self.prev_eq)
else:
reward = float(self.equity - self.prev_eq)
self.prev_eq = self.equity
self._i += 1
terminated = bool(self._i >= len(self.df) - 1)
truncated = False
if self.equity <= self.min_equity:
truncated = True
info['early_stop'] = True
info.update({'time': ts, 'price': price, 'pos': int(self.pos), 'equity': float(self.equity), 'inside_hours': bool(inside)})
return self._obs(), reward, terminated, truncated, info


=== FILE: _backup_py\fetch__mt5_data.py ===

# -*- coding: utf-8 -*-
"""
Fetch bars & 24h tick sample from MT5 (demo/real). Incremental merge to maintain 720d.
Atomic CSV writes, Retries/backoff, Weekend-safe ticks (warn only)
"""
import MetaTrader5 as mt5
import pandas as pd
from datetime import datetime, timedelta, timezone
import yaml
from pathlib import Path
import numpy as np, time
from utils.atomic import atomic_write_csv
from utils.mt5_health import ensure_mt5_ready

cfg = yaml.safe_load(open('config.yaml','r',encoding='utf-8'))
SYMBOL = cfg['symbol']
BARS_CSV = cfg['files']['bars_csv']
TICKS_CSV = cfg['files']['ticks_csv']
HISTORY_DAYS = int(cfg.get('history_days', 720))
TF_MAP={'M1': mt5.TIMEFRAME_M1,'M5': mt5.TIMEFRAME_M5,'M15': mt5.TIMEFRAME_M15}
TF_NAME = cfg.get('timeframe','M5')
TF = TF_MAP.get(TF_NAME, mt5.TIMEFRAME_M5)
CHUNK = int(cfg.get('mt5',{}).get('bars_chunk', 20000))
UPDATE_DAYS = int(cfg.get('mt5',{}).get('update_days', 60))

def init_mt5():
    # inicjalizacja + czytelny komunikat, gdy terminal/konto nie są gotowe
    if not ensure_mt5_ready():
        last_err = mt5.last_error()
        raise RuntimeError(f"MT5 not ready (terminal/account). Start MT5 and login to a demo/real account. last_error={last_err}")
    term = mt5.terminal_info(); acc = mt5.account_info()
    parts=[]
    if getattr(term,"company",None): parts.append(f"Company={term.company}")
    if getattr(term,"name",None): parts.append(f"TerminalName={term.name}")
    if getattr(acc,"login",0): parts.append(f"Login={acc.login}")
    if getattr(acc,"server",None): parts.append(f"Server={acc.server}")
    if getattr(acc,"name",None): parts.append(f"AccountName={acc.name}")
    print("[MT5] " + " | ".join(parts) if parts else "[MT5] initialized")

def ensure_symbol(symbol: str)->bool:
    info = mt5.symbol_info(symbol)
    if info is None:
        mt5.symbol_select(symbol, True)
        info = mt5.symbol_info(symbol)
    if info is None: return False
    if not info.visible:
        if not mt5.symbol_select(symbol, True): return False
    return True

def with_retries(fn, attempts=3, sleep_s=2, *a, **kw):
    last=None
    for i in range(attempts):
        try:
            return fn(*a, **kw)
        except Exception as e:
            last = e
            time.sleep(sleep_s*(i+1))
    if last: raise last

def _to_df(rates):
    df = pd.DataFrame(rates)
    if df.empty: return df
    df['time'] = pd.to_datetime(df['time'], unit='s', utc=True)
    if 'real_volume' in df.columns:
        df.rename(columns={'real_volume':'tick_volume'}, inplace=True)
    cols=['time','open','high','low','close','tick_volume','spread']
    return df[cols].sort_values('time').drop_duplicates('time')

def fetch_range(symbol, timeframe, utc_from, utc_to):
    rates = mt5.copy_rates_range(symbol, timeframe, utc_from, utc_to)
    if rates is None or len(rates)==0:
        last_err = mt5.last_error()
        raise RuntimeError(f"copy_rates_range empty for '{symbol}'. last_error={last_err}")
    return _to_df(rates)

def fetch_from_pos_tail(symbol, timeframe, count):
    rates = mt5.copy_rates_from_pos(symbol, timeframe, 0, count)
    if rates is None or len(rates)==0:
        last_err = mt5.last_error()
        raise RuntimeError(f"copy_rates_from_pos empty for '{symbol}'. last_error={last_err}")
    return _to_df(rates)

def load_existing_bars(path: str):
    p = Path(path)
    if not p.exists(): return None
    try:
        df = pd.read_csv(p, parse_dates=['time'])
        if df.empty: return None
        return df.sort_values('time').drop_duplicates('time').reset_index(drop=True)
    except Exception:
        return None

def merge_clip(existing: pd.DataFrame | None, new_df: pd.DataFrame, keep_days:int)->pd.DataFrame:
    if existing is None or existing.empty:
        base = new_df.copy()
    else:
        base = (pd.concat([existing, new_df], ignore_index=True)
                .drop_duplicates('time').sort_values('time'))
    cutoff = datetime.now(timezone.utc) - timedelta(days=keep_days+1)
    base = base[base['time'] >= pd.Timestamp(cutoff)]
    return base.reset_index(drop=True)

def fetch_bars_incremental(symbol, timeframe, keep_days:int, update_days:int)->pd.DataFrame:
    existing = load_existing_bars(BARS_CSV)
    if existing is None:
        to = datetime.now(timezone.utc); frm = to - timedelta(days=keep_days+2)
        df = with_retries(lambda: fetch_range(symbol, timeframe, frm, to))
        if len(df) < 1000:
            tail = with_retries(lambda: fetch_from_pos_tail(symbol, timeframe, CHUNK))
            df = merge_clip(df, tail, keep_days)
        return df
    to = datetime.now(timezone.utc); frm = to - timedelta(days=max(2, update_days))
    fresh = with_retries(lambda: fetch_range(symbol, timeframe, frm, to))
    merged = merge_clip(existing, fresh, keep_days)
    return merged

def fetch_ticks(symbol: str, hours: int=24)->pd.DataFrame:
    utc_to = datetime.now(timezone.utc)
    utc_from = utc_to - timedelta(hours=hours)
    ticks = mt5.copy_ticks_range(symbol, utc_from, utc_to, mt5.COPY_TICKS_ALL)
    if ticks is None or len(ticks)==0:
        last_err = mt5.last_error()
        raise RuntimeError(f"No MT5 ticks for '{symbol}'. last_error={last_err}")
    tdf = pd.DataFrame(ticks)
    tdf['time'] = pd.to_datetime(tdf['time'], unit='s', utc=True)
    return tdf[['time','bid','ask','last','volume']]

def suggest_costs(tdf: pd.DataFrame)->dict:
    spr = (tdf['ask'] - tdf['bid']).astype(float).replace([np.inf,-np.inf], np.nan).dropna()
    med_spread = float(np.median(spr)) if len(spr) else 0.0
    p75_spread = float(np.percentile(spr, 75)) if len(spr) else 0.0
    mid = (tdf['ask'] + tdf['bid'])/2.0
    dm = (mid.diff().abs()).replace([np.inf,-np.inf], np.nan).dropna()
    med_dm = float(np.median(dm)) if len(dm) else 0.0
    med_price = float(np.nanmedian(mid)) if len(mid) else 1.0
    slippage_k = float(min(max(med_dm / max(med_price, 1e-12), 0.0), 0.01))
    return {'spread_abs_median': round(med_spread,5), 'spread_abs_p75': round(p75_spread,5), 'slippage_k_suggested': round(slippage_k,4)}

def main():
    init_mt5()
    try:
        print(f"[CFG] symbol={SYMBOL} tf={TF_NAME} keep_days={HISTORY_DAYS} update_days={UPDATE_DAYS}")
        if not ensure_symbol(SYMBOL):
            raise SystemExit(
                "Symbol not found or not visible in Market Watch. "
                "Open Symbols window in MT5 and SHOW the instrument."
            )
        bars = fetch_bars_incremental(SYMBOL, TF, keep_days=HISTORY_DAYS, update_days=UPDATE_DAYS)
        assert {'time','open','high','low','close'}.issubset(bars.columns), "Bars frame malformed"
        assert len(bars) > 100, "Too few bars"
        atomic_write_csv(bars, BARS_CSV)
        print(f"Saved bars: {BARS_CSV} ({len(bars)})")
        # ticks są opcjonalne (weekend-safe)
        try:
            ticks = with_retries(lambda: fetch_ticks(SYMBOL, hours=24))
            atomic_write_csv(ticks, TICKS_CSV)
            print(f"Saved ticks: {TICKS_CSV} ({len(ticks)})")
            sugg = suggest_costs(ticks)
            Path('reports').mkdir(parents=True, exist_ok=True)
            Path('reports/costs_suggestion.yaml').write_text(
                yaml.safe_dump(sugg, allow_unicode=True, sort_keys=False), encoding='utf-8')
            print("Cost suggestions -> reports/costs_suggestion.yaml")
        except Exception as e:
            print(f"[warn] ticks unavailable ({e}); keeping previous {TICKS_CSV}")
    finally:
        mt5.shutdown()

if __name__ == '__main__':
    main()

=== FILE: _backup_py\quick_env_test.py ===

import yaml, pandas as pd
from env_xau import XauTradingEnv
cfg=yaml.safe_load(open('config.yaml','r',encoding='utf-8'))
df=pd.read_csv(cfg['files']['features_csv'], parse_dates=['time']).sort_values('time').reset_index(drop=True)
df=df.tail(max(int(cfg.get('window',128))+256,512))
env=XauTradingEnv(df, window=int(cfg.get('window',128)),
spread_abs=cfg['costs']['spread_abs'], commission_rate=cfg['costs']['commission_rate'], slippage_k=cfg['costs']['slippage_k'],
reward_mode=cfg.get('env',{}).get('reward_mode', cfg.get('reward_mode','pct')), use_close_norm=True,
min_equity=float(cfg.get('env',{}).get('min_equity',0.8)))
obs,info=env.reset(); print('reset OK', len(obs))
obs,r,term,trunc,info=env.step(1); print('step OK', r, term, trunc)
